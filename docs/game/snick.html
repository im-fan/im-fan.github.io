<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>game-snick</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style>
        body {
            /* ä»¥ä¸­å¿ƒç‚¹å¾€å››å‘¨è¾¹ç¼˜æ¸å˜è‰²ï¼Œä»é»‘è‰²æ¸å˜åˆ°ç™½è‰² */
            background: radial-gradient(circle at center, black, rgb(63, 62, 62));
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            /* æ¯›ç»ç’ƒèƒŒæ™¯ */
            backdrop-filter: blur(10px);
        }

        #game-board {
            position: relative;
            width: 400px;
            height: 400px;
            /* è¾¹ç¼˜åœ†è§’,1px,ç™½è‰² */
            border: 1px solid white;
            border-radius: 20px;
            /* é€æ˜èƒŒæ™¯è‰² */
            background-color: transparent;
        }

        .snake {
            position: absolute;
            width: 20px;
            height: 20px;
        }

        .snake-head {
            /* background-color: red; */
        }

        .food {
            position: absolute;
            width: 20px;
            height: 20px;
            font-size: 18px;
            line-height: 20px;
            text-align: center;
            color: white;
        }

        #count {
            /* å­—ä½“é¢œè‰²ç™½è‰²ï¼Œå¤§å°18 */
            color: white;
            font-size: 18px;
            border: 1px solid white;
            border-radius: 10px;
            /* æ–‡å­—é å³ */
            text-align: center;
            width: 100px;
            /* è·ç¦»å³è¾¹0px */
            margin-left: 300px;
        }

    </style>
</head>
<body>
<!-- ç”¨ä¸€ä¸ªæ— è¾¹æ¡†çš„divæ¡†å°†ä¸¤ä¸ªdivåŒ…è£¹èµ·æ¥ï¼Œå¹¶å½¢æˆcountåœ¨ä¸Šï¼Œgame-boardæ¡†åœ¨ä¸‹ -->
<div>
    <!-- æ·»åŠ ä¸€ä¸ªè®¡æ•°æ¿,ç”¨äºæ˜¾ç¤ºè›‡åƒåˆ°çš„é£Ÿç‰©çš„æ•°é‡-->
    <div id="count"></div>

    <div id="game-board"></div>
</div>


<script>
    //æ·»åŠ ä¸€ä¸ªè®¡æ•°æ¿,ç”¨äºæ˜¾ç¤ºè›‡åƒåˆ°çš„é£Ÿç‰©çš„æ•°é‡
    const countDiv = document.getElementById('count');
    //è®¾ç½®åˆå§‹å†…å®¹
    countDiv.innerHTML = "åˆ†æ•°: 0";
    let foodCount = 0;

    // æ¸¸æˆé¢æ¿å¤§å°
    const boardSize = 20;
    const board = document.getElementById('game-board');

    // è›‡åˆå§‹ä½ç½®å’Œç§»åŠ¨æ–¹å‘
    let snake = [{ x: 10, y: 10 }];
    let direction = { x: 0, y: 0 };

    // éšæœºç”Ÿæˆé£Ÿç‰©
    let food = generateFood();

    //æ¯æ¬¡ç§»åŠ¨çš„åƒç´ å€¼
    const stepPx = 0.5;

    // é”®ç›˜äº‹ä»¶ç›‘å¬ï¼Œæ”¹å˜è›‡çš„ç§»åŠ¨æ–¹å‘
    document.addEventListener('keydown', changeDirection)

    // æ¸¸æˆä¸»å¾ªç¯,æ¯éš”200æ¯«ç§’æ‰§è¡Œä¸€æ¬¡,æ¸¸æˆç»“æŸååœæ­¢å¾ªç¯
    let loopFlag = setInterval(gameLoop, 200);

    function gameLoop() {
        // ç§»åŠ¨è›‡å¤´
        const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
        snake.unshift(head);

        // åˆ¤æ–­æ˜¯å¦åƒåˆ°é£Ÿç‰©
        if (head.x === food.x && head.y === food.y) {
            // å¦‚æœåƒåˆ°é£Ÿç‰©ï¼Œç”Ÿæˆæ–°çš„é£Ÿç‰©
            food = generateFood();
            foodCount++;
            countDiv.innerHTML = "åˆ†æ•°: "+foodCount;
        } else {
            // å¦‚æœæ²¡æœ‰åƒåˆ°é£Ÿç‰©ï¼Œç§»é™¤è›‡å°¾
            snake.pop();
        }

        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ,ç»“æŸåä¿æŒå½“å‰é¡µé¢å¹¶é€€å‡ºå¾ªç¯
        if (isGameOver()) {
            console.log('æ¸¸æˆç»“æŸ,Enteré”®ç»§ç»­æ¸¸æˆ');

            //æŒ‰ä¸‹å›è½¦é”®åç»§ç»­
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    location.reload();
                }
            });

            //è›‡åœæ­¢åœ¨å½“å‰ä½ç½®
            clearInterval(loopFlag);
        }
        // æ›´æ–°æ¸¸æˆé¢æ¿å…ƒç´ 
        updateBoard();
    }

    function generateFood() {
        const food = {
            x: Math.floor(Math.random() * boardSize),
            y: Math.floor(Math.random() * boardSize)
        };
        return food;
    }

    function updateBoard() {
        // æ¸…é™¤æ¸¸æˆé¢æ¿ä¸Šçš„æ‰€æœ‰å…ƒç´ 
        board.innerHTML = '';

        // ç»˜åˆ¶è›‡çš„èº«ä½“
        snake.forEach((segment, index) => {
            const snakeElement = document.createElement('div');
            snakeElement.className = `snake ${index === 0 ? 'snake-head' : ''}`;
            snakeElement.innerHTML = 'ğŸ˜ˆ';
            snakeElement.style.left = segment.x * 20 + 'px';
            snakeElement.style.top = segment.y * 20 + 'px';
            board.appendChild(snakeElement);
        });

        // ç»˜åˆ¶é£Ÿç‰©
        const foodElement = document.createElement('div');
        foodElement.className = 'food';
        foodElement.innerHTML = 'ğŸ';
        foodElement.style.left = food.x * 20 + 'px';
        foodElement.style.top = food.y * 20 + 'px';
        board.appendChild(foodElement);
    }

    function changeDirection(event) {
        // console.log(event.key);
        switch (event.key) {
            //ä¸Šé”®æˆ–è€…é”®ç›˜ä¸Šçš„wé”®éƒ½å¯ä»¥å¾€ä¸Šèµ°
            case 'w':
            case 'ArrowUp':
                if (direction.y !== stepPx) {
                    direction = { x: 0, y: -stepPx };
                }
                break;
            case 's':
            case 'ArrowDown':
                if (direction.y !== -stepPx) {
                    direction = { x: 0, y: stepPx };
                }
                break;
            case 'a':
            case 'ArrowLeft':
                if (direction.x !== stepPx) {
                    direction = { x: -stepPx, y: 0 };
                }
                break;
            case 'd':
            case 'ArrowRight':
                if (direction.x !== -stepPx) {
                    direction = { x: stepPx, y: 0 };
                }
            default :
                direction = { x: stepPx, y: 0 };
                break;
        }
    }

    function isGameOver() {
        // æ£€æŸ¥è›‡æ˜¯å¦ç¢°åˆ°è¾¹ç•Œ
        const head = snake[0];

        if (head.x < 0 || head.x >= boardSize-stepPx || head.y <= 0 || head.y >= boardSize-stepPx) {
            //ä¿®æ”¹game-boardè¾¹æ¡†é¢œè‰²
            board.style.borderColor = 'red';
            return true;
        }

        // æ£€æŸ¥è›‡æ˜¯å¦ç¢°åˆ°è‡ªå·±
        for (let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) {
                return true;
            }
        }

        return false;
    }
</script>
</body>
</html>
