<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SpringBoot-EventStream</title>
      <link href="/2023/12/06/backend/spring/springboot-event-stream/"/>
      <url>/2023/12/06/backend/spring/springboot-event-stream/</url>
      
        <content type="html"><![CDATA[<h3 id="äº‹ä»¶æ¨é€å®ç°æ–¹å¼"><a href="#äº‹ä»¶æ¨é€å®ç°æ–¹å¼" class="headerlink" title="äº‹ä»¶æ¨é€å®ç°æ–¹å¼"></a>äº‹ä»¶æ¨é€å®ç°æ–¹å¼</h3><ul><li>WebSocket</li><li>SseEmitter</li></ul><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><table><thead><tr><th>å®ç°æ–¹å¼</th><th>å»ºç«‹è¿æ¥</th><th>ä¼ è¾“æ•ˆç‡</th><th>å…¼å®¹æ€§</th><th>ä¼ è¾“å†…å®¹</th><th>åŠŸèƒ½</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>WebSocket</td><td>é‡‡ç”¨åŒå·¥é€šä¿¡,å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹å®æ—¶çš„åŒå‘é€šä¿¡ä¿¡é“ã€‚</td><td>å»ºç«‹åä¿æŒè¿æ¥ä¸æ–­,æ•ˆç‡é«˜äºSSEã€‚</td><td>ç°ä»£æµè§ˆå™¨åŸºæœ¬å…¨é¢æ”¯æŒã€‚</td><td>æ”¯æŒä¼ è¾“æ–‡æœ¬ä»¥åŠäºŒè¿›åˆ¶æ•°æ®ã€‚</td><td>æ”¯æŒåŒå‘å…¨ duplex é€šä¿¡,å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ä¸»åŠ¨å‘é€æ¶ˆæ¯ã€‚</td><td>é€‚ç”¨äºéœ€è¦å®æ—¶åŒå‘äº¤äº’çš„åœºæ™¯ã€‚ä¾‹å¦‚èŠå¤©åº”ç”¨ã€‚</td></tr><tr><td>SseEmitter</td><td>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé•¿è¿æ¥è¯·æ±‚ï¼Œç„¶åæœåŠ¡ç«¯å°†äº‹ä»¶é€šè¿‡ HTTP å“åº”æ¨é€ç»™å®¢æˆ·ç«¯ã€‚</td><td>éœ€è¦ç»å¸¸å»ºç«‹å’Œå…³é—­è¿æ¥,æ•ˆç‡ä¸å¦‚ WebSocketã€‚ä½†æ”¯æŒ HTTP ç¼“å­˜ã€‚</td><td>åŸç”Ÿæ”¯æŒçš„æµè§ˆå™¨ç›¸å¯¹è¾ƒå°‘ã€‚éœ€è¦Polyfillã€‚</td><td>åªå…è®¸æ¨é€æ–‡æœ¬ï¼Œä¸æ”¯æŒä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ã€‚</td><td>åªæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€,å®¢æˆ·ç«¯åªèƒ½è¢«åŠ¨æ¥æ”¶ã€‚</td><td>é€‚ç”¨äºéœ€è¦ä¸€å¯¹ä¸€æ¨é€äº‹ä»¶çš„åœºæ™¯ã€‚å®¢æˆ·ç«¯åªéœ€ç›‘å¬,æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ã€‚</td></tr></tbody></table><ul><li>æ€»ç»“<ul><li>SSE é€‚ç”¨äºæœåŠ¡å™¨å•å‘æ¨é€æ–‡æœ¬äº‹ä»¶çš„åœºæ™¯ï¼Œå…¼å®¹æ€§ç¨å·®ä½†æ•ˆç‡é«˜ã€‚</li><li>WebSocket é€‚ç”¨äºå®æ—¶åŒå‘é€šä¿¡çš„åœºæ™¯ï¼Œæ•ˆç‡æ›´é«˜ä½†å…¼å®¹æ€§è¦æ±‚é«˜ã€‚</li></ul></li></ul><h3 id="SSEå®ç°"><a href="#SSEå®ç°" class="headerlink" title="SSEå®ç°"></a>SSEå®ç°</h3><ul><li><p>å¯¼åŒ…</p><pre><code class="xml">&lt;dependency&gt;  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; </code></pre></li><li><p>è‡ªå®šä¹‰SseEmitter(è§£å†³ä¸­æ–‡ä¹±ç )</p><pre><code class="java">public class SseEmitterUTF8 extends SseEmitter &#123;  public SseEmitterUTF8(Long timeout) &#123;      super(timeout);  &#125;  @Override  protected void extendResponse(ServerHttpResponse outputMessage) &#123;      super.extendResponse(outputMessage);      HttpHeaders headers = outputMessage.getHeaders();      headers.setContentType(new MediaType(MediaType.TEXT_EVENT_STREAM, StandardCharsets.UTF_8));  &#125;&#125;</code></pre></li><li><p>Controller</p><pre><code class="java"></code></pre></li></ul><p>@Slf4j<br>@RestController<br>@RequestMapping(value = â€œ/aiâ€)<br>public class AIController {</p><pre><code>//é˜²æ­¢ä¸²æµprivate static final Map&lt;String, SseEmitterUTF8&gt; SSE_CACHE = new ConcurrentHashMap&lt;&gt;();@GetMapping(value = &quot;/open&quot;, produces = &#123;MediaType.TEXT_EVENT_STREAM_VALUE&#125;)public SseEmitterUTF8 open(@RequestParam(&quot;clientId&quot;) String clientId) &#123;    try&#123;        final SseEmitterUTF8 emitter = this.getConn(clientId);        CompletableFuture.runAsync(() -&gt; &#123;            try &#123;                this.send(clientId);            &#125; catch (Exception e) &#123;                log.error(&quot;&#123;&#125;&quot;,e);            &#125;        &#125;);        return emitter;    &#125; catch (Exception e)&#123;        log.error(&quot;&#123;&#125;&quot;,e);    &#125;    return null;&#125;@GetMapping(&quot;/close&quot;)public Result&lt;String&gt; closeConn(@RequestParam(&quot;clientId&quot;) String clientId) &#123;    final SseEmitter sseEmitter = SSE_CACHE.get(clientId);    if (sseEmitter != null) &#123;        sseEmitter.complete();    &#125;    return Result.success(&quot;è¿æ¥å·²å…³é—­&quot;);&#125;//è·å–é“¾æ¥public SseEmitterUTF8 getConn(@NotBlank String clientId) &#123;    final SseEmitterUTF8 sseEmitter = SSE_CACHE.get(clientId);    if (sseEmitter != null) &#123;        return sseEmitter;    &#125; else &#123;        // è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦é…åˆé…ç½®é¡¹ spring.mvc.async.request-timeout: 600000 ä¸€èµ·ä½¿ç”¨        final SseEmitterUTF8 emitter = new SseEmitterUTF8(600_000L);        // æ³¨å†Œè¶…æ—¶å›è°ƒï¼Œè¶…æ—¶åè§¦å‘        emitter.onTimeout(() -&gt; &#123;            log.info(&quot;è¿æ¥å·²è¶…æ—¶ï¼Œæ­£å‡†å¤‡å…³é—­ï¼ŒclientId = &#123;&#125;&quot;, clientId);            SSE_CACHE.remove(clientId);        &#125;);        // æ³¨å†Œå®Œæˆå›è°ƒï¼Œè°ƒç”¨ emitter.complete() è§¦å‘        emitter.onCompletion(() -&gt; &#123;            log.info(&quot;è¿æ¥å·²å…³é—­ï¼Œæ­£å‡†å¤‡é‡Šæ”¾ï¼ŒclientId = &#123;&#125;&quot;, clientId);            SSE_CACHE.remove(clientId);            log.info(&quot;è¿æ¥å·²é‡Šæ”¾ï¼ŒclientId = &#123;&#125;&quot;, clientId);        &#125;);        // æ³¨å†Œå¼‚å¸¸å›è°ƒï¼Œè°ƒç”¨ emitter.completeWithError() è§¦å‘        emitter.onError(throwable -&gt; &#123;            log.error(&quot;è¿æ¥å·²å¼‚å¸¸ï¼Œæ­£å‡†å¤‡å…³é—­ï¼ŒclientId = &#123;&#125;&quot;, clientId, throwable);            SSE_CACHE.remove(clientId);        &#125;);        SSE_CACHE.put(clientId, emitter);        return emitter;    &#125;&#125;/** * æ¨¡æ‹Ÿç±»ä¼¼äº chatGPT çš„æµå¼æ¨é€å›ç­” * * @param clientId å®¢æˆ·ç«¯ id */public void send(@NotBlank String clientId) throws IOException, InterruptedException &#123;    final SseEmitterUTF8 emitter = SSE_CACHE.get(clientId);    // æ¨æµå†…å®¹åˆ°å®¢æˆ·ç«¯    for(int i=0; i&lt;10; i++)&#123;        String msg = &quot;ç¬¬&quot;+i+&quot;æ¡æ¶ˆæ¯&quot;;        emitter.send(new String(msg.getBytes(), StandardCharsets.UTF_8), MediaType.APPLICATION_JSON);        Thread.sleep(300);    &#125;    // ç»“æŸæ¨æµ    emitter.complete();&#125;</code></pre><p>}</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> äº‹ä»¶æ¨é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äº‹ä»¶æ¨é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stable Diffusion Web UI(ä¸€)-éƒ¨ç½²</title>
      <link href="/2023/09/06/ai/gc/stable-diffusion-01/"/>
      <url>/2023/09/06/ai/gc/stable-diffusion-01/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h1><h2 id="1-1-Stable-Diffusion"><a href="#1-1-Stable-Diffusion" class="headerlink" title="1.1 Stable Diffusion"></a>1.1 Stable Diffusion</h2><p><strong>Stable Diffusion</strong>æ˜¯2022å¹´å‘å¸ƒçš„ä¸»è¦ç”¨äº <strong>æ–‡æœ¬ç”Ÿæˆå›¾åƒ</strong> çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„txt2imgçš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡ç»™å®š <strong>æ–‡æœ¬æç¤ºè¯ï¼ˆtext promptï¼‰</strong>ï¼Œè¯¥æ¨¡å‹ä¼šè¾“å‡ºä¸€å¼ åŒ¹é…æç¤ºè¯çš„å›¾ç‰‡ã€‚</p><p>Stable Diffusionæ˜¯åŸºäºâ€œæ½œåœ¨æ‰©æ•£æ¨¡å‹â€ï¼ˆlatent diffusion modelï¼›LDMï¼‰çš„æ¨¡å‹</p><ul><li>åŸç†å›¾(åŸºäºLDMè®ºæ–‡)</li></ul><img alt="LDMè®ºæ–‡" height="400" src="/img/ai/LDM.png" width="600"/><ul><li><ul><li>å˜åˆ†ç¼–ç å™¨ Vector Quantised Variational AutoEncoderï¼ŒVQ-VAE</li></ul></li><li><p>æ‰©æ•£æ¨¡å‹ Diffusion Modelï¼Œ DM</p></li><li><p>æ¡ä»¶æ§åˆ¶å™¨ Conditioning</p></li><li><p>åº”ç”¨åœºæ™¯</p></li></ul><p>txt2img(æ–‡ç”Ÿå›¾)ã€img2img(å›¾ç”Ÿå›¾)ã€Depth-to-imageï¼ˆæ·±åº¦å›¾ç”Ÿå›¾ï¼‰ã€Inpaintingï¼ˆå›¾ç‰‡ä¿®å¤ï¼‰</p><h2 id="1-2-Stable-Diffusion-WebUI"><a href="#1-2-Stable-Diffusion-WebUI" class="headerlink" title="1.2 Stable Diffusion WebUI"></a>1.2 Stable Diffusion WebUI</h2><blockquote><p>åŸºäºStable Diffusionçš„Webç«¯æ“ä½œé¡µé¢</p></blockquote><img alt="sd-webui" height="400" src="/img/ai/sd-webui.png" width="600"/><h1 id="äºŒã€éƒ¨ç½²"><a href="#äºŒã€éƒ¨ç½²" class="headerlink" title="äºŒã€éƒ¨ç½²"></a>äºŒã€éƒ¨ç½²</h1><h2 id="1-å®‰è£…éƒ¨ç½²"><a href="#1-å®‰è£…éƒ¨ç½²" class="headerlink" title="1. å®‰è£…éƒ¨ç½²"></a>1. å®‰è£…éƒ¨ç½²</h2><h3 id="1-1-ç®€æ˜“å®‰è£…æ­¥éª¤"><a href="#1-1-ç®€æ˜“å®‰è£…æ­¥éª¤" class="headerlink" title="1.1. ç®€æ˜“å®‰è£…æ­¥éª¤"></a>1.1. ç®€æ˜“å®‰è£…æ­¥éª¤</h3><p>å‰ææ¡ä»¶ï¼šWindowsç³»ç»Ÿ+Nvidiaç‹¬ç«‹æ˜¾å¡+æœ€ä½4Gæ˜¾å­˜</p><p><a href="https://www.bilibili.com/video/BV1iM4y1y7oA/?vd_source=a587431d27f99623cb0298cf5e56d7c1">ç§‹å¶-æ•´åˆåŒ…</a></p><p><a href="https://www.bilibili.com/video/BV1bT411p7Gt/?spm_id_from=333.788&vd_source=a587431d27f99623cb0298cf5e56d7c1">æ˜Ÿç©º-æ•´åˆåŒ…</a></p><h3 id="1-2-ä¸“ä¸šå®‰è£…æ­¥éª¤-æ¨è"><a href="#1-2-ä¸“ä¸šå®‰è£…æ­¥éª¤-æ¨è" class="headerlink" title="1.2. ä¸“ä¸šå®‰è£…æ­¥éª¤(æ¨è)"></a>1.2. ä¸“ä¸šå®‰è£…æ­¥éª¤(æ¨è)</h3><ul><li>ç¯å¢ƒå‡†å¤‡</li></ul><p>gitã€Python3.10åŠä»¥ä¸Šç‰ˆæœ¬ã€æœ€ä½4GBæ˜¾å­˜(ä½æ˜¾å­˜ä¹Ÿèƒ½è·‘)</p><p>Nvidiaæ˜¾å¡éœ€è¦å®‰è£…CUDAã€AMDæ˜¾å¡éœ€è¦å®‰è£…Ort</p><p><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/Installation-on-Apple-Silicon">MacOS AppleèŠ¯ç‰‡éƒ¨ç½²</a></p><ul><li>ä¸‹è½½&amp;éƒ¨ç½²</li></ul><p>æ­¥éª¤å‚è€ƒ <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">stable-diffusion-webui</a> æ–‡æ¡£</p><ul><li>å¯åŠ¨</li></ul><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</p><pre><code class="shell"># æ›´å¤šå‚æ•°å‚è€ƒgithubæ–‡æ¡£ï¼Œå¯åŠ¨åä¼šè‡ªåŠ¨å®‰è£…éœ€è¦çš„åŒ…./webui.sh --medvram --theme dark</code></pre><ul><li><p>è§£å†³ç–‘éš¾æ‚ç—‡</p><p>  å…ˆåœ¨SDWebui githubä¸Šçš„æ–‡æ¡£æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆï¼Œæ²¡æœ‰äº†å†å‚è€ƒç½‘ä¸Šç›¸å…³è§£å†³æ–¹æ¡ˆ</p></li></ul><h2 id="2-æ’ä»¶"><a href="#2-æ’ä»¶" class="headerlink" title="2. æ’ä»¶"></a>2. æ’ä»¶</h2><ul><li>é¡µé¢å®‰è£…(éœ€ğŸªœ)<pre><code class="textmate">é¦–é¡µ -&gt; Extensions -&gt; Available;  ç‚¹å‡»Load fromåŠ è½½æ’ä»¶ æˆ–è€… ä»URLå®‰è£…æ’ä»¶å®‰è£…å®Œæˆåç‚¹å‡» Settings -&gt;  Reload UI</code></pre></li></ul><img alt="sd-web-plugin" height="400" src="/img/ai/sd-web-plugin.png" width="800"/><ul><li><p>æœ¬åœ°å®‰è£…</p><pre><code class="textmate">ä¸‹è½½æ’ä»¶é¡¹ç›®åæ”¾åœ¨ /extensions ç›®å½•ä¸‹</code></pre></li><li><p>éƒ¨åˆ†æ’ä»¶æ¨è</p></li></ul><table><thead><tr><th>åç§°</th><th>ç®€ä»‹</th></tr></thead><tbody><tr><td>sd-webui-bilingual-localization</td><td>åŒè¯­ç¿»è¯‘</td></tr><tr><td>stable-diffusion-webui-localization-zh_CN</td><td>æ±‰åŒ–åŒ…ï¼Œæ­é…ä¸Šé¢çš„ä½¿ç”¨</td></tr><tr><td>sd-webui-controlnet</td><td>æ¨¡å‹ç»†èŠ‚æ§åˆ¶</td></tr><tr><td>sd-webui-infinite-image-browsing</td><td>å›¾ç‰‡ç®¡ç†å™¨</td></tr></tbody></table><ul><li>æ±‰åŒ–</li></ul><pre><code class="textmate">Settings -&gt; User interface -&gt; Localizationï¼Œé€‰æ‹©zh_CNå®Œæˆåç‚¹å‡» Settings -&gt;  Reload UI</code></pre><h2 id="3-æ‰€éœ€èµ„æºæ–‡ä»¶"><a href="#3-æ‰€éœ€èµ„æºæ–‡ä»¶" class="headerlink" title="3. æ‰€éœ€èµ„æºæ–‡ä»¶"></a>3. æ‰€éœ€èµ„æºæ–‡ä»¶</h2><blockquote><p><strong>æ³¨æ„ï¼Œèµ„æºæ–‡ä»¶åä¸­ä¸è¦æœ‰æ±‰å­—</strong><br><strong>ä¸‹è½½å®Œæˆåéœ€è¦é‡å¯ä¸‹SD Webuiæ‰èƒ½è®°è½½åˆ°èµ„æº</strong></p></blockquote><ul><li>ä¸‹è½½åœ°å€</li></ul><p><a href="https://link.zhihu.com/?target=http://www.liandange.com/models">ç‚¼ä¸¹é˜ (www.liandange.com)</a> å›½å†…ï¼Œå¤§å¤šæ¥è‡ªäºcivitai</p><ul><li>èµ„æºç±»å‹ä»‹ç»</li></ul><table><thead><tr><th>æè¿°</th><th>åç¼€å</th><th>å­˜æ”¾ä½ç½®</th><th>ä½œç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æƒé‡æ–‡ä»¶</td><td>ckptsafetensors</td><td>/stable-diffusion-webui/models/Stable-diffusion</td><td>åŸºç¡€æ¨¡å‹æ–‡ä»¶ï¼Œå¿…é¡»</td><td>éƒ¨åˆ†æ¨¡å‹ä¼šé™„å¸¦(.vae.pt)æˆ–é…ç½®æ–‡ä»¶(.yaml)å¦‚æœä¸€ä¸ªæ¨¡å‹é™„å¸¦é…ç½®æ–‡ä»¶æˆ–è€…VAEï¼Œéœ€è¦å…ˆæŠŠå®ƒä»¬çš„æ–‡ä»¶åæ”¹ä¸ºç›¸åŒçš„æ–‡ä»¶åï¼Œç„¶åå†æ”¾å…¥ç›®å½•ä¸­</td></tr><tr><td>Lora</td><td></td><td>/stable-diffusion-webui/models/Stable-diffusion</td><td>éå¿…é¡»ï¼Œç”Ÿæˆçš„å›¾ç‰‡çš„é£æ ¼æ›´åŠ ç»†è…»</td><td></td></tr><tr><td>ControlNet</td><td></td><td></td><td>éå¿…é¡»ï¼Œæ¨¡å‹ç»†èŠ‚æ§åˆ¶ç®€å•ç‚¹ç†è§£å°±æ˜¯ï¼ŒæŒ‰æˆ‘ç»™çš„å›¾ç‰‡é£æ ¼ç”Ÿæˆæ–°çš„å›¾ç‰‡</td><td>éœ€è¦æ’ä»¶æ”¯æŒ</td></tr><tr><td>vae</td><td></td><td></td><td>è§£ç å™¨/æ»¤é•œï¼Œéå¿…é¡»</td><td></td></tr></tbody></table><h1 id="ä¸‰ã€ç®€å•ä½¿ç”¨"><a href="#ä¸‰ã€ç®€å•ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ç®€å•ä½¿ç”¨"></a>ä¸‰ã€ç®€å•ä½¿ç”¨</h1><h2 id="1-å¸¸ç”¨åŠŸèƒ½"><a href="#1-å¸¸ç”¨åŠŸèƒ½" class="headerlink" title="1. å¸¸ç”¨åŠŸèƒ½"></a>1. å¸¸ç”¨åŠŸèƒ½</h2><ul><li><p>text2img-æ–‡ç”Ÿå›¾</p></li><li><p>img2img-å›¾ç”Ÿå›¾ã€ç»˜å›¾ã€å±€éƒ¨é‡ç»˜</p></li><li><p>PNG Info-å›¾ç‰‡ä¿¡æ¯ï¼Œå¯å°†å›¾ç‰‡ä¿¡æ¯å‘é€åˆ°text2imgå’Œimg2imgä¸­</p></li></ul><h2 id="2-å‚æ•°ä»‹ç»"><a href="#2-å‚æ•°ä»‹ç»" class="headerlink" title="2. å‚æ•°ä»‹ç»"></a>2. å‚æ•°ä»‹ç»</h2><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Prompt</td><td>æ­£å‘æç¤ºè¯</td></tr><tr><td>Negative prompt</td><td>åå‘/æ¶ˆæçš„æç¤ºè¯</td></tr><tr><td>Widthã€Height</td><td>å›¾ç‰‡å°ºå¯¸ã€‚å°ºå¯¸è¶Šå¤§è¶Šè€—æ€§èƒ½ï¼Œç”Ÿæˆæ—¶é—´è¶Šä¹…ã€‚</td></tr><tr><td>Batch count</td><td>ç”Ÿæˆæ‰¹æ¬¡</td></tr><tr><td>Batch size</td><td>æ¯ä¸€æ‰¹ç”Ÿæˆçš„å›¾ç‰‡æ•°</td></tr><tr><td>CFG scale</td><td>AI å¯¹æè¿°å‚æ•°ï¼ˆPromptï¼‰çš„å€¾å‘ç¨‹åº¦ã€‚å€¼è¶Šå°ç”Ÿæˆçš„å›¾ç‰‡è¶Šåç¦»ä½ çš„æè¿°ï¼Œä½†è¶Šç¬¦åˆé€»è¾‘ï¼›å€¼è¶Šå¤§åˆ™ç”Ÿæˆçš„å›¾ç‰‡è¶Šç¬¦åˆä½ çš„æè¿°ï¼Œä½†å¯èƒ½ä¸ç¬¦åˆé€»è¾‘ã€‚</td></tr><tr><td>Sampling method</td><td>é‡‡æ ·æ–¹æ³•ã€‚æœ‰å¾ˆå¤šç§ï¼Œä½†åªæ˜¯é‡‡æ ·ç®—æ³•ä¸Šæœ‰å·®åˆ«ï¼Œæ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œé€‰ç”¨é€‚åˆçš„å³å¯ã€‚</td></tr><tr><td>Sampling steps</td><td>é‡‡æ ·æ­¥é•¿ã€‚å¤ªå°çš„è¯é‡‡æ ·çš„éšæœºæ€§ä¼šå¾ˆé«˜ï¼Œå¤ªå¤§çš„è¯é‡‡æ ·çš„æ•ˆç‡ä¼šå¾ˆä½ï¼Œæ‹’ç»æ¦‚ç‡é«˜(å¯ä»¥ç†è§£ä¸ºæ²¡æœ‰é‡‡æ ·åˆ°,é‡‡æ ·çš„ç»“æœè¢«èˆå¼ƒäº†)ã€‚</td></tr><tr><td>Seed</td><td>éšæœºæ•°ç§å­ã€‚ç”Ÿæˆæ¯å¼ å›¾ç‰‡æ—¶çš„éšæœºç§å­ï¼Œè¿™ä¸ªç§å­æ˜¯ç”¨æ¥ä½œä¸ºç¡®å®šæ‰©æ•£åˆå§‹çŠ¶æ€çš„åŸºç¡€ã€‚ä¸æ‡‚çš„è¯ï¼Œç”¨éšæœºçš„å³å¯ã€‚</td></tr></tbody></table><h2 id="3-æè¿°è¯å­¦ä¹ "><a href="#3-æè¿°è¯å­¦ä¹ " class="headerlink" title="3. æè¿°è¯å­¦ä¹ "></a>3. æè¿°è¯å­¦ä¹ </h2><ul><li><a href="https://thereisnospon.github.io/NovelAiTag/">Tagç½‘ç«™</a></li></ul><pre><code class="textmate">é€šè¿‡ç‚¹ç‚¹ç‚¹ç”Ÿæˆæè¿°è¯çŸ¥è¯†ç‚¹: æƒé‡é€šè¿‡ &#123;æè¿°è¯&#125; å½¢å¼è¡¨ç¤ºï¼Œé«˜æƒé‡è¯å†™æ³•&#123;&#123;&#123;æè¿°è¯&#125;&#125;&#125;</code></pre><h2 id="4-æ•ˆæœå±•ç¤º"><a href="#4-æ•ˆæœå±•ç¤º" class="headerlink" title="4. æ•ˆæœå±•ç¤º"></a>4. æ•ˆæœå±•ç¤º</h2><blockquote><p>è‡ªè¡Œä¸‹è½½å¯¹åº”æ¨¡å‹</p></blockquote><pre><code class="textmate">prompt: a girlNegative prompt: uglySteps: 40, Sampler: Euler a, CFG scale: 7, Seed: 1348569158, Size: 512x512, Model hash: e7aab5067d, Model: caricature, Clip skip: 7, ENSD: 31337, Eta: 0.68, Version: v1.6.0</code></pre><img alt="demo1" height="500" src="/img/ai/demo1.png" width="500"/><pre><code class="textmate">prompt: a girl,Delicate face, HD, extreme detail, master of realism, short-sleeved jeans Negative prompt: Ugly faces, extra fingers, extra hands, discordant images Steps: 35, Sampler: Euler a, CFG scale: 7, Seed: 123124, Size: 512x512, Model hash: e4a30e4607, Model: realHuman_majicmixRealistic_v6, Clip skip: 7, ENSD: 31337, Eta: 0.68, Version: v1.5.1-RC-3-geb6d330b</code></pre><img alt="demo2" height="500" src="/img/ai/demo2.png" width="500"/><h2 id="5-æ‰©å±•"><a href="#5-æ‰©å±•" class="headerlink" title="5. æ‰©å±•"></a>5. æ‰©å±•</h2><img alt="ikun1" height="400" src="/img/ai/ikun1.png" width="600"/><img alt="ikun2" height="500" src="/img/ai/ikun2.png" width="500"/><img alt="ikun3" height="500" src="/img/ai/ikun3.png" width="500"/>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIGC,SD,StableDiffusion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stable Diffusion Web UI(äºŒ)-èµ„æº</title>
      <link href="/2023/09/06/ai/gc/stable-diffusion-02/"/>
      <url>/2023/09/06/ai/gc/stable-diffusion-02/</url>
      
        <content type="html"><![CDATA[<h2 id="æ­å»ºæŒ‡å—-amp-ä½¿ç”¨æ•™ç¨‹"><a href="#æ­å»ºæŒ‡å—-amp-ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="æ­å»ºæŒ‡å— &amp; ä½¿ç”¨æ•™ç¨‹"></a>æ­å»ºæŒ‡å— &amp; ä½¿ç”¨æ•™ç¨‹</h2><ul><li><a href="https://mp.weixin.qq.com/s/eFi-xoVDQomzCBr5kO9nHA">å´ä¸œå­-ä½¿ç”¨æ•™ç¨‹(è½¬)</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjgyNTc4OQ==&mid=2247488963&idx=1&sn=e0e895739c4a1d8bfa12c6e6f7dbbf96&chksm=9f193b11a86eb2070f9c192c55862f70b1983bcb02320c1f77c789849cc6dbbffeaf5b8ecc72&scene=132&exptype=timeline_recommend_article_extendread_samebiz#wechat_redirect">å¹»æœ¯AI</a></li></ul><h2 id="Promptè¯å­¦ä¹ "><a href="#Promptè¯å­¦ä¹ " class="headerlink" title="Promptè¯å­¦ä¹ "></a>Promptè¯å­¦ä¹ </h2><h3 id="promptè¯åº“"><a href="#promptè¯åº“" class="headerlink" title="promptè¯åº“"></a>promptè¯åº“</h3><ul><li><a href="https://docs.qq.com/doc/DWFdSTHJtQWRzYk9k">å…ƒç´ é­”æ³•å…¸-01</a></li><li><a href="https://docs.qq.com/doc/DWHl3am5Zb05QbGVs?dver=">å…ƒç´ é­”æ³•å…¸-02</a></li><li><a href="https://danbooru.donmai.us/wiki_pages/tag_groups">å„ç§è§’è‰²é­”æ³•å…¸</a></li><li><a href="https://thereisnospon.github.io/NovelAiTag/">Tagç½‘ç«™</a></li></ul><h3 id="é€šç”¨è¯ç¤ºä¾‹"><a href="#é€šç”¨è¯ç¤ºä¾‹" class="headerlink" title="é€šç”¨è¯ç¤ºä¾‹"></a>é€šç”¨è¯ç¤ºä¾‹</h3><ul><li>åå‘è¯<pre><code class="textmate">(worst quality:2), (low quality:2), (normal quality:2), lowres, ((monochrome)), ((grayscale)), bad anatomy,DeepNegative, skin spots, acnes, skin blemishes,(fat:1.2),facing away, looking away,tilted head, lowres,bad anatomy,bad hands, missing fingers,extra digit, fewer digits,bad feet,poorly drawn hands,poorly drawn face,mutation,deformed,extra fingers,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands,polar lowres,bad body,bad proportions,gross proportions,missing arms,missing legs,extra digit, extra arms, extra leg, extra foot,teethcroppe,signature, watermark, username,blurry,cropped,jpeg artifacts,text,error</code></pre></li></ul><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><h3 id="æ¨¡å‹ç½‘ç«™"><a href="#æ¨¡å‹ç½‘ç«™" class="headerlink" title="æ¨¡å‹ç½‘ç«™"></a>æ¨¡å‹ç½‘ç«™</h3><blockquote><p>æ¨¡å‹åç§°éœ€è¦æ”¹æˆè‹±æ–‡</p></blockquote><ul><li><a href="https://huggingface.co/">huggingface</a></li><li><a href="https://civitai.com/">civitai</a></li><li><a href="www.liblibai.com">LiblibAI</a>  å·ç§°å›½å†…æœ€å¤§ï¼Œå¤§å¤šæ¥è‡ªäºcivitai</li><li><a href="www.liandange.com">ç‚¼ä¸¹é˜</a>  å›½å†…ï¼Œå¤§å¤šæ¥è‡ªäºcivitai</li></ul><h3 id="åŸºç¡€æ¨¡å‹æ¨è"><a href="#åŸºç¡€æ¨¡å‹æ¨è" class="headerlink" title="åŸºç¡€æ¨¡å‹æ¨è"></a>åŸºç¡€æ¨¡å‹æ¨è</h3><table><thead><tr><th>æ¨¡å‹åç§°</th><th>ç®€ä»‹</th><th>æ¥æº</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>majicmix-realistic</td><td>çœŸäººæ¨¡å‹</td><td>hugginface</td><td><a href="https://huggingface.co/emilianJR/majicMIX_realistic_v6">majicMIX_realistic_v6</a></td></tr><tr><td>Stable Diffusion 2.0</td><td></td><td>768-v-ema.ckptä¸768-v-ema.yaml</td><td><a href="https://huggingface.co/stabilityai/stable-diffusion-2/resolve/main/768-v-ema.ckpt">sd2.0</a><a href="https://raw.githubusercontent.com/Stability-AI/stablediffusion/main/configs/stable-diffusion/v2-inference.yaml">sd2.0-yml</a></td></tr><tr><td>Stable Diffusion 2.1</td><td></td><td></td><td><a href="https://huggingface.co/stabilityai/stable-diffusion-2-1">SD2.1</a></td></tr></tbody></table><h3 id="ControlNetæ¨¡å‹"><a href="#ControlNetæ¨¡å‹" class="headerlink" title="ControlNetæ¨¡å‹"></a>ControlNetæ¨¡å‹</h3><ul><li><p><a href="https://huggingface.co/lllyasviel/ControlNet-v1-1/tree/main">ä¸‹è½½åœ°å€</a></p><blockquote><p>åªç”¨ä¸‹è½½pthç»“å°¾çš„æ–‡ä»¶ï¼Œä¸‹è½½åæ”¾åœ¨ â€œstable-diffusion-webui\extensions\sd-webui-controlnet\modelsâ€ æ–‡ä»¶å¤¹ä¸­</p></blockquote></li><li><p>æ¨¡å‹ä»‹ç»</p></li></ul><table><thead><tr><th>æ¨¡å‹åç§°</th><th>æ¨¡å‹æè¿°</th><th>æ¨¡å‹å’Œé…ç½®æ–‡ä»¶</th></tr></thead><tbody><tr><td>control_v11p_sd15_canny</td><td>ä½¿ç”¨ Canny è¾¹ç¼˜æ£€æµ‹ç®—æ³•çš„æ¨¡å‹</td><td>control_v11p_sd15_canny.pth / control_v11p_sd15_canny.yaml</td></tr><tr><td>control_v11p_sd15_mlsd</td><td>ä½¿ç”¨æœ€å°é•¿åº¦åˆ†å‰²çº¿æ£€æµ‹ç®—æ³• (MLSD) çš„æ¨¡å‹</td><td>control_v11p_sd15_mlsd.pth / control_v11p_sd15_mlsd.yaml</td></tr><tr><td>control_v11f1p_sd15_depth</td><td>ç”Ÿæˆæ·±åº¦ä¿¡æ¯çš„æ¨¡å‹</td><td>control_v11f1p_sd15_depth.pth / control_v11f1p_sd15_depth.yaml</td></tr><tr><td>control_v11p_sd15_normalbae</td><td>åº”ç”¨æ³•çº¿ä¼°è®¡å’Œè‡ªç¼–ç å™¨ (BAE) çš„æ¨¡å‹</td><td>control_v11p_sd15_normalbae.pth / control_v11p_sd15_normalbae.yaml</td></tr><tr><td>control_v11p_sd15_seg</td><td>ç”¨äºå›¾åƒåˆ†å‰²çš„æ¨¡å‹</td><td>control_v11p_sd15_seg.pth / control_v11p_sd15_seg.yaml</td></tr><tr><td>control_v11p_sd15_inpaint</td><td>ç”¨äºå›¾åƒä¿®å¤çš„æ¨¡å‹</td><td>control_v11p_sd15_inpaint.pth / control_v11p_sd15_inpaint.yaml</td></tr><tr><td>control_v11p_sd15_lineart</td><td>ç”¨äºçº¿ç¨¿ç”Ÿæˆçš„æ¨¡å‹</td><td>control_v11p_sd15_lineart.pth / control_v11p_sd15_lineart.yaml</td></tr><tr><td>control_v11p_sd15s2_lineart_anime</td><td>ç”¨äºåŠ¨æ¼«çº¿ç¨¿ç”Ÿæˆçš„æ¨¡å‹</td><td>control_v11p_sd15s2_lineart_anime.pth / control_v11p_sd15s2_lineart_anime.yaml</td></tr><tr><td>control_v11p_sd15_openpose</td><td>ç”¨äºäººä½“å§¿åŠ¿ä¼°è®¡çš„æ¨¡å‹</td><td>control_v11p_sd15_openpose.pth / control_v11p_sd15_openpose.yaml</td></tr><tr><td>control_v11p_sd15_scribble</td><td>ç”¨äºæ¶‚é¸¦ç”Ÿæˆçš„æ¨¡å‹</td><td>control_v11p_sd15_scribble.pth / control_v11p_sd15_scribble.yaml</td></tr><tr><td>control_v11p_sd15_softedge</td><td>ç”¨äºè½¯è¾¹ç¼˜ç”Ÿæˆçš„æ¨¡å‹</td><td>control_v11p_sd15_softedge.pth / control_v11p_sd15_softedge.yaml</td></tr><tr><td>control_v11e_sd15_shuffle</td><td>ä½¿ç”¨æ·±åº¦ä¼°è®¡å’Œå·ç§¯ç¥ç»ç½‘ç»œçš„æ¨¡å‹è¿›è¡Œå›¾åƒé‡æ’</td><td>control_v11e_sd15_shuffle.pth / control_v11e_sd15_shuffle.yaml</td></tr><tr><td>control_v11e_sd15_ip2p</td><td>ä½¿ç”¨å›¾åƒä¿®å¤å’Œå·ç§¯ç¥ç»ç½‘ç»œçš„æ¨¡å‹è¿›è¡Œå›¾åƒåˆ°å›¾åƒçš„è½¬æ¢</td><td>control_v11e_sd15_ip2p.pth / control_v11e_sd15_ip2p.yaml</td></tr><tr><td>control_v11f1e_sd15_tile</td><td>ä½¿ç”¨æ·±åº¦ä¼°è®¡å’Œå›¾åƒç“¦ç‰‡ç”Ÿæˆçš„æ¨¡å‹</td><td>control_v11f1e_sd15_tile.pth / control_v11f1e_sd15_tile.yaml</td></tr></tbody></table><h2 id="SDWebUIæ’ä»¶"><a href="#SDWebUIæ’ä»¶" class="headerlink" title="SDWebUIæ’ä»¶"></a>SDWebUIæ’ä»¶</h2><ul><li><p><a href="https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json">é»˜è®¤æ’ä»¶åŠ è½½åœ°å€</a></p></li><li><p><a href="https://gitcode.net/rubble7343/sd-webui-extensions/raw/master/index.json">gitcodeåœ°å€</a></p></li></ul><table><thead><tr><th>åç§°</th><th>ç®€ä»‹</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>sd-webui-bilingual-localization</td><td>åŒè¯­ç¿»è¯‘</td><td><a href="https://github.com/journey-ad/sd-webui-bilingual-localization">https://github.com/journey-ad/sd-webui-bilingual-localization</a></td></tr><tr><td>stable-diffusion-webui-localization-zh_CN</td><td>æ±‰åŒ–åŒ…ï¼Œæ­é…ä¸Šé¢çš„ä½¿ç”¨</td><td><a href="https://github.com/dtlnor/stable-diffusion-webui-localization-zh_CN">https://github.com/dtlnor/stable-diffusion-webui-localization-zh_CN</a></td></tr><tr><td>sd-webui-controlnet</td><td>æ¨¡å‹ç»†èŠ‚æ§åˆ¶</td><td><a href="https://github.com/Mikubill/sd-webui-controlnet.git">https://github.com/Mikubill/sd-webui-controlnet.git</a></td></tr><tr><td>sd-webui-infinite-image-browsing</td><td>å›¾ç‰‡ç®¡ç†å™¨</td><td></td></tr><tr><td>WD 1.4 Tagger</td><td>å›¾ç‰‡æè¿°ä¿¡æ¯æ‹†è§£</td><td></td></tr><tr><td>segment anything</td><td>æŠ å›¾æ’ä»¶</td><td></td></tr><tr><td>vae</td><td>è§£ç å™¨/æ»¤é•œï¼Œéå¿…é¡»</td><td><a href="https://zhuanlan.zhihu.com/p/646853233">VAEä»‹ç»</a></td></tr><tr><td>tagcomplete</td><td>tagæç¤º</td><td><a href="https://github.com/DominikDoom/a1111-sd-webui-tagcomplete.git[%E8%AE%BE%E7%BD%AE%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%BF%BB%E8%AF%91](https://xie.infoq.cn/article/ef345282c4de3ec742952b344)[%E4%B8%AD%E6%96%87Tag%E5%9C%B0%E5%9D%80](https://github.com/DominikDoom/a1111-sd-webui-tagcomplete/files/9834821/danbooru.csv)">https://github.com/DominikDoom/a1111-sd-webui-tagcomplete.git[è®¾ç½®æç¤ºè¯ç¿»è¯‘](https://xie.infoq.cn/article/ef345282c4de3ec742952b344)[ä¸­æ–‡Tagåœ°å€](https://github.com/DominikDoom/a1111-sd-webui-tagcomplete/files/9834821/danbooru.csv)</a></td></tr><tr><td>LightDiffusionFlow</td><td>SDå·¥ä½œæµ</td><td><a href="https://gitee.com/mirrors/lightdiffusionflow">Lightdiffusionflow-Gitee</a></td></tr></tbody></table><h2 id="å…¶ä»–ç›¸å…³é“¾æ¥"><a href="#å…¶ä»–ç›¸å…³é“¾æ¥" class="headerlink" title="å…¶ä»–ç›¸å…³é“¾æ¥"></a>å…¶ä»–ç›¸å…³é“¾æ¥</h2><ul><li><a href="https://stablediffusionweb.com/">SD-online</a></li><li><a href="https://editor.fusionbrain.ai/">æ— é™åˆ›æ„-fusionbrain</a></li><li><a href="https://github.com/upscayl/upscayl">å›¾ç‰‡ä¿®å¤</a></li><li><a href="http://www.liuyuxiang.com:9999/chatIMG.html">æ–‡ç”Ÿå›¾-å…è´¹</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIGC,SD,StableDiffusion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰è¶£çš„é“¾æ¥</title>
      <link href="/2023/08/08/other/url/"/>
      <url>/2023/08/08/other/url/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ‰è¶£çš„é“¾æ¥"><a href="#æœ‰è¶£çš„é“¾æ¥" class="headerlink" title="æœ‰è¶£çš„é“¾æ¥"></a>æœ‰è¶£çš„é“¾æ¥</h1><ul><li><p><a href="https://github.com/jianchang512/clone-voice">CV å£°éŸ³å…‹éš†å·¥å…·</a></p></li><li><p><a href="https://vavebg.com/">VAVE BG-AIå£çº¸åº“</a></p></li><li><p><a href="https://google.github.io/styleguide/">è°·æ­Œç¼–ç¨‹é£æ ¼æŒ‡å—</a></p></li><li><p><a href="https://news.ycombinator.com/item?id=34591291">æœ€å¥½çš„è®²åº§è§†é¢‘-è‹±æ–‡</a></p></li><li><p><a href="https://www.redblobgames.com/making-of/draggable/">å¯æ‹–åŠ¨å¯¹è±¡çš„ç½‘é¡µå®ç°</a></p></li><li><p><a href="https://frozenfractal.com/blog/2023/11/2/around-the-world-1-continents/">å¦‚ä½•ç”Ÿæˆè™šæ‹Ÿçš„ä¸–ç•Œåœ°å›¾</a></p></li><li><p><a href="https://fcpp.org/2021/07/28/misinformation-should-be-refuted-not-censored/">ã€Šé”™è¯¯ä¿¡æ¯çš„è§£è¯ã€‹</a></p></li><li><p><a href="https://github.com/tb0hdan/domains/blob/master/STATS.md">é¡¶çº§åŸŸåç»Ÿè®¡</a></p></li><li><p><a href="https://flashmuseum.org/">Flashåšç‰©é¦†</a></p></li><li><p><a href="https://martinrue.com/my-engineering-axioms/">ã€Šæˆ‘çš„å·¥ç¨‹å…¬ç†ã€‹</a></p><ul><li>äº§å“æ˜¯èµ„äº§ï¼Œä»£ç æ˜¯è´Ÿå€ºã€‚</li><li>ä½ çš„äº§å“è§£å†³äº†å®¢æˆ·çš„é—®é¢˜ï¼Œå› æ­¤æ˜¯ä½ çš„èµ„äº§ã€‚ä»£ç åˆ™æ˜¯åˆ›é€ èµ„äº§çš„æˆæœ¬ã€‚ä½ æ‹¥æœ‰çš„ä»£ç è¶Šå¤šï¼Œé˜…è¯»ã€æµ‹è¯•ã€æ›´æ”¹å’Œç†è§£æ‰€ä»˜å‡ºçš„æˆæœ¬å°±è¶Šé«˜ã€‚</li></ul></li><li><p><a href="https://addyosmani.com/blog/good-code/">ã€Šå¥½çš„ä»£ç å°±åƒå†™ç»™æ¥æ‰‹è€…çš„ä¸€å°æƒ…ä¹¦ã€‹</a></p><ul><li>ç¨‹åºå‘˜çš„ä»»åŠ¡ä¸ä»…ä»…æ˜¯è§£å†³ä»Šå¤©çš„é—®é¢˜ï¼Œè¿˜è¦ç¡®ä¿ä½ çš„ä»£ç ä¸ä¼šæˆä¸ºæ˜å¤©çš„é—®é¢˜ã€‚</li></ul></li><li><p><a href="https://botero.art/cn/exhibitions/8-botero-in-china/works/">åšç‰¹ç½—ä½œå“å±•</a></p></li><li><p><a href="https://dinosaurpictures.org/ancient-earth/">å¤ä»£åœ°çƒ</a></p></li><li><p><a href="https://bigthink.com/leadership/babble-hypothesis-leader/">é¢†å¯¼è€…çš„å–‹å–‹ä¸ä¼‘å‡è¯´</a></p></li><li><p><a href="https://adplist.substack.com/p/10-most-expensive-design-mistakes">10 ä¸ªæœ€æ˜‚è´µçš„è®¾è®¡é”™è¯¯</a></p></li><li><p><a href="https://www.bjnews.com.cn/detail/1693810149129843.html">ä»»æ­£éï¼šåä¸ºæœ‰ä¸šåŠ¡è¾¹ç•Œï¼Œäººæ‰è¦åœ¨è¾¹ç•Œå†…ç ”ç©¶æ¢ç´¢</a></p></li><li><p><a href="https://18alan.space/posts/how-hard-is-it-to-build-a-frontend-framework.html">å¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªå‰ç«¯æ¡†æ¶</a> </p></li><li><p><a href="https://thetaoofwealth.wordpress.com/2013/02/17/harry-brownes-17-golden-rules-of-financial-safety/">è´¢åŠ¡å®‰å…¨çš„17æ¡æ³•åˆ™</a></p></li><li><p><a href="https://github.com/krahets/hello-algo">Hello ç®—æ³•ğŸ”¥</a></p></li><li><p><a href="https://afgprogrammer.com/flutter/">Flutter Demo</a></p></li><li><p><a href="https://blog.qartis.com/decoding-small-qr-codes-by-hand/">æ‰‹å·¥è§£ç äºŒç»´ç </a></p></li><li><p><a href="https://github.com/emaction/emaction.frontend">emaction</a><br><br/>è‡ªéƒ¨ç½² GitHub é£æ ¼çš„ Reactions ç‚¹èµåŠŸèƒ½</p></li><li><p><a href="https://www.prettypolly.app/app">PrettyPolly</a><br><br/>å£è¯­ç»ƒä¹ </p></li><li><p><a href="https://www.hackingwithswift.com/100/swiftui">SwiftUI 100 è§†é¢‘æ•™ç¨‹</a></p></li><li><p><a href="https://www.nngroup.com/articles/ai-paradigm/">ã€ŠAIï¼š60å¹´æ¥ç¬¬ä¸€ä¸ªæ–°çš„ UI èŒƒå¼ã€‹</a></p></li><li><p><a href="https://giansegato.com/essays/edutainment-is-not-learning">ã€Šå¦‚ä½•åœ¨æ•°å­—æ—¶ä»£æ›´å¥½åœ°å­¦ä¹ ã€‹</a></p></li><li><p><a href="https://s3.ifanr.com/wp-content/uploads/2022/03/eadb74787dda41cc6333341e55293432.g[if](https://s3.ifanr.com/wp-content/uploads/2022/03/eadb74787dda41cc6333341e55293432.gif)">åŠ è½½ä¸­åŠ¨ç”»</a></p></li><li><p><a href="https://github.com/michelpereira/awesome-games">Githubä¸Šå¼€æºæ¸¸æˆåˆé›†</a></p></li><li><p><a href="https://laosheng.top/fuwu/yuanxiao">ä¸­å›½é«˜ç­‰é™¢æ ¡ä¸‰åƒæ‰€</a></p></li><li><p><a href="https://www.actionsbyexample.com/">GitHub Actions ç¤ºä¾‹æ•™ç¨‹</a></p></li><li><p><a href="https://www3.nd.edu/~dthain/compilerbook/-">ç¼–è¯‘å™¨è®¾è®¡å…¥é—¨</a></p></li><li><p><a href="https://github.blog/2023-07-12-introducing-passwordless-authentication-on-github-com/">GitHub æ”¯æŒæ— å¯†ç ç™»å½•</a></p></li><li><p><a href="https://github.com/linyimin0812/spring-startup-analyzer">Spring Startup Ananlyzer</a></p></li><li><p><a href="https://johnnysswlab.com/how-branches-influence-the-performance-of-your-code-and-what-can-you-do-about-it/">CPUå¯¹åˆ†æ”¯ä»£ç çš„å½±å“</a></p></li><li><p><a href="https://github.com/rothgar/static-mastodon">é™æ€ Mastodon æœåŠ¡å™¨</a> </p></li><li><p><a href="https://citw.dev/tutorial/create-your-own-compiler">åŠ¨æ‰‹å†™ç¼–è¯‘å™¨ï¼šäº’åŠ¨è®²è§£</a></p></li><li><p><a href="https://www.v2ex.com/t/934564">æˆ‘çš„å¼€æºç»å†</a></p></li><li><p><a href="https://decode.sh/building-a-code-pen-type-editor-from-scratch">å¦‚ä½•è‡ªå·±å®ç° CodePen</a></p></li><li><p><a href="https://jvns.ca/blog/2016/03/16/tcpdump-is-amazing/">tcpdump å¿«é€Ÿä¸Šæ‰‹</a></p></li><li><p><a href="https://horuspass.com/send">HorusPass</a></p></li></ul><h3 id="æˆé•¿"><a href="#æˆé•¿" class="headerlink" title="æˆé•¿"></a>æˆé•¿</h3><ul><li><a href="https://rngzej6pnb.feishu.cn/docx/ZIjjdVkXyowZrMxH8pZci9z9npg">CEOä¿®ç‚¼æ‰‹å†Œ</a></li></ul><h3 id="AIç›¸å…³"><a href="#AIç›¸å…³" class="headerlink" title="AIç›¸å…³"></a>AIç›¸å…³</h3><ul><li><a href="https://simonwillison.net/2023/Nov/29/llamafile/">llamafile æ˜¯è¿è¡Œ LLM æœ€æ–¹ä¾¿çš„æ–¹æ³•</a></li><li><a href="https://tusiart.com/">AIGC-å…è´¹-åå¸</a></li><li><a href="https://www.liblib.ai/">AIGC-å…è´¹-liblib</a></li><li><a href="https://www.aigc.cn/sites/12818.html">AIGC-å¯¼èˆª</a></li><li><a href="https://www.yjpoo.com/ai-fuwushang/">æ˜ æŠ€æ´¾-AIå·¥å…·åˆé›†</a></li><li><a href="https://github.com/tldraw/draw-fast">draw-fast-ç”»ä½œè¿›é˜¶</a></li><li><a href="https://blog.warmplace.cn/post/chatgpt">ChatGPT ä½¿ç”¨å…¥é—¨</a></li><li><a href="https://xorvoid.com/chatgpt_a_mental_model.html">ã€Šå¦‚ä½•è®¤è¯† ChatGPTã€‹</a></li><li><a href="https://github.com/microsoft/ML-For-Beginners">å¾®è½¯-æœºå™¨å­¦ä¹ å…¥é—¨æ•™ç¨‹</a></li><li><a href="https://www.bing.com/images/create">Bing å›¾åƒåˆ›å»ºå™¨</a><ul><li>å¾®è½¯å®˜æ–¹çš„ AI æ–‡ç”Ÿå›¾æœåŠ¡ã€‚</li></ul></li><li><a href="https://shortbread.ai/">ShortbreadAI-ç”Ÿæˆæ¼«ç”»</a></li><li><a href="https://github.com/sirwart/ripsecrets">ripsecrets-ä»£ç æ³„éœ²å¯†é’¥æ£€æŸ¥</a></li><li><a href="https://emoji.fly.dev/">EmojiGen-ç”ŸæˆEmoji</a></li><li><a href="https://github.com/abi/screenshot-to-code">screenshot-to-code(æ ¹æ®å›¾ç‰‡ç»™å‡ºhtmlä»£ç å®ç°)</a></li><li><a href="https://start.chatgot.io/">ChatGot-å¤šAIæ¨¡å‹ä¼šè¯</a></li><li><a href="https://uxaudit.vercel.app/">ç½‘é¡µ AI è¯„å®¡</a></li><li><a href="https://aitdk.com/zh-CN/">AITDK-AI SEOä¼˜åŒ–</a></li><li><a href="https://v0.dev/">Vercel-v0.dev(è‡ªåŠ¨ç”Ÿæˆç½‘é¡µ)</a></li><li><a href="https://github.com/lllyasviel/Fooocus">Fooocus-ç¦»çº¿æ–‡æœ¬ç”Ÿå›¾</a></li><li><a href="https://www.lepton.ai/playground">AIå¼€æ”¾äº‘æœåŠ¡</a></li><li><a href="https://finchat.io/">è´¢æŠ¥AI</a></li><li><a href="https://beebee.ai/">BeeBee AI</a></li><li><a href="https://noteai.com/">NoteAI-ç¬”è®°æ±‡æ€»</a></li><li><a href="https://finance.sina.cn/2023-09-08/detail-imzkzkea2108254.d.html">é©¬æ–¯å…‹çš„AIä¹‹è·¯</a></li><li><a href="https://github.com/get-convex/ai-town">AIå°é•‡</a></li><li><a href="https://www.stablediffusionai.ai/">StableDiffusion XL ä½“éªŒç«™</a></li><li><a href="https://www.aihub.cn/">AIHub-å…è´¹AIåˆé›†</a></li><li><a href="https://www.toolai.io/">ToolAI</a></li><li><a href="https://www.deeplearning.ai/short-courses/chatgpt-prompt-engineering-for-developers/">é¢å‘å¼€å‘äººå‘˜çš„ ChatGPT æç¤ºå·¥ç¨‹</a></li><li><a href="https://freegpt.one/">FreeGPT</a></li><li><a href="https://chatgptdemo.net/zh-hans">Chat GPT Demo-å…è´¹ChatGPT</a></li><li><a href="https://www.promptingguide.ai/">æç¤ºå·¥ç¨‹å…¥é—¨</a></li><li><a href="https://codenews.cc/chatgpt">ChatGPT ä¸­æ–‡åœ¨çº¿ - å·¥å…·åˆé›†</a></li><li>æœç´¢ ChatGPTæº<ul><li><a href="https://github.com/LiLittleCat/awesome-free-chatgpt">1</a></li><li><a href="https://github.com/lzwme/chatgpt-sites">2</a></li><li><a href="https://github.com/xxxily/hello-ai/blob/main/home/FreeChatGPTSiteList.md">3</a></li></ul></li></ul><h3 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h3><ul><li><a href="https://github.com/binpash/try">try-linuxæ²™ç›’</a></li><li><a href="https://zibada.guru/gcj/">è°·æ­Œç¼–ç¨‹ç«èµ›è¯•é¢˜</a></li><li><a href="https://dbdb.io/">æ•°æ®åº“çš„æ•°æ®åº“</a></li><li><a href="https://mp.weixin.qq.com/s/HoFSNCd1U3eoUqYaQiEgwQ">Code Review ç»ˆæå¤§æ³•ï¼ˆä¸­æ–‡ï¼‰</a></li><li><a href="https://blog.turso.tech/why-sqlite-is-so-great-for-the-edge-ee00a3a9a55f">ä¸ºä»€ä¹ˆ SQLite å¦‚æ­¤é€‚åˆè¾¹ç¼˜è®¡ç®—</a></li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li><a href="https://imagine.meta.com/">meat-Imagine</a></li><li><a href="https://git.herrbischoff.com/awesome-macos-command-line/about/">Macå‘½ä»¤è¡Œå‘½ä»¤</a></li><li><a href="https://news.ycombinator.com/item?id=37931804">æœ€æ¼‚äº®çš„ç½‘é¡µæ¸¸æˆ</a></li><li><a href="https://felix.link/apps/captions">AI Image Captions</a><br>ä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¯ä»¥ä¸ºå›¾ç‰‡ç”Ÿæˆä»‹ç»è¯ï¼Œç”¨äºç¤¾äº¤åª’ä½“ï¼Œå¯ä»¥æŒ‡å®šè¯­è¨€ã€é£æ ¼å’Œé•¿åº¦ã€‚</li><li><a href="https://pythononlinecompiler.com/">Python Online Compiler</a><br>ä¸€ä¸ªåœ¨ç½‘é¡µè¿è¡Œ Python ä»£ç ã€æ˜¾ç¤ºè¿è¡Œç»“æœçš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥æŒ‡å®š Python ç‰ˆæœ¬ã€‚</li><li><a href="https://github.com/jason5ng32/MyIP/blob/main/README_CN.md">IPå·¥å…·ç®±</a><br>ä¸€ä¸ªå¼€æºçš„æœ¬åœ°ç½‘ç«™ï¼Œé›†æˆäº† IP ç›¸å…³çš„å„ç§æŸ¥è¯¢ã€‚</li><li><a href="https://www.33subs.com/">33å­—å¹•</a><br>ä¸€ä¸ª Win/Mac æ¡Œé¢è½¯ä»¶ï¼Œç”¨äºè¯†åˆ«/åˆ¶ä½œéŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶çš„åŒè¯­å­—å¹•ã€‚</li><li><a href="https://www.apigpts.dev/tools">å‘¨åˆŠå·¥å…·æœç´¢å¼•æ“</a></li><li><a href="https://bbycroft.net/llm">LLMå¯è§†åŒ–</a><br>è¿™ä¸ªç½‘ç«™æä¾›å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åŸç†è®²è§£ï¼Œæ¯ä¸€æ­¥è®²è§£éƒ½åœ¨å³ä¾§é…ä¸ŠåŠ¨ç”»ã€‚</li><li><a href="https://nvd.nist.gov/">è½¯ä»¶æ¼æ´æ•°æ®åº“</a><br>ç¾å›½çš„å›½å®¶è½¯ä»¶æ¼æ´æ•°æ®åº“ï¼Œæ”¶å…¥äº†å„ç§è½¯ä»¶æ¼æ´ï¼Œä»¥åŠè¡¥ä¸æƒ…å†µï¼Œæ–¹ä¾¿æ£€ç´¢ã€‚</li><li><a href="https://plant.max-richter.dev/">3Dæ¤ç‰©</a><br>ä¸€ä¸ªåœ¨çº¿çš„ 3D æ¤ç‰©æ„å»ºå™¨ï¼Œå¯ä»¥è°ƒèŠ‚å„ç§å‚æ•°ï¼Œç”Ÿæˆä¸€ä¸ª 3D æ¨¡å‹ã€‚</li><li><a href="https://every.to/napkin-math/steve-jobs-legacy-for-builders">ã€Šä¹”å¸ƒæ–¯çš„é—äº§ã€‹</a></li><li><a href="https://github.com/esteininger/vector-search">Aha Vector Search</a><br>çŸ¢é‡æœç´¢</li><li><a href="https://github.com/AmruthPillai/Reactive-Resume">ç®€å†ç”Ÿæˆå™¨ï¼šReactive-Resume</a></li><li><a href="https://github.com/windmill-labs/windmill">å¯è§†åŒ–å¼€å‘ï¼šwindmill</a></li><li><a href="https://github.com/sickcodes/Docker-OSX">Docker è·‘ macOSï¼šDocker-OSX</a></li><li><a href="https://github.com/tinacms/tinacms">headless CMSï¼štinacms</a><ul><li>è¿™æ˜¯ä¸€ä¸ªå®Œå…¨çš„ headless CMSï¼Œæ”¯æŒ Markdown å’Œå®æ—¶é¢„è§ˆçš„å¯è§†åŒ–ç¼–è¾‘ã€‚é™¤äº† Markdownï¼Œè¿˜æ”¯æŒ MDXã€JSONã€Yaml ç­‰ã€‚</li></ul></li><li><a href="https://github.com/blakeblackshear/frigate">æ‘„åƒå¤´ç›®æ ‡æ£€æµ‹ï¼šfrigate</a></li><li><a href="https://github.com/LHRUN/bubble">Bubble</a><ul><li>ä»“åº“æ”¶é›†å„ç§å¯ä»¥æ”¾åœ¨ GitHub Profile å’Œ Readme ä¸Šé¢çš„å°ç»„ä»¶</li></ul></li><li><a href="https://github.com/Tencent/tgfx">2D å›¾å½¢åº“ TGFX</a></li><li><a href="https://pag.art/">åŠ¨æ•ˆè§£å†³æ–¹æ¡ˆ PAG</a></li><li><a href="https://free-for.dev/">Free for Developers</a></li><li><a href="https://github.com/dnakov/little-rat">little-rat chromeç½‘ç»œæ’ä»¶</a></li><li><a href="https://ffmpeg-online.vercel.app/">åœ¨çº¿ffmpeg</a></li><li><a href="https://www.subdomain.center/">å­åŸŸåæŸ¥è¯¢ Subdomain Center</a></li><li><a href="https://ipinfo.io/">ipinfo.io</a></li><li><a href="https://ipapi.is/">ipapi.is</a></li><li><a href="https://github.com/docusealco/docuseal">ç­¾åæ’ä»¶ DocuSign</a></li><li><a href="https://github.com/wangrongding/github-old-feed">Github Old Feed</a></li><li><a href="https://github.com/zhbhun/idify">Idify-å·¥ä½œç…§ç”Ÿæˆ</a></li><li><a href="https://apps.apple.com/cn/app/niceshots/id6450619697">NiceShots-iPhoneæˆªå›¾ç¾åŒ–å·¥å…·</a></li><li><a href="https://rustdesk.com/">RustDesk</a></li><li><a href="https://github.com/GyulyVGC/sniffnet">Sniffnet</a></li><li><a href="https://www.automa.site/">Automa</a></li><li><a href="https://developer.chrome.com/docs/devtools/recorder/">ç”¨æˆ·è¡Œä¸ºå½•åˆ¶</a></li><li><a href="https://github.com/n8n-io/n8n">è‡ªåŠ¨åŒ–å·¥å…·n8n</a></li><li><a href="http://idphoto.aistart.cc/">å»å›¾ç‰‡èƒŒæ™¯</a></li></ul><h3 id="éŸ³ä¹"><a href="#éŸ³ä¹" class="headerlink" title="éŸ³ä¹"></a>éŸ³ä¹</h3><ul><li><a href="https://www.eartrainx.com/">EarTrainX</a><br><br/>è¯¥ç½‘ç«™æä¾›éŸ³ä¹åˆå­¦è€…çš„å„ç§å¬éŸ³ç»ƒä¹ ï¼Œè®­ç»ƒè¾¨è¯†æ—‹å¾‹çš„èƒ½åŠ›ã€‚</li><li><a href="http://imissmybar.com/">è‡ªå®šä¹‰é…’å§èƒŒæ™¯éŸ³</a></li><li><a href="https://learningmusic.ableton.com/zh-Hans/">éŸ³ä¹åˆ›ä½œç½‘ç«™</a></li><li><a href="https://mubert.com/">AI x Mubert</a></li></ul><h3 id="å°æ¸¸æˆ"><a href="#å°æ¸¸æˆ" class="headerlink" title="å°æ¸¸æˆ"></a>å°æ¸¸æˆ</h3><ul><li><a href="/game/snick.html" target="_blank">è´ªåƒè›‡</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> url </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GPT-AIä»‹ç»</title>
      <link href="/2023/04/11/ai/gpt/gpt/"/>
      <url>/2023/04/11/ai/gpt/gpt/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><ul><li><a href="https://chat.openai.com/">chat.openai</a></li></ul><h3 id="æ–‡ç”Ÿå›¾"><a href="#æ–‡ç”Ÿå›¾" class="headerlink" title="æ–‡ç”Ÿå›¾"></a>æ–‡ç”Ÿå›¾</h3><ul><li><a href="https://www.midjourney.com/">midjourney</a></li><li><a href="https://firefly.adobe.com/">Firefly</a></li><li><a href="https://editor.fusionbrain.ai/">Fusionbrain</a><br>   å…ğŸªœï¼Œå¤šç§é£æ ¼ï¼Œä¸é™é‡</li><li><a href="http://www.liuyuxiang.com:9999/chatIMG.html">å…è´¹æ–‡ç”Ÿå›¾</a><br>   æ¯å°æ—¶æœ‰é™åˆ¶æ•°</li></ul><h3 id="ç¼–ç¨‹åŠ©æ‰‹"><a href="#ç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="ç¼–ç¨‹åŠ©æ‰‹"></a>ç¼–ç¨‹åŠ©æ‰‹</h3><ul><li><a href="https://www.cursor.so/">Cursor</a><br>   å®¢æˆ·ç«¯è½¯ä»¶,å…è´¹æœ‰é™é¢</li><li><a href="https://codeium.com/">CodeiumğŸ”¥</a><br>   Webç«¯å’Œæ’ä»¶,æ”¯æŒå¤šç§ç¼–ç¨‹å·¥å…·,ä¸ªäººå…è´¹æš‚æ— é™é¢</li></ul><h3 id="ChatGPT"><a href="#ChatGPT" class="headerlink" title="ChatGPT"></a>ChatGPT</h3><ul><li><p><a href="https://auth.xf233.com/contribute">å…è´¹å…¬ç›Šå¹³å°</a></p></li><li><p><a href="https://app.myshell.ai/">MyShell</a><br> create robot</p></li><li><p><a href="https://you.com/">You</a><br>  éœ€ğŸªœ,å…è´¹ChatGPT3.5</p></li><li><p><a href="https://claude.ai/">Claude</a><br>  éœ€ğŸªœï¼Œwebç«¯ï¼Œå…è´¹ï¼ŒChatGPTå¹³æ›¿</p></li><li><p><a href="https://ai.w3school.top/">ä¸‰æ–¹chatç½‘ç«™</a></p><ul><li><a href="https://juejin.cn/post/7238917620849672247">æ­å»ºæ­¥éª¤</a></li></ul></li><li><p><a href="https://chat.forefront.ai/">Forefront</a><br>å…è´¹ gpt3.5, é™é¢gpt4</p></li></ul><ul><li><p><a href="https://gpt.ai-copilot.cn/#/home">AI Copilot</a></p></li><li><p><a href="https://shellgpt.top/#/chat">ShellGTPç»¼åˆå¹³å°</a></p><ul><li><a href="https://github.com/akl7777777/ShellGPT">Github</a></li></ul></li><li><p><a href="https://luna-oss.github.io/awesome-free-ai-apis/">APIæ¥å£</a></p></li><li><p><a href="https://github.com/LiLittleCat/awesome-free-chatgpt">AwesomeFreeChatGPT</a></p></li><li><p><a href="https://perplexity.ai/">æµè§ˆå™¨AIæ’ä»¶ğŸ”¥ğŸ”¥ğŸ”¥</a><br>  å¯ä»¥æ€»ç»“ç½‘é¡µä¿¡æ¯ã€æä¾›ç±»ä¼¼æŸ¥è¯¢ç­‰</p></li></ul><h3 id="å…¶ä»–AIå·¥å…·"><a href="#å…¶ä»–AIå·¥å…·" class="headerlink" title="å…¶ä»–AIå·¥å…·"></a>å…¶ä»–AIå·¥å…·</h3><ul><li><p><a href="https://mubert.com/render">ç”ŸæˆéŸ³ä¹</a></p></li><li><p><a href="https://www.mindshow.fun/">ç”Ÿæˆppt</a></p></li><li><p><a href="https://replicate.com/sczhou/codeformer">å›¾ç‰‡ä¿®å¤-1</a></p></li><li><p><a href="https://replicate.com/tencentarc/gfpgan">å›¾ç‰‡ä¿®å¤-2</a></p></li><li><p>æ–‡å­—ç”Ÿè§†é¢‘ï¼Œå½¢è±¡ç­‰</p><ul><li>1 <a href="http://kaiber.ai/">http://kaiber.ai</a></li><li>2 <a href="http://runwayml.com/">http://runwayml.com</a></li><li>3 <a href="http://studio.d-id.com/">http://studio.d-id.com</a></li><li>4 <a href="http://fliki.ai/">http://fliki.ai</a></li><li>5 <a href="http://synthesia.io/">http://synthesia.io</a></li><li>6 <a href="http://pictory.ai/">http://pictory.ai</a></li><li>7 <a href="http://app.heygen.com/">http://app.heygen.com</a></li><li>8 <a href="http://wonderdynamics.com/">http://wonderdynamics.com</a></li><li>9 <a href="http://alpha.genmo.ai/">http://alpha.genmo.ai</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aiç›¸å…³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLM-AIä»‹ç»</title>
      <link href="/2023/04/11/ai/llm/llm/"/>
      <url>/2023/04/11/ai/llm/llm/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><ul><li><a href="https://baijiahao.baidu.com/s?id=1762777142029974542&wfr=spider&for=pc">å¼€æºLLM,ChatGPTå¹³æ›¿</a></li><li><a href="https://freedomgpt.com/">freedomGPT-æ— é™åˆ¶å›ç­”</a></li><li><a href="https://chat.colossalai.org/">colossalai-æœ€æ¥è¿‘ChatGPTçš„é¡¹ç›®</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> LLM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ä¸Šé—®é¢˜å¤„ç†è¿‡ç¨‹-ES</title>
      <link href="/2023/03/29/error/es-error/"/>
      <url>/2023/03/29/error/es-error/</url>
      
        <content type="html"><![CDATA[<h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><ul><li>æ¥å£å‘Šè­¦ç¾¤æŠ›å‡ºæ¥å£è°ƒç”¨å¼‚å¸¸</li><li>APPé¦–é¡µæ— æ•°æ®</li><li>é˜¿é‡Œäº‘ElasticSearchçš„ç›‘æ§å¹³å°ï¼Œå‘ç°æœåŠ¡CPUå ç”¨è¿‡é«˜ï¼Œæœ‰æ…¢æŸ¥è¯¢</li></ul><h2 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h2><ul><li>çœ‹armsä¸Šæœ‰è°ƒç”¨esæœåŠ¡çš„æœåŠ¡æ¥å£è€—æ—¶æƒ…å†µï¼ŒæŸ¥æ‰¾å¼•èµ·cpuè¿‡é«˜çš„åŸå› </li></ul><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><ul><li>å…ˆä¸´æ—¶ä¸‹æ‰è€—æ—¶ä¹…çš„æ¥å£</li><li>esæŒ‰æ¥å£é‡å¯</li><li>æœåŠ¡ä¸­esè¿æ¥é…ç½®è®¾ç½®è¯»å–è¶…æ—¶æ—¶é—´</li></ul><h2 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h2><ul><li><a href="https://cloud.tencent.com/developer/article/1943055">Elasticsearch High Level Rest Clientå¶ç°è®¿é—®é›†ç¾¤è¶…æ—¶çš„é—®é¢˜å®šä½ä¸è§£å†³</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> çº¿ä¸Šé—®é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çº¿ä¸Šé—®é¢˜ </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eurekaæºç å­¦ä¹ ç¬”è®°(äºŒ)</title>
      <link href="/2023/03/16/backend/service/eureka/eureka-2/"/>
      <url>/2023/03/16/backend/service/eureka/eureka-2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Clientæ³¨å†Œã€æœåŠ¡ä¿¡æ¯åŒæ­¥ã€Serverç«¯æ”¶åˆ°ç»­çº¦å¿ƒè·³è¯·æ±‚çš„å¤„ç†ç»†èŠ‚</p></blockquote><h1 id="ä¸€ã€Clientæ³¨å†Œåˆ†æ"><a href="#ä¸€ã€Clientæ³¨å†Œåˆ†æ" class="headerlink" title="ä¸€ã€Clientæ³¨å†Œåˆ†æ"></a>ä¸€ã€Clientæ³¨å†Œåˆ†æ</h1><h2 id="1-å…¥å£ç±»"><a href="#1-å…¥å£ç±»" class="headerlink" title="1.å…¥å£ç±»"></a>1.å…¥å£ç±»</h2><pre><code class="java">@Configuration(proxyBeanMethods = false)@EnableConfigurationProperties@ConditionalOnClass(EurekaClientConfig.class)@ConditionalOnProperty(value = &quot;eureka.client.enabled&quot;, matchIfMissing = true)/**  * spring.cloud.discovery.enabled=trueæ‰ç”Ÿæ•ˆï¼Œé…ç½®é»˜è®¤ä¸ºtrue * */@ConditionalOnDiscoveryEnabled@AutoConfigureBefore(&#123;         NoopDiscoveryClientAutoConfiguration.class,        /** åˆå§‹åŒ–å®¢æˆ·ç«¯å¥åº·çŠ¶å†µæŒ‡ç¤ºå™¨: åˆå§‹åŒ–çŠ¶æ€ã€å¯åŠ¨çŠ¶æ€ */        CommonsClientAutoConfiguration.class,         ServiceRegistryAutoConfiguration.class &#125;)/** è‡ªåŠ¨æ³¨å…¥å®Œæˆåï¼Œæ³¨å…¥è¿™äº›ä¿¡æ¯ */@AutoConfigureAfter(name = &#123;        &quot;org.springframework.cloud.netflix.eureka.config.DiscoveryClientOptionalArgsConfiguration&quot;,                /** è‡ªåŠ¨åˆ·æ–°é…ç½® */        &quot;org.springframework.cloud.autoconfigure.RefreshAutoConfiguration&quot;,        /** clientæœåŠ¡å‘ç°é…ç½® */        &quot;org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientConfiguration&quot;,        /** æœåŠ¡è‡ªåŠ¨æ³¨å†Œé…ç½® */        &quot;org.springframework.cloud.client.serviceregistry.AutoServiceRegistrationAutoConfiguration&quot; &#125;)public class EurekaClientAutoConfiguration &#123;    /** clienté…ç½®bean */    @Bean    @ConditionalOnMissingBean(value = EurekaClientConfig.class,            search = SearchStrategy.CURRENT)    public EurekaClientConfigBean eurekaClientConfigBean(ConfigurableEnvironment env) &#123;        return new EurekaClientConfigBean();    &#125;    /** è·å–eureka.instanceå¼€å¤´çš„é…ç½®,å°è£…åˆ°EurekaInstanceConfigBeanç±»ä¸­ */    @Bean    @ConditionalOnMissingBean(value = EurekaInstanceConfig.class,            search = SearchStrategy.CURRENT)    public EurekaInstanceConfigBean eurekaInstanceConfigBean(            InetUtils inetUtils,            ManagementMetadataProvider managementMetadataProvider) &#123;     //...       &#125;    /** åˆå§‹åŒ–eurekaServiceæ³¨å†Œå™¨ï¼Œæä¾›registerã€deregister */    @Bean    public EurekaServiceRegistry eurekaServiceRegistry() &#123;        return new EurekaServiceRegistry();    &#125;        /** è‡ªåŠ¨æ³¨å†Œé€»è¾‘     * æä¾›startã€stopæ–¹æ³•     * */    @Bean    @ConditionalOnBean(AutoServiceRegistrationProperties.class)    @ConditionalOnProperty(            value = &quot;spring.cloud.service-registry.auto-registration.enabled&quot;,            matchIfMissing = true)    public EurekaAutoServiceRegistration eurekaAutoServiceRegistration(            ApplicationContext context, EurekaServiceRegistry registry,            EurekaRegistration registration) &#123;        return new EurekaAutoServiceRegistration(context, registry, registration);    &#125;&#125;</code></pre><ul><li>æ€»ç»“<pre><code class="textmate">1ï¼šé¡¹ç›®å¯åŠ¨2ï¼šåˆå§‹åŒ–é…ç½®EurekaClientAutoConfiguration -&gt; eurekaInstanceConfigBean3ï¼šæ„é€ EurekaClientå¯¹è±¡ï¼ˆå†…éƒ¨ç±»EurekaClientAutoConfiguration: RefreshableEurekaClientConfigurationï¼‰  3.1ï¼šæ„é€ å¿ƒè·³ä»»åŠ¡çº¿ç¨‹æ±   3.2ï¼šæ„é€ ç¼“å­˜åˆ·æ–°ä»»åŠ¡çº¿ç¨‹æ± 4ï¼šå¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼ˆå¿ƒè·³+ç¼“å­˜åˆ·æ–°ï¼‰  4.1ï¼šå¯åŠ¨ç¼“å­˜åˆ·æ–°å®šæ—¶ä»»åŠ¡  4.2ï¼šå¯åŠ¨å¿ƒè·³å®šæ—¶ä»»åŠ¡  4.3ï¼šå¯åŠ¨instanceInfoReplicatorçº¿ç¨‹ï¼Œæ‰§è¡Œæ³¨å†Œä»»åŠ¡5ï¼šæœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå»¶è¿Ÿ40ç§’å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œ6ï¼šå¿ƒè·³æ—¶é—´é»˜è®¤æ˜¯30ç§’ï¼Œå¯é€šè¿‡eureka.instance.lease-renewal-interval-in-secondsä¿®æ”¹</code></pre></li></ul><pre><code># äºŒã€æœåŠ¡ä¿¡æ¯åŒæ­¥åˆ†æ# ä¸‰ã€æœåŠ¡å¿ƒè·³ç»­çº¦åˆ†æ</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> eureka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eurekaæºç å­¦ä¹ ç¬”è®°æ±‡æ€»</title>
      <link href="/2023/03/16/backend/service/eureka/eureka/"/>
      <url>/2023/03/16/backend/service/eureka/eureka/</url>
      
        <content type="html"><![CDATA[<h2 id="2-ç›®æ ‡"><a href="#2-ç›®æ ‡" class="headerlink" title="2.ç›®æ ‡"></a>2.ç›®æ ‡</h2><ul><li><input checked="" disabled="" type="checkbox"> EurekaServerå¯åŠ¨æµç¨‹</li><li><input disabled="" type="checkbox"> Eureka Server å¤„ç†æ³¨å†Œè¯·æ±‚</li><li><input disabled="" type="checkbox"> Eureka Server æœåŠ¡ä¿¡æ¯åŒæ­¥</li><li><input disabled="" type="checkbox"> Eureka Serer æ”¶åˆ°ç»­çº¦å¿ƒè·³è¯·æ±‚çš„å¤„ç†</li><li><input disabled="" type="checkbox"> æœåŠ¡ç»­çº¦</li><li><input disabled="" type="checkbox"> æœåŠ¡å‘ç°</li><li><input disabled="" type="checkbox"> æœåŠ¡æ³¨å†Œå…¥å£</li><li><input disabled="" type="checkbox"> æœåŠ¡æ³¨å†Œè¯·æ±‚çš„å‘èµ·</li><li><input disabled="" type="checkbox"> Eureka çš„å¤šçº§ç¼“å­˜è®¾è®¡</li><li><input disabled="" type="checkbox"> Eureka è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</li></ul><h2 id="ç¬”è®°ç›®å½•"><a href="#ç¬”è®°ç›®å½•" class="headerlink" title="ç¬”è®°ç›®å½•"></a>ç¬”è®°ç›®å½•</h2><ul><li><a href="./eureka-1.md">Eurekaæºç å­¦ä¹ ç¬”è®°(ä¸€): EurekaServerå¯åŠ¨æµç¨‹</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> eureka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdownç”»å›¾</title>
      <link href="/2022/11/19/other/markdown/"/>
      <url>/2022/11/19/other/markdown/</url>
      
        <content type="html"><![CDATA[<h3 id="mermaidç”»å›¾"><a href="#mermaidç”»å›¾" class="headerlink" title="mermaidç”»å›¾"></a>mermaidç”»å›¾</h3><h4 id="åºåˆ—å›¾"><a href="#åºåˆ—å›¾" class="headerlink" title="åºåˆ—å›¾"></a>åºåˆ—å›¾</h4><pre class="mermaid">sequenceDiagram    participant serverA as AæœåŠ¡    participant serverB as BæœåŠ¡        note left of serverA : è¿™ä¸ªé€»è¾‘A    serverA->> serverA: å¤„ç†é€»è¾‘        activate serverA        serverA->> +serverB: è¯·æ±‚åˆ—è¡¨        loop  å¾ªç¯å¤„ç†            serverB->>serverB: æŸ¥è¯¢æ•°æ®        end        serverB-->> -serverA: è¿”å›ç»“æœ                serverA->>+serverB: è¯·æ±‚        serverB->>-serverA: è¿”å›    deactivate serverA        serverA-->>+serverB: è¯·æ±‚B    alt 0<num<10        serverB-->>serverB: é€»è¾‘ä¸€    else 10<=num<99        serverB-->>serverB: é€»è¾‘äºŒ    end        note left of serverA : å·¦è¾¹æ³¨é‡Š    note right of serverA : å³è¾¹æ³¨é‡Š    note over serverA : ä¸­é—´æ³¨é‡Š</pre><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://mermaid-js.github.io/mermaid/#/README">mermaidå®˜ç½‘</a></li><li><a href="https://blog.csdn.net/zhw21w/article/details/125749449">Markdownç”»åºåˆ—å›¾</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eurekaæºç å­¦ä¹ ç¬”è®°(ä¸€)</title>
      <link href="/2022/09/28/backend/service/eureka/eureka-1/"/>
      <url>/2022/09/28/backend/service/eureka/eureka-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>EurekaServerå¯åŠ¨æµç¨‹,åŒ…æ‹¬EurekaæœåŠ¡æ³¨å†Œã€å¿ƒè·³ã€æ³¨å†Œè¡¨åŒæ­¥ã€æœåŠ¡å‰”é™¤ç­‰æµç¨‹<br>åŸºäº4Ræ¶æ„ç†è®ºæ‹†è§£: é¡¶å±‚ç»“æ„(Rank) â€“&gt; ç»„æˆè§’è‰²(Role) â€“&gt; è§’è‰²å…³ç³»(Relation) â€“&gt; è¿ä½œè§„åˆ™(Rule)</p></blockquote><h1 id="ä¸€ã€Eurekaæ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€Eurekaæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€Eurekaæ˜¯ä»€ä¹ˆ"></a>ä¸€ã€Eurekaæ˜¯ä»€ä¹ˆ</h1><pre><code class="textmate">Eurekaæ˜¯ä¸€ä¸ªåŸºäºRESTåè®®(Representational State Transferè¡¨è¿°æ€§çŠ¶æ€è½¬ç§»)çš„æœåŠ¡,Eurekaè¿˜é™„å¸¦äº†ä¸€ä¸ªåŸºäºjavaçš„å®¢æˆ·ç«¯ç»„ä»¶Eureka clientï¼Œå®ƒä½¿ä¸æœåŠ¡çš„äº¤äº’æ›´åŠ å®¹æ˜“ã€‚å®¢æˆ·ç«¯è¿˜æœ‰ä¸€ä¸ªå†…ç½®çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºè¿›è¡ŒåŸºæœ¬çš„è½®è¯¢è´Ÿè½½å¹³è¡¡ã€‚Eurekaå¡«è¡¥äº†ä¸­é—´å±‚è´Ÿè½½å¹³è¡¡çš„éœ€æ±‚tips: REST,èµ„æº(URI)è¡¨è¿°æ€§çŠ¶æ€è½¬ç§»     çŠ¶æ€è½¬ç§»å°±æ˜¯å®¢æˆ·ç«¯é€šè¿‡ä¸€ç³»åˆ—è¯·æ±‚åŠ¨ä½œï¼Œæ¨åŠ¨æœåŠ¡ç«¯çš„èµ„æºçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œèµ„æºçš„çŠ¶æ€å¯ä»¥åœ¨ã€Œåˆ›å»º-ä¿®æ”¹-æŸ¥çœ‹-åˆ é™¤ã€ä¹‹é—´è½¬ç§»ã€‚</code></pre><p><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/imageseurek.png" alt="eureakç»„ä»¶å›¾"></p><h2 id="1-4Ræ‹†è§£"><a href="#1-4Ræ‹†è§£" class="headerlink" title="1. 4Ræ‹†è§£"></a>1. 4Ræ‹†è§£</h2><h3 id="1-1-é¡¶å±‚ç»“æ„"><a href="#1-1-é¡¶å±‚ç»“æ„" class="headerlink" title="1.1.é¡¶å±‚ç»“æ„"></a>1.1.é¡¶å±‚ç»“æ„</h3><ul><li>Eureka Serverï¼šEureka æœåŠ¡ç«¯</li><li>Eureka Clientï¼šEureka å®¢æˆ·ç«¯</li></ul><h3 id="1-2-ç»„æˆè§’è‰²"><a href="#1-2-ç»„æˆè§’è‰²" class="headerlink" title="1.2.ç»„æˆè§’è‰²"></a>1.2.ç»„æˆè§’è‰²</h3><ul><li>Eureka Serverï¼šEureka æœåŠ¡ç«¯</li><li>Eureka Clientï¼šEureka å®¢æˆ·ç«¯<ul><li>Application Providerï¼š æœåŠ¡ç”Ÿäº§è€…</li><li>Application Consumerï¼šæœåŠ¡æ¶ˆè´¹è€…</li></ul></li></ul><h3 id="1-3-è§’è‰²å…³ç³»"><a href="#1-3-è§’è‰²å…³ç³»" class="headerlink" title="1.3.è§’è‰²å…³ç³»"></a>1.3.è§’è‰²å…³ç³»</h3><pre><code class="textmate">EurekaServerç»´æŠ¤æ³¨å†Œè¡¨ã€ä¸»åŠ¨ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤è¶…æ—¶æœªç»­çº¦çš„EurekaClientEurekaClientå‘EurekaServeræ³¨å†Œè‡ªå·±çš„æœåŠ¡ã€å‘å¿ƒè·³ã€ä¸‹çº¿ã€è·å–æœåŠ¡åˆ—è¡¨ApplicationProvideræä¾›æœåŠ¡ApplicationConsumeræ¶ˆè´¹æœåŠ¡</code></pre><h3 id="1-4-è¿ä½œè§„å¾‹"><a href="#1-4-è¿ä½œè§„å¾‹" class="headerlink" title="1.4.è¿ä½œè§„å¾‹"></a>1.4.è¿ä½œè§„å¾‹</h3><pre><code class="textmate">æœåŠ¡æ³¨å†Œ Register: Client ç«¯ä¸»åŠ¨å‘ Server ç«¯æ³¨å†Œã€‚å¿ƒè·³ç»­çº¦ Renew: Client é»˜è®¤ä¼šæ¯éš”30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³åˆ° Server æ¥å®Œæˆç»­çº¦ã€‚ä¸»åŠ¨ä¸‹çº¿ Cancelï¼šClient ç«¯åœ¨åœæœºæ—¶ï¼ˆæ­£å¸¸åœæ­¢ï¼‰ä¸»åŠ¨å‘ Server å‘é€ä¸‹çº¿ï¼Œæç¤ºServerç«¯ä¸‹æ‰è‡ªå·±çš„æœåŠ¡è·å–æœåŠ¡åˆ—è¡¨ Get Registryï¼šClient ä» Server è·å–æ³¨å†Œè¡¨ï¼Œå¹¶å°†å…¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚ç¼“å­˜ä¿¡æ¯é»˜è®¤æ¯ 30s æ›´æ–°ä¸€æ¬¡ã€‚æ³¨å†Œè¡¨åŒæ­¥ Replicateï¼šå¤šä¸ª Server ä¹‹é—´é€šè¿‡ P2P å¤åˆ¶çš„æ–¹å¼å®ŒæˆæœåŠ¡æ³¨å†Œè¡¨çš„åŒæ­¥ã€‚æœåŠ¡å‰”é™¤ Evictionï¼šåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå½“ Client è¿ç»­ 90 ç§’æ²¡æœ‰å‘ Server å‘é€æœåŠ¡ç»­çº¦ï¼ŒServer ä¼šå°†è¯¥ Client ä»æœåŠ¡æ³¨å†Œåˆ—è¡¨åˆ é™¤ã€‚</code></pre><h2 id="2-å‰æœŸå‡†å¤‡"><a href="#2-å‰æœŸå‡†å¤‡" class="headerlink" title="2.å‰æœŸå‡†å¤‡"></a>2.å‰æœŸå‡†å¤‡</h2><ul><li><a href="https://github.com/spring-cloud/spring-cloud-netflix">spring-cloud-netflixæºç åœ°å€</a></li><li>SequenceDiagram Ideaæ’ä»¶</li></ul><h1 id="äºŒã€æœåŠ¡å¯åŠ¨æºç æ‹†è§£"><a href="#äºŒã€æœåŠ¡å¯åŠ¨æºç æ‹†è§£" class="headerlink" title="äºŒã€æœåŠ¡å¯åŠ¨æºç æ‹†è§£"></a>äºŒã€æœåŠ¡å¯åŠ¨æºç æ‹†è§£</h1><h2 id="1-å…¥å£åˆ†æ"><a href="#1-å…¥å£åˆ†æ" class="headerlink" title="1.å…¥å£åˆ†æ"></a>1.å…¥å£åˆ†æ</h2><blockquote><p>ä»¥@EnableEurekaServerä½œä¸ºåˆ‡å…¥ç‚¹å¼€å§‹åˆ†æ</p></blockquote><pre><code class="java">//1.ä½œç”¨: æ³¨å…¥EurekaServerMarkerConfigurationMarker.Markerå¯¹è±¡@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(EurekaServerMarkerConfiguration.class)public @interface EnableEurekaServer &#123;&#125;@Configuration(proxyBeanMethods = false)public class EurekaServerMarkerConfiguration &#123;  @Bean  public Marker eurekaServerMarkerBean() &#123;    return new Marker();  &#125;  class Marker &#123;&#125;&#125;//2.ä½œç”¨: åŠ è½½é…ç½®ã€åˆå§‹åŒ–EurekaServerç›¸å…³ç±»ã€å¯åŠ¨æœåŠ¡@Configuration(proxyBeanMethods = false)@Import(EurekaServerInitializerConfiguration.class)@ConditionalOnBean(EurekaServerMarkerConfiguration.Marker.class)@EnableConfigurationProperties(&#123; EurekaDashboardProperties.class,        InstanceRegistryProperties.class &#125;)@PropertySource(&quot;classpath:/eureka/server.properties&quot;)public class EurekaServerAutoConfiguration implements WebMvcConfigurer &#123;&#125;// 3.SpringCloudè‡ªåŠ¨è£…é…äº†EurekaServerAutoConfiguration/** org.springframework.boot.autoconfigure.EnableAutoConfiguration=\        org.springframework.cloud.netflix.eureka.server.EurekaServerAutoConfiguration**/</code></pre><ul><li>æµç¨‹æè¿°</li></ul><pre><code class="textmate">1.æ¡†æ¶è‡ªåŠ¨è£…é…EnableAutoConfiguration2.æœåŠ¡å¯åŠ¨ç±»æ·»åŠ @EnableEurekaServer,æ³¨å…¥EurekaServerMarkerConfiguration.Marker3.EurekaServerAutoConfigurationç±»çš„@ConditionalOnBeanç”Ÿæ•ˆ,EurekaServerAutoConfigurationå¼€å§‹åˆå§‹åŒ–</code></pre><h2 id="2-å¯åŠ¨è¿‡ç¨‹åºåˆ—å›¾"><a href="#2-å¯åŠ¨è¿‡ç¨‹åºåˆ—å›¾" class="headerlink" title="2.å¯åŠ¨è¿‡ç¨‹åºåˆ—å›¾"></a>2.å¯åŠ¨è¿‡ç¨‹åºåˆ—å›¾</h2><h3 id="2-1-ä¸»è¦æµç¨‹"><a href="#2-1-ä¸»è¦æµç¨‹" class="headerlink" title="2.1 ä¸»è¦æµç¨‹"></a>2.1 ä¸»è¦æµç¨‹</h3><pre class="mermaid">sequenceDiagram    participant SpringCloud    participant enable as @EnableEurekaServer    participant auto as EurekaServerAutoConfiguration    participant dashboard as EurekaDashboardProperties    participant serverContext as DefaultEurekaServerContext    participant node as PeerEurekaNodes    participant registry as InstanceRegistryProperties    participant FilterRegistrationBean    participant Application    participant EurekaServerConfigBeanConfiguration    participant conf as EurekaServerInitializerConfiguration    participant bootStrap as EurekaServerBootstrap    SpringCloud->>auto: 1.æ¡†æ¶è‡ªåŠ¨è£…é…     enable->>enable: 2.æ³¨å…¥Markerå¯¹è±¡Bean    note over auto: æœ‰Markerå¯¹è±¡Beanæ—¶æ‰æ³¨å…¥æ­¤Bean    note over registry: å¯¹ç­‰æ³¨å†Œè¡¨å®ä¾‹      #é…ç½®åŠ è½½    par 3.åŠ è½½é…ç½®    auto->>dashboard: 3.1 åŠ è½½é…ç½®(eureka.dashboard.*)    activate auto    auto->>registry: 3.2 åŠ è½½é…ç½®(eureka.instance.registry.*)    auto->>auto: 3.3 åŠ è½½é…ç½®(/eureka/server.properties)    deactivate auto    end      #EurekaServerAutoConfigurationä¸­æ³¨å…¥çš„Bean    par 4.æ³¨å…¥å…¶ä»–Bean      note right of auto: eureka.dashboard.enabled=trueæ‰æ³¨å…¥ï¼›æä¾›æœåŠ¡ç«¯è®¿é—®é¡µé¢çš„æ¥å£      auto->>auto: 4.1 æ³¨å…¥EurekaController        note right of auto: å¤åˆ¶å®¢æˆ·ç«¯æ—¶é™„åŠ è¿‡æ»¤å™¨      auto->>auto: 4.2 æ³¨å…¥ReplicationClientAdditionalFilters              auto->>registry: 4.3 æ³¨å…¥PeerAwareInstanceRegistry          note over node: å¯åˆ·æ–°çš„å¯¹ç­‰EureakNode      auto->>node: 4.4 æ³¨å…¥PeerEurekaNodes(é›†ç¾¤çš„ServerèŠ‚ç‚¹ä¿¡æ¯)          auto->>+serverContext: 4.5 æ³¨å…¥EurekaServerContext          serverContext->>serverContext: è§¦å‘initialize()æ–¹æ³•      serverContext->>node: start()      serverContext->>-registry: init()          auto->>bootStrap: 4.6 new()(åç»­å¯åŠ¨ä¸­ä½¿ç”¨)      auto->>FilterRegistrationBean: 4.7 Jerseyæ‹¦æˆªå™¨(å¼€æºRESTfulæ¡†æ¶)      auto->>Application: 4.8 æ„å»ºJerseyApplication      auto->>EurekaServerConfigBeanConfiguration: 4.9 EurekaæœåŠ¡å™¨é…ç½®Bean(ä»¥eureka.serverå¼€å¤´çš„é…ç½®)    end      note over conf: å®ç°äº†SmartLifecycle,Beanåˆå§‹åŒ–å®Œæˆåæ‰§è¡Œstart()    auto->>conf: 5.å¯¼å…¥EurekaServerInitializerConfigurationå®ä¾‹,å¯åŠ¨æˆåŠŸ[é‡è¦]</pre><h3 id="2-2-æ ¸å¿ƒæµç¨‹"><a href="#2-2-æ ¸å¿ƒæµç¨‹" class="headerlink" title="2.2 æ ¸å¿ƒæµç¨‹"></a>2.2 æ ¸å¿ƒæµç¨‹</h3><blockquote><p>EurekaServerInitializerConfigurationç±»åˆå§‹æµç¨‹</p></blockquote><pre class="mermaid">sequenceDiagram    participant conf as EurekaServerInitializerConfiguration    participant bootStrap as EurekaServerBootstrap    participant serverContent as DefaultEurekaServerContext    participant registry as InstanceRegistryProperties    participant node as PeerEurekaNodes    participant registry as PeerAwareInstanceRegistry    participant availableEvent as EurekaRegistryAvailableEvent    participant startEvent as EurekaServerStartedEvent    participant instance as AbstractInstanceRegistry    participant servlet as ServletContext     conf->>conf: start(),å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œä»¥ä¸‹æµç¨‹    conf->>bootStrap: contextInitialized()      bootStrap->>bootStrap: 1.initEurekaEnvironment()     bootStrap->>+registry: 2.syncUp()ä»å…¶ä»–èŠ‚ç‚¹è·å–æ³¨å†Œä¿¡æ¯,å¹¶æ³¨å†Œåˆ°æœ¬åœ°æ³¨å†Œè¡¨ä¸­    loop é»˜è®¤é‡è¯•5æ¬¡      registry->>registry: ä»ç¬¬äºŒæ¬¡å¾ªç¯å¼€å§‹,æ¯æ¬¡é»˜è®¤sleep30s      note over registry: è·å–EurekaClientåº”ç”¨åŠæ¯ä¸ªåº”ç”¨å®ä¾‹,æ³¨å†Œåˆ°æœ¬Serverä¸Š      registry->>registry: æœåŠ¡æ³¨å†Œ      registry->>instance: æ‰§è¡Œæ³¨å†Œæµç¨‹      instance->>+instance: register()          #æ³¨å†Œæµç¨‹      instance->>instance: æ·»åŠ è¯»é”      instance->>instance: åˆ¤æ–­è¯¥å®ä¾‹æ˜¯å¦åœ¨æ³¨å†Œè¡¨ä¸­å­˜åœ¨,ä¸å­˜åœ¨åˆ™æ³¨å†Œå®ä¾‹      instance->>instance: åˆ¤æ–­è¯¥æœåŠ¡æ˜¯å¦æœ‰å®ä¾‹IDï¼Œæœ‰æ›´æ–°å¦åˆ™æ–°å¢      instance->>instance: æ·»åŠ é˜Ÿåˆ—æ•°æ®ã€ç¼“å­˜å¤±æ•ˆ      registry->>-bootStrap: è¿”å›æ•°é‡    end    bootStrap->>registry: 4.openForTraffic()å¼€æ”¾æ³¨å†Œ    note right of conf: è°ƒæ•´æ¯åˆ†é’Ÿæ›´æ–°èŠ‚ç‚¹çš„é˜ˆå€¼,æ›´æ–°åº”ç”¨å®ä¾‹çŠ¶æ€ä¸ºUPã€å¼€å¯ä¸»åŠ¨ä¸‹çº¿å®ä¾‹ä¸€æ­¥ä»»åŠ¡    bootStrap->>bootStrap: EurekaMonitors.registerAllStats()      conf->>availableEvent: å‘å¸ƒeureakæ³¨å†Œè¡¨å¯ç”¨äº‹ä»¶ã€eurekaServeræœåŠ¡çŠ¶æ€è¿è¥çŠ¶æ€æ”¹ä¸ºtrue    conf->>startEvent: å‘å¸ƒeureakæœåŠ¡å¯åŠ¨äº‹ä»¶        serverContent->>servlet: å°†EurekaServerContextç±»æ·»åŠ åˆ°serveltä¸­</pre><h2 id="3-EurekaServerAutoConfigurationé…ç½®ç±»è¯¦è§£"><a href="#3-EurekaServerAutoConfigurationé…ç½®ç±»è¯¦è§£" class="headerlink" title="3.EurekaServerAutoConfigurationé…ç½®ç±»è¯¦è§£"></a>3.EurekaServerAutoConfigurationé…ç½®ç±»è¯¦è§£</h2><blockquote><p>ä¸»è¦ä½œç”¨æ˜¯åŠ è½½é…ç½®ã€æ³¨å…¥å…¶ä»–é…ç½®ç±»</p></blockquote><pre><code class="java">@Configuration(proxyBeanMethods = false)/** 1.TODOã€é‡è¦ã€‘å¯åŠ¨EurekaServeræœåŠ¡ã€å‘å¸ƒç›¸å…³äº‹ä»¶ **/@Import(EurekaServerInitializerConfiguration.class)/** 2.æ³¨å…¥æ ‡è®°ç±» **/@ConditionalOnBean(EurekaServerMarkerConfiguration.Marker.class)/** 3.åŠ è½½é…ç½® **/@EnableConfigurationProperties(&#123; EurekaDashboardProperties.class,        InstanceRegistryProperties.class &#125;)@PropertySource(&quot;classpath:/eureka/server.properties&quot;)public class EurekaServerAutoConfiguration implements WebMvcConfigurer &#123;    /**     * List of packages containing Jersey resources required by the Eureka server.     */    private static final String[] EUREKA_PACKAGES = new String[] &#123;            &quot;com.netflix.discovery&quot;, &quot;com.netflix.eureka&quot; &#125;;    @Autowired    private ApplicationInfoManager applicationInfoManager;    @Autowired    private EurekaServerConfig eurekaServerConfig;    @Autowired    private EurekaClientConfig eurekaClientConfig;    @Autowired    private EurekaClient eurekaClient;    @Autowired    private InstanceRegistryProperties instanceRegistryProperties;    /** æä¾›æœåŠ¡ç«¯è®¿é—®é¡µé¢çš„æ¥å£ **/    @Bean    @ConditionalOnProperty(prefix = &quot;eureka.dashboard&quot;, name = &quot;enabled&quot;,            matchIfMissing = true)    public EurekaController eurekaController() &#123;        return new EurekaController(this.applicationInfoManager);    &#125;    /** clientå®ä¾‹æ³¨å†Œ **/    @Bean    public PeerAwareInstanceRegistry peerAwareInstanceRegistry(            ServerCodecs serverCodecs) &#123;        this.eurekaClient.getApplications(); // force initialization        return new InstanceRegistry(this.eurekaServerConfig, this.eurekaClientConfig,                serverCodecs, this.eurekaClient,                this.instanceRegistryProperties.getExpectedNumberOfClientsSendingRenews(),                this.instanceRegistryProperties.getDefaultOpenForTrafficCount());    &#125;    /** å¯åˆ·æ–°çš„eurekaèŠ‚ç‚¹ **/    @Bean    @ConditionalOnMissingBean    public PeerEurekaNodes peerEurekaNodes(PeerAwareInstanceRegistry registry,            ServerCodecs serverCodecs,            ReplicationClientAdditionalFilters replicationClientAdditionalFilters) &#123;        return new RefreshablePeerEurekaNodes(registry, this.eurekaServerConfig,                this.eurekaClientConfig, serverCodecs, this.applicationInfoManager,                replicationClientAdditionalFilters);    &#125;    /** eurekaæœåŠ¡ä¸Šä¸‹æ–‡ **/    @Bean    @ConditionalOnMissingBean    public EurekaServerContext eurekaServerContext(ServerCodecs serverCodecs,            PeerAwareInstanceRegistry registry, PeerEurekaNodes peerEurekaNodes) &#123;        return new DefaultEurekaServerContext(this.eurekaServerConfig, serverCodecs,                registry, peerEurekaNodes, this.applicationInfoManager);    &#125;    /** åˆå§‹åŒ–Eureka-server,åˆå§‹åŒ–æœåŠ¡èŠ‚ç‚¹å¹¶æ³¨å†Œ **/    @Bean    public EurekaServerBootstrap eurekaServerBootstrap(PeerAwareInstanceRegistry registry,            EurekaServerContext serverContext) &#123;        return new EurekaServerBootstrap(this.applicationInfoManager,                this.eurekaClientConfig, this.eurekaServerConfig, registry,                serverContext);    &#125;    /** é…ç½®æ‹¦æˆªå™¨ï¼ŒServletContaineré‡Œé¢å®ç°äº†jerseyæ¡†æ¶ï¼Œé€šè¿‡ä»–æ¥å®ç°eurekaServerå¯¹å¤–çš„restFullæ¥å£ **/    /** jerseyæ¡†æ¶ å¼€æºçš„RESTfulæ¡†æ¶, å®ç°äº†JAX-RS (JSR 311 &amp; JSR 339) è§„èŒƒ     * Register the Jersey filter.     * @param eurekaJerseyApp an &#123;@link Application&#125; for the filter to be registered     * @return a jersey &#123;@link FilterRegistrationBean&#125;     */    @Bean    public FilterRegistrationBean&lt;?&gt; jerseyFilterRegistration(            javax.ws.rs.core.Application eurekaJerseyApp) &#123;        FilterRegistrationBean&lt;Filter&gt; bean = new FilterRegistrationBean&lt;Filter&gt;();        bean.setFilter(new ServletContainer(eurekaJerseyApp));        bean.setOrder(Ordered.LOWEST_PRECEDENCE);        bean.setUrlPatterns(                Collections.singletonList(EurekaConstants.DEFAULT_PREFIX + &quot;/*&quot;));        return bean;    &#125;    /**     * æ„å»ºJerseyåº”ç”¨ç¨‹åºå’ŒEurekaæœåŠ¡å™¨æ‰€éœ€çš„æ‰€æœ‰èµ„æºã€‚     */    @Bean    public javax.ws.rs.core.Application jerseyApplication(Environment environment,            ResourceLoader resourceLoader) &#123;            ClassPathScanningCandidateComponentProvider provider = new ClassPathScanningCandidateComponentProvider(                  false, environment);            // Filter to include only classes that have a particular annotation.          provider.addIncludeFilter(new AnnotationTypeFilter(Path.class));          provider.addIncludeFilter(new AnnotationTypeFilter(Provider.class));            // Find classes in Eureka packages (or subpackages)          Set&lt;Class&lt;?&gt;&gt; classes = new HashSet&lt;&gt;();          for (String basePackage : EUREKA_PACKAGES) &#123;              Set&lt;BeanDefinition&gt; beans = provider.findCandidateComponents(basePackage);              for (BeanDefinition bd : beans) &#123;                  Class&lt;?&gt; cls = ClassUtils.resolveClassName(bd.getBeanClassName(),                          resourceLoader.getClassLoader());                  classes.add(cls);              &#125;          &#125;            // Construct the Jersey ResourceConfig          Map&lt;String, Object&gt; propsAndFeatures = new HashMap&lt;&gt;();          propsAndFeatures.put(                  // Skip static content used by the webapp                  ServletContainer.PROPERTY_WEB_PAGE_CONTENT_REGEX,                  EurekaConstants.DEFAULT_PREFIX + &quot;/(fonts|images|css|js)/.*&quot;);            DefaultResourceConfig rc = new DefaultResourceConfig(classes);          rc.setPropertiesAndFeatures(propsAndFeatures);            return rc;    &#125;    @Bean    @ConditionalOnBean(name = &quot;httpTraceFilter&quot;)    public FilterRegistrationBean&lt;?&gt; traceFilterRegistration(            @Qualifier(&quot;httpTraceFilter&quot;) Filter filter) &#123;        FilterRegistrationBean&lt;Filter&gt; bean = new FilterRegistrationBean&lt;Filter&gt;();        bean.setFilter(filter);        bean.setOrder(Ordered.LOWEST_PRECEDENCE - 10);        return bean;    &#125;    /** é…ç½® EurekaæœåŠ¡å™¨é…ç½®Bean **/    @Configuration(proxyBeanMethods = false)    protected static class EurekaServerConfigBeanConfiguration &#123;        @Bean        @ConditionalOnMissingBean        public EurekaServerConfig eurekaServerConfig(EurekaClientConfig clientConfig) &#123;            EurekaServerConfigBean server = new EurekaServerConfigBean();            if (clientConfig.shouldRegisterWithEureka()) &#123;                //è®¾ç½®æ³¨å†Œè¡¨åŒæ­¥é‡è¯•æ¬¡æ•°                server.setRegistrySyncRetries(5);            &#125;            return server;        &#125;    &#125;&#125;</code></pre><h2 id="4-EurekaServerInitializerConfigurationæºç "><a href="#4-EurekaServerInitializerConfigurationæºç " class="headerlink" title="4.EurekaServerInitializerConfigurationæºç "></a>4.EurekaServerInitializerConfigurationæºç </h2><blockquote><p>ä¸»è¦ä½œç”¨ç®¡ç†EurekaServeræœåŠ¡ç”Ÿå‘½å‘¨æœŸ</p></blockquote><pre><code class="java">/**  * å®ç°äº†Lifecycleæ–¹æ³•ï¼Œå¯¹è±¡åˆå§‹åŒ–å®Œæˆåå¼€å§‹æ‰§è¡Œstart()ã€å¯¹è±¡é”€æ¯æ—¶è°ƒç”¨stop() * **/@Configuration(proxyBeanMethods = false)public class EurekaServerInitializerConfiguration        implements ServletContextAware, SmartLifecycle, Ordered &#123;        @Override    public void start() &#123;      new Thread(() -&gt; &#123;        try &#123;          /** TODOã€é‡è¦ã€‘åˆå§‹åŒ–ç¯å¢ƒå˜é‡ã€å¯åŠ¨EurekaServerèŠ‚ç‚¹ã€åŒæ­¥æ³¨å†Œè¡¨ä¿¡æ¯ç­‰ **/          eurekaServerBootstrap.contextInitialized(                  EurekaServerInitializerConfiguration.this.servletContext);          log.info(&quot;Started Eureka Server&quot;);            //å‘å¸ƒæ³¨å†Œè¡¨å¯ç”¨äº‹ä»¶          publish(new EurekaRegistryAvailableEvent(getEurekaServerConfig()));                  //è®¾ç½®EurekaServeræœåŠ¡çŠ¶æ€ä¸ºrunning          EurekaServerInitializerConfiguration.this.running = true;                  //å‘å¸ƒEurekaServerå¯åŠ¨æˆåŠŸäº‹ä»¶          publish(new EurekaServerStartedEvent(getEurekaServerConfig()));        &#125; catch (Exception ex) &#123;          // Help!          log.error(&quot;Could not initialize Eureka servlet context&quot;, ex);        &#125;      &#125;).start();    &#125;      /** beané”€æ¯å‰è¿è¡Œ **/    @Override    public void stop() &#123;        this.running = false;        eurekaServerBootstrap.contextDestroyed(this.servletContext);    &#125;&#125;</code></pre><h3 id="4-1-EurekaServerBootstrapæºç è§£æ"><a href="#4-1-EurekaServerBootstrapæºç è§£æ" class="headerlink" title="4.1.EurekaServerBootstrapæºç è§£æ"></a>4.1.EurekaServerBootstrapæºç è§£æ</h3><blockquote><p>å¯åŠ¨å¼•å¯¼, æä¾›åˆå§‹åŒ–ã€é”€æ¯æ–¹æ³•</p></blockquote><pre><code class="java">class EurekaServerBootstrap&#123;    /** åˆå§‹åŒ–EurekaServerContext **/    public void contextInitialized(ServletContext context) &#123;        try &#123;            //åˆå§‹åŒ–ç¯å¢ƒå˜é‡            initEurekaEnvironment();            //TODOã€é‡è¦ã€‘åˆå§‹åŒ–EurekaèŠ‚ç‚¹åˆ—è¡¨ã€åŒæ­¥æ³¨å†Œè¡¨ä¿¡æ¯ç­‰            initEurekaServerContext();                      context.setAttribute(EurekaServerContext.class.getName(), this.serverContext);        &#125; catch (Throwable e) &#123;            log.error(&quot;Cannot bootstrap eureka server :&quot;, e);            throw new RuntimeException(&quot;Cannot bootstrap eureka server :&quot;, e);        &#125;    &#125;    /** é”€æ¯EurekaServerContext **/    public void contextDestroyed(ServletContext context) &#123;      try &#123;          log.info(&quot;Shutting down Eureka Server..&quot;);          context.removeAttribute(EurekaServerContext.class.getName());            //å…³é—­Eurekaç›‘è§†å™¨ã€å…³é—­ä¸Šä¸‹æ–‡ç­‰          destroyEurekaServerContext();                  //ç”¨æˆ·å¯ä»¥é‡å†™æ¬¡æ–¹æ³•æ¥æ¸…ç†ç¯å¢ƒå˜é‡          destroyEurekaEnvironment();      &#125; catch (Throwable e) &#123;        log.error(&quot;Error shutting down eureka&quot;, e);      &#125;      log.info(&quot;Eureka Service is now shutdown...&quot;);    &#125;  protected void initEurekaServerContext() throws Exception &#123;    // For backward compatibility    JsonXStream.getInstance().registerConverter(new V1AwareInstanceInfoConverter(),            XStream.PRIORITY_VERY_HIGH);    XmlXStream.getInstance().registerConverter(new V1AwareInstanceInfoConverter(),            XStream.PRIORITY_VERY_HIGH);    if (isAws(this.applicationInfoManager.getInfo())) &#123;      this.awsBinder = new AwsBinderDelegate(this.eurekaServerConfig,              this.eurekaClientConfig, this.registry, this.applicationInfoManager);      this.awsBinder.start();    &#125;    //åˆå§‹åŒ–ä¸Šä¸‹æ–‡holder    EurekaServerContextHolder.initialize(this.serverContext);    log.info(&quot;Initialized server context&quot;);    //ä»ç›¸é‚»èŠ‚ç‚¹åŒæ­¥æ³¨å†Œä¿¡æ¯    int registryCount = this.registry.syncUp();    //å¯åŠ¨å„ç§å¼‚æ­¥ä»»åŠ¡ã€ä¿®æ”¹å®ä¾‹çŠ¶æ€ä¸ºUPã€å¼€å¯å®ä¾‹ä¸»åŠ¨ä¸‹çº¿ä»»åŠ¡    this.registry.openForTraffic(this.applicationInfoManager, registryCount);    // æ³¨å†Œæ‰€æœ‰ç›‘æ§ç»Ÿè®¡ä¿¡æ¯ã€‚    EurekaMonitors.registerAllStats();  &#125;&#125;</code></pre><h4 id="4-1-1-EurekaServerContextè¯¦è§£"><a href="#4-1-1-EurekaServerContextè¯¦è§£" class="headerlink" title="4.1.1.EurekaServerContextè¯¦è§£"></a>4.1.1.EurekaServerContextè¯¦è§£</h4><blockquote><p>å®é™…æ˜¯åˆå§‹åŒ–äº†DefaultEurekaServerContextç±»,åœ¨EurekaServerAutoConfigurationä¸­åˆå§‹åŒ–</p></blockquote><pre><code class="java">@Singletonpublic class DefaultEurekaServerContext implements EurekaServerContext &#123;    private static final Logger logger = LoggerFactory.getLogger(DefaultEurekaServerContext.class);      private final PeerAwareInstanceRegistry registry;    private final PeerEurekaNodes peerEurekaNodes;    @PostConstruct    @Override    public void initialize() &#123;      logger.info(&quot;Initializing ...&quot;);      /**       * TODOã€é‡è¦ã€‘       * 1.åˆ›å»ºå•çº¿ç¨‹æ± ä½œä¸ºå¼‚æ­¥ä»»åŠ¡çº¿ç¨‹       * 2.æ›´æ–°eurekaèŠ‚ç‚¹é›†åˆ       * 3.åˆ›å»ºä¸€ä¸ªå‘¨æœŸæ€§å¼‚æ­¥ä»»åŠ¡       *     10åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡eurekaèŠ‚ç‚¹é›†åˆ       * **/      peerEurekaNodes.start();      try &#123;          /**            * TODOã€é‡è¦ã€‘           * 1.60sæ›´æ–°ä¸€æ¬¡æœ€è¿‘æœ€å°å¤åˆ¶æ¬¡æ•°           * 2.åˆå§‹åŒ–å“åº”ç¼“å­˜ã€å¼€å¯å®šæ—¶æ›´æ–°clientç«¯ç¼“å­˜ä»»åŠ¡,30sæ›´æ–°ä¸€æ¬¡           * 3.å¼€å¯å®šæ—¶æ›´æ–°&lt;æ›´æ–°é˜ˆå€¼&gt;ä»»åŠ¡ã€‚æ›´æ–°é˜ˆå€¼å°†ç”¨äºç¡®å®šæ˜¯å¦ç”±äºç½‘ç»œåˆ†åŒºè€Œå¯¼è‡´æ›´æ–°æ•°é‡æ€¥å‰§ä¸‹é™ï¼Œå¹¶ä¿æŠ¤ä¸€æ¬¡è¿‡æœŸçš„å®ä¾‹è¿‡å¤šã€‚           * 4.åˆå§‹åŒ–æ³¨å†Œä¸­å¿ƒ           * **/        registry.init(peerEurekaNodes);      &#125; catch (Exception e) &#123;        throw new RuntimeException(e);      &#125;      logger.info(&quot;Initialized&quot;);    &#125;      /** å…³é—­å„ç§å®¹å™¨ã€ç›‘è§†å™¨ç­‰ **/    @PreDestroy    @Override    public void shutdown() &#123;      logger.info(&quot;Shutting down ...&quot;);      registry.shutdown();      peerEurekaNodes.shutdown();      ServoControl.shutdown();      EurekaMonitors.shutdown();      logger.info(&quot;Shut down&quot;);    &#125;    //ã€‚ã€‚ã€‚&#125;</code></pre><h3 id="4-2-peerEurekaNodes-start-åˆ†æ"><a href="#4-2-peerEurekaNodes-start-åˆ†æ" class="headerlink" title="4.2.peerEurekaNodes.start()åˆ†æ"></a>4.2.peerEurekaNodes.start()åˆ†æ</h3><blockquote><p>æ›´æ–°èŠ‚ç‚¹é›†åˆï¼Œå¹¶å®šä¹‰å®šæ—¶æ›´æ–°èŠ‚ç‚¹é›†åˆä»»åŠ¡</p></blockquote><pre><code class="java">@Singletonpublic class PeerEurekaNodes &#123;    public void start() &#123;        //å•çº¿ç¨‹çº¿ç¨‹æ±         taskExecutor = Executors.newSingleThreadScheduledExecutor(                new ThreadFactory() &#123;                  @Override                  public Thread newThread(Runnable r) &#123;                    Thread thread = new Thread(r, &quot;Eureka-PeerNodesUpdater&quot;);                    thread.setDaemon(true);                    return thread;                  &#125;                &#125;        );        try &#123;                      //æ›´æ–°eurekaèŠ‚ç‚¹é›†åˆ            updatePeerEurekaNodes(resolvePeerUrls());                      //å®šä¹‰å¼‚æ­¥ä»»åŠ¡            Runnable peersUpdateTask = new Runnable() &#123;              @Override              public void run() &#123;                try &#123;                  updatePeerEurekaNodes(resolvePeerUrls());                &#125; catch (Throwable e) &#123;                  logger.error(&quot;Cannot update the replica Nodes&quot;, e);                &#125;              &#125;            &#125;;            //10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æ›´æ–°eurekaèŠ‚ç‚¹ä»»åŠ¡            taskExecutor.scheduleWithFixedDelay(                    peersUpdateTask,                    serverConfig.getPeerEurekaNodesUpdateIntervalMs(),                    serverConfig.getPeerEurekaNodesUpdateIntervalMs(),                    TimeUnit.MILLISECONDS            );        &#125; catch (Exception e) &#123;          throw new IllegalStateException(e);        &#125;        for (PeerEurekaNode node : peerEurekaNodes) &#123;          logger.info(&quot;Replica node URL:  &#123;&#125;&quot;, node.getServiceUrl());        &#125;    &#125;      //è§£æeurekaèŠ‚ç‚¹url    protected List&lt;String&gt; resolvePeerUrls() &#123;        InstanceInfo myInfo = applicationInfoManager.getInfo();        String zone = InstanceInfo.getZone(clientConfig.getAvailabilityZones(clientConfig.getRegion()), myInfo);        List&lt;String&gt; replicaUrls = EndpointUtils                .getDiscoveryServiceUrls(clientConfig, zone, new EndpointUtils.InstanceInfoBasedUrlRandomizer(myInfo));              int idx = 0;        while (idx &lt; replicaUrls.size()) &#123;          if (isThisMyUrl(replicaUrls.get(idx))) &#123;            replicaUrls.remove(idx);          &#125; else &#123;            idx++;          &#125;        &#125;        return replicaUrls;    &#125;      //æ›´æ–°EurekaèŠ‚ç‚¹ä¿¡æ¯é›†åˆ    protected void updatePeerEurekaNodes(List&lt;String&gt; newPeerUrls) &#123;      if (newPeerUrls.isEmpty()) &#123;        logger.warn(&quot;The replica size seems to be empty. Check the route 53 DNS Registry&quot;);        return;      &#125;        Set&lt;String&gt; toShutdown = new HashSet&lt;&gt;(peerEurekaNodeUrls);      toShutdown.removeAll(newPeerUrls);      Set&lt;String&gt; toAdd = new HashSet&lt;&gt;(newPeerUrls);      toAdd.removeAll(peerEurekaNodeUrls);        if (toShutdown.isEmpty() &amp;&amp; toAdd.isEmpty()) &#123; // No change        return;      &#125;        // Remove peers no long available      List&lt;PeerEurekaNode&gt; newNodeList = new ArrayList&lt;&gt;(peerEurekaNodes);        if (!toShutdown.isEmpty()) &#123;        logger.info(&quot;Removing no longer available peer nodes &#123;&#125;&quot;, toShutdown);        int i = 0;        while (i &lt; newNodeList.size()) &#123;          PeerEurekaNode eurekaNode = newNodeList.get(i);          if (toShutdown.contains(eurekaNode.getServiceUrl())) &#123;              newNodeList.remove(i);              eurekaNode.shutDown();          &#125; else &#123;              i++;          &#125;        &#125;      &#125;        // Add new peers      if (!toAdd.isEmpty()) &#123;        logger.info(&quot;Adding new peer nodes &#123;&#125;&quot;, toAdd);        for (String peerUrl : toAdd) &#123;            newNodeList.add(createPeerEurekaNode(peerUrl));        &#125;      &#125;        this.peerEurekaNodes = newNodeList;      this.peerEurekaNodeUrls = new HashSet&lt;&gt;(newPeerUrls);    &#125;&#125;</code></pre><h3 id="4-3-registry-init-åˆ†æ"><a href="#4-3-registry-init-åˆ†æ" class="headerlink" title="4.3.registry.init()åˆ†æ"></a>4.3.registry.init()åˆ†æ</h3><blockquote><p>åˆå§‹åŒ–å“åº”ç¼“å­˜ã€å¤„ç†äºŒçº§ç¼“å­˜ç›¸å…³ä¸šåŠ¡é€»è¾‘</p></blockquote><pre><code class="java">@Singletonpublic class PeerAwareInstanceRegistryImpl extends AbstractInstanceRegistry implements PeerAwareInstanceRegistry &#123;    @Override    public void init(PeerEurekaNodes peerEurekaNodes) throws Exception &#123;        //1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æœ€åæœ€å°å¤åˆ¶æ•°        this.numberOfReplicationsLastMin.start();        this.peerEurekaNodes = peerEurekaNodes;              /**          * åˆå§‹åŒ–å“åº”ç¼“å­˜ï¼Œè¿‡æœŸæ—¶é—´         * æ­¤å¤„åšäº†ä¸¤çº§ç¼“å­˜ï¼Œæ ¹æ®shouldUseReadOnlyResponseCache=trueåˆ¤æ–­ï¼Œé»˜è®¤true         *     ps:é€šè¿‡eureka.shouldUseReadOnlyResponseCacheé…ç½®         *           *  readWriteCacheMap(äºŒçº§ç¼“å­˜,ç¼“å­˜180s)ã€readOnlyCacheMap(ä¸‰çº§ç¼“å­˜,30såˆ·æ–°ä¸€æ¬¡)         *      readOnlyCacheMap å®šæ—¶ä» readWriteCacheMap ä¸­æ›´æ–°ç¼“å­˜         * **/        initializedResponseCache();        scheduleRenewalThresholdUpdateTask();        initRemoteRegionRegistry();          try &#123;          Monitors.registerObject(this);        &#125; catch (Throwable e) &#123;          logger.warn(&quot;Cannot register the JMX monitor for the InstanceRegistry :&quot;, e);        &#125;    &#125;&#125;</code></pre><ul><li>Eurekaä¸­çš„ä¸‰çº§ç¼“å­˜</li></ul><table><thead><tr><th>ç¼“å­˜</th><th>æ•°æ®ç±»å‹</th><th>æºç ä¸­ä½ç½®</th><th>æè¿°</th></tr></thead><tbody><tr><td>registry(ä¸€çº§)</td><td>ConcurrentHashMap&lt;String, Map&lt;String, Lease<InstanceInfo>&gt;&gt;</td><td>AbstractInstanceRegistry.registry</td><td>å®æ—¶æ›´æ–°ï¼Œåˆç§°<strong>æ³¨å†Œè¡¨</strong>ï¼ŒUIç•Œé¢ä»è¿™é‡Œè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯</td></tr><tr><td>readWriteCacheMap(äºŒçº§)</td><td>com.google.common.cache.LoadingCache</td><td>ResponseCacheImpl</td><td>ç¼“å­˜æ—¶é—´é»˜è®¤180ç§’(eureka.responseCacheAutoExpirationInSecondsé…ç½®)</td></tr><tr><td>readOnlyCacheMap(ä¸‰çº§)</td><td>ConcurrentHashMap</td><td>ResponseCacheImpl</td><td>æ¯30såŒæ­¥readWriteCacheMapæ•°æ®ï¼ŒEurekaClienté»˜è®¤ä»è¿™é‡Œè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯(å¯é…ç½®)</td></tr></tbody></table><ul><li>initä¸­è®¡ç®—ä»»åŠ¡å¼€å§‹æ—¶é—´ä»£ç ç¤ºä¾‹</li></ul><pre><code class="java">class Test &#123;  /** registry.init()ä¸­è®¡ç®—ä»»åŠ¡å¼€å§‹æ—¶é—´ **/  public static void main(String[] args) throws InterruptedException &#123;    int responseCacheUpdateIntervalMs = 30 * 1000;    for(int i=0; i&lt;3; i++)&#123;      Thread.sleep(1000);      Date dt = new Date(              ( (System.currentTimeMillis() / responseCacheUpdateIntervalMs) * responseCacheUpdateIntervalMs)                      + responseCacheUpdateIntervalMs);      System.out.println(DateUtils.formatDateYMDHMS(dt));    &#125;  &#125;  /**   * ç»“æœ:    * 2022-11-23 14:45:30   * 2022-11-23 14:45:30   * 2022-11-23 14:45:30   * **/&#125;</code></pre><h2 id="5-åŒæ­¥é›†ç¾¤èŠ‚ç‚¹æ³¨å†Œè¡¨-PeerAwareInstanceRegistry-syncUp"><a href="#5-åŒæ­¥é›†ç¾¤èŠ‚ç‚¹æ³¨å†Œè¡¨-PeerAwareInstanceRegistry-syncUp" class="headerlink" title="5.åŒæ­¥é›†ç¾¤èŠ‚ç‚¹æ³¨å†Œè¡¨ PeerAwareInstanceRegistry.syncUp()"></a>5.åŒæ­¥é›†ç¾¤èŠ‚ç‚¹æ³¨å†Œè¡¨ PeerAwareInstanceRegistry.syncUp()</h2><pre><code class="java">class PeerAwareInstanceRegistry &#123;    @Override    public int syncUp() &#123;      // ç»Ÿè®¡åŒæ­¥åˆ°æœ¬åœ°æ³¨å†Œè¡¨çš„å®ä¾‹æ•°      int count = 0;          // é»˜è®¤é‡è¯•5æ¬¡ï¼Œæ¯æ¬¡é—´éš”30ç§’, æˆåŠŸä¸€æ¬¡åˆ™ä¸å†é‡è¯•      for (int i = 0; ((i &lt; serverConfig.getRegistrySyncRetries()) &amp;&amp; (count == 0)); i++) &#123;        if (i &gt; 0) &#123;          try &#123;            Thread.sleep(serverConfig.getRegistrySyncRetryWaitMs());          &#125; catch (InterruptedException e) &#123;            logger.warn(&quot;Interrupted during registry transfer..&quot;);            break;          &#125;        &#125;        // æ‹‰å–é›†ç¾¤èŠ‚ç‚¹æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡å®ä¾‹ä¿¡æ¯        Applications apps = eurekaClient.getApplications();        for (Application app : apps.getRegisteredApplications()) &#123;          for (InstanceInfo instance : app.getInstances()) &#123;            try &#123;              if (isRegisterable(instance)) &#123;                  //TODOã€é‡è¦ã€‘æ³¨å†Œå®ä¾‹åˆ°æœ¬åœ°æ³¨å†Œè¡¨                  register(instance, instance.getLeaseInfo().getDurationInSecs(), true);                  count++;              &#125;            &#125; catch (Throwable t) &#123;              logger.error(&quot;During DS init copy&quot;, t);            &#125;          &#125;        &#125;      &#125;      return count;    &#125;&#125;</code></pre><h2 id="6-PeerAwareInstanceRegistry-openForTraffic"><a href="#6-PeerAwareInstanceRegistry-openForTraffic" class="headerlink" title="6.PeerAwareInstanceRegistry.openForTraffic()"></a>6.PeerAwareInstanceRegistry.openForTraffic()</h2><pre><code class="java">@Singletonpublic class PeerAwareInstanceRegistryImpl extends AbstractInstanceRegistry implements PeerAwareInstanceRegistry &#123;    @Override    public void openForTraffic(ApplicationInfoManager applicationInfoManager, int count) &#123;        //...çœç•¥        logger.info(&quot;Changing status to UP&quot;);        //è®¾ç½®çŠ¶æ€        applicationInfoManager.setInstanceStatus(InstanceStatus.UP);        //æ‰§è¡Œåˆå§‹åŒ–å,åç»­ä»»åŠ¡        super.postInit();    &#125;&#125;public abstract class AbstractInstanceRegistry implements InstanceRegistry &#123;    private final AtomicReference&lt;EvictionTask&gt; evictionTaskRef = new AtomicReference&lt;EvictionTask&gt;();    protected void postInit() &#123;      renewsLastMin.start();      //é©±é€ä»»åŠ¡      if (evictionTaskRef.get() != null) &#123;            evictionTaskRef.get().cancel();      &#125;      evictionTaskRef.set(new EvictionTask());      //å¯åŠ¨å®šæ—¶é©±é€ä»»åŠ¡      evictionTimer.schedule(evictionTaskRef.get(),              serverConfig.getEvictionIntervalTimerInMs(),              serverConfig.getEvictionIntervalTimerInMs());    &#125;&#125;</code></pre><h2 id="7-å¯åŠ¨è¿‡ç¨‹æ€»ç»“"><a href="#7-å¯åŠ¨è¿‡ç¨‹æ€»ç»“" class="headerlink" title="7.å¯åŠ¨è¿‡ç¨‹æ€»ç»“"></a>7.å¯åŠ¨è¿‡ç¨‹æ€»ç»“</h2><pre><code class="textmate">1.åŠ è½½é…ç½®    eureka.server    eureka.dashboard    eureka.instance.registry    /eureka/server.properties2.åˆå§‹åŒ–ç›¸å…³ç±»    åˆå§‹åŒ–PeerEurekaNodes(EurekaServerèŠ‚ç‚¹ç±»)    åˆå§‹åŒ–EurekaServerBootstrapã€    åˆå§‹åŒ–ä¸Šä¸‹æ–‡åŠå…¶ä»–ç›¸å…³ç±»3.åˆå§‹åŒ–EurekaServer    åˆå§‹åŒ–ç¯å¢ƒå˜é‡    åˆå§‹åŒ–EurekaServerä¸Šä¸‹æ–‡ã€åŒæ­¥èŠ‚ç‚¹ä¿¡æ¯ã€å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ã€ä¿®æ”¹å®ä¾‹çŠ¶æ€    å‘å¸ƒç›¸å…³äº‹ä»¶(æ³¨å†Œè¡¨å¯ç”¨äº‹ä»¶ã€EurekaServerå¯åŠ¨äº‹ä»¶)</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> eureka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç›¸å…³-jsonç±»å‹</title>
      <link href="/2022/06/01/backend/storage/mysql-json/"/>
      <url>/2022/06/01/backend/storage/mysql-json/</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><blockquote><p>MySQL 5.7 å¢åŠ äº† JSON æ•°æ®ç±»å‹çš„æ”¯æŒ; å¯ä»¥ç›´æ¥é€šè¿‡å†…ç½®è¯­æ³•å¯¹jsonç»“æ„æ•°æ®è¿›è¡Œæ“ä½œ<br>æ³¨æ„: å¯¹jsonç»“æ„ä½ç½®ä¸èƒ½å˜æ›´çš„ä¸šåŠ¡ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨varcharæˆ–è€…textç­‰ç»“æ„å­˜å‚¨ï¼Œjsonç±»å‹ä¼šä¼˜åŒ–keyé¡ºåº</p></blockquote><h3 id="æŸ¥è¯¢è¯­æ³•"><a href="#æŸ¥è¯¢è¯­æ³•" class="headerlink" title="æŸ¥è¯¢è¯­æ³•"></a>æŸ¥è¯¢è¯­æ³•</h3><table><thead><tr><th>è¯­æ³•</th><th>æè¿°</th><th>æœ€å°å¯ç”¨ç‰ˆæœ¬(5.7+)</th><th>å·²å¼ƒç”¨</th></tr></thead><tbody><tr><td>-&gt;</td><td>è¯„ä¼°è·¯å¾„åä» JSON åˆ—è¿”å›å€¼ï¼›ç›¸å½“äº JSON_EXTRACT()ã€‚</td><td></td><td></td></tr><tr><td>-&gt;&gt;</td><td>è¯„ä¼°è·¯å¾„å¹¶å–æ¶ˆå¼•ç”¨ç»“æœåä» JSON åˆ—è¿”å›å€¼ï¼›ç›¸å½“äº JSON_UNQUOTE(JSON_EXTRACT())ã€‚</td><td>5.7.13</td><td></td></tr><tr><td>JSON_APPEND()</td><td>å°†æ•°æ®é™„åŠ åˆ° JSON æ–‡æ¡£</td><td>Y</td><td></td></tr><tr><td>JSON_ARRAY()</td><td>åˆ›å»º JSON æ•°ç»„</td><td></td><td></td></tr><tr><td>JSON_ARRAY_APPEND()</td><td>å°†æ•°æ®é™„åŠ åˆ° JSON æ–‡æ¡£</td><td></td><td></td></tr><tr><td>JSON_ARRAY_INSERT()</td><td>æ’å…¥ JSON æ•°ç»„</td><td></td><td></td></tr><tr><td>JSON_CONTAINS()</td><td>JSON æ–‡æ¡£æ˜¯å¦åœ¨è·¯å¾„ä¸­åŒ…å«ç‰¹å®šå¯¹è±¡</td><td></td><td></td></tr><tr><td>JSON_CONTAINS_PATH()</td><td>JSON æ–‡æ¡£æ˜¯å¦åŒ…å«è·¯å¾„ä¸­çš„ä»»ä½•æ•°æ®</td><td></td><td></td></tr><tr><td>JSON_DEPTH()</td><td>JSON æ–‡æ¡£çš„æœ€å¤§æ·±åº¦</td><td></td><td></td></tr><tr><td>JSON_EXTRACT()</td><td>ä» JSON æ–‡æ¡£è¿”å›æ•°æ®</td><td></td><td></td></tr><tr><td>JSON_INSERT()</td><td>å°†æ•°æ®æ’å…¥ JSON æ–‡æ¡£</td><td></td><td></td></tr><tr><td>JSON_KEYS()</td><td>JSON æ–‡æ¡£ä¸­çš„é”®æ•°ç»„</td><td></td><td></td></tr><tr><td>JSON_LENGTH()</td><td>JSON æ–‡æ¡£ä¸­çš„å…ƒç´ æ•°</td><td></td><td></td></tr><tr><td>JSON_MERGE()</td><td>åˆå¹¶ JSON æ–‡æ¡£ï¼Œä¿ç•™é‡å¤é”®ã€‚JSON_MERGE_PRESERVE() çš„å¼ƒç”¨åŒä¹‰è¯</td><td>5.7.22</td><td></td></tr><tr><td>JSON_MERGE_PATCH()</td><td>åˆå¹¶ JSON æ–‡æ¡£ï¼Œæ›¿æ¢é‡å¤é”®çš„å€¼</td><td>5.7.22</td><td></td></tr><tr><td>JSON_MERGE_PRESERVE()</td><td>åˆå¹¶ JSON æ–‡æ¡£ï¼Œä¿ç•™é‡å¤é”®</td><td>5.7.22</td><td></td></tr><tr><td>JSON_OBJECT()</td><td>åˆ›å»º JSON å¯¹è±¡</td><td></td><td></td></tr><tr><td>JSON_PRETTY()</td><td>ä»¥äººç±»å¯è¯»çš„æ ¼å¼æ‰“å° JSON æ–‡æ¡£</td><td>5.7.22</td><td></td></tr><tr><td>JSON_QUOTE()</td><td>å¼•ç”¨ JSON æ–‡æ¡£</td><td></td><td></td></tr><tr><td>JSON_REMOVE()</td><td>ä» JSON æ–‡æ¡£ä¸­åˆ é™¤æ•°æ®</td><td></td><td></td></tr><tr><td>JSON_REPLACE()</td><td>æ›¿æ¢ JSON æ–‡æ¡£ä¸­çš„å€¼</td><td></td><td></td></tr><tr><td>JSON_SEARCH()</td><td>JSON æ–‡æ¡£ä¸­å€¼çš„è·¯å¾„</td><td></td><td></td></tr><tr><td>JSON_SET()</td><td>å°†æ•°æ®æ’å…¥ JSON æ–‡æ¡£</td><td></td><td></td></tr><tr><td>JSON_STORAGE_SIZE()</td><td>ç”¨äºå­˜å‚¨ JSON æ–‡æ¡£çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ç©ºé—´    5.7.22</td><td></td><td></td></tr><tr><td>JSON_TYPE()</td><td>JSON å€¼çš„ç±»å‹</td><td></td><td></td></tr><tr><td>JSON_UNQUOTE()</td><td>å–æ¶ˆå¼•ç”¨ JSON å€¼</td><td></td><td></td></tr><tr><td>JSON_VALID()</td><td>JSONå€¼æ˜¯å¦æœ‰æ•ˆ</td><td></td><td></td></tr></tbody></table><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h4 id="åˆ›å»º-JSON"><a href="#åˆ›å»º-JSON" class="headerlink" title="åˆ›å»º JSON"></a>åˆ›å»º JSON</h4><pre><code class="sql">SELECT JSON_ARRAY(1, &quot;abc&quot;, NULL, TRUE, CURTIME());SELECT JSON_OBJECT(&#39;id&#39;, 87, &#39;name&#39;, &#39;carrot&#39;);SELECT JSON_QUOTE(&#39;null&#39;), JSON_QUOTE(&#39;&quot;null&quot;&#39;),JSON_QUOTE(&#39;[1, 2, 3]&#39;);</code></pre><h4 id="æœç´¢JSON"><a href="#æœç´¢JSON" class="headerlink" title="æœç´¢JSON"></a>æœç´¢JSON</h4><pre><code class="sql">select b.c -&gt;&#39;$.a&#39; from  ( select JSON_OBJECT(&#39;a&#39;,&quot;10&quot;,&quot;b&quot;,&quot;15&quot;,&quot;c&quot;,&quot;25&quot;) as c  ) b;select b.c -&gt;&gt;&#39;$.a&#39; from  ( select JSON_OBJECT(&#39;a&#39;,&quot;10&quot;,&quot;b&quot;,&quot;15&quot;,&quot;c&quot;,&quot;25&quot;) as c  ) b;</code></pre><h4 id="JSONå­—ç¬¦ä¸²è½¬JSONå¯¹è±¡"><a href="#JSONå­—ç¬¦ä¸²è½¬JSONå¯¹è±¡" class="headerlink" title="JSONå­—ç¬¦ä¸²è½¬JSONå¯¹è±¡"></a>JSONå­—ç¬¦ä¸²è½¬JSONå¯¹è±¡</h4><pre><code class="sql">select b.js-&gt;&gt;&#39;$.a&#39; from (select CAST(&#39;&#123;&quot;a&quot;:&quot;10&quot;,&quot;b&quot;:&quot;15&quot;,&quot;x&quot;:&quot;25&quot;&#125;&#39; as json) js ) as b;</code></pre><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>JSONç»“æ„é‡æ’åº<pre><code class="textmate">ç°è±¡:    æ‰§è¡Œ select CAST(&#39;&#123;&quot;aaa&quot;:&quot;10&quot;,&quot;d&quot;:&quot;15&quot;,&quot;cc&quot;:&quot;25&quot;,&quot;c&quot;:&quot;11&quot;&#125;&#39; as json) åè¿”å›æ•°æ®  &#123;&quot;c&quot;: &quot;11&quot;, &quot;d&quot;: &quot;15&quot;, &quot;cc&quot;: &quot;25&quot;, &quot;aaa&quot;: &quot;10&quot;&#125;</code></pre></li></ul><p>åŸå› : MySQLä¼šé’ˆå¯¹JSONç»“æ„ä¼˜åŒ–æ’åºï¼Œæé«˜æœç´¢æ•ˆç‡ï¼›æ’åºè§„åˆ™æ˜¯å…ˆæ ¹æ®keyé•¿åº¦æ’åºï¼Œé•¿åº¦ç›¸åŒæ ¹æ®ASCII()å€¼æ’åº<br>    select  ASCII(â€˜dâ€™),ASCII(â€˜câ€™)</p><pre><code>### ç›¸å…³èµ„æ–™- [MySQLå®˜æ–¹æ–‡æ¡£](https://dev.mysql.com/doc/refman/5.7/en/json-functions.html)</code></pre>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> jsonç±»å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ognlè¡¨è¾¾å¼</title>
      <link href="/2022/05/25/backend/other/ognl/"/>
      <url>/2022/05/25/backend/other/ognl/</url>
      
        <content type="html"><![CDATA[<h3 id="è¡¨è¾¾å¼ä½œç”¨"><a href="#è¡¨è¾¾å¼ä½œç”¨" class="headerlink" title="è¡¨è¾¾å¼ä½œç”¨"></a>è¡¨è¾¾å¼ä½œç”¨</h3><blockquote><p>æ ¹æ®å®šä¹‰çš„è¯­æ³•è§„åˆ™ï¼Œæ“ä½œå¯¹è±¡ä¿¡æ¯</p></blockquote><h3 id="è¡¨è¾¾å¼æ¡†æ¶"><a href="#è¡¨è¾¾å¼æ¡†æ¶" class="headerlink" title="è¡¨è¾¾å¼æ¡†æ¶"></a>è¡¨è¾¾å¼æ¡†æ¶</h3><ul><li>Ognl(Object-Graph Navigation Language): å¯ä»¥æ–¹ä¾¿åœ°æ“ä½œå¯¹è±¡å±æ€§çš„å¼€æºè¡¨è¾¾å¼è¯­è¨€</li><li>JSTL(JSP Standard Tag Library): JSP2.0é›†æˆçš„æ ‡å‡†è¡¨è¾¾å¼è¯­è¨€</li></ul><h3 id="Ognlæä¾›çš„èƒ½åŠ›"><a href="#Ognlæä¾›çš„èƒ½åŠ›" class="headerlink" title="Ognlæä¾›çš„èƒ½åŠ›"></a>Ognlæä¾›çš„èƒ½åŠ›</h3><pre><code class="textmate">1ã€æ”¯æŒå¯¹è±¡æ–¹æ³•è°ƒç”¨2ã€æ”¯æŒç±»é™æ€çš„æ–¹æ³• æˆ– å€¼è°ƒç”¨    æ ¼å¼: &quot;@[ç±»å…¨å(åŒ…æ‹¬åŒ…è·¯å¾„)]@[æ–¹æ³•å|å€¼å]&quot;ã€‚    ä¾‹å­:         è°ƒç”¨ç±»é™æ€æ–¹æ³• @java.lang.String@format(&#39;user%s&#39;,&#39;getUserId&#39;)        è®¿é—®ç±»çš„é™æ€å€¼ @com.my.module@APP_ID3ã€æ”¯æŒèµ‹å€¼æ“ä½œå’Œè¡¨è¾¾å¼ä¸²è”    å¦‚ user.id=1,  è¡¨è¾¾å¼ #user.id+1, è¿”å›2    æ”¯æŒ +, -, *, /, ++, --, ==, !=, = , mod, in, not in ç­‰æ“ä½œç¬¦4ã€è®¿é—®OGNLä¸Šä¸‹æ–‡ (OGNL context) å’Œ ActionContext5ã€æ“ä½œé›†åˆå¯¹è±¡</code></pre><h3 id="Ognlç”¨é€”"><a href="#Ognlç”¨é€”" class="headerlink" title="Ognlç”¨é€”"></a>Ognlç”¨é€”</h3><ul><li>Mybatis</li><li>åŠ¨æ€ä¸šåŠ¡å¤„ç†(åŠ¨æ€é€»è¾‘ã€åŠ¨æ€æ•°æ®è·å–ç­‰)</li></ul><h3 id="OGNLä¸­çš„-ã€-å’Œ-ç¬¦å·å¯¹æ¯”"><a href="#OGNLä¸­çš„-ã€-å’Œ-ç¬¦å·å¯¹æ¯”" class="headerlink" title="OGNLä¸­çš„#ã€%å’Œ$ç¬¦å·å¯¹æ¯”"></a>OGNLä¸­çš„#ã€%å’Œ$ç¬¦å·å¯¹æ¯”</h3><h4 id="ç¬¦å·çš„ç”¨æ³•"><a href="#ç¬¦å·çš„ç”¨æ³•" class="headerlink" title="#ç¬¦å·çš„ç”¨æ³•"></a>#ç¬¦å·çš„ç”¨æ³•</h4><pre><code class="textmate">1.è®¿é—®å¯¹è±¡å±æ€§(ä¸åŠ #é»˜è®¤è®¿é—®æ ¹å¯¹è±¡)    ä¾‹å¦‚ #user.name2.ç”¨äºè¿‡æ»¤å’ŒæŠ•å½±ï¼ˆprojectingï¼‰é›†åˆ    #users.&#123;?#this.id&gt;=2&#125;    ? --è·å–é›†åˆä¸­æ‰€æœ‰æ»¡è¶³é€‰æ‹©é€»è¾‘çš„å¯¹è±¡    ^ --è·å–é›†åˆä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³é€‰æ‹©é€»è¾‘çš„å¯¹è±¡    $ --è·å–é›†åˆä¸­æœ€åä¸€ä¸ªæ»¡è¶³é€‰æ‹©é€»è¾‘çš„å¯¹è±¡3.ç”¨æ¥æ„é€ Map    ä¾‹å¦‚ #&#123;&#39;id&#39;:&#39;1&#39;, &#39;name&#39;:&#39;å°æ˜&#39;&#125;</code></pre><h4 id="ç¬¦å·çš„ç”¨æ³•-1"><a href="#ç¬¦å·çš„ç”¨æ³•-1" class="headerlink" title="%ç¬¦å·çš„ç”¨æ³•"></a>%ç¬¦å·çš„ç”¨æ³•</h4><pre><code class="textmate">ä½œç”¨: ç”¨äºæ ‡è¯†å½“å‰è¡¨è¾¾å¼æ˜¯å¦è¢«ognlè§£æå™¨è§£æ(å‰ç«¯)    %&#123;#user.name&#125; æ ‡è¯†æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªognlè¡¨è¾¾å¼ï¼Œéœ€è¦è§£æ</code></pre><h4 id="ç¬¦å·çš„ç”¨æ³•-2"><a href="#ç¬¦å·çš„ç”¨æ³•-2" class="headerlink" title="$ç¬¦å·çš„ç”¨æ³•"></a>$ç¬¦å·çš„ç”¨æ³•</h4><pre><code class="textmate">ä½œç”¨: å¼•ç”¨å€¼ç”¨é€”:    1.åœ¨å›½é™…åŒ–èµ„æºæ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼    2.åœ¨Struts 2æ¡†æ¶çš„é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨OGNLè¡¨è¾¾å¼        $&#123;title&#125;</code></pre><h3 id="ç®€å•Demo"><a href="#ç®€å•Demo" class="headerlink" title="ç®€å•Demo"></a>ç®€å•Demo</h3><ul><li><p>å¯¼å…¥MavenåŒ…</p><pre><code class="xml">&lt;!-- ognlè¡¨è¾¾å¼ --&gt;&lt;dependency&gt;  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  &lt;version&gt;3.4.0&lt;/version&gt;  &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt;</code></pre></li><li><p>OgnlUtil</p><pre><code class="java">package com.utils;</code></pre></li></ul><p>import org.apache.ibatis.ognl.Ognl;<br>import org.apache.ibatis.ognl.OgnlContext;<br>import org.apache.ibatis.ognl.OgnlException;</p><p>public class OgnlUtil {</p><pre><code>/** * æ ¹æ®OGNLè¡¨è¾¾å¼è¿›è¡Œå–å€¼æ“ä½œ * * @param expression ognlè¡¨è¾¾å¼ * @param ctx  ognlä¸Šä¸‹æ–‡ * @param rootObject ognlæ ¹å¯¹è±¡ * @return */public static Object getValue(String expression,                              OgnlContext ctx,                              Object rootObject) &#123;    try &#123;        return Ognl.getValue(expression, ctx, rootObject);    &#125; catch (OgnlException e) &#123;        throw new RuntimeException(e);    &#125;&#125;/** * æ ¹æ®OGNLè¡¨è¾¾å¼è¿›è¡Œèµ‹å€¼æ“ä½œ * * @param expression ognlè¡¨è¾¾å¼ * @param ctx ognlä¸Šä¸‹æ–‡ * @param rootObject ognlæ ¹å¯¹è±¡ * @param value å€¼å¯¹è±¡ */public static void setValue(String expression, OgnlContext ctx,                            Object rootObject, Object value) &#123;    try &#123;        Ognl.setValue(expression, ctx, rootObject, value);    &#125; catch (OgnlException e) &#123;        throw new RuntimeException(e);    &#125;&#125;</code></pre><p>}</p><pre><code>- moduleå¯¹è±¡```javapublic class Employee &#123;    private int id;    private String title;    public Employee()&#123;&#125;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public String getTitle() &#123;        return title;    &#125;    public void setTitle(String title) &#123;        this.title = title;    &#125;&#125;public class User &#123;    private int id;    private String name;    public User()&#123;&#125;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public String getName() &#123;        return name;    &#125;    public void setName(String name) &#123;        this.name = name;    &#125;&#125;</code></pre><ul><li>test</li></ul><pre><code class="java">public class OgnlTest &#123;    public static void main(String[] args) &#123;        Employee emp = new Employee();        OgnlContext ctx = initOgnlContext(emp);        //æµ‹è¯•è·å–å…ƒç´         testGet(ctx,emp);        //æµ‹è¯•è®¾ç½®å…ƒç´         testPut(ctx,emp);                /**         * æ‰§è¡Œç»“æœ         ç ”å‘éƒ¨         å°æ˜         ç ”å‘éƒ¨         2         [&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;å°ç‹&quot;&#125;,&#123;&quot;id&quot;:3,&quot;name&quot;:&quot;å°å…­&quot;&#125;]         &#123;&quot;id&quot;:3,&quot;name&quot;:&quot;å°å…­&quot;&#125;         &#123;&quot;id&quot;:1,&quot;title&quot;:&quot;æµ‹è¯•æ–°æ ‡é¢˜&quot;&#125;         [&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;å°æ˜&quot;&#125;,&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;å°ç‹&quot;&#125;,&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;å°é»„&quot;&#125;]               **/    &#125;    //æµ‹è¯•è®¾ç½®å…ƒç´     private static void testPut(OgnlContext ctx,Employee emp)&#123;        OgnlUtil.setValue(&quot;title&quot;,ctx,emp,&quot;æµ‹è¯•æ–°æ ‡é¢˜&quot;);        Employee newEmp = (Employee) OgnlUtil.getValue(&quot;#emp&quot;, ctx, emp);        System.out.println(JSON.toJSONString(newEmp));        //è®¾ç½®é›†åˆ        User user = new User();        user.setId(4);        user.setName(&quot;å°é»„&quot;);        OgnlUtil.setValue(&quot;#users[2]&quot;,ctx,emp,user);        List&lt;User&gt; users = (List&lt;User&gt;) OgnlUtil.getValue(&quot;#users&quot;,ctx,emp);        System.out.println(JSONArray.toJSONString(users));    &#125;    //æµ‹è¯•è·å–å…ƒç´     private static void testGet(OgnlContext ctx,Employee emp)&#123;        //å–å‡ºognlä¸Šä¸‹æ–‡ï¼ˆå®¹å™¨ï¼‰ä¸­çš„æ ¹å…ƒç´ çš„idå±æ€§,å–æ ¹èŠ‚ç‚¹çš„å¯¹è±¡ï¼Œå¯ä»¥æ— éœ€æŒ‡å®šå‘½åç©ºé—´        String id = (String) OgnlUtil.getValue(&quot;title&quot;, ctx, emp);        System.out.println(id);        // è¡¨è¾¾å¼#user.nameå°†æ‰§è¡Œuser.getName()        //å–å‡ºognlä¸Šä¸‹æ–‡ä¸­éæ ¹å¯¹è±¡çš„nameå€¼ï¼Œéæ ¹å¯¹è±¡å–å€¼å¿…é¡»é€šè¿‡æŒ‡å®šçš„ç±»å®ä¾‹å»å–        String uName = (String) OgnlUtil.getValue(&quot;#user.name&quot;,ctx, emp);        System.out.println(uName);        // å½“ç„¶æ ¹å¯¹è±¡ä¹Ÿå¯ä»¥ä½¿ç”¨#emp.titleè¡¨è¾¾å¼è¿›è¡Œè®¿é—®        String empName = (String) OgnlUtil.getValue(&quot;#emp.title&quot;, ctx, emp);        System.out.println(empName);        Integer id2 = (Integer) OgnlUtil.getValue(&quot;#user.id+1&quot;, ctx, emp);        System.out.println(id2);        List&lt;User&gt; users = (List&lt;User&gt;) OgnlUtil.getValue(&quot;#users.&#123;?#this.id&gt;=2&#125;&quot;,ctx,emp);        System.out.println(JSONArray.toJSONString(users));        User user = (User) OgnlUtil.getValue(&quot;#users[2]&quot;,ctx,emp);        System.out.println(JSON.toJSONString(user));    &#125;    //åˆå§‹åŒ–Ognlä¸Šä¸‹æ–‡    public static OgnlContext initOgnlContext(Employee root)&#123;        root.setId(1);        root.setTitle(&quot;ç ”å‘éƒ¨&quot;);        User user = new User();        user.setId(1);        user.setName(&quot;å°æ˜&quot;);        User user2 = new User();        user2.setId(2);        user2.setName(&quot;å°ç‹&quot;);        User user3 = new User();        user3.setId(3);        user3.setName(&quot;å°å…­&quot;);        List&lt;User&gt; users = new ArrayList&lt;&gt;();        users.add(user);        users.add(user2);        users.add(user3);        // åˆ›å»ºOGNLä¸‹æ–‡,è€ŒOGNLä¸Šä¸‹æ–‡å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªMapå¯¹è±¡        OgnlContext ctx = new OgnlContext();        ctx.put(&quot;emp&quot;,root);        ctx.put(&quot;user&quot;,user);        ctx.put(&quot;users&quot;,users);        ctx.put(&quot;maxAge&quot;,24);        ctx.put(&quot;minAge&quot;,18);        //è®¾ç½®ä¸Šä¸‹æ–‡æ ¹å¯¹è±¡ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­åªæœ‰ä¸€ä¸ªæ ¹å¯¹è±¡        ctx.setRoot(root);        return ctx;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> ognlè¡¨è¾¾å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ognl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pulsaræ¶ˆæ¯é˜Ÿåˆ—</title>
      <link href="/2022/05/23/backend/mq/pulsar/"/>
      <url>/2022/05/23/backend/mq/pulsar/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>Apache Pulsar æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šé¡¶çº§é¡¹ç›®ï¼Œæ˜¯ä¸‹ä¸€ä»£äº‘åŸç”Ÿåˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ï¼Œé›†æ¶ˆæ¯ã€å­˜å‚¨ã€è½»é‡åŒ–å‡½æ•°å¼è®¡ç®—ä¸ºä¸€ä½“ï¼Œ<br>é‡‡ç”¨è®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€æŒä¹…åŒ–å­˜å‚¨ã€å¤šæœºæˆ¿è·¨åŒºåŸŸæ•°æ®å¤åˆ¶ï¼Œå…·æœ‰å¼ºä¸€è‡´æ€§ã€é«˜ååã€ä½å»¶æ—¶åŠé«˜å¯æ‰©å±•æ€§ç­‰æµæ•°æ®å­˜å‚¨ç‰¹æ€§ï¼Œ<br>è¢«çœ‹ä½œæ˜¯äº‘åŸç”Ÿæ—¶ä»£å®æ—¶æ¶ˆæ¯æµä¼ è¾“ã€å­˜å‚¨å’Œè®¡ç®—æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><h3 id="ç»„ä»¶ä»‹ç»"><a href="#ç»„ä»¶ä»‹ç»" class="headerlink" title="ç»„ä»¶ä»‹ç»"></a>ç»„ä»¶ä»‹ç»</h3><ul><li><p>pulsarç»„ä»¶<br><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/imagespulsar-module.jpg" alt="pulsarç»„ä»¶"></p></li><li><p>æ¶ˆæ¯ç»“æ„</p><pre class="mermaid">%%{init: {'theme':'base'}}%%;graph TD  EventStream --> segment1  EventStream --> segment2  EventStream --> segment3  segment1 --> message1  segment1 --> message2  Leder-id -.-> message2  entry-id -.-> message2  batch-index -.-> message2  partition-index -.-> message2</pre></li><li><p>ç»„ä»¶æè¿°</p></li></ul><table><thead><tr><th align="left">ç»„ä»¶</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">Value / data payload</td><td align="left">æ¶ˆæ¯æºå¸¦çš„æ•°æ®ã€‚æ‰€æœ‰ Pulsar æ¶ˆæ¯éƒ½åŒ…å«åŸå§‹å­—èŠ‚ï¼Œå°½ç®¡æ¶ˆæ¯æ•°æ®ä¹Ÿå¯ä»¥ç¬¦åˆæ•°æ®æ¨¡å¼ã€‚</td></tr><tr><td align="left">Key</td><td align="left">æ¶ˆæ¯å¯ä»¥æœ‰é€‰æ‹©åœ°ä½¿ç”¨é”®æ ‡è®°ï¼Œè¿™å¯¹äºè¯¸å¦‚ä¸»é¢˜å‹ç¼©ä¹‹ç±»çš„äº‹æƒ…å¾ˆæœ‰ç”¨ã€‚</td></tr><tr><td align="left">Properties</td><td align="left">ç”¨æˆ·å®šä¹‰å±æ€§çš„å¯é€‰é”®/å€¼æ˜ å°„ã€‚</td></tr><tr><td align="left">Topic name</td><td align="left">æ¶ˆæ¯è¦å‘å¸ƒåˆ°çš„ä¸»é¢˜çš„åç§°ã€‚</td></tr><tr><td align="left">Schema version</td><td align="left">ä½¿ç”¨è¯¥æ¨¡å¼ç”Ÿæˆæ¶ˆæ¯çš„ç‰ˆæœ¬å·ã€‚</td></tr><tr><td align="left">Sequence ID</td><td align="left">æ¯æ¡pulsarä¿¡æ¯éƒ½å±äºå…¶ä¸»é¢˜çš„æœ‰åºåºåˆ—ã€‚æ¶ˆæ¯çš„åºåˆ—IDæœ€åˆæ˜¯ç”±å®ƒçš„ç”Ÿäº§è€…åˆ†é…çš„ï¼Œè¡¨ç¤ºå®ƒåœ¨åºåˆ—ä¸­çš„é¡ºåºï¼Œä¹Ÿå¯ä»¥å®šåˆ¶ã€‚</td></tr><tr><td align="left">â€œåºåˆ—IDâ€å¯ç”¨äºé‡å¤æ•°æ®åˆ é™¤ã€‚å¦‚æœbrokerDeduplicationEnabledè®¾ç½®ä¸ºtrueï¼Œæ¯ä¸ªæ¶ˆæ¯çš„åºåˆ—IDåœ¨ä¸€ä¸ªä¸»é¢˜(æœªåˆ†åŒº)æˆ–åˆ†åŒºçš„ç”Ÿäº§è€…ä¸­æ˜¯å”¯ä¸€çš„ã€‚</td><td align="left"></td></tr><tr><td align="left">Message ID</td><td align="left">æ¶ˆæ¯çš„æ¶ˆæ¯IDåœ¨æ¶ˆæ¯è¢«æŒä¹…åŒ–å­˜å‚¨åç«‹å³ç”±ç»çºªäººåˆ†é…ã€‚æ¶ˆæ¯IDè¡¨ç¤ºæ¶ˆæ¯åœ¨åˆ†ç±»è´¦ä¸­çš„ç‰¹å®šä½ç½®ï¼Œåœ¨Pulsaré›†ç¾¤ä¸­æ˜¯å”¯ä¸€çš„ã€‚</td></tr><tr><td align="left">Publish time</td><td align="left">æ¶ˆæ¯å‘å¸ƒçš„æ—¶é—´æˆ³ã€‚æ—¶é—´æˆ³ç”±ç”Ÿäº§è€…è‡ªåŠ¨åº”ç”¨ã€‚</td></tr><tr><td align="left">Event time</td><td align="left">ç”±åº”ç”¨ç¨‹åºé™„åŠ åˆ°æ¶ˆæ¯ä¸Šçš„å¯é€‰æ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯æ—¶é™„åŠ æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®äº‹ä»¶æ—¶é—´ï¼Œåˆ™è¯¥å€¼ä¸º0ã€‚</td></tr></tbody></table><pre><code class="textmate">    Producerï¼šæ•°æ®ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯çš„ä¸€æ–¹ã€‚ç”Ÿäº§è€…è´Ÿè´£åˆ›å»ºæ¶ˆæ¯ï¼Œå°†å…¶æŠ•é€’åˆ° Pulsar ä¸­ã€‚    Consumerï¼šæ•°æ®æ¶ˆè´¹è€…ï¼Œæ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹ã€‚æ¶ˆè´¹è€…è¿æ¥åˆ° Pulsar å¹¶æ¥æ”¶æ¶ˆæ¯ï¼Œè¿›è¡Œç›¸åº”çš„ä¸šåŠ¡å¤„ç†ã€‚    Brokerï¼šæ— çŠ¶æ€çš„æœåŠ¡å±‚ï¼Œè´Ÿè´£æ¥æ”¶æ¶ˆæ¯ã€ä¼ é€’æ¶ˆæ¯ã€é›†ç¾¤è´Ÿè½½å‡è¡¡ç­‰æ“ä½œã€‚Broker ä¸ä¼šæŒä¹…åŒ–ä¿å­˜å…ƒæ•°æ®ã€‚    BookKeeperï¼šæœ‰çŠ¶æ€çš„æŒä¹…å±‚ï¼Œè´Ÿè´£æŒä¹…åŒ–åœ°å­˜å‚¨æ¶ˆæ¯ã€‚    ZooKeeperï¼šå­˜å‚¨ Pulsarã€BookKeeper çš„å…ƒæ•°æ®ï¼Œé›†ç¾¤é…ç½®ç­‰ä¿¡æ¯ï¼Œè´Ÿè´£é›†ç¾¤é—´çš„åè°ƒ(ä¾‹å¦‚ï¼šTopic ä¸ Broker çš„å…³ç³»)ã€æœåŠ¡å‘ç°ç­‰ã€‚</code></pre><h4 id="å¯æ‰©å±•"><a href="#å¯æ‰©å±•" class="headerlink" title="å¯æ‰©å±•"></a>å¯æ‰©å±•</h4><ul><li><p>Broker æ‰©å±•</p><pre><code class="textmate">  Broker æ˜¯æ— çŠ¶æ€çš„ï¼Œå½“éœ€è¦æ”¯æŒæ›´å¤šçš„æ¶ˆè´¹è€…æˆ–ç”Ÿäº§è€…æ—¶ï¼Œå¯ä»¥ç®€å•åœ°æ·»åŠ æ›´å¤šçš„ Broker èŠ‚ç‚¹æ¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚  Pulsar æ”¯æŒè‡ªåŠ¨çš„åˆ†åŒºè´Ÿè½½å‡è¡¡ï¼Œåœ¨ Broker èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œä¼šå°†è´Ÿè½½è¿ç§»åˆ°è´Ÿè½½è¾ƒä½çš„ Broker èŠ‚ç‚¹ï¼Œ  è¿™ä¸ªè¿‡ç¨‹ä¸­åˆ†åŒºä¹Ÿå°†åœ¨å¤šä¸ª Broker èŠ‚ç‚¹ä¸­åšå¹³è¡¡è¿ç§»ï¼Œä¸€äº›åˆ†åŒºçš„æ‰€æœ‰æƒä¼šè½¬ç§»åˆ°æ–°çš„ Broker èŠ‚ç‚¹ã€‚</code></pre></li><li><p>Bookie æ‰©å±•</p><pre><code class="textmate">  å­˜å‚¨å±‚çš„æ‰©å®¹ï¼Œé€šè¿‡å¢åŠ  Bookie èŠ‚ç‚¹æ¥å®ç°ã€‚åœ¨ BooKie æ‰©å®¹çš„é˜¶æ®µï¼Œç”±äºåˆ†ç‰‡æœºåˆ¶ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸ä¼šæ¶‰åŠåˆ°ä¸å¿…è¦çš„æ•°æ®æ¬è¿ï¼Œ  å³ä¸éœ€è¦å°†æ—§æ•°æ®ä»ç°æœ‰å­˜å‚¨èŠ‚ç‚¹é‡æ–°å¤åˆ¶åˆ°æ–°å­˜å‚¨èŠ‚ç‚¹ã€‚</code></pre></li></ul><h3 id="éƒ¨ç½²æ–‡æ¡£-dockerå•æœºéƒ¨ç½²"><a href="#éƒ¨ç½²æ–‡æ¡£-dockerå•æœºéƒ¨ç½²" class="headerlink" title="éƒ¨ç½²æ–‡æ¡£(dockerå•æœºéƒ¨ç½²)"></a>éƒ¨ç½²æ–‡æ¡£(dockerå•æœºéƒ¨ç½²)</h3><pre><code class="textmate">- å¯åŠ¨apachePulsar(å•æœº)docker run --name apachePulsar -dit -p 8080:8080 -p 6650:6650 apachepulsar/pulsar-standalone- å¯åŠ¨ç®¡ç†å¹³å°docker run --name apachePulsar-dashboard -dit -p 8081:80 -e SERVICE_URL=http://pulsar:8080 --link apachePulsar apachepulsar/pulsar-dashboard- æµ‹è¯•æ¶ˆæ¯å‘é€docker exec -it apachePulsar bash /pulsar/bin/pulsar-client produce my-topic --messages &quot;hello-pulsar&quot;- è®¿é—®ç®¡ç†å¹³å°http://localhost:8081/</code></pre><h3 id="Javaæ¥å…¥Pulsar"><a href="#Javaæ¥å…¥Pulsar" class="headerlink" title="Javaæ¥å…¥Pulsar"></a>Javaæ¥å…¥Pulsar</h3><ul><li><a href="https://pulsar.apache.org/docs/next/client-libraries-java">å®˜ç½‘demo</a></li></ul><h3 id="ç›¸å…³ç½‘ç«™"><a href="#ç›¸å…³ç½‘ç«™" class="headerlink" title="ç›¸å…³ç½‘ç«™"></a>ç›¸å…³ç½‘ç«™</h3><ul><li><a href="https://pulsar.apache.org/">Apache Pulsarå®˜ç½‘</a></li><li><a href="https://pulsar.apache.org/docs/next/reference-configuration">Apache Pulsaré…ç½®è¯¦è§£</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> message </tag>
            
            <tag> pulsar </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shellå‘½ä»¤è®°å½•</title>
      <link href="/2022/03/08/devops/shell/"/>
      <url>/2022/03/08/devops/shell/</url>
      
        <content type="html"><![CDATA[<h1 id="å¿«æ·æ‰“å¼€è½¯ä»¶"><a href="#å¿«æ·æ‰“å¼€è½¯ä»¶" class="headerlink" title="å¿«æ·æ‰“å¼€è½¯ä»¶"></a>å¿«æ·æ‰“å¼€è½¯ä»¶</h1><pre><code class="shell">alias sublime=&#39;open -a &quot;Sublime Text&quot;&#39;</code></pre><h3 id="è·å–æœ¬æœºIP"><a href="#è·å–æœ¬æœºIP" class="headerlink" title="è·å–æœ¬æœºIP"></a>è·å–æœ¬æœºIP</h3><pre><code class="shell"># è¾“å‡ºipåœ°å€alias ip=&quot;ifconfig | grep &#39;inet 192&#39; | grep -Eo &#39;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&#39; | head -1&quot;</code></pre><h3 id="åˆ¤æ–­ä½¿ç”¨çš„æ˜¯é‚£ä¸ªshell"><a href="#åˆ¤æ–­ä½¿ç”¨çš„æ˜¯é‚£ä¸ªshell" class="headerlink" title="åˆ¤æ–­ä½¿ç”¨çš„æ˜¯é‚£ä¸ªshell"></a>åˆ¤æ–­ä½¿ç”¨çš„æ˜¯é‚£ä¸ªshell</h3><pre><code class="shell">echo $0# -zsh è¡¨ç¤ºä½¿ç”¨çš„æ˜¯zsh,å¯¹åº”é…ç½®æ–‡ä»¶ ~/.zshrc# bash æ ‡è¯†ä½¿ç”¨çš„æ˜¯bash,å¯¹åº”é…ç½®æ–‡ä»¶ ~/.bashrc</code></pre><h3 id="è‡ªå®šä¹‰alias"><a href="#è‡ªå®šä¹‰alias" class="headerlink" title="è‡ªå®šä¹‰alias"></a>è‡ªå®šä¹‰alias</h3><pre><code class="shell">#åœ¨å¯¹åº”shellçš„é…ç½®æ–‡ä»¶ä¸­æ–°å¢alias key=value#ä¾‹å¦‚ alias gogogo=&quot;echo gogogo&quot;</code></pre><h3 id="è¾“å…¥è‡ªå®šä¹‰çš„aliaså‘½ä»¤"><a href="#è¾“å…¥è‡ªå®šä¹‰çš„aliaså‘½ä»¤" class="headerlink" title="è¾“å…¥è‡ªå®šä¹‰çš„aliaså‘½ä»¤"></a>è¾“å…¥è‡ªå®šä¹‰çš„aliaså‘½ä»¤</h3><pre><code class="shell">#æ­¤å‘½ä»¤æ”¾åœ¨è‡ªå®šä¹‰aliaså‘½ä»¤ä¹‹å‰; # +117 è¡Œå· è¾“å…¥æ–‡ä»¶117è¡Œä¹‹åçš„å†…å®¹# æ³¨æ„å¯¹åº”shellé…ç½®æ–‡ä»¶ååalias my-alias=&quot;tail -n +117 ~/.zshrc&quot;</code></pre><h2 id="ä¸€å°ç”µè„‘é…ç½®å¤šä¸ªgitee-githubå…¬é’¥"><a href="#ä¸€å°ç”µè„‘é…ç½®å¤šä¸ªgitee-githubå…¬é’¥" class="headerlink" title="ä¸€å°ç”µè„‘é…ç½®å¤šä¸ªgitee/githubå…¬é’¥"></a>ä¸€å°ç”µè„‘é…ç½®å¤šä¸ªgitee/githubå…¬é’¥</h2><h3 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h3><pre><code class="shell"># æŸ¥çœ‹ssh-agentç¼“å­˜ssh-add -l# åˆ é™¤æ‰€æœ‰ç¼“å­˜ssh-add -D# æ·»åŠ å¯†é’¥ç¼“å­˜ssh-add work_id_rsa#å°†ä»¥ä¸Šå‘½ä»¤å†™å…¥shellæ–‡ä»¶ï¼Œç„¶åè‡ªå®šä¹‰aliaså‘½ä»¤ï¼Œä½¿ç”¨çš„æ—¶å€™åˆ‡æ¢å³å¯alias gitee-work=&quot;sh work.sh&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellå‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESå®˜æ–¹æ–‡æ¡£ç¬”è®°</title>
      <link href="/2022/02/15/backend/storage/es/"/>
      <url>/2022/02/15/backend/storage/es/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/getting-started.html">ElasticSearchå®˜æ–¹æ•™ç¨‹(éæœ€æ–°ç‰ˆ)</a></li></ul><h2 id="é›†ç¾¤åŸç†"><a href="#é›†ç¾¤åŸç†" class="headerlink" title="é›†ç¾¤åŸç†"></a>é›†ç¾¤åŸç†</h2><h3 id="ç©ºé›†ç¾¤"><a href="#ç©ºé›†ç¾¤" class="headerlink" title="ç©ºé›†ç¾¤"></a>ç©ºé›†ç¾¤</h3><pre><code class="textmate">ä¸€ä¸ªè¿è¡Œä¸­çš„Elasticsearchå®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œé›†ç¾¤æ˜¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ‹¥æœ‰ç›¸åŒcluster.nameé…ç½®çš„èŠ‚ç‚¹ç»„æˆï¼Œå®ƒä»¬å…±åŒæ‰¿æ‹…æ•°æ®å’Œè´Ÿè½½çš„å‹åŠ›ã€‚å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­æˆ–è€…ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹æ—¶ï¼Œé›†ç¾¤å°†ä¼šé‡æ–°å¹³å‡åˆ†å¸ƒæ‰€æœ‰çš„æ•°æ®ã€‚è´Ÿè´£ç®¡ç†é›†ç¾¤èŒƒå›´å†…çš„æ‰€æœ‰å˜æ›´ï¼Œä¾‹å¦‚å¢åŠ ã€åˆ é™¤ç´¢å¼•ï¼Œæˆ–è€…å¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚è€Œä¸»èŠ‚ç‚¹å¹¶ä¸éœ€è¦æ¶‰åŠåˆ°æ–‡æ¡£çº§åˆ«çš„å˜æ›´å’Œæœç´¢ç­‰æ“ä½œï¼Œæ‰€ä»¥å½“é›†ç¾¤åªæ‹¥æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æµé‡çš„å¢åŠ å®ƒä¹Ÿä¸ä¼šæˆä¸ºç“¶é¢ˆã€‚ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥æˆä¸ºä¸»èŠ‚ç‚¹ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹é›†ç¾¤å°±åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒåŒæ—¶ä¹Ÿæˆä¸ºäº†ä¸»èŠ‚ç‚¹ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ä¸»èŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“ä»»æ„æ–‡æ¡£æ‰€å¤„çš„ä½ç½®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†æˆ‘ä»¬çš„è¯·æ±‚ç›´æ¥è½¬å‘åˆ°å­˜å‚¨æˆ‘ä»¬æ‰€éœ€æ–‡æ¡£çš„èŠ‚ç‚¹ã€‚æ— è®ºæˆ‘ä»¬å°†è¯·æ±‚å‘é€åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Œå®ƒéƒ½èƒ½è´Ÿè´£ä»å„ä¸ªåŒ…å«æˆ‘ä»¬æ‰€éœ€æ–‡æ¡£çš„èŠ‚ç‚¹æ”¶é›†å›æ•°æ®ï¼Œå¹¶å°†æœ€ç»ˆç»“æœè¿”å›çµ¦å®¢æˆ·ç«¯ã€‚</code></pre><h3 id="é›†ç¾¤å¥åº·"><a href="#é›†ç¾¤å¥åº·" class="headerlink" title="é›†ç¾¤å¥åº·"></a>é›†ç¾¤å¥åº·</h3><pre><code class="textmate">Elasticsearchçš„é›†ç¾¤ç›‘æ§ä¿¡æ¯ä¸­åŒ…å«äº†è®¸å¤šçš„ç»Ÿè®¡æ•°æ®ï¼Œå…¶ä¸­æœ€ä¸ºé‡è¦çš„ä¸€é¡¹å°±æ˜¯é›†ç¾¤å¥åº·ï¼Œå®ƒåœ¨statuså­—æ®µä¸­å±•ç¤ºä¸ºgreenã€yellowæˆ–è€…redã€‚GET/_cluster/health1.green    æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œã€‚2.yellow    æ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œã€‚3.red    æœ‰ä¸»åˆ†ç‰‡æ²¡èƒ½æ­£å¸¸è¿è¡Œã€‚</code></pre><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><pre><code class="textmate">ç´¢å¼•å®é™…ä¸Šæ˜¯æŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰©ç†åˆ†ç‰‡çš„é€»è¾‘å‘½åç©ºé—´ã€‚ä¸€ä¸ª åˆ†ç‰‡ æ˜¯ä¸€ä¸ªåº•å±‚çš„å·¥ä½œå•å…ƒ ï¼Œå®ƒä»…ä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†,ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ç´¢å¼•åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«åˆ†é…5ä¸ªä¸»åˆ†ç‰‡ï¼Œæˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚Elasticsearch æ˜¯åˆ©ç”¨åˆ†ç‰‡å°†æ•°æ®åˆ†å‘åˆ°é›†ç¾¤å†…å„å¤„çš„ã€‚åˆ†ç‰‡æ˜¯æ•°æ®çš„å®¹å™¨ï¼Œæ–‡æ¡£ä¿å­˜åœ¨åˆ†ç‰‡å†…ï¼Œåˆ†ç‰‡åˆè¢«åˆ†é…åˆ°é›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹é‡Œã€‚ å½“ä½ çš„é›†ç¾¤è§„æ¨¡æ‰©å¤§æˆ–è€…ç¼©å°æ—¶ï¼Œ Elasticsearch ä¼šè‡ªåŠ¨çš„åœ¨å„èŠ‚ç‚¹ä¸­è¿ç§»åˆ†ç‰‡ï¼Œä½¿å¾—æ•°æ®ä»ç„¶å‡åŒ€åˆ†å¸ƒåœ¨é›†ç¾¤é‡Œã€‚ä¸€ä¸ªåˆ†ç‰‡å¯ä»¥æ˜¯ ä¸»åˆ†ç‰‡æˆ–è€… å‰¯æœ¬ åˆ†ç‰‡ã€‚ ç´¢å¼•å†…ä»»æ„ä¸€ä¸ªæ–‡æ¡£éƒ½å½’å±äºä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥ä¸»åˆ†ç‰‡çš„æ•°ç›®å†³å®šç€ç´¢å¼•èƒ½å¤Ÿä¿å­˜çš„æœ€å¤§æ•°æ®é‡ã€‚</code></pre><ul><li>æ·»åŠ ç´¢å¼•è¯­æ³•</li></ul><pre><code class="textmate">PUT /blogs&#123;   &quot;settings&quot; : &#123;      &quot;number_of_shards&quot; : 3,  //åˆ†ç‰‡æ•°é‡      &quot;number_of_replicas&quot; : 1 //å‰¯æœ¬æ•°é‡   &#125;&#125;</code></pre><h3 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><pre><code class="textmate">å½“ä½ åœ¨åŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨äº†ç¬¬äºŒä¸ªèŠ‚ç‚¹æ—¶ï¼Œåªè¦å®ƒå’Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹æœ‰åŒæ ·çš„ cluster.name é…ç½®ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å‘ç°é›†ç¾¤å¹¶åŠ å…¥åˆ°å…¶ä¸­ã€‚ ä½†æ˜¯åœ¨ä¸åŒæœºå™¨ä¸Šå¯åŠ¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ºäº†åŠ å…¥åˆ°åŒä¸€é›†ç¾¤ï¼Œä½ éœ€è¦é…ç½®ä¸€ä¸ªå¯è¿æ¥åˆ°çš„å•æ’­ä¸»æœºåˆ—è¡¨ã€‚</code></pre><h3 id="æ°´å¹³æ‰©å®¹"><a href="#æ°´å¹³æ‰©å®¹" class="headerlink" title="æ°´å¹³æ‰©å®¹"></a>æ°´å¹³æ‰©å®¹</h3><pre><code class="textmate">æ‹¥æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤â€”â€”ä¸ºäº†åˆ†æ•£è´Ÿè½½è€Œå¯¹åˆ†ç‰‡è¿›è¡Œé‡æ–°åˆ†é…åˆ†ç‰‡æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æœç´¢å¼•æ“ï¼Œå®ƒæ‹¥æœ‰ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰èµ„æºçš„èƒ½åŠ›ã€‚ æœ‰6ä¸ªåˆ†ç‰‡ï¼ˆ3ä¸ªä¸»åˆ†ç‰‡å’Œ3ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼‰çš„ç´¢å¼•å¯ä»¥æœ€å¤§æ‰©å®¹åˆ°6ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜åœ¨ä¸€ä¸ªåˆ†ç‰‡ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†ç‰‡æ‹¥æœ‰æ‰€åœ¨èŠ‚ç‚¹çš„å…¨éƒ¨èµ„æºã€‚ä¸»åˆ†ç‰‡çš„æ•°ç›®åœ¨ç´¢å¼•åˆ›å»ºæ—¶å°±å·²ç»ç¡®å®šäº†ä¸‹æ¥ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ•°ç›®å®šä¹‰äº†è¿™ä¸ªç´¢å¼•èƒ½å¤Ÿ å­˜å‚¨ çš„æœ€å¤§æ•°æ®é‡ã€‚ï¼ˆå®é™…å¤§å°å–å†³äºä½ çš„æ•°æ®ã€ç¡¬ä»¶å’Œä½¿ç”¨åœºæ™¯ã€‚ï¼‰ ä½†æ˜¯ï¼Œè¯»æ“ä½œâ€”â€”æœç´¢å’Œè¿”å›æ•°æ®â€”â€”å¯ä»¥åŒæ—¶è¢«ä¸»åˆ†ç‰‡ æˆ– å‰¯æœ¬åˆ†ç‰‡æ‰€å¤„ç†ï¼Œæ‰€ä»¥å½“ä½ æ‹¥æœ‰è¶Šå¤šçš„å‰¯æœ¬åˆ†ç‰‡æ—¶ï¼Œä¹Ÿå°†æ‹¥æœ‰è¶Šé«˜çš„ååé‡ã€‚åœ¨è¿è¡Œä¸­çš„é›†ç¾¤ä¸Šæ˜¯å¯ä»¥åŠ¨æ€è°ƒæ•´å‰¯æœ¬åˆ†ç‰‡æ•°ç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰éœ€ä¼¸ç¼©é›†ç¾¤</code></pre><ul><li>è°ƒæ•´å‰¯æœ¬æ•°é‡</li></ul><pre><code class="textmate">PUT /blogs/_settings&#123;   &quot;number_of_replicas&quot; : 2&#125;</code></pre><h3 id="æ•…éšœè½¬ç§»-1"><a href="#æ•…éšœè½¬ç§»-1" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><pre><code class="textmate">| Node1 | Node2 | Node3 ||1* 2 3 |1 2*  3|1 2 3* |*ä»£è¡¨ä¸»åˆ†ç‰‡å¦‚æœå…³é—­Node1,åˆ™ä¼šå¤±å»1ä¸»åˆ†ç‰‡ï¼Œç´¢å¼•ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæ­¤æ—¶é›†ç¾¤çŠ¶æ€æ˜¯red;å…¶ä»–èŠ‚ç‚¹ä¼šç«‹å³å°†Node2æˆ–Node3ä¸Šçš„å‰¯æœ¬åˆ†ç‰‡æå‡ä¸ºä¸»åˆ†ç‰‡ï¼Œæ­¤æ—¶é›†ç¾¤çŠ¶æ€æ˜¯yellow,è¯¥åŠ¨ä½œæ˜¯ç¬æ—¶å‘ç”Ÿçš„ï¼›å¦‚æœé‡å¯Node1,é›†ç¾¤å¯ä»¥å°†ç¼ºå¤±çš„å‰¯æœ¬åˆ†ç‰‡å†æ¬¡è¿›è¡Œåˆ†é…ï¼Œå¦‚æœNode1ä¾ç„¶æ‹¥æœ‰ä¹‹å‰çš„åˆ†ç‰‡ï¼Œåˆ™ä¼šå°è¯•é‡ç”¨ï¼Œä»…ä»ä¸»åˆ†ç‰‡å¤åˆ¶æ”¹åŠ¨è¿‡çš„æ•°æ®æ–‡ä»¶</code></pre><h2 id="æ•°æ®è¾“å…¥è¾“å‡º"><a href="#æ•°æ®è¾“å…¥è¾“å‡º" class="headerlink" title="æ•°æ®è¾“å…¥è¾“å‡º"></a>æ•°æ®è¾“å…¥è¾“å‡º</h2><blockquote><p>åœ¨ Elasticsearch ä¸­ï¼Œ æ¯ä¸ªå­—æ®µçš„æ‰€æœ‰æ•°æ® éƒ½æ˜¯ é»˜è®¤è¢«ç´¢å¼•çš„ ã€‚ å³æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸ºäº†å¿«é€Ÿæ£€ç´¢è®¾ç½®çš„ä¸“ç”¨å€’æ’ç´¢å¼•</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯æ–‡æ¡£"><a href="#ä»€ä¹ˆæ˜¯æ–‡æ¡£" class="headerlink" title="ä»€ä¹ˆæ˜¯æ–‡æ¡£"></a>ä»€ä¹ˆæ˜¯æ–‡æ¡£</h3><pre><code class="textmate">åœ¨ Elasticsearch ä¸­ï¼Œæœ¯è¯­ æ–‡æ¡£ æœ‰ç€ç‰¹å®šçš„å«ä¹‰ã€‚å®ƒæ˜¯æŒ‡æœ€é¡¶å±‚æˆ–è€…æ ¹å¯¹è±¡, è¿™ä¸ªæ ¹å¯¹è±¡è¢«åºåˆ—åŒ–æˆ JSON å¹¶å­˜å‚¨åˆ° Elasticsearch ä¸­ï¼ŒæŒ‡å®šäº†å”¯ä¸€ ID;å­—æ®µçš„åå­—å¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„å­—ç¬¦ä¸²ï¼Œä½† ä¸å¯ä»¥ åŒ…å«è‹±æ–‡å¥å·(.)ã€‚</code></pre><h3 id="æ–‡æ¡£å…ƒæ•°æ®"><a href="#æ–‡æ¡£å…ƒæ•°æ®" class="headerlink" title="æ–‡æ¡£å…ƒæ•°æ®"></a>æ–‡æ¡£å…ƒæ•°æ®</h3><pre><code class="textmate">ä¸‰ä¸ªå¿…é¡»çš„å…ƒæ•°æ®å…ƒç´ ï¼š  _index: æ–‡æ¡£åœ¨å“ªå­˜æ”¾  _type: æ–‡æ¡£è¡¨ç¤ºçš„å¯¹è±¡ç±»åˆ«  _id: æ–‡æ¡£å”¯ä¸€æ ‡è¯†</code></pre><h3 id="ç´¢å¼•æ–‡æ¡£"><a href="#ç´¢å¼•æ–‡æ¡£" class="headerlink" title="ç´¢å¼•æ–‡æ¡£"></a>ç´¢å¼•æ–‡æ¡£</h3><pre><code class="textmate">// åˆ›å»ºæ–‡æ¡£æ—¶ä½¿ç”¨è‡ªå®šä¹‰IDPUT /website/blog/123&#123;  &quot;title&quot;: &quot;My first blog entry&quot;,  &quot;text&quot;:  &quot;Just trying this out...&quot;,  &quot;date&quot;:  &quot;2014/01/01&quot;&#125;//åˆ›å»ºæ–‡æ¡£æ—¶ä½¿ç”¨ESè‡ªåŠ¨ç”Ÿæˆçš„IDPOST /website/blog/&#123;  &quot;title&quot;: &quot;My second blog entry&quot;,  &quot;text&quot;:  &quot;Still trying this out...&quot;,  &quot;date&quot;:  &quot;2014/01/01&quot;&#125;/**tips: è‡ªåŠ¨ç”Ÿæˆçš„ ID æ˜¯ URL-safeã€ åŸºäº Base64 ç¼–ç ä¸”é•¿åº¦ä¸º20ä¸ªå­—ç¬¦çš„ GUID å­—ç¬¦ä¸²ã€‚ è¿™äº› GUID å­—ç¬¦ä¸²ç”±å¯ä¿®æ”¹çš„ FlakeID æ¨¡å¼ç”Ÿæˆï¼Œè¿™ç§æ¨¡å¼å…è®¸å¤šä¸ªèŠ‚ç‚¹å¹¶è¡Œç”Ÿæˆå”¯ä¸€ ID ï¼Œä¸”äº’ç›¸ä¹‹é—´çš„å†²çªæ¦‚ç‡å‡ ä¹ä¸ºé›¶ã€‚**/</code></pre><h3 id="å¤„ç†å†²çª"><a href="#å¤„ç†å†²çª" class="headerlink" title="å¤„ç†å†²çª"></a>å¤„ç†å†²çª</h3><pre><code class="textmate">ä¹è§‚å¹¶å‘æ§åˆ¶æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ª _version ï¼ˆç‰ˆæœ¬ï¼‰å·ï¼Œå½“æ–‡æ¡£è¢«ä¿®æ”¹æ—¶ç‰ˆæœ¬å·é€’å¢ã€‚ Elasticsearch ä½¿ç”¨è¿™ä¸ª _version å·æ¥ç¡®ä¿å˜æ›´ä»¥æ­£ç¡®é¡ºåºå¾—åˆ°æ‰§è¡Œã€‚å¦‚æœæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨æ–°ç‰ˆæœ¬ä¹‹ååˆ°è¾¾ï¼Œå®ƒå¯ä»¥è¢«ç®€å•çš„å¿½ç•¥ã€‚</code></pre><h2 id="åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨"><a href="#åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨" class="headerlink" title="åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨"></a>åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨</h2><h3 id="è·¯ç”±ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ªåˆ†ç‰‡ä¸­"><a href="#è·¯ç”±ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ªåˆ†ç‰‡ä¸­" class="headerlink" title="è·¯ç”±ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ªåˆ†ç‰‡ä¸­"></a>è·¯ç”±ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ªåˆ†ç‰‡ä¸­</h3><pre><code class="textmate">è®¡ç®—å…¬å¼ï¼šshard = hash(routing) % number_of_primary_shards(ä¸»åˆ†ç‰‡çš„æ•°é‡)routingæ˜¯å¯å˜å€¼ï¼Œé»˜è®¤æ˜¯æ–‡æ¡£çš„_id,ä¹Ÿå¯ä»¥è®¾ç½®æˆä¸€ä¸ªè‡ªå®šä¹‰çš„å€¼ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±ç¡®å®šå¥½ä¸»åˆ†ç‰‡çš„æ•°é‡ å¹¶ä¸”æ°¸è¿œä¸ä¼šæ”¹å˜è¿™ä¸ªæ•°é‡ï¼šå› ä¸ºå¦‚æœæ•°é‡å˜åŒ–äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¹‹å‰è·¯ç”±çš„å€¼éƒ½ä¼šæ— æ•ˆï¼Œæ–‡æ¡£ä¹Ÿå†ä¹Ÿæ‰¾ä¸åˆ°äº†ã€‚</code></pre><h3 id="ä¸»å‰¯åˆ†ç‰‡äº¤äº’"><a href="#ä¸»å‰¯åˆ†ç‰‡äº¤äº’" class="headerlink" title="ä¸»å‰¯åˆ†ç‰‡äº¤äº’"></a>ä¸»å‰¯åˆ†ç‰‡äº¤äº’</h3><pre><code class="textmate">æˆ‘ä»¬å¯ä»¥å‘é€è¯·æ±‚åˆ°é›†ç¾¤ä¸­çš„ä»»ä¸€èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰èƒ½åŠ›å¤„ç†ä»»æ„è¯·æ±‚ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“é›†ç¾¤ä¸­ä»»ä¸€æ–‡æ¡£ä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†è¯·æ±‚è½¬å‘åˆ°éœ€è¦çš„èŠ‚ç‚¹ä¸Šã€‚å°†æ‰€æœ‰çš„è¯·æ±‚å‘é€åˆ° Node 1 ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º åè°ƒèŠ‚ç‚¹(coordinating node) ã€‚tips:å½“å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œ ä¸ºäº†æ‰©å±•è´Ÿè½½ï¼Œæ›´å¥½çš„åšæ³•æ˜¯è½®è¯¢é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚</code></pre><h3 id="æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤æ–‡æ¡£æ—¶æ­¥éª¤"><a href="#æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤æ–‡æ¡£æ—¶æ­¥éª¤" class="headerlink" title="æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤æ–‡æ¡£æ—¶æ­¥éª¤"></a>æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤æ–‡æ¡£æ—¶æ­¥éª¤</h3><pre><code class="textmate">ä»¥ä¸‹æ˜¯åœ¨ä¸»å‰¯åˆ†ç‰‡å’Œä»»ä½•å‰¯æœ¬åˆ†ç‰‡ä¸Šé¢ æˆåŠŸæ–°å»ºï¼Œç´¢å¼•å’Œåˆ é™¤æ–‡æ¡£æ‰€éœ€è¦çš„æ­¥éª¤é¡ºåºï¼š1.å®¢æˆ·ç«¯å‘ Node 1 å‘é€æ–°å»ºã€ç´¢å¼•æˆ–è€…åˆ é™¤è¯·æ±‚ã€‚2.èŠ‚ç‚¹ä½¿ç”¨æ–‡æ¡£çš„ _id ç¡®å®šæ–‡æ¡£å±äºåˆ†ç‰‡ 0 ã€‚è¯·æ±‚ä¼šè¢«è½¬å‘åˆ° Node 3ï¼Œå› ä¸ºåˆ†ç‰‡ 0 çš„ä¸»åˆ†ç‰‡ç›®å‰è¢«åˆ†é…åœ¨ Node 3 ä¸Šã€‚3.Node 3 åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢æ‰§è¡Œè¯·æ±‚ã€‚å¦‚æœæˆåŠŸäº†ï¼Œå®ƒå°†è¯·æ±‚å¹¶è¡Œè½¬å‘åˆ° Node 1 å’Œ Node 2 çš„å‰¯æœ¬åˆ†ç‰‡ä¸Šã€‚ä¸€æ—¦æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æŠ¥å‘ŠæˆåŠŸ, Node 3 å°†å‘åè°ƒèŠ‚ç‚¹æŠ¥å‘ŠæˆåŠŸï¼Œåè°ƒèŠ‚ç‚¹å‘å®¢æˆ·ç«¯æŠ¥å‘ŠæˆåŠŸã€‚</code></pre><h3 id="æŸ¥è¯¢æ–‡æ¡£æ­¥éª¤"><a href="#æŸ¥è¯¢æ–‡æ¡£æ­¥éª¤" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£æ­¥éª¤"></a>æŸ¥è¯¢æ–‡æ¡£æ­¥éª¤</h3><pre><code class="textmate">ä»¥ä¸‹æ˜¯ä»ä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡æ£€ç´¢æ–‡æ¡£çš„æ­¥éª¤é¡ºåºï¼š1ã€å®¢æˆ·ç«¯å‘ Node 1 å‘é€è·å–è¯·æ±‚ã€‚2ã€èŠ‚ç‚¹ä½¿ç”¨æ–‡æ¡£çš„ _id æ¥ç¡®å®šæ–‡æ¡£å±äºåˆ†ç‰‡ 0 ã€‚åˆ†ç‰‡ 0 çš„å‰¯æœ¬åˆ†ç‰‡å­˜åœ¨äºæ‰€æœ‰çš„ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†è¯·æ±‚è½¬å‘åˆ° Node2ã€‚3ã€Node2å°†æ–‡æ¡£è¿”å›ç»™ Node 1 ï¼Œç„¶åå°†æ–‡æ¡£è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨å¤„ç†è¯»å–è¯·æ±‚æ—¶ï¼Œåè°ƒç»“ç‚¹åœ¨æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šé€šè¿‡è½®è¯¢æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡ã€‚åœ¨æ–‡æ¡£è¢«æ£€ç´¢æ—¶ï¼Œå·²ç»è¢«ç´¢å¼•çš„æ–‡æ¡£å¯èƒ½å·²ç»å­˜åœ¨äºä¸»åˆ†ç‰‡ä¸Šä½†æ˜¯è¿˜æ²¡æœ‰å¤åˆ¶åˆ°å‰¯æœ¬åˆ†ç‰‡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰¯æœ¬åˆ†ç‰‡å¯èƒ½ä¼šæŠ¥å‘Šæ–‡æ¡£ä¸å­˜åœ¨ï¼Œä½†æ˜¯ä¸»åˆ†ç‰‡å¯èƒ½æˆåŠŸè¿”å›æ–‡æ¡£ã€‚ ä¸€æ—¦ç´¢å¼•è¯·æ±‚æˆåŠŸè¿”å›ç»™ç”¨æˆ·ï¼Œæ–‡æ¡£åœ¨ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ˜¯å¯ç”¨çš„ã€‚è€ƒè™‘åˆ°åˆ†é¡µè¿‡æ·±ä»¥åŠä¸€æ¬¡è¯·æ±‚å¤ªå¤šç»“æœçš„æƒ…å†µï¼Œç»“æœé›†åœ¨è¿”å›ä¹‹å‰å…ˆè¿›è¡Œæ’åºã€‚ ä½†è¯·è®°ä½ä¸€ä¸ªè¯·æ±‚ç»å¸¸è·¨è¶Šå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½äº§ç”Ÿè‡ªå·±çš„æ’åºç»“æœï¼Œè¿™äº›ç»“æœéœ€è¦è¿›è¡Œé›†ä¸­æ’åºä»¥ä¿è¯æ•´ä½“é¡ºåºæ˜¯æ­£ç¡®çš„ã€‚æ·±åº¦åˆ†é¡µé—®é¢˜: åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯¹ç»“æœæ’åºçš„æˆæœ¬éšåˆ†é¡µçš„æ·±åº¦æˆæŒ‡æ•°ä¸Šå‡ã€‚è¿™å°±æ˜¯ web æœç´¢å¼•æ“å¯¹ä»»ä½•æŸ¥è¯¢éƒ½ä¸è¦è¿”å›è¶…è¿‡ 1000 ä¸ªç»“æœçš„åŸå› ã€‚</code></pre><h3 id="æ›´æ–°å±€éƒ¨æ–‡æ¡£æ­¥éª¤"><a href="#æ›´æ–°å±€éƒ¨æ–‡æ¡£æ­¥éª¤" class="headerlink" title="æ›´æ–°å±€éƒ¨æ–‡æ¡£æ­¥éª¤"></a>æ›´æ–°å±€éƒ¨æ–‡æ¡£æ­¥éª¤</h3><pre><code class="textmate">ä»¥ä¸‹æ˜¯éƒ¨åˆ†æ›´æ–°ä¸€ä¸ªæ–‡æ¡£çš„æ­¥éª¤ï¼š1.å®¢æˆ·ç«¯å‘ Node 1 å‘é€æ›´æ–°è¯·æ±‚ã€‚2.å®ƒå°†è¯·æ±‚è½¬å‘åˆ°ä¸»åˆ†ç‰‡æ‰€åœ¨çš„ Node 3 ã€‚3.Node 3 ä»ä¸»åˆ†ç‰‡æ£€ç´¢æ–‡æ¡£ï¼Œä¿®æ”¹ _source å­—æ®µä¸­çš„ JSON ï¼Œå¹¶ä¸”å°è¯•é‡æ–°ç´¢å¼•ä¸»åˆ†ç‰‡çš„æ–‡æ¡£ã€‚ å¦‚æœæ–‡æ¡£å·²ç»è¢«å¦ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹ï¼Œå®ƒä¼šé‡è¯•æ­¥éª¤ 3 ï¼Œè¶…è¿‡ retry_on_conflict æ¬¡åæ”¾å¼ƒã€‚4.å¦‚æœ Node 3 æˆåŠŸåœ°æ›´æ–°æ–‡æ¡£ï¼Œå®ƒå°†æ–°ç‰ˆæœ¬çš„æ–‡æ¡£å¹¶è¡Œè½¬å‘åˆ° Node 1 å’Œ Node 2 ä¸Šçš„å‰¯æœ¬åˆ†ç‰‡ï¼Œé‡æ–°å»ºç«‹ç´¢å¼•ã€‚ ä¸€æ—¦æ‰€æœ‰å‰¯æœ¬åˆ†ç‰‡éƒ½è¿”å›æˆåŠŸï¼Œ Node 3 å‘åè°ƒèŠ‚ç‚¹ä¹Ÿè¿”å›æˆåŠŸï¼Œåè°ƒèŠ‚ç‚¹å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸã€‚ps: å½“ä¸»åˆ†ç‰‡æŠŠæ›´æ”¹è½¬å‘åˆ°å‰¯æœ¬åˆ†ç‰‡æ—¶ï¼Œ å®ƒä¸ä¼šè½¬å‘æ›´æ–°è¯·æ±‚ã€‚ ç›¸åï¼Œå®ƒè½¬å‘å®Œæ•´æ–‡æ¡£çš„æ–°ç‰ˆæœ¬ã€‚è¯·è®°ä½ï¼Œè¿™äº›æ›´æ”¹å°†ä¼šå¼‚æ­¥è½¬å‘åˆ°å‰¯æœ¬åˆ†ç‰‡ï¼Œå¹¶ä¸”ä¸èƒ½ä¿è¯å®ƒä»¬ä»¥å‘é€å®ƒä»¬ç›¸åŒçš„é¡ºåºåˆ°è¾¾ã€‚ å¦‚æœElasticsearchä»…è½¬å‘æ›´æ”¹è¯·æ±‚ï¼Œåˆ™å¯èƒ½ä»¥é”™è¯¯çš„é¡ºåºåº”ç”¨æ›´æ”¹ï¼Œå¯¼è‡´å¾—åˆ°æŸåçš„æ–‡æ¡£ã€‚</code></pre><h2 id="åˆ†ç‰‡å†…éƒ¨åŸç†"><a href="#åˆ†ç‰‡å†…éƒ¨åŸç†" class="headerlink" title="åˆ†ç‰‡å†…éƒ¨åŸç†"></a>åˆ†ç‰‡å†…éƒ¨åŸç†</h2><h3 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h3><pre><code class="textmate">å€’æ’ç´¢å¼•è¢«å†™å…¥ç£ç›˜åæ˜¯ ä¸å¯æ”¹å˜ çš„:å®ƒæ°¸è¿œä¸ä¼šä¿®æ”¹ã€‚ ä¸å˜æ€§æœ‰é‡è¦çš„ä»·å€¼ï¼š1.ä¸éœ€è¦é”ã€‚å¦‚æœä½ ä»æ¥ä¸æ›´æ–°ç´¢å¼•ï¼Œä½ å°±ä¸éœ€è¦æ‹…å¿ƒå¤šè¿›ç¨‹åŒæ—¶ä¿®æ”¹æ•°æ®çš„é—®é¢˜ã€‚2.ä¸€æ—¦ç´¢å¼•è¢«è¯»å…¥å†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œä¾¿ä¼šç•™åœ¨å“ªé‡Œï¼Œç”±äºå…¶ä¸å˜æ€§ã€‚åªè¦æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­è¿˜æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†è¯»è¯·æ±‚ä¼šç›´æ¥è¯·æ±‚å†…å­˜ï¼Œè€Œä¸ä¼šå‘½ä¸­ç£ç›˜ã€‚è¿™æä¾›äº†å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚3.å…¶å®ƒç¼“å­˜(åƒfilterç¼“å­˜)ï¼Œåœ¨ç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸå†…å§‹ç»ˆæœ‰æ•ˆã€‚å®ƒä»¬ä¸éœ€è¦åœ¨æ¯æ¬¡æ•°æ®æ”¹å˜æ—¶è¢«é‡å»ºï¼Œå› ä¸ºæ•°æ®ä¸ä¼šå˜åŒ–ã€‚4.å†™å…¥å•ä¸ªå¤§çš„å€’æ’ç´¢å¼•å…è®¸æ•°æ®è¢«å‹ç¼©ï¼Œå‡å°‘ç£ç›˜ I/O å’Œ éœ€è¦è¢«ç¼“å­˜åˆ°å†…å­˜çš„ç´¢å¼•çš„ä½¿ç”¨é‡ã€‚å½“ç„¶ï¼Œä¸€ä¸ªä¸å˜çš„ç´¢å¼•ä¹Ÿæœ‰ä¸å¥½çš„åœ°æ–¹ã€‚ä¸»è¦äº‹å®æ˜¯å®ƒæ˜¯ä¸å¯å˜çš„! ä½ ä¸èƒ½ä¿®æ”¹å®ƒã€‚å¦‚æœä½ éœ€è¦è®©ä¸€ä¸ªæ–°çš„æ–‡æ¡£ å¯è¢«æœç´¢ï¼Œä½ éœ€è¦é‡å»ºæ•´ä¸ªç´¢å¼•ã€‚è¿™è¦ä¹ˆå¯¹ä¸€ä¸ªç´¢å¼•æ‰€èƒ½åŒ…å«çš„æ•°æ®é‡é€ æˆäº†å¾ˆå¤§çš„é™åˆ¶ï¼Œè¦ä¹ˆå¯¹ç´¢å¼•å¯è¢«æ›´æ–°çš„é¢‘ç‡é€ æˆäº†å¾ˆå¤§çš„é™åˆ¶ã€‚</code></pre><h3 id="ç´¢å¼•ä¸åˆ†ç‰‡çš„æ¯”è¾ƒ"><a href="#ç´¢å¼•ä¸åˆ†ç‰‡çš„æ¯”è¾ƒ" class="headerlink" title="ç´¢å¼•ä¸åˆ†ç‰‡çš„æ¯”è¾ƒ"></a>ç´¢å¼•ä¸åˆ†ç‰‡çš„æ¯”è¾ƒ</h3><pre><code class="textmate">ä¸€ä¸ª Lucene ç´¢å¼• æˆ‘ä»¬åœ¨ Elasticsearch ç§°ä½œ åˆ†ç‰‡ ã€‚ ä¸€ä¸ª Elasticsearch ç´¢å¼• æ˜¯åˆ†ç‰‡çš„é›†åˆã€‚ å½“ Elasticsearch åœ¨ç´¢å¼•ä¸­æœç´¢çš„æ—¶å€™ï¼Œ ä»–å‘é€æŸ¥è¯¢åˆ°æ¯ä¸€ä¸ªå±äºç´¢å¼•çš„åˆ†ç‰‡(Lucene ç´¢å¼•)ï¼Œç„¶ååƒ æ‰§è¡Œåˆ†å¸ƒå¼æ£€ç´¢ æåˆ°çš„é‚£æ ·ï¼Œåˆå¹¶æ¯ä¸ªåˆ†ç‰‡çš„ç»“æœåˆ°ä¸€ä¸ªå…¨å±€çš„ç»“æœé›†ã€‚</code></pre><h3 id="åˆ é™¤å’Œæ›´æ–°"><a href="#åˆ é™¤å’Œæ›´æ–°" class="headerlink" title="åˆ é™¤å’Œæ›´æ–°"></a>åˆ é™¤å’Œæ›´æ–°</h3><pre><code class="textmate">å½“ä¸€ä¸ªæ–‡æ¡£è¢« â€œåˆ é™¤â€ æ—¶ï¼Œå®ƒå®é™…ä¸Šåªæ˜¯åœ¨ .del æ–‡ä»¶ä¸­è¢« æ ‡è®° åˆ é™¤ã€‚ä¸€ä¸ªè¢«æ ‡è®°åˆ é™¤çš„æ–‡æ¡£ä»ç„¶å¯ä»¥è¢«æŸ¥è¯¢åŒ¹é…åˆ°ï¼Œ ä½†å®ƒä¼šåœ¨æœ€ç»ˆç»“æœè¢«è¿”å›å‰ä»ç»“æœé›†ä¸­ç§»é™¤ã€‚æ–‡æ¡£æ›´æ–°ä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œæ–¹å¼ï¼šå½“ä¸€ä¸ªæ–‡æ¡£è¢«æ›´æ–°æ—¶ï¼Œæ—§ç‰ˆæœ¬æ–‡æ¡£è¢«æ ‡è®°åˆ é™¤ï¼Œæ–‡æ¡£çš„æ–°ç‰ˆæœ¬è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°çš„æ®µä¸­ã€‚ å¯èƒ½ä¸¤ä¸ªç‰ˆæœ¬çš„æ–‡æ¡£éƒ½ä¼šè¢«ä¸€ä¸ªæŸ¥è¯¢åŒ¹é…åˆ°ï¼Œä½†è¢«åˆ é™¤çš„é‚£ä¸ªæ—§ç‰ˆæœ¬æ–‡æ¡£åœ¨ç»“æœé›†è¿”å›å‰å°±å·²ç»è¢«ç§»é™¤ã€‚</code></pre><h3 id="æŒä¹…åŒ–å˜æ›´"><a href="#æŒä¹…åŒ–å˜æ›´" class="headerlink" title="æŒä¹…åŒ–å˜æ›´"></a>æŒä¹…åŒ–å˜æ›´</h3><pre><code class="textmate">Elasticsearch å¢åŠ äº†ä¸€ä¸ª translog(äº‹åŠ¡æ—¥å¿—)ï¼Œåœ¨æ¯ä¸€æ¬¡å¯¹ Elasticsearch è¿›è¡Œæ“ä½œæ—¶å‡è¿›è¡Œäº†æ—¥å¿—è®°å½•1.ä¸€ä¸ªæ–‡æ¡£è¢«ç´¢å¼•ä¹‹åï¼Œå°±ä¼šè¢«æ·»åŠ åˆ°å†…å­˜ç¼“å†²åŒºï¼Œå¹¶ä¸” è¿½åŠ åˆ°äº† translog 2.åˆ·æ–°ï¼ˆrefreshï¼‰, ç¼“å­˜è¢«æ¸…ç©ºä½†æ˜¯äº‹åŠ¡æ—¥å¿—ä¸ä¼š3.äº‹åŠ¡æ—¥å¿—æŒç»­ç§¯ç´¯æ–‡æ¡£4.æ¯éš”ä¸€æ®µæ—¶é—´â€”ä¾‹å¦‚ translog å˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œç´¢å¼•è¢«åˆ·æ–°ï¼ˆflushï¼‰ï¼›ä¸€ä¸ªæ–°çš„ translog è¢«åˆ›å»ºï¼Œå¹¶ä¸”ä¸€ä¸ªå…¨é‡æäº¤è¢«æ‰§è¡Œ    4.1æ‰€æœ‰åœ¨å†…å­˜ç¼“å†²åŒºçš„æ–‡æ¡£éƒ½è¢«å†™å…¥ä¸€ä¸ªæ–°çš„æ®µã€‚  4.2ç¼“å†²åŒºè¢«æ¸…ç©ºã€‚  4.3ä¸€ä¸ªæäº¤ç‚¹è¢«å†™å…¥ç¡¬ç›˜ã€‚  4.4æ–‡ä»¶ç³»ç»Ÿç¼“å­˜é€šè¿‡ fsync è¢«åˆ·æ–°ï¼ˆflushï¼‰ã€‚  4.5è€çš„ translog è¢«åˆ é™¤ã€‚</code></pre><h3 id="Translogå®‰å…¨æ€§"><a href="#Translogå®‰å…¨æ€§" class="headerlink" title="Translogå®‰å…¨æ€§"></a>Translogå®‰å…¨æ€§</h3><pre><code class="textmate">åœ¨æ–‡ä»¶è¢« fsync åˆ°ç£ç›˜å‰ï¼Œè¢«å†™å…¥çš„æ–‡ä»¶åœ¨é‡å¯ä¹‹åå°±ä¼šä¸¢å¤±ã€‚é»˜è®¤ translog æ˜¯æ¯ 5 ç§’è¢« fsync åˆ·æ–°åˆ°ç¡¬ç›˜ï¼Œ æˆ–è€…åœ¨æ¯æ¬¡å†™è¯·æ±‚å®Œæˆä¹‹åæ‰§è¡Œ(e.g. index, delete, update, bulk)ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡éƒ½ä¼šå‘ç”Ÿã€‚æœ€ç»ˆï¼Œ åŸºæœ¬ä¸Šï¼Œè¿™æ„å‘³ç€åœ¨æ•´ä¸ªè¯·æ±‚è¢« fsync åˆ°ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡çš„translogä¹‹å‰ï¼Œä½ çš„å®¢æˆ·ç«¯ä¸ä¼šå¾—åˆ°ä¸€ä¸ª 200 OK å“åº”ã€‚åœ¨æ¯æ¬¡è¯·æ±‚åéƒ½æ‰§è¡Œä¸€ä¸ª fsync ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½æŸå¤±ï¼Œå°½ç®¡å®è·µè¡¨æ˜è¿™ç§æŸå¤±ç›¸å¯¹è¾ƒå°ï¼ˆç‰¹åˆ«æ˜¯bulkå¯¼å…¥ï¼Œå®ƒåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­å¹³æ‘Šäº†å¤§é‡æ–‡æ¡£çš„å¼€é”€ï¼‰ã€‚ä½†æ˜¯å¯¹äºä¸€äº›å¤§å®¹é‡çš„å¶å°”ä¸¢å¤±å‡ ç§’æ•°æ®é—®é¢˜ä¹Ÿå¹¶ä¸ä¸¥é‡çš„é›†ç¾¤ï¼Œä½¿ç”¨å¼‚æ­¥çš„ fsync è¿˜æ˜¯æ¯”è¾ƒæœ‰ç›Šçš„ã€‚æ¯”å¦‚ï¼Œå†™å…¥çš„æ•°æ®è¢«ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå†æ¯5ç§’æ‰§è¡Œä¸€æ¬¡ fsync ã€‚è¿™ä¸ªè¡Œä¸ºå¯ä»¥é€šè¿‡è®¾ç½® durability å‚æ•°ä¸º async æ¥å¯ç”¨ï¼šPUT /my_index/_settings&#123;    &quot;index.translog.durability&quot;: &quot;async&quot;,    &quot;index.translog.sync_interval&quot;: &quot;5s&quot;&#125;è¿™ä¸ªé€‰é¡¹å¯ä»¥é’ˆå¯¹ç´¢å¼•å•ç‹¬è®¾ç½®ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœä½ å†³å®šä½¿ç”¨å¼‚æ­¥ translog çš„è¯ï¼Œä½ éœ€è¦ ä¿è¯ åœ¨å‘ç”Ÿcrashæ—¶ï¼Œä¸¢å¤±æ‰ sync_interval æ—¶é—´æ®µçš„æ•°æ®ä¹Ÿæ— æ‰€è°“ã€‚</code></pre><h3 id="åˆ·æ–°"><a href="#åˆ·æ–°" class="headerlink" title="åˆ·æ–°"></a>åˆ·æ–°</h3><pre><code class="textmate">åœ¨ Elasticsearch ä¸­ï¼Œå†™å…¥å’Œæ‰“å¼€ä¸€ä¸ªæ–°æ®µçš„è½»é‡çš„è¿‡ç¨‹å«åš refresh ã€‚ é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªåˆ†ç‰‡ä¼šæ¯ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ Elasticsearch æ˜¯ è¿‘ å®æ—¶æœç´¢: æ–‡æ¡£çš„å˜åŒ–å¹¶ä¸æ˜¯ç«‹å³å¯¹æœç´¢å¯è§ï¼Œä½†ä¼šåœ¨ä¸€ç§’ä¹‹å†…å˜ä¸ºå¯è§ã€‚// æ‰‹åŠ¨åˆ·æ–°æ•°æ® POST /_refresh  //åˆ·æ–°æ‰€æœ‰ç´¢å¼•POST /blogs/_refresh  //åªåˆ·æ–°blogsç´¢å¼•</code></pre><h3 id="æ®µåˆå¹¶"><a href="#æ®µåˆå¹¶" class="headerlink" title="æ®µåˆå¹¶"></a>æ®µåˆå¹¶</h3><pre><code class="textmate">ç›®çš„ï¼š    ç”±äºè‡ªåŠ¨åˆ·æ–°æµç¨‹æ¯ç§’ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ®µ ï¼Œè¿™æ ·ä¼šå¯¼è‡´çŸ­æ—¶é—´å†…çš„æ®µæ•°é‡æš´å¢ã€‚è€Œæ®µæ•°ç›®å¤ªå¤šä¼šå¸¦æ¥è¾ƒå¤§çš„éº»çƒ¦ã€‚ æ¯ä¸€ä¸ªæ®µéƒ½ä¼šæ¶ˆè€—æ–‡ä»¶å¥æŸ„ã€å†…å­˜å’Œcpuè¿è¡Œå‘¨æœŸã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ¯ä¸ªæœç´¢è¯·æ±‚éƒ½å¿…é¡»è½®æµæ£€æŸ¥æ¯ä¸ªæ®µï¼›æ‰€ä»¥æ®µè¶Šå¤šï¼Œæœç´¢ä¹Ÿå°±è¶Šæ…¢ã€‚    Elasticsearché€šè¿‡åœ¨åå°è¿›è¡Œæ®µåˆå¹¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°çš„æ®µè¢«åˆå¹¶åˆ°å¤§çš„æ®µï¼Œç„¶åè¿™äº›å¤§çš„æ®µå†è¢«åˆå¹¶åˆ°æ›´å¤§çš„æ®µã€‚æµç¨‹ï¼š  1.å½“ç´¢å¼•çš„æ—¶å€™ï¼Œåˆ·æ–°ï¼ˆrefreshï¼‰æ“ä½œä¼šåˆ›å»ºæ–°çš„æ®µå¹¶å°†æ®µæ‰“å¼€ä»¥ä¾›æœç´¢ä½¿ç”¨ã€‚  2.åˆå¹¶è¿›ç¨‹é€‰æ‹©ä¸€å°éƒ¨åˆ†å¤§å°ç›¸ä¼¼çš„æ®µï¼Œå¹¶ä¸”åœ¨åå°å°†å®ƒä»¬åˆå¹¶åˆ°æ›´å¤§çš„æ®µä¸­ã€‚è¿™å¹¶ä¸ä¼šä¸­æ–­ç´¢å¼•å’Œæœç´¢ã€‚  3.åˆå¹¶ç»“æŸï¼Œè€çš„æ®µè¢«åˆ é™¤  tips:åˆå¹¶å¤§çš„æ®µéœ€è¦æ¶ˆè€—å¤§é‡çš„I/Oå’ŒCPUèµ„æºï¼Œé»˜è®¤ä¸‹ä¼šå¯¹åˆå¹¶æµç¨‹è¿›è¡Œèµ„æºé™åˆ¶optimeze API(å¼ºåˆ¶åˆå¹¶)ä»‹ç»: optimize APIå¤§å¯çœ‹åšæ˜¯ å¼ºåˆ¶åˆå¹¶ APIã€‚å®ƒä¼šå°†ä¸€ä¸ªåˆ†ç‰‡å¼ºåˆ¶åˆå¹¶åˆ° max_num_segments å‚æ•°æŒ‡å®šå¤§å°çš„æ®µæ•°ç›®ã€‚ è¿™æ ·åšçš„æ„å›¾æ˜¯å‡å°‘æ®µçš„æ•°é‡ï¼ˆé€šå¸¸å‡å°‘åˆ°ä¸€ä¸ªï¼‰ï¼Œæ¥æå‡æœç´¢æ€§èƒ½ã€‚tips:     1.optimize API ä¸åº”è¯¥ è¢«ç”¨åœ¨ä¸€ä¸ªæ´»è·ƒçš„ç´¢å¼•â€”â€”â€”â€”ä¸€ä¸ªæ­£ç§¯ææ›´æ–°çš„ç´¢å¼•ã€‚åå°åˆå¹¶æµç¨‹å·²ç»å¯ä»¥å¾ˆå¥½åœ°å®Œæˆå·¥ä½œã€‚    2.ä½¿ç”¨ optimize API è§¦å‘æ®µåˆå¹¶çš„æ“ä½œä¸ä¼šå—åˆ°ä»»ä½•èµ„æºä¸Šçš„é™åˆ¶ã€‚è¿™å¯èƒ½ä¼šæ¶ˆè€—æ‰ä½ èŠ‚ç‚¹ä¸Šå…¨éƒ¨çš„I/Oèµ„æº</code></pre><h2 id="å¸¸ç”¨æŸ¥æ‰¾è¯­æ³•"><a href="#å¸¸ç”¨æŸ¥æ‰¾è¯­æ³•" class="headerlink" title="å¸¸ç”¨æŸ¥æ‰¾è¯­æ³•"></a>å¸¸ç”¨æŸ¥æ‰¾è¯­æ³•</h2><h3 id="ç²¾ç¡®æŸ¥æ‰¾-åŒ…å«ï¼Œä¸æ˜¯ç­‰äº"><a href="#ç²¾ç¡®æŸ¥æ‰¾-åŒ…å«ï¼Œä¸æ˜¯ç­‰äº" class="headerlink" title="ç²¾ç¡®æŸ¥æ‰¾(åŒ…å«ï¼Œä¸æ˜¯ç­‰äº)"></a>ç²¾ç¡®æŸ¥æ‰¾(åŒ…å«ï¼Œä¸æ˜¯ç­‰äº)</h3><pre><code class="textmate">//termæŸ¥æ•°å­—GET /my_store/products/_search&#123;    &quot;query&quot; : &#123;        &quot;constant_score&quot; : &#123;             &quot;filter&quot; : &#123;                &quot;term&quot; : &#123;                     &quot;price&quot; : 20                &#125;            &#125;        &#125;    &#125;&#125;//termæŸ¥æ–‡æœ¬åŸè¯å¯èƒ½ä¼šè¢«åˆ†è¯,æ„å»ºç´¢å¼•æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸åˆ†æå€¼&quot;index&quot; : &quot;not_analyzed&quot; //termsåŒ¹é…å¤šä¸ªå†…å®¹    //è¿è¡Œéè¯„åˆ†æŸ¥è¯¢(ç²¾ç¡®æŸ¥è¯¢)æ—¶çš„æ­¥éª¤1.æŸ¥æ‰¾åŒ¹é…æ–‡æ¡£2.åˆ›å»ºbitset(ä¸€ä¸ªåŒ…å« 0 å’Œ 1 çš„æ•°ç»„ï¼‰ï¼Œå®ƒæè¿°äº†å“ªä¸ªæ–‡æ¡£ä¼šåŒ…å«è¯¥ term 3.è¿­ä»£bitsets4.å¢é‡è®¡æ•°</code></pre><h3 id="ç»„åˆè¿‡æ»¤å™¨"><a href="#ç»„åˆè¿‡æ»¤å™¨" class="headerlink" title="ç»„åˆè¿‡æ»¤å™¨"></a>ç»„åˆè¿‡æ»¤å™¨</h3><ul><li>å¸ƒå°”è¿‡æ»¤å™¨</li></ul><pre><code class="textmate">&#123;   &quot;bool&quot; : &#123;      &quot;must&quot; :     [],  //ç›¸å½“äºand,æœ‰è¯„åˆ†      &quot;should&quot; :   [],  //ç›¸å½“äºor      &quot;must_not&quot; : [],  //ç›¸å½“äºnot      &quot;filter&quot; : []     //ç›¸å½“äºand,æ— è¯„åˆ†,ä¸mustæ¯”æ•ˆç‡é«˜   &#125;&#125;</code></pre><h3 id="èŒƒå›´"><a href="#èŒƒå›´" class="headerlink" title="èŒƒå›´"></a>èŒƒå›´</h3><pre><code class="textmate">&quot;range&quot; : &#123;    &quot;price&quot; : &#123;        &quot;gte&quot; : 20,        &quot;lte&quot; : 40    &#125;&#125;/**  gt: &gt; å¤§äºï¼ˆgreater thanï¼‰  lt: &lt; å°äºï¼ˆless thanï¼‰  gte: &gt;= å¤§äºæˆ–ç­‰äºï¼ˆgreater than or equal toï¼‰  lte: &lt;= å°äºæˆ–ç­‰äºï¼ˆless than or equal toï¼‰**/// ç‰¹æ®Šç”¨æ³•//1.æ—¶é—´è®¡ç®—ï¼š æŸ¥æ‰¾æ—¶é—´æˆ³åœ¨è¿‡å»ä¸€å°æ—¶å†…çš„æ‰€æœ‰æ–‡æ¡£&quot;range&quot; : &#123;    &quot;timestamp&quot; : &#123;        &quot;gt&quot; : &quot;now-1h&quot;    &#125;&#125;&quot;range&quot; : &#123;    &quot;timestamp&quot; : &#123;        &quot;gt&quot; : &quot;2014-01-01 00:00:00&quot;,        &quot;lt&quot; : &quot;2014-01-01 00:00:00||+1M&quot;  //æ—©äº2014å¹´1æœˆ1æ—¥åŠ 1æœˆï¼ˆ2014å¹´2æœˆ1æ—¥é›¶æ—¶ï¼‰    &#125;&#125;//2.å­—ç¬¦ä¸²èŒƒå›´(æ•ˆç‡è¾ƒä½)&quot;range&quot; : &#123;    &quot;title&quot; : &#123;        &quot;gte&quot; : &quot;a&quot;,        &quot;lt&quot; :  &quot;b&quot;    &#125;&#125;</code></pre><h3 id="Nullå€¼æŸ¥è¯¢"><a href="#Nullå€¼æŸ¥è¯¢" class="headerlink" title="Nullå€¼æŸ¥è¯¢"></a>Nullå€¼æŸ¥è¯¢</h3><pre><code class="textmate">// å­˜åœ¨æŸ¥è¯¢ existGET /my_index/posts/_search&#123;    &quot;query&quot; : &#123;        &quot;constant_score&quot; : &#123;            &quot;filter&quot; : &#123;                &quot;exists&quot; : &#123; &quot;field&quot; : &quot;tags&quot; &#125;            &#125;        &#125;    &#125;&#125;//ä¸å­˜åœ¨æŸ¥è¯¢GET /my_index/posts/_search&#123;    &quot;query&quot; : &#123;        &quot;constant_score&quot; : &#123;            &quot;filter&quot;: &#123;                &quot;missing&quot; : &#123; &quot;field&quot; : &quot;tags&quot; &#125;            &#125;        &#125;    &#125;&#125;//å¯¹è±¡çš„å­˜åœ¨ä¸ä¸å­˜åœ¨ //å¦‚æœ first å’Œ last éƒ½æ˜¯ç©ºï¼Œé‚£ä¹ˆ name è¿™ä¸ªå‘½åç©ºé—´æ‰ä¼šè¢«è®¤ä¸ºä¸å­˜åœ¨ã€‚&#123;  //å¯¹è±¡æ•°æ®   &quot;name&quot; : &#123;      &quot;first&quot; : &quot;John&quot;,      &quot;last&quot; :  &quot;Smith&quot;   &#125;&#125;&#123; //æŸ¥è¯¢è¯­å¥    &quot;exists&quot; : &#123; &quot;field&quot; : &quot;name&quot; &#125;&#125;&#123; //å®é™…æ‰§è¡Œçš„è¯­å¥    &quot;bool&quot;: &#123;        &quot;should&quot;: [            &#123; &quot;exists&quot;: &#123; &quot;field&quot;: &quot;name.first&quot; &#125;&#125;,            &#123; &quot;exists&quot;: &#123; &quot;field&quot;: &quot;name.last&quot; &#125;&#125;        ]    &#125;&#125;</code></pre><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><pre><code class="textmate">è‡ªåŠ¨ç¼“å­˜Elasticsearch ä¼šåŸºäºä½¿ç”¨é¢‘æ¬¡è‡ªåŠ¨ç¼“å­˜æŸ¥è¯¢ã€‚å¦‚æœä¸€ä¸ªéè¯„åˆ†æŸ¥è¯¢åœ¨æœ€è¿‘çš„ 256 æ¬¡æŸ¥è¯¢ä¸­è¢«ä½¿ç”¨è¿‡ï¼ˆæ¬¡æ•°å–å†³äºæŸ¥è¯¢ç±»å‹ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢å°±ä¼šä½œä¸ºç¼“å­˜çš„å€™é€‰ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç‰‡æ®µéƒ½èƒ½ä¿è¯ç¼“å­˜ bitset ã€‚åªæœ‰é‚£äº›æ–‡æ¡£æ•°é‡è¶…è¿‡ 10,000 ï¼ˆæˆ–è¶…è¿‡æ€»æ–‡æ¡£æ•°é‡çš„ 3% )æ‰ä¼šç¼“å­˜ bitset ã€‚å› ä¸ºå°çš„ç‰‡æ®µå¯ä»¥å¾ˆå¿«çš„è¿›è¡Œæœç´¢å’Œåˆå¹¶ï¼Œè¿™é‡Œç¼“å­˜çš„æ„ä¹‰ä¸å¤§ã€‚ä¸€æ—¦ç¼“å­˜äº†ï¼Œéè¯„åˆ†è®¡ç®—çš„ bitset ä¼šä¸€ç›´é©»ç•™åœ¨ç¼“å­˜ä¸­ç›´åˆ°å®ƒè¢«å‰”é™¤ã€‚å‰”é™¤è§„åˆ™æ˜¯åŸºäº LRU çš„ï¼šä¸€æ—¦ç¼“å­˜æ»¡äº†ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„è¿‡æ»¤å™¨ä¼šè¢«å‰”é™¤ã€‚</code></pre><h2 id="ç›¸å…³åº¦"><a href="#ç›¸å…³åº¦" class="headerlink" title="ç›¸å…³åº¦"></a>ç›¸å…³åº¦</h2><h3 id="ç›¸å…³åº¦è¯„åˆ†é€»è¾‘"><a href="#ç›¸å…³åº¦è¯„åˆ†é€»è¾‘" class="headerlink" title="ç›¸å…³åº¦è¯„åˆ†é€»è¾‘"></a>ç›¸å…³åº¦è¯„åˆ†é€»è¾‘</h3><pre><code class="textmate">Luceneï¼ˆæˆ– Elasticsearchï¼‰ä½¿ç”¨ å¸ƒå°”æ¨¡å‹ï¼ˆBoolean modelï¼‰ æŸ¥æ‰¾åŒ¹é…æ–‡æ¡£ï¼Œå¹¶ç”¨ä¸€ä¸ªåä¸º å®ç”¨è¯„åˆ†å‡½æ•°ï¼ˆpractical scoring functionï¼‰ çš„å…¬å¼æ¥è®¡ç®—ç›¸å…³åº¦ã€‚è¿™ä¸ªå…¬å¼å€Ÿé‰´äº† è¯é¢‘/é€†å‘æ–‡æ¡£é¢‘ç‡ï¼ˆterm frequency/inverse document frequencyï¼‰ å’Œ å‘é‡ç©ºé—´æ¨¡å‹ï¼ˆvector space modelï¼‰ï¼ŒåŒæ—¶ä¹ŸåŠ å…¥äº†ä¸€äº›ç°ä»£çš„æ–°ç‰¹æ€§ï¼Œå¦‚åè°ƒå› å­ï¼ˆcoordination factorï¼‰ï¼Œå­—æ®µé•¿åº¦å½’ä¸€åŒ–ï¼ˆfield length normalizationï¼‰ï¼Œä»¥åŠè¯æˆ–æŸ¥è¯¢è¯­å¥æƒé‡æå‡ã€‚</code></pre><h4 id="å¸ƒå°”æ¨¡å‹"><a href="#å¸ƒå°”æ¨¡å‹" class="headerlink" title="å¸ƒå°”æ¨¡å‹"></a>å¸ƒå°”æ¨¡å‹</h4><pre><code class="textmate">å¸ƒå°”æ¨¡å‹ï¼ˆBoolean Modelï¼‰åªæ˜¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ ANDã€OR å’Œ NOTï¼ˆä¸ã€æˆ–å’Œéï¼‰è¿™æ ·çš„æ¡ä»¶æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡æ¡£ï¼Œä»¥ä¸‹æŸ¥è¯¢ï¼šfull AND text AND search AND (elasticsearch OR lucene)ä¼šå°†æ‰€æœ‰åŒ…æ‹¬è¯ full ã€ text å’Œ search ï¼Œä»¥åŠ elasticsearch æˆ– lucene çš„æ–‡æ¡£ä½œä¸ºç»“æœé›†ã€‚</code></pre><h4 id="è¯é¢‘-é€†å‘æ–‡æ¡£é¢‘ç‡-TF-IDF"><a href="#è¯é¢‘-é€†å‘æ–‡æ¡£é¢‘ç‡-TF-IDF" class="headerlink" title="è¯é¢‘/é€†å‘æ–‡æ¡£é¢‘ç‡(TF/IDF)"></a>è¯é¢‘/é€†å‘æ–‡æ¡£é¢‘ç‡(TF/IDF)</h4><pre><code class="textmate">å½“åŒ¹é…åˆ°ä¸€ç»„æ–‡æ¡£åï¼Œéœ€è¦æ ¹æ®ç›¸å…³åº¦æ’åºè¿™äº›æ–‡æ¡£ï¼Œä¸æ˜¯æ‰€æœ‰çš„æ–‡æ¡£éƒ½åŒ…å«æ‰€æœ‰è¯ï¼Œæœ‰äº›è¯æ¯”å…¶ä»–çš„è¯æ›´é‡è¦ã€‚ä¸€ä¸ªæ–‡æ¡£çš„ç›¸å…³åº¦è¯„åˆ†éƒ¨åˆ†å–å†³äºæ¯ä¸ªæŸ¥è¯¢è¯åœ¨æ–‡æ¡£ä¸­çš„ æƒé‡ ã€‚è¯é¢‘è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘åº¦è¶Šé«˜ï¼Œæƒé‡è¶Šé«˜ ã€‚é€†å‘æ–‡æ¡£é¢‘ç‡è¯åœ¨é›†åˆæ‰€æœ‰æ–‡æ¡£é‡Œå‡ºç°çš„é¢‘æ¬¡è¶Šé«˜ï¼Œæƒé‡è¶Šä½ </code></pre><h4 id="å­—æ®µé•¿åº¦å½’ä¸€"><a href="#å­—æ®µé•¿åº¦å½’ä¸€" class="headerlink" title="å­—æ®µé•¿åº¦å½’ä¸€"></a>å­—æ®µé•¿åº¦å½’ä¸€</h4><pre><code class="textmate">å­—æ®µçš„é•¿åº¦è¶ŠçŸ­ï¼Œå­—æ®µçš„æƒé‡è¶Šé«˜ã€‚å­—æ®µé•¿åº¦å½’ä¸€å€¼(norm)</code></pre><h4 id="ç»„åˆä½¿ç”¨"><a href="#ç»„åˆä½¿ç”¨" class="headerlink" title="ç»„åˆä½¿ç”¨"></a>ç»„åˆä½¿ç”¨</h4><pre><code class="textmate">è¯é¢‘ï¼ˆterm frequencyï¼‰ã€é€†å‘æ–‡æ¡£é¢‘ç‡ï¼ˆinverse document frequencyï¼‰å’Œå­—æ®µé•¿åº¦å½’ä¸€å€¼ï¼ˆfield-length normï¼‰â€”â€”æ˜¯åœ¨ç´¢å¼•æ—¶è®¡ç®—å¹¶å­˜å‚¨çš„ã€‚æœ€åå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·è®¡ç®—å•ä¸ªè¯åœ¨ç‰¹å®šæ–‡æ¡£ä¸­çš„æƒé‡ ã€‚</code></pre><h3 id="è„šæœ¬è¯„åˆ†"><a href="#è„šæœ¬è¯„åˆ†" class="headerlink" title="è„šæœ¬è¯„åˆ†"></a>è„šæœ¬è¯„åˆ†</h3><pre><code class="textmate">å¦‚æœæ‰€æœ‰ function_score å†…ç½®çš„å‡½æ•°éƒ½æ— æ³•æ»¡è¶³åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ script_score å‡½æ•°è‡ªè¡Œå®ç°é€»è¾‘Elasticsearch é‡Œä½¿ç”¨ Groovy ä½œä¸ºé»˜è®¤çš„è„šæœ¬è¯­è¨€ä¾‹å­:å…¥å‚:     priceå’Œmarginå˜é‡å¯ä»¥åˆ†åˆ«ä»æ–‡æ¡£ä¸­æå–    thresholdã€discountã€targetæ˜¯ä½œä¸ºå‚æ•°paramsä¼ å…¥çš„GET /_search&#123;  &quot;function_score&quot;: &#123;    &quot;functions&quot;: [      &#123; ...location clause... &#125;,       &#123; ...price clause... &#125;,       &#123;        &quot;script_score&quot;: &#123;          &quot;params&quot;: &#123;             &quot;threshold&quot;: 80,            &quot;discount&quot;: 0.1,            &quot;target&quot;: 10          &#125;,          &quot;script&quot;: &quot;price  = doc[&#39;price&#39;].value; margin = doc[&#39;margin&#39;].value;          if (price &lt; threshold) &#123; return price * margin / target &#125;;          return price * (1 - discount) * margin / target;&quot;         &#125;      &#125;    ]  &#125;&#125;tips:   1.å°†è¿™äº›å˜é‡ä½œä¸ºå‚æ•° params ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢æ—¶åŠ¨æ€æ”¹å˜è„šæœ¬æ— é¡»é‡æ–°ç¼–è¯‘ã€‚  2.JSON ä¸èƒ½æ¥å—å†…åµŒçš„æ¢è¡Œç¬¦ï¼Œè„šæœ¬ä¸­çš„æ¢è¡Œç¬¦å¯ä»¥ç”¨ \n æˆ– ; ç¬¦å·æ›¿ä»£</code></pre><h2 id="äººç±»è¯­è¨€å¤„ç†"><a href="#äººç±»è¯­è¨€å¤„ç†" class="headerlink" title="äººç±»è¯­è¨€å¤„ç†"></a>äººç±»è¯­è¨€å¤„ç†</h2><pre><code class="textmate">åˆ†è¯å™¨  standard(æ ‡å‡†åˆ†è¯å™¨)ã€english(è‹±æ–‡åˆ†è¯å™¨)ã€icu(äºšæ´²è¯­è¨€åˆ†è¯å™¨) é”™è¯¯æ‹¼å†™åŒ¹é…-è¯­éŸ³åŒ¹é…    æœç´¢å‘éŸ³ç›¸ä¼¼çš„è¯ï¼Œå³ä½¿ä»–ä»¬çš„æ‹¼å†™ä¸åŒã€‚ Soundexç®—æ³•</code></pre><h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h2><h3 id="ä¸»è¦æ¦‚å¿µ"><a href="#ä¸»è¦æ¦‚å¿µ" class="headerlink" title="ä¸»è¦æ¦‚å¿µ"></a>ä¸»è¦æ¦‚å¿µ</h3><pre><code class="textmate">æ¡¶ï¼ˆBucketsï¼‰    æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæŒ‡æ ‡ï¼ˆMetricsï¼‰    å¯¹æ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œç»Ÿè®¡è®¡ç®—æ¯ä¸ªèšåˆéƒ½æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¡¶å’Œé›¶ä¸ªæˆ–è€…å¤šä¸ªæŒ‡æ ‡çš„ç»„åˆæ¡¶åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äº SQL çš„åˆ†ç»„ï¼ˆGROUP BYï¼‰ï¼Œè€ŒæŒ‡æ ‡åˆ™ç±»ä¼¼äº COUNT() ã€ SUM() ã€ MAX() ç­‰ç»Ÿè®¡æ–¹æ³•ã€‚ä¾‹ï¼šSELECT COUNT(color)  FROM table GROUP BY color;1.COUNT(color) ç›¸å½“äºæŒ‡æ ‡ã€‚2.GROUP BY color ç›¸å½“äºæ¡¶ã€‚</code></pre><h3 id="æ¡¶"><a href="#æ¡¶" class="headerlink" title="æ¡¶"></a>æ¡¶</h3><pre><code class="textmate">æ¡¶ ç®€å•æ¥è¯´å°±æ˜¯æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆ1.å½“èšåˆå¼€å§‹è¢«æ‰§è¡Œï¼Œæ¯ä¸ªæ–‡æ¡£é‡Œé¢çš„å€¼é€šè¿‡è®¡ç®—æ¥å†³å®šç¬¦åˆå“ªä¸ªæ¡¶çš„æ¡ä»¶ã€‚å¦‚æœåŒ¹é…åˆ°ï¼Œæ–‡æ¡£å°†æ”¾å…¥ç›¸åº”çš„æ¡¶å¹¶æ¥ç€è¿›è¡Œèšåˆæ“ä½œã€‚2.æ¡¶ä¹Ÿå¯ä»¥è¢«åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ï¼Œæä¾›å±‚æ¬¡åŒ–çš„æˆ–è€…æœ‰æ¡ä»¶çš„åˆ’åˆ†æ–¹æ¡ˆã€‚3.Elasticsearch æœ‰å¾ˆå¤šç§ç±»å‹çš„æ¡¶ï¼Œèƒ½è®©ä½ é€šè¿‡å¾ˆå¤šç§æ–¹å¼æ¥åˆ’åˆ†æ–‡æ¡£ï¼ˆæ—¶é—´ã€æœ€å—æ¬¢è¿çš„è¯ã€å¹´é¾„åŒºé—´ã€åœ°ç†ä½ç½®ç­‰ç­‰ï¼‰ã€‚å…¶å®æ ¹æœ¬ä¸Šéƒ½æ˜¯é€šè¿‡åŒæ ·çš„åŸç†è¿›è¡Œæ“ä½œï¼šåŸºäºæ¡ä»¶æ¥åˆ’åˆ†æ–‡æ¡£ã€‚</code></pre><h3 id="æŒ‡æ ‡"><a href="#æŒ‡æ ‡" class="headerlink" title="æŒ‡æ ‡"></a>æŒ‡æ ‡</h3><pre><code class="textmate">æ¡¶èƒ½è®©æˆ‘ä»¬åˆ’åˆ†æ–‡æ¡£åˆ°æœ‰æ„ä¹‰çš„é›†åˆï¼Œä½†æ˜¯æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯å¯¹è¿™äº›æ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œä¸€äº›æŒ‡æ ‡çš„è®¡ç®—ã€‚åˆ†æ¡¶æ˜¯ä¸€ç§è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µï¼šå®ƒæä¾›äº†ä¸€ç§ç»™æ–‡æ¡£åˆ†ç»„çš„æ–¹æ³•æ¥è®©æˆ‘ä»¬å¯ä»¥è®¡ç®—æ„Ÿå…´è¶£çš„æŒ‡æ ‡ã€‚å¤§å¤šæ•° æŒ‡æ ‡ æ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ï¼ˆä¾‹å¦‚æœ€å°å€¼ã€å¹³å‡å€¼ã€æœ€å¤§å€¼ï¼Œè¿˜æœ‰æ±‡æ€»ï¼‰ï¼Œè¿™äº›æ˜¯é€šè¿‡æ–‡æ¡£çš„å€¼æ¥è®¡ç®—ã€‚åœ¨å®è·µä¸­ï¼ŒæŒ‡æ ‡èƒ½è®©ä½ è®¡ç®—åƒå¹³å‡è–ªèµ„ã€æœ€é«˜å‡ºå”®ä»·æ ¼ã€95%çš„æŸ¥è¯¢å»¶è¿Ÿè¿™æ ·çš„æ•°æ®ã€‚èšåˆ     ç”±æ¡¶å’ŒæŒ‡æ ‡ç»„æˆçš„ã€‚ èšåˆå¯èƒ½åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå¯èƒ½åªæœ‰ä¸€ä¸ªæŒ‡æ ‡ï¼Œæˆ–è€…å¯èƒ½ä¸¤ä¸ªéƒ½æœ‰ã€‚ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›æ¡¶åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ã€‚</code></pre><h3 id="æ¡å½¢å›¾"><a href="#æ¡å½¢å›¾" class="headerlink" title="æ¡å½¢å›¾"></a>æ¡å½¢å›¾</h3><pre><code class="textmate">èšåˆè¿˜æœ‰ä¸€ä¸ªä»¤äººæ¿€åŠ¨çš„ç‰¹æ€§å°±æ˜¯èƒ½å¤Ÿååˆ†å®¹æ˜“åœ°å°†å®ƒä»¬è½¬æ¢æˆå›¾è¡¨å’Œå›¾å½¢ã€‚ä¾‹:GET /cars/transactions/_search&#123;   &quot;size&quot; : 0,   &quot;aggs&quot;:&#123;      &quot;price&quot;:&#123;         &quot;histogram&quot;:&#123;            &quot;field&quot;: &quot;price&quot;,            &quot;interval&quot;: 20000         &#125;,         &quot;aggs&quot;:&#123;            &quot;revenue&quot;: &#123;               &quot;sum&quot;: &#123;                  &quot;field&quot; : &quot;price&quot;               &#125;             &#125;         &#125;      &#125;   &#125;&#125;//å“åº”ç»“æœ-ç›´æ–¹å›¾&#123;...   &quot;aggregations&quot;: &#123;      &quot;price&quot;: &#123;         &quot;buckets&quot;: [            &#123;               &quot;key&quot;: 0,               &quot;doc_count&quot;: 3,               &quot;revenue&quot;: &#123;                  &quot;value&quot;: 37000               &#125;            &#125;,            &#123;               &quot;key&quot;: 20000,               &quot;doc_count&quot;: 4,               &quot;revenue&quot;: &#123;                  &quot;value&quot;: 95000               &#125;            &#125;         ]      &#125;   &#125;&#125;</code></pre><h3 id="æŒ‰æ—¶é—´ç»Ÿè®¡"><a href="#æŒ‰æ—¶é—´ç»Ÿè®¡" class="headerlink" title="æŒ‰æ—¶é—´ç»Ÿè®¡"></a>æŒ‰æ—¶é—´ç»Ÿè®¡</h3><pre><code class="textmate">//æŸ¥è¯¢è„šæœ¬GET /cars/transactions/_search&#123;   &quot;size&quot; : 0,   &quot;aggs&quot;: &#123;      &quot;sales&quot;: &#123;         &quot;date_histogram&quot;: &#123;            &quot;field&quot;: &quot;sold&quot;,            &quot;interval&quot;: &quot;month&quot;,             &quot;format&quot;: &quot;yyyy-MM-dd&quot;,               &quot;min_doc_count&quot; : 0,    //å¼ºåˆ¶è¿”å›ç©º bucketsã€‚            &quot;extended_bounds&quot; : &#123;   //å¼ºåˆ¶è¿”å›æ•´å¹´ã€‚                &quot;min&quot; : &quot;2014-01-01&quot;,                &quot;max&quot; : &quot;2014-12-31&quot;            &#125;         &#125;      &#125;   &#125;&#125;//è¿”å›ç»“æœ&#123;   ...   &quot;aggregations&quot;: &#123;      &quot;sales&quot;: &#123;         &quot;buckets&quot;: [            &#123;               &quot;key_as_string&quot;: &quot;2014-01-01&quot;,               &quot;key&quot;: 1388534400000,               &quot;doc_count&quot;: 1            &#125;,            &#123;               &quot;key_as_string&quot;: &quot;2014-02-01&quot;,               &quot;key&quot;: 1391212800000,               &quot;doc_count&quot;: 1            &#125;         ]...&#125;</code></pre><h3 id="Doc-Values"><a href="#Doc-Values" class="headerlink" title="Doc Values"></a>Doc Values</h3><pre><code class="textmate">1.èšåˆä½¿ç”¨ä¸€ä¸ªå« doc values çš„æ•°æ®ç»“æ„ã€‚Doc values å¯ä»¥ä½¿èšåˆæ›´å¿«ã€æ›´é«˜æ•ˆå¹¶ä¸”å†…å­˜å‹å¥½2.Doc values çš„å­˜åœ¨æ˜¯å› ä¸ºå€’æ’ç´¢å¼•åªå¯¹æŸäº›æ“ä½œæ˜¯é«˜æ•ˆçš„ã€‚ å€’æ’ç´¢å¼•çš„ä¼˜åŠ¿ åœ¨äºæŸ¥æ‰¾åŒ…å«æŸä¸ªé¡¹çš„æ–‡æ¡£ï¼Œè€Œå¯¹äºä»å¦å¤–ä¸€ä¸ªæ–¹å‘çš„ç›¸åæ“ä½œå¹¶ä¸é«˜æ•ˆï¼Œå³ï¼šç¡®å®šå“ªäº›é¡¹æ˜¯å¦å­˜åœ¨å•ä¸ªæ–‡æ¡£é‡Œï¼Œèšåˆéœ€è¦è¿™ç§æ¬¡çº§çš„è®¿é—®æ¨¡å¼ã€‚3.Doc Values æ˜¯åœ¨ç´¢å¼•æ—¶ä¸ å€’æ’ç´¢å¼• åŒæ—¶ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ Doc Values å’Œ å€’æ’ç´¢å¼• ä¸€æ ·ï¼ŒåŸºäº Segement ç”Ÿæˆå¹¶ä¸”æ˜¯ä¸å¯å˜çš„ã€‚åŒæ—¶ Doc Values å’Œ å€’æ’ç´¢å¼• ä¸€æ ·åºåˆ—åŒ–åˆ°ç£ç›˜ï¼Œè¿™æ ·å¯¹æ€§èƒ½å’Œæ‰©å±•æ€§æœ‰å¾ˆå¤§å¸®åŠ©ã€‚Doc Values é€šè¿‡åºåˆ—åŒ–æŠŠæ•°æ®ç»“æ„æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„å†…å­˜ï¼Œè€Œä¸æ˜¯ JVM çš„ Heap ã€‚ å½“ working set è¿œå°äºç³»ç»Ÿçš„å¯ç”¨å†…å­˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°† Doc Values é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œä½¿å¾—å…¶è¯»å†™ååˆ†å¿«é€Ÿï¼›ä¸è¿‡ï¼Œå½“å…¶è¿œå¤§äºå¯ç”¨å†…å­˜æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®éœ€è¦ä»ç£ç›˜è¯»å– Doc Valuesï¼Œç„¶åé€‰æ‹©æ€§æ”¾åˆ°åˆ†é¡µç¼“å­˜ä¸­ã€‚åŸç†:    Doc values é€šè¿‡è½¬ç½®ä¸¤è€…é—´çš„å…³ç³»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å€’æ’ç´¢å¼•å°†è¯é¡¹æ˜ å°„åˆ°åŒ…å«å®ƒä»¬çš„æ–‡æ¡£ï¼Œdoc values å°†æ–‡æ¡£æ˜ å°„åˆ°å®ƒä»¬åŒ…å«çš„è¯é¡¹    ç”¨é€”:Doc values ä¸ä»…å¯ä»¥ç”¨äºèšåˆã€‚ ä»»ä½•éœ€è¦æŸ¥æ‰¾æŸä¸ªæ–‡æ¡£åŒ…å«çš„å€¼çš„æ“ä½œéƒ½å¿…é¡»ä½¿ç”¨å®ƒã€‚ é™¤äº†èšåˆï¼Œè¿˜åŒ…æ‹¬æ’åºï¼Œè®¿é—®å­—æ®µå€¼çš„è„šæœ¬ï¼Œçˆ¶å­å…³ç³»å¤„ç†</code></pre><h2 id="åœ°ç†ä½ç½®"><a href="#åœ°ç†ä½ç½®" class="headerlink" title="åœ°ç†ä½ç½®"></a>åœ°ç†ä½ç½®</h2><pre><code class="textmate">Elasticsearch æä¾›äº† ä¸¤ç§è¡¨ç¤ºåœ°ç†ä½ç½®çš„æ–¹å¼ï¼š1.ç”¨çº¬åº¦ï¼ç»åº¦è¡¨ç¤ºçš„åæ ‡ç‚¹ä½¿ç”¨ geo_point å­—æ®µç±»å‹2.ç”¨GeoJSON æ ¼å¼å®šä¹‰çš„å¤æ‚åœ°ç†å½¢çŠ¶ï¼Œä½¿ç”¨ geo_shape å­—æ®µç±»å‹ã€‚Geo-points å…è®¸ä½ æ‰¾åˆ°è·ç¦»å¦ä¸€ä¸ªåæ ‡ç‚¹ä¸€å®šèŒƒå›´å†…çš„åæ ‡ç‚¹ã€è®¡ç®—å‡ºä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»æ¥æ’åºæˆ–è¿›è¡Œç›¸å…³æ€§æ‰“åˆ†ã€æˆ–è€…èšåˆåˆ°æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Šçš„ä¸€ä¸ªç½‘æ ¼ã€‚å¦ä¸€æ–¹é¢ï¼ŒGeo-shapes çº¯ç²¹æ˜¯ç”¨æ¥è¿‡æ»¤çš„ã€‚å®ƒä»¬å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªåœ°ç†å½¢çŠ¶æ˜¯å¦æœ‰é‡åˆæˆ–è€…æŸä¸ªåœ°ç†å½¢çŠ¶æ˜¯å¦å®Œå…¨åŒ…å«äº†å…¶ä»–åœ°ç†å½¢çŠ¶ã€‚Geohashes æ˜¯ä¸€ç§å°†ç»çº¬åº¦åæ ‡ï¼ˆ lat/lon ï¼‰ç¼–ç æˆå­—ç¬¦ä¸²çš„æ–¹å¼ã€‚è¿™ä¹ˆåšçš„åˆè¡·åªæ˜¯ä¸ºäº†è®©åœ°ç†ä½ç½®åœ¨ url ä¸Šå‘ˆç°çš„å½¢å¼æ›´åŠ å‹å¥½ï¼Œä½†ç°åœ¨ geohashes å·²ç»å˜æˆä¸€ç§åœ¨æ•°æ®åº“ä¸­æœ‰æ•ˆç´¢å¼•åœ°ç†åæ ‡ç‚¹å’Œåœ°ç†å½¢çŠ¶çš„æ–¹å¼ã€‚Geohashes æŠŠæ•´ä¸ªä¸–ç•Œåˆ†ä¸º 32 ä¸ªå•å…ƒçš„æ ¼å­ â€”â€” 4 è¡Œ 8 åˆ— â€”â€” æ¯ä¸€ä¸ªæ ¼å­éƒ½ç”¨ä¸€ä¸ªå­—æ¯æˆ–è€…æ•°å­—æ ‡è¯†ã€‚</code></pre><h2 id="æ•°æ®å»ºæ¨¡"><a href="#æ•°æ®å»ºæ¨¡" class="headerlink" title="æ•°æ®å»ºæ¨¡"></a>æ•°æ®å»ºæ¨¡</h2><pre><code class="textmate">Elasticsearchå»ºæ¨¡    å…³è”å…³ç³»å¤„ç† ã€ åµŒå¥—å¯¹è±¡ å’Œ çˆ¶-å­å…³ç³»æ–‡æ¡£ å¦å¤–ESæ”¯æŒå¤šç§æ‰©å®¹æ–¹å¼</code></pre><h2 id="è¿ç»´"><a href="#è¿ç»´" class="headerlink" title="è¿ç»´"></a>è¿ç»´</h2><pre><code class="textmate">æ”¯æŒåŠ¨æ€æ›´æ–°çš„å‚æ•°https://www.elastic.co/guide/en/elasticsearch/reference/5.6/cluster-update-settings.htmlé›†ç¾¤å¤‡ä»½ã€å¿«ç…§æ¢å¤</code></pre><h2 id="ESä½¿ç”¨æ—¶è¯¥æ³¨æ„ä»€ä¹ˆ"><a href="#ESä½¿ç”¨æ—¶è¯¥æ³¨æ„ä»€ä¹ˆ" class="headerlink" title="ESä½¿ç”¨æ—¶è¯¥æ³¨æ„ä»€ä¹ˆ"></a>ESä½¿ç”¨æ—¶è¯¥æ³¨æ„ä»€ä¹ˆ</h2><ul><li>ä¸€å®šè¦é…ç½®å¯†ç ,æ¨è<a href="https://search-guard.com/">SearchGuard</a></li><li><a href="https://www.infoq.cn/article/ZzAZ0wZ0JmzfxSj-v1lU">å±å®³-åœ¨çº¿èµŒåœºæ³„æ¼ 1.08 äº¿æŠ•æ³¨ä¿¡æ¯ï¼ŒElasticSearch å†æˆç¥¸é¦–</a></li><li><a href="https://www.infoq.cn/article/Pmc0PXdFdXHB*T5CygVJ">ä¸€ä¸ªæœˆ 6 æ¬¡æ³„éœ²ï¼Œä¸ºå•¥å¤§å®¶ç”¨ Elasticsearch æ€»ä¸è®¾å¯†ç </a></li></ul><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/mnhtYvR_5N7gtIOgjSUJmA">æœç´¢ä¹‹è·¯ï¼šElasticsearchçš„è¯ç”Ÿ</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/es-optimizing-query-performance.md">es åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼ˆæ•°åäº¿çº§åˆ«ï¼‰å¦‚ä½•æé«˜æŸ¥è¯¢æ•ˆç‡å•Šï¼Ÿ</a></li><li><a href="https://www.infoq.cn/article/ug*cbrk9303MiNZPrSEO">æ»´æ»´åŸºäº ElasticSearch çš„ä¸€ç«™å¼æœç´¢ä¸­å°å®è·µ</a></li><li><a href="https://mp.weixin.qq.com/s/Fvf9JcOc5oSRlLdHB4tYxA">è®©Elasticsearché£èµ·æ¥ï¼ç™¾äº¿çº§å®æ—¶æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜</a></li><li><a href="https://mp.weixin.qq.com/s/g9_eXCouaaBobU9Emjp9bA">Elasticsearchè¯»å†™ä¸­é—´ä»¶çš„è®¾è®¡</a></li><li><a href="https://www.infoq.cn/article/build-enterprise-search-scenarios-using-elasticsearch">å¦‚ä½•ä½¿ç”¨ Elasticsearch æ„å»ºä¼ä¸šçº§æœç´¢æ–¹æ¡ˆï¼Ÿ</a></li><li><a href="https://cloud.tencent.com/developer/article/1066239">Elasticsearchå­¦ä¹ ï¼Œè¯·å…ˆçœ‹è¿™ä¸€ç¯‡ï¼</a></li></ul><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><h3 id="é‡å»ºç´¢å¼•æ­¥éª¤"><a href="#é‡å»ºç´¢å¼•æ­¥éª¤" class="headerlink" title="é‡å»ºç´¢å¼•æ­¥éª¤"></a>é‡å»ºç´¢å¼•æ­¥éª¤</h3><blockquote><p>æ€»ä½“æ€è·¯: åˆ›å»ºå¤‡ä»½ç´¢å¼•ï¼Œå¤åˆ¶æ•°æ®ï¼Œåˆ é™¤æ—§ç´¢å¼•ï¼Œæ–°å»ºç´¢å¼•ï¼Œå¤åˆ¶æ•°æ®ï¼Œåˆ é™¤å¤‡ä»½ç´¢å¼•</p></blockquote><pre><code class="textmate">ä¾‹å¦‚ï¼š user_index  user_index_alias# æ–°å»ºå¤‡ä»½ç´¢å¼•PUT user_index_bak&#123;       &quot;settings&quot;:&#123;        &quot;number_of_replicas&quot;: 1,        &quot;number_of_shards&quot;: 1        -- åˆ†è¯å™¨è®¾ç½®    &#125;,    &quot;mappings&quot;:&#123;        &quot;user_index_bak&quot;:&#123;            &quot;properties&quot;:&#123;                &quot;id&quot;:&#123;                    &quot;type&quot;: &quot;keyword&quot;                &#125;            &#125;        &#125;    &#125;&#125;#å¤åˆ¶æ•°æ®POST _reindex&#123;  &quot;source&quot;: &#123;    &quot;index&quot;: &quot;user_index&quot;  &#125;,  &quot;dest&quot;: &#123;    &quot;index&quot;: &quot;user_index_bak&quot;  &#125;&#125;#æŸ¥è¯¢å¤åˆ¶çš„æ•°æ®GET user_index_bak/_search&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;# æŸ¥è¯¢é…ç½®GET user_index_bak/_mappingGET user_index_bak/_settings# åˆ é™¤ç´¢å¼•DELETE  user_index#é‡å»ºPUT user_index&#123;       &quot;settings&quot;:&#123;        &quot;number_of_replicas&quot;: 1,        &quot;number_of_shards&quot;: 1        -- åˆ†è¯å™¨è®¾ç½®    &#125;,    &quot;mappings&quot;:&#123;        &quot;user_index_bak&quot;:&#123;            &quot;properties&quot;:&#123;                &quot;id&quot;:&#123;                    &quot;type&quot;: &quot;keyword&quot;                &#125;            &#125;        &#125;    &#125;&#125;# åˆ›å»ºç´¢å¼•åˆ«åPUT _alias&#123;  &quot;actions&quot; : [&#123;&quot;add&quot; : &#123;&quot;index&quot; : &quot;user_index&quot; , &quot;alias&quot; : &quot;user_index_alias&quot;&#125;&#125;]&#125;# å¤åˆ¶æ•°æ®POST _reindex&#123;  &quot;source&quot;: &#123;    &quot;index&quot;: &quot;user_index_bak&quot;  &#125;,  &quot;dest&quot;: &#123;    &quot;index&quot;: &quot;user_index_alias&quot;  &#125;&#125;# æŸ¥è¯¢æ•°æ®POST user_index_alias/_search&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;# æŸ¥è¯¢é…ç½®GET user_index_alias/_mappingGET user_index_alias/_settings#åˆ é™¤å¤‡ä»½ç´¢å¼•DELETE  user_index_bak</code></pre>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§è¯æ•°æ®ç»“æ„-æ‘˜è¦</title>
      <link href="/2022/01/13/backend/java/algorithm/book1/"/>
      <url>/2022/01/13/backend/java/algorithm/book1/</url>
      
        <content type="html"><![CDATA[<h2 id="å¤§è¯æ•°æ®ç»“æ„-æ‘˜è¦"><a href="#å¤§è¯æ•°æ®ç»“æ„-æ‘˜è¦" class="headerlink" title="å¤§è¯æ•°æ®ç»“æ„-æ‘˜è¦"></a>å¤§è¯æ•°æ®ç»“æ„-æ‘˜è¦</h2><blockquote><p>é˜…è¯»ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹ä¸€ä¹¦ï¼Œæ€»ç»“ä¸‹æ¥ä¸€äº›ä¸œè¥¿ï¼›æ€»ç»“çš„æ¯”è¾ƒç²—ï¼Œéƒ¨åˆ†æ€æƒ³æš‚æ—¶ç†è§£ä¸äº†ï¼Œå…ˆæ”¾ä¸€æ”¾ï¼Œåé¢é€šè¿‡å­¦ä¹ å…¶ä»–çš„ä¸œè¥¿åï¼Œå†å›è¿‡å¤´æ¥æ¶ˆåŒ–è¿™äº›çŸ¥è¯†ç‚¹</p></blockquote><h3 id="1ã€æ•°æ®ç»“æ„"><a href="#1ã€æ•°æ®ç»“æ„" class="headerlink" title="1ã€æ•°æ®ç»“æ„"></a>1ã€æ•°æ®ç»“æ„</h3><blockquote><p>æ•°æ®ç»“æ„æ˜¯ç›¸äº’ä¹‹é—´å­˜åœ¨ä¸€ç§æˆ–å¤šç§ç‰¹å®šå…³ç³»çš„æ•°æ®å…ƒç´ çš„é›†åˆ</p></blockquote><h4 id="æ•°æ®çš„é€»è¾‘ç»“æ„"><a href="#æ•°æ®çš„é€»è¾‘ç»“æ„" class="headerlink" title="æ•°æ®çš„é€»è¾‘ç»“æ„"></a>æ•°æ®çš„é€»è¾‘ç»“æ„</h4><pre><code class="textmate">1.é›†åˆç»“æ„    å±äºåŒä¸€é›†åˆï¼Œå…ƒç´ å¹³ç­‰2.çº¿æ€§ç»“æ„    å…ƒç´ ä¸€å¯¹ä¸€3.æ ‘çŠ¶ç»“æ„    å…ƒç´ ä¸€å¯¹å¤šçš„å±‚æ¬¡å…³ç³»4.å›¾çŠ¶ç»“æ„    å…ƒç´ å¤šå¯¹å¤š</code></pre><h4 id="æ•°æ®çš„ç‰©ç†ç»“æ„"><a href="#æ•°æ®çš„ç‰©ç†ç»“æ„" class="headerlink" title="æ•°æ®çš„ç‰©ç†ç»“æ„"></a>æ•°æ®çš„ç‰©ç†ç»“æ„</h4><pre><code class="textmate">1.é¡ºåºå­˜å‚¨    å…ƒç´ å­˜æ”¾åœ¨åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒï¼Œæ•°æ®é€»è¾‘å…³ç³»ä¸ç‰©ç†å…³ç³»ä¸€è‡´2.é“¾å¼ç»“æ„    æŠŠæ•°æ®å­˜åœ¨ä»»åŠ¡ä»»æ„çš„ å­˜å‚¨å•å…ƒä¸­ï¼Œåœ°å€è¿ä¸è¿ç»­éƒ½å¯ä»¥ï¼›é€šè¿‡æŒ‡é’ˆæ‰¾åˆ°ç›¸å…³è”çš„æ•°æ®ä½ç½®</code></pre><h3 id="2ã€æ—¶é—´ç®—æ³•å¤æ‚åº¦"><a href="#2ã€æ—¶é—´ç®—æ³•å¤æ‚åº¦" class="headerlink" title="2ã€æ—¶é—´ç®—æ³•å¤æ‚åº¦"></a>2ã€æ—¶é—´ç®—æ³•å¤æ‚åº¦</h3><h4 id="æ¨å¯¼æ–¹æ³•"><a href="#æ¨å¯¼æ–¹æ³•" class="headerlink" title="æ¨å¯¼æ–¹æ³•"></a>æ¨å¯¼æ–¹æ³•</h4><pre><code class="textmate">1.ç”¨å¸¸æ•°1å–ä»£æ—¶é—´ä¸­çš„æ‰€æœ‰åŠ æ³•å¸¸æ•°2.ä¿®æ”¹çš„æ¬¡å‡½æ•°ä¸­ï¼Œåªä¿ç•™æœ€é«˜é˜¶3.å¦‚æœæœ€é«˜é˜¶å­˜åœ¨ä¸”ä¸æ˜¯1ï¼Œåˆ™å»é™¤ä¸è¿™ä¸ªé¡¹ç›¸ä¹˜çš„å¸¸æ•°ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯å¤§Oé˜¶</code></pre><ul><li>å¸¸æ•°é˜¶ O(1)</li></ul><pre><code class="textmate">int sum = 0,n=100; //æ‰§è¡Œä¸€æ¬¡sum = sum+n; //æ‰§è¡Œä¸€æ¬¡System.out.printf(sum); //æ‰§è¡Œä¸€æ¬¡O(1)</code></pre><ul><li>çº¿æ€§é˜¶ O(n)</li><li>å¯¹æ•°é˜¶ Ologn</li><li>å¹³æ–¹é˜¶ O(nÂ²)</li></ul><h3 id="3ã€çº¿æ€§è¡¨"><a href="#3ã€çº¿æ€§è¡¨" class="headerlink" title="3ã€çº¿æ€§è¡¨"></a>3ã€çº¿æ€§è¡¨</h3><ul><li>é¡ºåºå­˜å‚¨ç»“æ„</li></ul><pre><code class="textmate">å­˜å‚¨ä½ç½®è¿ç»­ï¼Œæ’å…¥æ…¢ï¼ŒæŸ¥æ‰¾å¿«(ä¸‹æ ‡æŸ¥æ‰¾)</code></pre><ul><li>é“¾å¼å­˜å‚¨ç»“æ„<ul><li>å•é“¾è¡¨</li><li>é™æ€é“¾è¡¨</li><li>å¾ªç¯é“¾è¡¨</li><li>åŒå‘å¾ªç¯é“¾è¡¨</li></ul></li></ul><pre><code class="textmate">æŸ¥æ‰¾æ…¢ï¼Œæ’å…¥åˆ é™¤å—ï¼›ç©ºé—´æ¢æ—¶é—´</code></pre><h3 id="4ã€æ ˆä¸é˜Ÿåˆ—"><a href="#4ã€æ ˆä¸é˜Ÿåˆ—" class="headerlink" title="4ã€æ ˆä¸é˜Ÿåˆ—"></a>4ã€æ ˆä¸é˜Ÿåˆ—</h3><ul><li>æ ˆ</li></ul><pre><code class="textmate">æ ˆæ˜¯é™å®šä»…åœ¨é˜Ÿå°¾è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ä½œç”¨ï¼šé€’å½’åº”ç”¨ï¼šå››åˆ™è¿ç®—è¡¨è¾¾å¼æ±‚å€¼(åç¼€è¡¨è¾¾å¼)</code></pre><ul><li>é˜Ÿåˆ—</li></ul><pre><code class="textmate">é˜Ÿåˆ—æ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œå¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨</code></pre><h3 id="5ã€ä¸²"><a href="#5ã€ä¸²" class="headerlink" title="5ã€ä¸²"></a>5ã€ä¸²</h3><blockquote><p>ä¸²æ˜¯ç”±0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆçš„æœ‰é™åºåˆ—ï¼Œåˆå«å­—ç¬¦ä¸²</p></blockquote><ul><li>KMPåŒ¹é…ç®—æ³•</li></ul><h3 id="6ã€æ ‘"><a href="#6ã€æ ‘" class="headerlink" title="6ã€æ ‘"></a>6ã€æ ‘</h3><ul><li><p>æ·±åº¦</p><pre><code class="textmate">æ ‘ä¸­èŠ‚ç‚¹çš„æœ€å¤§å±‚æ¬¡ï¼Œç§°ä¸ºæ ‘çš„æ·±åº¦æˆ–é«˜åº¦</code></pre></li><li><p>è¡¨ç¤ºæ–¹æ³•</p></li></ul><pre><code class="textmate">åŒäº²è¡¨ç¤ºæ³•ã€å­©å­è¡¨ç¤ºæ³•ã€å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•</code></pre><ul><li>äºŒå‰æ ‘</li></ul><pre><code class="textmate">1.æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤é¢—å­æ ‘ï¼ŒäºŒå‰æ ‘ä¸­ä¸å­˜åœ¨åº¦å¤§äº2çš„èŠ‚ç‚¹2.å·¦å³å­—æ•°æ˜¯æœ‰é¡ºåºçš„ï¼Œä¸èƒ½é¢ å€’3.åªæœ‰ä¸€é¢—å­æ ‘ï¼Œä¹Ÿè¦åŒºåˆ†æ˜¯å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘äº”ç§åŸºæœ¬å½¢æ€    1.ç©ºäºŒå‰æ ‘    2.åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹    3.æ ¹èŠ‚ç‚¹åªæœ‰å·¦å­æ ‘    4.æ ¹èŠ‚ç‚¹åªæœ‰å³å­æ ‘    5.æ ¹èŠ‚ç‚¹æ—¢æœ‰å·¦å­æ ‘åˆæœ‰å³å­æ ‘</code></pre><ul><li>ç‰¹æ®ŠäºŒå‰æ ‘</li></ul><pre><code class="textmate">1.æ–œæ ‘2.æ»¡äºŒå‰æ ‘(å·¦å³èŠ‚ç‚¹æ•°é‡å®Œå…¨ç›¸ç­‰)3.å®Œå…¨äºŒå‰æ ‘(åœ¨æŸä¸€å±‚ä¸Šï¼Œå·¦å³èŠ‚ç‚¹æ•°é‡ç›¸ç­‰)</code></pre><ul><li>äºŒå‰æ ‘éå†æ–¹æ³•</li></ul><pre><code class="textmate">1.å‰åº       ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆå·¦è¾¹åå³ä¾æ¬¡éå†2.ä¸­åº    ä»æœ€å·¦è¾¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†æ ¹èŠ‚ç‚¹ï¼Œåéå†å³è¾¹èŠ‚ç‚¹3.ååº    ä»æœ€å·¦è¾¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†å³è¾¹èŠ‚ç‚¹ï¼Œæœ€åéå†æ ¹èŠ‚ç‚¹4.å±‚åºéå†    ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚ä»å·¦åˆ°å³éå†</code></pre><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/tree-first.png" alt="tree-first" style="zoom:30%;" /><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/tree-middle.png" alt="tree-middle" style="zoom:33%;" /><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/tree-last.png" alt="image-20220113103906997" style="zoom:31%;" /><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/tree-level.png" alt="image-20220113103925951" style="zoom:33%;" /><ul><li><p>æ ‘çš„åº”ç”¨</p><pre><code class="textmate">èµ«å¤«æ›¼æ ‘    å¸¦æƒè·¯å¾„é•¿åº¦WPLæœ€å°çš„äºŒå‰æ ‘ç§°ä¸ºèµ«å¤«æ›¼æ ‘èµ«å¤«æ›¼ç¼–ç -å‹ç¼©</code></pre></li></ul><h3 id="7ã€å›¾-Graph"><a href="#7ã€å›¾-Graph" class="headerlink" title="7ã€å›¾-Graph"></a>7ã€å›¾-Graph</h3><blockquote><p>å›¾æ˜¯ç”±é¡¶ç‚¹çš„æœ‰ç©·éç©ºé›†åˆçš„é¡¶ç‚¹ä¹‹é—´è¾¹çš„é›†åˆç»„æˆï¼Œé€šå¸¸è¡¨ç¤ºä¸ºï¼š G(V,E), å…¶ä¸­Gæ˜¯ä¸€ä¸ªå›¾ï¼ŒVæ˜¯å›¾Gä¸­é¡¶ç‚¹çš„ç»“å©šï¼ŒEæ˜¯å›¾Gä¸­è¾¹çš„é›†åˆ</p></blockquote><h4 id="å›¾ä¸­çš„ä¸€äº›å®šä¹‰"><a href="#å›¾ä¸­çš„ä¸€äº›å®šä¹‰" class="headerlink" title="å›¾ä¸­çš„ä¸€äº›å®šä¹‰"></a>å›¾ä¸­çš„ä¸€äº›å®šä¹‰</h4><ul><li><p>å›¾ä¸­æ•°æ®å…ƒç´ ç§°ä¸ºé¡¶ç‚¹(Vertex)</p></li><li><p>å›¾ç»“æ„ä¸­ï¼Œä¸å…è®¸æ²¡æœ‰é¡¶ç‚¹</p></li><li><p>å›¾ä¸­ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´éƒ½æœ‰å¯èƒ½æœ‰å…³ç³»ï¼Œé¡¶ç‚¹ä¹‹é—´çš„é€»è¾‘å…³ç³»ç”¨è¾¹æ¥è¡¨ç¤ºï¼Œè¾¹é›†å¯ä»¥æ˜¯ç©ºçš„</p></li><li><p>è¾¹çš„å®šä¹‰</p><pre><code class="textmate">æ— å‘è¾¹æœ‰å‘è¾¹</code></pre></li></ul><h3 id="8ã€æŸ¥æ‰¾"><a href="#8ã€æŸ¥æ‰¾" class="headerlink" title="8ã€æŸ¥æ‰¾"></a>8ã€æŸ¥æ‰¾</h3><h4 id="é¡ºåºè¡¨æŸ¥æ‰¾"><a href="#é¡ºåºè¡¨æŸ¥æ‰¾" class="headerlink" title="é¡ºåºè¡¨æŸ¥æ‰¾"></a>é¡ºåºè¡¨æŸ¥æ‰¾</h4><h4 id="æœ‰åºè¡¨æŸ¥æ‰¾"><a href="#æœ‰åºè¡¨æŸ¥æ‰¾" class="headerlink" title="æœ‰åºè¡¨æŸ¥æ‰¾"></a>æœ‰åºè¡¨æŸ¥æ‰¾</h4><ul><li>æŠ˜åŠæŸ¥æ‰¾</li><li>æ’å€¼æŸ¥æ‰¾</li><li>æ–æ³¢é‚£å¥‘æŸ¥æ‰¾</li></ul><h4 id="çº¿æ€§ç´¢å¼•æŸ¥æ‰¾"><a href="#çº¿æ€§ç´¢å¼•æŸ¥æ‰¾" class="headerlink" title="çº¿æ€§ç´¢å¼•æŸ¥æ‰¾"></a>çº¿æ€§ç´¢å¼•æŸ¥æ‰¾</h4><ul><li><p>ç¨ å¯†ç´¢å¼•</p><pre><code class="textmate">ç¨ å¯†ç´¢å¼•æ˜¯æŒ‡åœ¨çº¿æ€§ç´¢å¼•ä¸­ï¼Œå°†æ•°æ®é›†ä¸­çš„æ¯ä¸ªè®°å½•å¯¹åº”ä¸€ä¸ªç´¢å¼•é¡¹ï¼›ä¾‹ï¼šè®°äº‹æœ¬</code></pre></li><li><p>åˆ†å—ç´¢å¼•</p><pre><code class="textmate">å—å†…æ— åºï¼Œå—é—´æœ‰åºï¼› å‚è€ƒå›¾ä¹¦é¦†ã€æ¡£æ¡ˆé¦†å­˜æ”¾ä¹¦ç±æ–¹å¼</code></pre></li><li><p>å€’æ’ç´¢å¼•</p><pre><code class="textmate">ç´¢å¼•é¡¹é€šç”¨ç»“æ„ï¼šæ¬¡å…³é”®ç è®°å½•å·è¡¨</code></pre></li></ul><h4 id="äºŒå‰æ’åºæ ‘"><a href="#äºŒå‰æ’åºæ ‘" class="headerlink" title="äºŒå‰æ’åºæ ‘"></a>äºŒå‰æ’åºæ ‘</h4><h4 id="å¹³è¡¡äºŒå‰æ ‘-AVLæ ‘"><a href="#å¹³è¡¡äºŒå‰æ ‘-AVLæ ‘" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘(AVLæ ‘)"></a>å¹³è¡¡äºŒå‰æ ‘(AVLæ ‘)</h4><pre><code class="textmate">æ„å»ºæ€æƒ³: æ¯å½“æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å› æ’å…¥è€Œç ´åäº†æ ‘çš„å¹³è¡¡æ€§ï¼Œè‹¥æ˜¯ï¼Œåˆ™æ‰¾å‡ºæœ€å°ä¸å¹³è¡¡å­æ ‘ã€‚åœ¨ä¿æŒäºŒå‰æ’åºæ ‘ç‰¹æ€§çš„å‰æä¸‹ï¼Œè°ƒæ•´æœ€å°ä¸å¹³è¡¡å­æ ‘å„èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥å…³ç³»ï¼Œè¿›è¡Œç›¸åº”æ—‹è½¬ï¼Œä½¿ä¹‹æˆä¸ºæ–°çš„å¹³è¡¡å­æ ‘</code></pre><h4 id="å¤šè·¯æŸ¥æ‰¾æ ‘-Bæ ‘"><a href="#å¤šè·¯æŸ¥æ‰¾æ ‘-Bæ ‘" class="headerlink" title="å¤šè·¯æŸ¥æ‰¾æ ‘(Bæ ‘)"></a>å¤šè·¯æŸ¥æ‰¾æ ‘(Bæ ‘)</h4><h4 id="å“ˆå¸Œè¡¨æŸ¥æ‰¾"><a href="#å“ˆå¸Œè¡¨æŸ¥æ‰¾" class="headerlink" title="å“ˆå¸Œè¡¨æŸ¥æ‰¾"></a>å“ˆå¸Œè¡¨æŸ¥æ‰¾</h4><pre><code class="textmate">æ•£åˆ—æŠ€æœ¯æœ€é€‚åˆçš„æ±‚è§£é—®é¢˜æ˜¯æŸ¥æ‰¾ä¸ç»™å®šå€¼ç›¸ç­‰çš„è®°å½•ï¼›ä½†æ˜¯æ— æ³•æŸ¥æ‰¾æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ç»“æœæ•£åˆ—å‡½æ•°çš„æ„é€ æ–¹æ³•ï¼š    1.ç›´æ¥å®šå€æ³•    2.æ•°å­—åˆ†ææ³•    3.å¹³æ–¹å–ä¸­æ³•    4.æŠ˜å æ³•    5.é™¤ç•™ä½™æ•°æ³•    6.éšæœºæ•°æ³•å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼š    1.å¼€æ”¾å®šå€æ³•        è§£å†³å†²çªçš„å¼€æ”¾å®šå€æ³•ç§°ä¸ºçº¿æ€§æ¢æµ‹æ³•        æœ¬æ¥ä¸æ˜¯åŒä¹‰è¯å´éœ€è¦äº‰å¤ºåŒä¸€ä¸ªåœ°å€çš„æƒ…å†µï¼Œç§°ä¸ºå †ç§¯        ä¸ºäº†ä¸è®©å…³é”®å­—éƒ½å †ç§¯åœ¨ä¸€ä¸ªåŒºåŸŸã€‚é‡‡ç”¨äºŒæ¬¡æ¢æµ‹æ³•/éšæœºæ¢æµ‹æ³• é‡æ–°è®¡ç®—åœ°å€    2.å†æ•£åˆ—å‡½æ•°æ³•    3.é“¾åœ°å€æ³•    4.å…¬å…±æº¢å‡ºåŒºæ³•</code></pre><h3 id="9ã€æ’åº"><a href="#9ã€æ’åº" class="headerlink" title="9ã€æ’åº"></a>9ã€æ’åº</h3><h4 id="æ’åºåˆ†ç±»"><a href="#æ’åºåˆ†ç±»" class="headerlink" title="æ’åºåˆ†ç±»"></a>æ’åºåˆ†ç±»</h4><pre><code class="textmate">æ ¹æ®åœ¨æ’åºè¿‡ç¨‹ä¸­å¾…æ’åºçš„è®°å½•æ˜¯å¦å…¨éƒ¨è¢«æ”¾ç½®åœ¨å†…å­˜ä¸­ï¼Œæ’åºåˆ†ä¸º:å†…æ’åºå’Œå¤–æ’åºå†…æ’åº: å†…æ’åºæ˜¯åœ¨æ’åºçš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¾…æ’åºçš„æ‰€æœ‰è®°å½•å…¨éƒ¨éƒ½è¢«æ”¾ç½®åœ¨å†…å­˜ä¸­ã€‚å¤–æ’åº: ç”±äºæ’åºçš„è®°å½•ä¸ªæ•°å¤ªå¤šï¼Œä¸èƒ½åŒæ—¶æ”¾ç½®åœ¨å†…å­˜ï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹æ€»éœ€è¦åœ¨å†…å¤–å­˜ä¹‹é—´å¤šæ¬¡äº¤æ¢æ•°æ®æ‰èƒ½è¿›è¡Œå†…æ’åºæ€§èƒ½å½±å“ç‚¹ï¼š    1.æ—¶é—´æ€§èƒ½    2.è¾…åŠ©ç©ºé—´    3.ç®—æ³•çš„å¤æ‚æ€§å†…æ’åºåˆ†ä¸º: æ’å…¥æ’åºã€äº¤æ¢æ’åºã€é€‰æ‹©æ’åºå’Œå½’å¹¶æ’åº</code></pre><h4 id="æ’åºç±»å‹"><a href="#æ’åºç±»å‹" class="headerlink" title="æ’åºç±»å‹"></a>æ’åºç±»å‹</h4><ul><li><a href="https://www.runoob.com/data-structures/heap-storage.html">èœé¸Ÿæ•™ç¨‹-æ•°æ®ç»“æ„</a></li></ul><pre><code class="textmate">å†’æ³¡æ’åºã€ç®€å•é€‰æ‹©æ’åºã€ç›´æ¥æ’å…¥æ’åºã€å¸Œå°”æ’åºã€å †æ’åºã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åº</code></pre><ul><li>å¿«é€Ÿæ’åºï¼ï¼ï¼<ul><li>éšæœºå¿«æ’</li><li>åŒè·¯å¿«æ’</li><li>ä¸‰è·¯å¿«æ’</li></ul></li></ul><h4 id="æ’åºæ–¹æ³•æ•ˆç‡æ¯”è¾ƒ"><a href="#æ’åºæ–¹æ³•æ•ˆç‡æ¯”è¾ƒ" class="headerlink" title="æ’åºæ–¹æ³•æ•ˆç‡æ¯”è¾ƒ"></a>æ’åºæ–¹æ³•æ•ˆç‡æ¯”è¾ƒ</h4><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/sort-rank.png" alt="sort-rank" style="zoom:50%;" /><h3 id="ç»“å°¾è¯­"><a href="#ç»“å°¾è¯­" class="headerlink" title="ç»“å°¾è¯­"></a>ç»“å°¾è¯­</h3><ul><li>æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯èƒ½çš„ï¼Œä¸è¦è¢«æ¡æ¡æ¡†æ¡†é™åˆ¶ä½è‡ªå·±çš„æ€ç»´</li><li>å¦‚æœä½ æœ‰æ¢¦æƒ³çš„è¯ï¼Œå°±è¦å»æå«å®ƒã€‚å½“åˆ«äººåšä¸åˆ°ï¼Œä»–ä»¬å°±æƒ³è¦å‘Šè¯‰ä½ ï¼Œä½ ä¹Ÿä¸èƒ½ã€‚å¦‚æœä½ æƒ³è¦äº›ä»€ä¹ˆã€‚å°±åŠªåŠ›å»äº‰å–ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥ä½œç›¸å…³</title>
      <link href="/2022/01/10/thinking/design/"/>
      <url>/2022/01/10/thinking/design/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ¡ˆè®¾è®¡æ–¹æ³•è®º"><a href="#æ–¹æ¡ˆè®¾è®¡æ–¹æ³•è®º" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡æ–¹æ³•è®º"></a>æ–¹æ¡ˆè®¾è®¡æ–¹æ³•è®º</h2><h3 id="4Ræ¶æ„ç†è®º"><a href="#4Ræ¶æ„ç†è®º" class="headerlink" title="4Ræ¶æ„ç†è®º"></a>4Ræ¶æ„ç†è®º</h3><blockquote><p>æ ¹æ®4Rç†è®ºï¼›å¯ä»¥å¾ˆå¥½çš„ååŠ©æˆ‘ä»¬å¾ˆæ¸…æ™°çš„å»è®¤è¯†ä¸€å¥—ç³»ç»Ÿï¼›å°¤å…¶æ˜¯æˆ‘ä»¬åœ¨å­¦ä¹ ä¸€å¥—æ¡†æ¶æºç åŸç†çš„æ—¶å€™</p></blockquote><pre><code class="textmate">é¡¶å±‚ç»“æ„Rank -&gt; ç»„æˆè§’è‰²Role -&gt; è§’è‰²å…³ç³»Relation -&gt; è¿è¡Œè§„åˆ™Rule</code></pre><h2 id="æ–¹æ¡ˆè®¾è®¡è¦ç‚¹æ€»ç»“"><a href="#æ–¹æ¡ˆè®¾è®¡è¦ç‚¹æ€»ç»“" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡è¦ç‚¹æ€»ç»“"></a>æ–¹æ¡ˆè®¾è®¡è¦ç‚¹æ€»ç»“</h2><h4 id="æ•°æ®é‡"><a href="#æ•°æ®é‡" class="headerlink" title="æ•°æ®é‡"></a>æ•°æ®é‡</h4><ul><li>æ¥å£æŸ¥è¯¢çš„æ•°æ®é‡<pre><code class="textmate">è¿‡å¤§çš„èµ°åˆ†é¡µæˆ–è®©æ•°æ®ç«¯å‡ºæ¥å£</code></pre></li><li>æ‰¹é‡æ›´æ–°çš„æ•°æ®é‡</li></ul><h4 id="å…¼å®¹æ€§"><a href="#å…¼å®¹æ€§" class="headerlink" title="å…¼å®¹æ€§"></a>å…¼å®¹æ€§</h4><ul><li>æ˜¯å¦å…¼å®¹è€æ¥å£</li><li>æ˜¯å¦å…¼å®¹è€æ•°æ®</li><li>ä¸åŒç«¯å£æ˜¯å¦å…¼å®¹</li></ul><h4 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h4><ul><li>æ–°ä¸šåŠ¡ä¸Šçº¿è€æ•°æ®æ˜¯å¦è¦å¤„ç†</li><li>åŸæ¥çš„é…ç½®é¡¹æ˜¯å¦è¦æ›´æ–°æˆ–æ–°å¢</li></ul><h4 id="æ‰©å±•æ€§"><a href="#æ‰©å±•æ€§" class="headerlink" title="æ‰©å±•æ€§"></a>æ‰©å±•æ€§</h4><ul><li>å…¶ä»–ä¸šåŠ¡æ˜¯å¦æœ‰ç±»ä¼¼éœ€æ±‚</li><li>ä»£ç æˆ–æ•°æ®æ¨¡å‹é¢„ç•™æ‰©å±•å£</li></ul><h4 id="ä¸šåŠ¡æ•°æ®é‡‡é›†"><a href="#ä¸šåŠ¡æ•°æ®é‡‡é›†" class="headerlink" title="ä¸šåŠ¡æ•°æ®é‡‡é›†"></a>ä¸šåŠ¡æ•°æ®é‡‡é›†</h4><ul><li>æ˜¯å¦æ–¹ä¾¿åç»­æ•°æ®ç»Ÿè®¡</li><li>æ˜¯å¦å½±å“å¤§æ•°æ®ä¸šåŠ¡</li></ul><h4 id="æ—¥å¿—æ‰“å°"><a href="#æ—¥å¿—æ‰“å°" class="headerlink" title="æ—¥å¿—æ‰“å°"></a>æ—¥å¿—æ‰“å°</h4><ul><li>ä¸‰æ–¹æ¥å£å‡ºå…¥å‚æ•°æ‰“å°</li><li>æ ¸å¿ƒæµç¨‹å‡ºå…¥å£æ‰“å°æ ‡è¯†</li><li>æ—¥å¿—æ ¼å¼å»ºè®®<pre><code class="textmate">[xxä¸šåŠ¡] xxæ“ä½œ success/failed param1:xxx param2:xxx</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“æ–¹æ³•è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åäººåè¨€å’Œä¸€äº›æ€ç»´æ¨¡å‹</title>
      <link href="/2022/01/10/thinking/famous/"/>
      <url>/2022/01/10/thinking/famous/</url>
      
        <content type="html"><![CDATA[<h3 id="åè¨€"><a href="#åè¨€" class="headerlink" title="åè¨€"></a>åè¨€</h3><pre><code class="textmate">ä¸è¦æµªè´¹ä½ çš„æ— çŸ¥ã€‚å½“ä½ å¯¹ä¸€é—¨çŸ¥è¯†æ¯«æ— æ‰€çŸ¥æ—¶ï¼Œæœ€å®¹æ˜“é—®å‡ºç®€å•è€Œé‡è¦çš„é—®é¢˜ã€‚ä¸€æ—¦ä½ ä¹ æƒ¯äº†æŸç§ç°è±¡æˆ–äº‹ç‰©ï¼Œè®¤ä¸ºå®ƒæ˜¯ç†æ‰€å½“ç„¶æ—¶ï¼Œæ€ç»´å°±ä¸çŸ¥ä¸è§‰å—åˆ°äº†é™åˆ¶ã€‚-- David Kohn</code></pre><h3 id="æ€ç»´æ¨¡å‹"><a href="#æ€ç»´æ¨¡å‹" class="headerlink" title="æ€ç»´æ¨¡å‹"></a>æ€ç»´æ¨¡å‹</h3><p><a href="https://mp.weixin.qq.com/s/ZvNWabq0339YEOhmUOdCKA">ä¸€äº›æ€ç»´æ¨¡å‹</a></p>]]></content>
      
      
      <categories>
          
          <category> åäººåè¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†™ä½œæ€è·¯å’ŒæŠ€å·§</title>
      <link href="/2022/01/10/thinking/write/"/>
      <url>/2022/01/10/thinking/write/</url>
      
        <content type="html"><![CDATA[<h3 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><h4 id="å†™ä½œæŠ€å·§"><a href="#å†™ä½œæŠ€å·§" class="headerlink" title="å†™ä½œæŠ€å·§"></a>å†™ä½œæŠ€å·§</h4><ul><li>1.é˜æ˜é—®é¢˜ã€è§£å†³æ–¹æ¡ˆå’Œæ”¶ç›Š</li><li>2.çªå‡ºæ–‡ç« çš„å·®å¼‚åŒ–</li><li>3.é—®ä¸€ä¸ªç´§è¿«çš„é—®é¢˜</li><li>4.è‰¾ç‰¹ä½ çš„ç²¾å‡†å—ä¼—</li><li>5.å¼•å…¥ç¤¾ä¼šè¯æ˜</li><li>6.å †ç Œå…³é”®è¯</li><li>7.æ’å…¥å˜é‡å’Œemoji</li></ul><h4 id="ä¸è¦è¸©çš„å‘"><a href="#ä¸è¦è¸©çš„å‘" class="headerlink" title="ä¸è¦è¸©çš„å‘"></a>ä¸è¦è¸©çš„å‘</h4><p>[x] 1.ä¸å¤Ÿç®€æ´<br>[x] 2.è¯­åºé”™ä¹±ï¼Œæœ¬æœ«å€’ç½®<br>[x] 3.ä¸è¿è´¯çš„å¥å­é€»è¾‘<br>[x] 4.å«ç³Šä¸æ¸…çš„æŠ€èƒ½ç‚¹è¡¨è¾¾<br>[x] 5.æ²¡æœ‰è¶³å¤Ÿçš„æ‰­æ›²åŠ›è®©å—ä¼—äº§ç”Ÿäº†è§£æ‚¨çš„äº§å“çš„é©±åŠ¨åŠ›</p><h3 id="æ‰“é€ IP"><a href="#æ‰“é€ IP" class="headerlink" title="æ‰“é€ IP"></a>æ‰“é€ IP</h3><blockquote><p><a href="http://www.woshipm.com/operate/5496711.html">å•†ä¸šIPï¼Œä»0åˆ°1æ“ä½œæŒ‡å—</a></p></blockquote><h4 id="åˆ†æå¥—è·¯"><a href="#åˆ†æå¥—è·¯" class="headerlink" title="åˆ†æå¥—è·¯"></a>åˆ†æå¥—è·¯</h4><pre><code class="textmate">å…³é”®è¯=IPæ‰“é€ IP=æ‰“é€ åŠ¿èƒ½åŠ¿èƒ½=ä¿¡æ¯ä¼ è¾“æ·±åº¦ X ä¿¡æ¯ä¼ è¾“æ•°é‡1. æˆ‘èƒ½æ‹†è§£NBæ¡ˆä¾‹=æˆ‘èƒ½åšåˆ°2. æˆ‘å†™çš„/æ‹çš„å¾ˆå¥½=æˆ‘å¾ˆä¼š    å¿«é€Ÿèµ·åŠ¿çš„å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ï¼Œé€šè¿‡å…¬ä¼—å·æ–‡ç« ï¼Œé’ˆå¯¹æŸä¸€é¢†åŸŸå†™3ç¯‡ï¼Œæ·±åº¦é•¿æ–‡ï¼Œæ­¥éª¤è¯¦å®ã€è½åœ°æ¸…æ™°ã€æ¡ˆä¾‹ä¸°å¯Œï¼Œæœ€é‡è¦çš„è¦é•¿ï¼Œè‡­é•¿è‡­é•¿çš„é‚£ç§ã€‚3. æˆ‘æœ‰å¾ˆå¤šç²‰ä¸=æˆ‘å¾ˆä¼š</code></pre><h4 id="æ ¸å¿ƒåŠ¨ä½œ"><a href="#æ ¸å¿ƒåŠ¨ä½œ" class="headerlink" title="æ ¸å¿ƒåŠ¨ä½œ"></a>æ ¸å¿ƒåŠ¨ä½œ</h4><pre><code class="textmate">1.å¿«é€Ÿå»ºç«‹ä¸“å®¶å½¢è±¡    3-5ç¯‡å¹²è´§é•¿æ–‡ï¼Œå°±å¤Ÿäº†ï¼å¯ä»¥æ˜¯è½åœ°å¹²è´§ã€å¯ä»¥æ˜¯æ¡ˆä¾‹æ‹†è§£ã€ç”šè‡³æ˜¯ä¸€ç¯‡è‡ªå·±ä¸°å¯Œç»å†çš„æ¢³ç†ã€‚2.æŒç»­å†…å®¹è¾“å‡ºé˜¶æ®µ    60%ä¸“ä¸š+20%çš„æ€åº¦+20%çš„æƒ…è°ƒï¼    ä¸“ä¸šå†…å®¹ï¼šç”¨æˆ·ä»˜è´¹çš„æ ¸å¿ƒå…³é”®    æ€åº¦å†…å®¹ï¼šç”¨æˆ·å–œæ¬¢çš„æ ¸å¿ƒå…³é”®    æƒ…è°ƒå†…å®¹ï¼šä½ é•¿æœŸåšæŒçš„å…³é”®3.å¹²è´§è¾“å‡ºå†…å®¹     ç»“æœã€æ¡ˆä¾‹ã€å¹²è´§ã€è®¢å•ã€å¥½è¯„ã€èƒŒä¹¦ã€å›¢é˜Ÿã€è¿‡ç¨‹ã€ç°åœºã€è®¤çŸ¥ã€‚ã€‚ã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†™ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é›†æˆSwaggerUI</title>
      <link href="/2021/11/25/backend/other/swagger/"/>
      <url>/2021/11/25/backend/other/swagger/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://doc.xiaominfo.com/knife4j/documentation/">knife4jå®˜ç½‘</a></li></ul><h3 id="é›†æˆæ­¥éª¤"><a href="#é›†æˆæ­¥éª¤" class="headerlink" title="é›†æˆæ­¥éª¤"></a>é›†æˆæ­¥éª¤</h3><ul><li><p>å¼•å…¥jaråŒ…</p><pre><code class="xml">&lt;dependency&gt;  &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;  &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;  &lt;version&gt;2.0.9&lt;/version&gt;&lt;/dependency&gt;</code></pre></li><li><p>æ·»åŠ é…ç½®ç±»<br>```java<br>/** </p></li></ul><ul><li><p>æ³¨æ„knifeç‰ˆæœ¬å·ï¼Œå¦‚æœæ˜¯2.0.x</p></li><li></li><li><p>**/<br>@Configuration<br>//@EnableSwagger2WebMvc //2.xç‰ˆæœ¬ç”¨è¿™ä¸ª<br>//@EnableOpenApi  //3.xç‰ˆæœ¬ç”¨è¿™ä¸ª<br>public class MySwagger {</p><p> @Bean<br> public Docket createRestApi(Environment env) {</p><pre><code> //å¼€å‘æµ‹è¯•ç¯å¢ƒå¼€å¯ Profiles profile = Profiles.of(&quot;local&quot;, &quot;dev&quot;, &quot;test&quot;); boolean flag = env.acceptsProfiles(profile); //2.xç‰ˆæœ¬ç”¨ DocumentationType.SWAGGER_2 //3.xç‰ˆæœ¬ç”¨ DocumentationType.OAS_30  return new Docket(DocumentationType.SWAGGER_2)         //åˆ†ç»„åç§°         .groupName(&quot;2.Xç‰ˆæœ¬&quot;)         .apiInfo(apiInfo())         .enable(flag)         .pathMapping(&quot;/&quot;)         .select()         //è¿™é‡ŒæŒ‡å®šControlleræ‰«æåŒ…è·¯å¾„         .apis(RequestHandlerSelectors.basePackage(&quot;com.my.demo.web.controller&quot;))         .paths(PathSelectors.any())         .build();</code></pre><p> }</p><p> private ApiInfo apiInfo() {</p><pre><code> return new ApiInfoBuilder()         .title(&quot;æœåŠ¡å&quot;)         .version(&quot;2.0.0&quot;)         .description(&quot;æè¿°&quot;)         .build();</code></pre><p> }<br>}</p><pre><code></code></pre></li></ul><ul><li>å¸¸ç”¨æ³¨è§£</li></ul><pre><code class="textmate">1.Controllerç±»æ³¨è§£    @Api(tags = &quot;Controllerå&quot;)    @RestController    @RequestMapping(&quot;/è¯·æ±‚è·¯å¾„&quot;)2.Controllerä¸­æ–¹æ³•æ³¨è§£    @ApiOperation(value = &quot;æ–¹æ³•å&quot;,notes = &quot;æ–¹æ³•æè¿°&quot;)    @GetMapping(&quot;/è¯·æ±‚è·¯å¾„&quot;)    @PostMapping(&quot;/è¯·æ±‚è·¯å¾„&quot;)3.Controllerä¸­æ–¹æ³•å…¥å‚æ³¨è§£    @RequestParam(value = &quot;å…¥å‚&quot;,name = &quot;å…¥å‚åç§°&quot;)    @RequestBody4.å‡ºå‚å…¥å‚æ³¨è§£    @ApiModel(&quot;å¯¹è±¡åç§°&quot;)    @ApiModelProperty(name = &quot;å±æ€§å&quot;)</code></pre><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ul><li>ç‰ˆæœ¬ä¸å…¼å®¹<pre><code class="textmate">&lt;!--swagger-ui å…¼å®¹æ€§å¥½çš„ç‰ˆæœ¬--&gt;&lt;dependency&gt;  &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;  &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;  &lt;version&gt;2.0.9&lt;/version&gt;  &lt;!-- å»æ‰ä¸å…¼å®¹çš„ç‰ˆæœ¬ --&gt;  &lt;exclusions&gt;      &lt;exclusion&gt;          &lt;artifactId&gt;spring-plugin-core&lt;/artifactId&gt;          &lt;groupId&gt;org.springframework.plugin&lt;/groupId&gt;      &lt;/exclusion&gt;  &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt;  &lt;groupId&gt;org.springframework.plugin&lt;/groupId&gt;  &lt;artifactId&gt;spring-plugin-core&lt;/artifactId&gt;  &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;&lt;/dependency&gt;</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¥å£æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¥å£æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é«˜å¹¶å‘ç›¸å…³</title>
      <link href="/2021/11/22/backend/java/thread/concurrent/"/>
      <url>/2021/11/22/backend/java/thread/concurrent/</url>
      
        <content type="html"><![CDATA[<h1 id="é«˜å¹¶å‘ç›¸å…³"><a href="#é«˜å¹¶å‘ç›¸å…³" class="headerlink" title="é«˜å¹¶å‘ç›¸å…³"></a>é«˜å¹¶å‘ç›¸å…³</h1><blockquote><p>é«˜å¹¶å‘ç›¸å…³ä¹¦ç±æ€»ç»“æ–‡æ¡£</p></blockquote><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h4 id="è¿›ç¨‹çš„ç»“æ„"><a href="#è¿›ç¨‹çš„ç»“æ„" class="headerlink" title="è¿›ç¨‹çš„ç»“æ„"></a>è¿›ç¨‹çš„ç»“æ„</h4><blockquote><p>ç”±ç¨‹åºæ®µã€æ•°æ®ç«¯å’Œè¿›ç¨‹æ§åˆ¶å—ç»„æˆ</p></blockquote><pre><code class="textmate">çº¿ç¨‹çš„å¤§è‡´ç»“æ„çº¿ç¨‹æè¿°ä¿¡æ¯ã€ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå†…å­˜ç»„æˆåŒºåˆ«1.è¿›ç¨‹æ˜¯è¿›ç¨‹ä»£ç æ®µçš„ä¸€æ¬¡é¡ºåºæ‰§è¡Œæµç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆ2.çº¿ç¨‹æ˜¯CPUè°ƒåº¦æœ€å°å•ä½ï¼›è¿›é¡¹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ã€‚3.çº¿ç¨‹ä»è¿›ç¨‹çš„å†…éƒ¨æ¼”è¿›è€Œæ¥ã€‚4.è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼›è¿›ç¨‹ä¸­çš„å„ä¸ªçº¿ç¨‹ä¸å®Œå…¨ç‹¬ç«‹ï¼Œå…±äº«è¿›ç¨‹çš„æ–¹æ³•åŒºå†…å­˜ã€å †å†…å­˜ã€ç³»ç»Ÿèµ„æºç­‰5.åˆ‡æ¢é€Ÿåº¦ä¸åŒï¼š çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é€Ÿåº¦å¿«ã€‚</code></pre><h4 id="Javaçº¿ç¨‹å’ŒOSçº¿ç¨‹å…³ç³»"><a href="#Javaçº¿ç¨‹å’ŒOSçº¿ç¨‹å…³ç³»" class="headerlink" title="Javaçº¿ç¨‹å’ŒOSçº¿ç¨‹å…³ç³»"></a>Javaçº¿ç¨‹å’ŒOSçº¿ç¨‹å…³ç³»</h4><pre><code class="textmate">ä¸€å¯¹ä¸€æ¨¡å‹ï¼Œç¼ºç‚¹æ˜¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ä¹Ÿè¦åˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¼€é”€å¤§</code></pre><h4 id="Javaçº¿ç¨‹åº•å±‚å®ç°"><a href="#Javaçº¿ç¨‹åº•å±‚å®ç°" class="headerlink" title="Javaçº¿ç¨‹åº•å±‚å®ç°"></a>Javaçº¿ç¨‹åº•å±‚å®ç°</h4><pre><code class="textmate">Windowsä¸Šé‡‡ç”¨Win32 APIå®ç°UNIXå’ŒLinuxé‡‡ç”¨Pthread( POSIXæ ‡å‡†çš„æ‰©å±•ï¼Œæä¾›ç”¨æˆ·çº§æˆ–å†…æ ¸çº§åº“)</code></pre><h4 id="JDKåˆ›å»ºLinuxçº¿ç¨‹æºç "><a href="#JDKåˆ›å»ºLinuxçº¿ç¨‹æºç " class="headerlink" title="JDKåˆ›å»ºLinuxçº¿ç¨‹æºç "></a>JDKåˆ›å»ºLinuxçº¿ç¨‹æºç </h4><pre><code class="textmate">src/hotspot/os/linux/os_linux.cpp</code></pre><h4 id="åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"><a href="#åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"></a>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</h4><pre><code class="textmate">Thread/Runnable/FutureTask/çº¿ç¨‹æ± (ThreadPoolExecutor)SynchronousQueued(åŒæ­¥é˜Ÿåˆ—)å¿…é¡»æœ‰takeçº¿ç¨‹åœ¨é˜»å¡ç­‰å¾…ï¼Œofferæ“ä½œæ‰èƒ½æˆåŠŸï¼›å¦åˆ™ä¼šä¸ºæ–°ä»»åŠ¡å¼€ä¸€æ¡æ–°çº¿ç¨‹å»æ‰§è¡Œå…³é—­çº¿ç¨‹æ± æ–¹æ³•shutdown/shutdownNow/awaitTermination</code></pre><h4 id="ç¡®å®šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°"><a href="#ç¡®å®šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°" class="headerlink" title="ç¡®å®šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°"></a>ç¡®å®šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°</h4><pre><code class="textmate">åˆ†ç±»ï¼šIOå¯†é›†å‹   æœ€ä½³çº¿ç¨‹æ•° = CPUæ ¸å¿ƒçº¿ç¨‹çš„2å€CPUå¯†é›†å‹  æœ€ä½³çº¿ç¨‹æ•° = CPUæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ··åˆå‹     æœ€ä½³çº¿ç¨‹æ•° = ((çº¿ç¨‹ç­‰å¾…æ—¶é—´+çº¿ç¨‹ CPU æ—¶é—´)/çº¿ç¨‹ CPU æ—¶é—´ )* CPU æ ¸æ•° = æœ€ä½³çº¿ç¨‹æ•°ç›® =(çº¿ç¨‹ç­‰å¾…æ—¶é—´ä¸çº¿ç¨‹ CPU æ—¶é—´ä¹‹æ¯” + 1)* CPU æ ¸æ•°</code></pre><h4 id="Javaå¯¹è±¡çš„ä¸‰ä¸ªéƒ¨åˆ†"><a href="#Javaå¯¹è±¡çš„ä¸‰ä¸ªéƒ¨åˆ†" class="headerlink" title="Javaå¯¹è±¡çš„ä¸‰ä¸ªéƒ¨åˆ†"></a>Javaå¯¹è±¡çš„ä¸‰ä¸ªéƒ¨åˆ†</h4><pre><code class="textmate">1.å¯¹è±¡å¤´å¯¹è±¡å¤´åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼ŒMark Word(æ ‡è®°å­—)ï¼Œç”¨äºå­˜å‚¨è‡ªèº«è¿è¡Œæ—¶çš„æ•°æ® ä¾‹å¦‚ GC æ ‡å¿—ä½ã€å“ˆå¸Œç ã€é”çŠ¶æ€ç­‰ä¿¡æ¯ã€‚Class Pointer(ç±»å¯¹è±¡æŒ‡é’ˆ)ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•åŒº Class å¯¹è±¡çš„åœ°å€ï¼Œè™šæ‹Ÿæœºé€š è¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚Array Length(æ•°ç»„é•¿åº¦)ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ª Java æ•°ç»„ï¼Œé‚£ä¹ˆæ­¤å­—æ®µå¿…é¡»æœ‰ï¼Œ ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®;å¦‚æœå¯¹è±¡ä¸æ˜¯ä¸€ä¸ª Java æ•°ç»„ï¼Œé‚£ä¹ˆæ­¤å­—æ®µä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯é€‰ å­—æ®µã€‚2.å¯¹è±¡ä½“å¯¹è±¡ä½“åŒ…å«äº†å¯¹è±¡çš„å®ä¾‹å˜é‡(æˆå‘˜å˜é‡)ã€‚ç”¨äºæˆå‘˜å±æ€§å€¼ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„æˆå‘˜å±æ€§å€¼ã€‚è¿™ éƒ¨åˆ†å†…å­˜æŒ‰ 4 å­—èŠ‚å¯¹é½ã€‚3.å¯¹é½å­—èŠ‚å¯¹é½å­—èŠ‚ä¹Ÿå«åšå¡«å……å¯¹é½ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥ä¿è¯ Java å¯¹è±¡åœ¨æ‰€å å†…å­˜å­—èŠ‚æ•°ä¸º 8 çš„å€æ•°(8N bytes)ã€‚HotSpot VM çš„å†…å­˜ç®¡ç†è¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚å¯¹è±¡å¤´æœ¬èº«æ˜¯ 8 çš„ å€æ•°ï¼Œå½“å¯¹è±¡çš„å®ä¾‹å˜é‡æ•°æ®ä¸æ˜¯ 8 çš„å€æ•°ï¼Œä¾¿éœ€è¦å¡«å……æ•°æ®æ¥ä¿è¯ 8 å­—èŠ‚çš„å¯¹é½ã€‚</code></pre><h4 id="å¯¹è±¡ç»“æ„ä¸­çš„æ ¸å¿ƒå­—æ®µä½œç”¨"><a href="#å¯¹è±¡ç»“æ„ä¸­çš„æ ¸å¿ƒå­—æ®µä½œç”¨" class="headerlink" title="å¯¹è±¡ç»“æ„ä¸­çš„æ ¸å¿ƒå­—æ®µä½œç”¨"></a>å¯¹è±¡ç»“æ„ä¸­çš„æ ¸å¿ƒå­—æ®µä½œç”¨</h4><pre><code class="textmate">(1)Mark Word(æ ‡è®°å­—)å­—æ®µä¸»è¦ç”¨æ¥è¡¨ç¤ºå¯¹è±¡çš„çº¿ç¨‹é”çŠ¶æ€ï¼Œå¦å¤–è¿˜å¯ä»¥ç”¨æ¥é…åˆ GCã€ å­˜æ”¾è¯¥å¯¹è±¡çš„ hashCodeã€‚(2)Class Pointer(ç±»å¯¹è±¡æŒ‡é’ˆ)å­—æ®µæ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•åŒºä¸­ Class ä¿¡æ¯çš„æŒ‡é’ˆï¼Œæ„å‘³ç€è¯¥å¯¹è±¡ å¯éšæ—¶çŸ¥é“è‡ªå·±æ˜¯å“ªä¸ª Class çš„å®ä¾‹ã€‚(3)Array Length(æ•°ç»„é•¿åº¦)å­—æ®µä¹Ÿå ç”¨ 32 ä½(åœ¨ 32 ä½ JVM ä¸­)çš„å­—èŠ‚ï¼Œè¿™æ˜¯å¯é€‰çš„ï¼Œ åªæœ‰å½“æœ¬å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡æ—¶æ‰ä¼šæœ‰è¿™ä¸ªéƒ¨åˆ†ã€‚(4)å¯¹è±¡ä½“ç”¨äºä¿å­˜å¯¹è±¡å±æ€§å€¼ï¼Œæ˜¯å¯¹è±¡çš„ä¸»ä½“éƒ¨åˆ†ï¼Œå ç”¨çš„å†…å­˜ç©ºé—´å¤§å°å–å†³äºå¯¹è±¡çš„å± æ€§æ•°é‡å’Œç±»å‹ã€‚(5)å¯¹é½å­—èŠ‚å¹¶ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œå®ƒä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨ã€‚å½“å¯¹è±¡å® ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½(8 å­—èŠ‚çš„æ•´æ•°å€)æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</code></pre><h4 id="å¯¹è±¡ç»“æ„ä¸­çš„å­—æ®µé•¿åº¦"><a href="#å¯¹è±¡ç»“æ„ä¸­çš„å­—æ®µé•¿åº¦" class="headerlink" title="å¯¹è±¡ç»“æ„ä¸­çš„å­—æ®µé•¿åº¦"></a>å¯¹è±¡ç»“æ„ä¸­çš„å­—æ®µé•¿åº¦</h4><pre><code class="textmate">Mark Wordã€Class Pointerã€Array Length ç­‰å­—æ®µçš„é•¿åº¦ï¼Œéƒ½ä¸ JVM çš„ä½æ•°æœ‰å…³ã€‚Mark Word çš„é•¿åº¦ä¸º JVM çš„ä¸€ä¸ª Word(å­—)å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´ 32 ä½ JVM çš„ Mark Word ä¸º 32 ä½ï¼Œ64 ä½ JVM ä¸º 64 ä½ã€‚Class Pointer(ç±»å¯¹è±¡æŒ‡é’ˆ)å­—æ®µçš„é•¿åº¦ä¹Ÿä¸º JVM çš„ä¸€ä¸ª Word(å­—)å¤§å°ï¼Œå³ 32 ä½çš„ JVMä¸º32ä½ï¼Œ64ä½çš„JVMä¸º64ä½ã€‚æ‰€ä»¥ï¼Œåœ¨ 32 ä½ JVM è™šæ‹Ÿæœºä¸­ï¼ŒMark Word å’Œ Class Pointer è¿™ä¸¤éƒ¨åˆ†éƒ½æ˜¯ 32 ä½çš„;åœ¨ 64 ä½ JVM è™šæ‹Ÿæœºä¸­ï¼ŒMark Word å’Œ Class Pointer è¿™ä¸¤éƒ¨åˆ†éƒ½æ˜¯ 64 ä½çš„ã€‚å¯¹äºå¯¹è±¡æŒ‡é’ˆè€Œè¨€ï¼Œå¦‚æœ JVM ä¸­å¯¹è±¡æ•°é‡è¿‡å¤šï¼Œä½¿ç”¨ 64 ä½çš„æŒ‡é’ˆå°†æµªè´¹å¤§é‡å†…å­˜ï¼Œé€šè¿‡ç®€ å•ç»Ÿè®¡ï¼Œ64 ä½çš„ JVM å°†ä¼šæ¯” 32 ä½çš„ JVM å¤šè€—è´¹ 50%çš„å†…å­˜ã€‚ä¸ºäº†èŠ‚çº¦å†…å­˜å¯ä»¥ä½¿ç”¨é€‰é¡¹ +UseCompressedOops å¼€å¯æŒ‡é’ˆå‹ç¼©ã€‚é€‰é¡¹ UseCompressedOops ä¸­çš„ Oop éƒ¨åˆ†ä¸º Ordinary object pointer æ™®é€šå¯¹è±¡æŒ‡é’ˆçš„ç¼©å†™ã€‚å¦‚æœå¼€å¯ UseCompressedOops é€‰é¡¹ï¼Œä»¥ä¸‹ç±»å‹çš„æŒ‡é’ˆå°†ä» 64 ä½å‹ç¼©è‡³ 32 ä½:1.Class å¯¹è±¡çš„å±æ€§æŒ‡é’ˆ(å³é™æ€å˜é‡)2.Object å¯¹è±¡çš„å±æ€§æŒ‡é’ˆ(å³æˆå‘˜å˜é‡)3.æ™®é€šå¯¹è±¡æ•°ç»„çš„å…ƒç´ æŒ‡é’ˆå½“ç„¶ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„æŒ‡é’ˆéƒ½ä¼šå‹ç¼©ï¼Œä¸€äº›ç‰¹æ®Šç±»å‹çš„æŒ‡é’ˆä¸ä¼šå‹ç¼©ï¼Œæ¯”å¦‚æŒ‡å‘ PermGen(æ°¸ ä¹…ä»£)çš„ Class å¯¹è±¡æŒ‡é’ˆ(JDK8 ä¸­æŒ‡å‘å…ƒç©ºé—´çš„ Class å¯¹è±¡æŒ‡é’ˆ)ã€æœ¬åœ°å˜é‡ã€å †æ ˆå…ƒç´ ã€å…¥å‚ã€è¿” å›å€¼å’Œ NULL æŒ‡é’ˆç­‰ã€‚</code></pre><h4 id="JOL"><a href="#JOL" class="headerlink" title="JOL"></a>JOL</h4><pre><code class="textmate">JOL å…¨ç§°ä¸º Java Object Layoutï¼Œæ˜¯åˆ†æ JVM ä¸­å¯¹è±¡çš„ç»“æ„å¸ƒå±€çš„å·¥å…·ï¼Œè¯¥å·¥å…·å¤§é‡ä½¿ç”¨äº† Unsafeã€JVMTI æ¥è§£ç å†…éƒ¨å¸ƒå±€æƒ…å†µï¼Œå…¶åˆ†æç»“æœç›¸å¯¹æ¯”è¾ƒç²¾å‡†çš„ã€‚è¦ä½¿ç”¨ JOL å·¥å…·ï¼Œå…ˆå¼•å…¥ Maven çš„ä¾èµ–åæ ‡:&lt;!--Java Object Layout --&gt; &lt;dependency&gt;    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;     &lt;artifactId&gt;jol-core&lt;/artifactId&gt;     &lt;version&gt;0.11&lt;/version&gt;&lt;/dependency&gt;</code></pre><h4 id="é”åˆ†ç±»"><a href="#é”åˆ†ç±»" class="headerlink" title="é”åˆ†ç±»"></a>é”åˆ†ç±»</h4><blockquote><p>åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</p></blockquote><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h4><pre><code class="textmate">åå‘é”çš„æ ¸å¿ƒåŸç†æ˜¯:    å¦‚æœä¸å­˜åœ¨çº¿ç¨‹ç«äº‰çš„ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œé‚£ä¹ˆé”å°±è¿›å…¥åå‘çŠ¶æ€ï¼Œ æ­¤æ—¶ Mark Word çš„ç»“æ„å˜ä¸ºåå‘é”ç»“æ„ï¼Œé”å¯¹è±¡çš„é”æ ‡å¿—ä½(lock)è¢«æ”¹ä¸º 01ï¼Œåå‘æ ‡å¿—ä½ (biased_lock)è¢«æ”¹ä¸º 1ï¼Œç„¶åçº¿ç¨‹çš„ ID è®°å½•åœ¨é”å¯¹è±¡çš„ Mark Word ä¸­(ä½¿ç”¨ CAS æ“ä½œå®Œæˆ)ä»¥åè¯¥çº¿ç¨‹è·å–é”çš„æ—¶ï¼Œåˆ¤æ–­ä¸€ä¸‹çº¿ç¨‹ ID å’Œæ ‡å¿—ä½ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ï¼Œè¿ CAS æ“ä½œéƒ½ä¸ éœ€è¦ï¼Œè¿™æ ·å°±çœå»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œï¼Œä»è€Œä¹Ÿå°±æä¾›ç¨‹åºçš„æ€§èƒ½ã€‚åå‘é”çš„ä¸»è¦ä½œç”¨:    æ¶ˆé™¤æ— ç«äº‰æƒ…å†µä¸‹çš„åŒæ­¥åŸè¯­ï¼Œè¿›ä¸€æ­¥æå‡ç¨‹åºæ€§èƒ½ï¼Œæ‰€åœ¨äºæ²¡æœ‰é”ç« äº‰çš„åœºåˆï¼Œåå‘é”æœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æœ‰ç¬¬äºŒæ¡çº¿ç¨‹éœ€è¦ç«äº‰é”ï¼Œé‚£ä¹ˆåå‘æ¨¡å¼ç«‹å³ ç»“æŸï¼Œè¿›å…¥è½»é‡çº§é”çš„çŠ¶æ€ã€‚åå‘é”çš„ç¼ºç‚¹:    å¦‚æœé”å¯¹è±¡æ—¶å¸¸è¢«å¤šæ¡çº¿ç¨‹ç«äº‰ï¼Œé‚£åå‘é”å°±æ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”å…¶æ’¤é”€çš„è¿‡ç¨‹ ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½å¼€é”€ã€‚</code></pre><h4 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h4><pre><code class="textmate">è½»é‡é”å­˜åœ¨çš„ç›®çš„æ˜¯å°½å¯èƒ½ä¸ç”¨åŠ¨ç”¨æ“ä½œç³»ç»Ÿå±‚é¢çš„äº’æ–¥é”ï¼Œå› ä¸ºé‚£ä¸ªæ€§èƒ½ä¼šæ¯”è¾ƒå·®ï¼Œè½»é‡çº§é”æ˜¯ä¸€ç§è‡ªæ—‹é”ï¼›è½»é‡çº§é”ä¸»è¦æœ‰ä¸¤ç§:    (1)æ™®é€šè‡ªæ—‹é”ï¼Œ        æ‰€è°“æ™®é€šè‡ªæ—‹é”ï¼Œå°±æ˜¯æŒ‡å½“æœ‰çº¿ç¨‹æ¥ç«äº‰é”æ—¶ï¼ŒæŠ¢é”çº¿ç¨‹ä¼šåœ¨åŸåœ°å¾ªç¯ç­‰å¾…ï¼Œè€Œä¸æ˜¯è¢«é˜»å¡ï¼Œç›´åˆ°é‚£ä¸ªå æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œè¿™ä¸ªæŠ¢é”çº¿ç¨‹å°±å¯ä»¥é©¬ä¸Šè·å¾—é”çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªæ—‹çš„æ¬¡æ•°ä¸º 10 æ¬¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡-XX:PreBlockSpin é€‰é¡¹æ¥è¿›è¡Œæ›´æ”¹ã€‚    (2)è‡ªé€‚åº”è‡ªæ—‹é”ã€‚        æ‰€è°“è‡ªé€‚åº”è‡ªæ—‹é”ï¼Œå°±æ˜¯ç­‰å¾…çº¿ç¨‹ç©ºå¾ªç¯çš„è‡ªæ—‹æ¬¡æ•°å¹¶éæ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ä¼šåŠ¨æ€ç€æ ¹æ®å®é™… æƒ…å†µæ¥æ”¹å˜è‡ªæ—‹ç­‰å¾…çš„æ¬¡æ•°ï¼Œè‡ªæ—‹æ¬¡æ•°ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šJDK1.6 çš„è½»é‡çº§é”ä½¿ç”¨çš„æ˜¯æ™®é€šè‡ªæ—‹é”ï¼Œä¸”éœ€è¦ä½¿ç”¨ -XX:+UseSpinning é€‰ é¡¹æ‰‹å·¥å¼€å¯ã€‚JDK1.7 åï¼Œè½»é‡çº§é”ä½¿ç”¨è‡ªé€‚åº”è‡ªæ—‹é”ï¼ŒJVM å¯åŠ¨æ—¶è‡ªåŠ¨å¼€å¯ï¼Œä¸”è‡ª æ—‹æ—¶é—´ç”± JVM è‡ªåŠ¨æ§åˆ¶ã€‚</code></pre><h4 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h4><pre><code class="textmate">JVM ä¸­æ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ªç›‘è§†å™¨ï¼Œç›‘è§†å™¨å’Œå¯¹è±¡ä¸€èµ·åˆ›å»ºã€é”€æ¯Monitor æ˜¯ä¸€ç§åŒæ­¥å·¥å…·ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯:(1)åŒæ­¥ã€‚    Monitor æ‰€ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç ï¼Œæ˜¯äº’æ–¥çš„æ‰§è¡Œã€‚ä¸€ä¸ª Monitor æ˜¯ä¸€ä¸ªè¿è¡Œè®¸å¯ï¼Œä»»ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä»£ç éƒ½éœ€è¦è·å¾—è¿™ä¸ªè®¸å¯ï¼Œç¦»å¼€æ—¶æŠŠè®¸å¯å½’è¿˜ã€‚(2)åä½œã€‚    Monitor æä¾› Signal æœºåˆ¶:å…è®¸æ­£æŒæœ‰è®¸å¯çš„çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒè®¸å¯è¿›å…¥é˜»å¡ç­‰å¾…çŠ¶ æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å‘é€ Signalå»å”¤é†’;å…¶ä»–æ‹¥æœ‰è®¸å¯çš„çº¿ç¨‹å¯ä»¥å‘é€ Signalï¼Œå”¤é†’æ­£åœ¨é˜»å¡ç­‰å¾… çš„çº¿ç¨‹ï¼Œè®©å®ƒå¯ä»¥é‡æ–°è·å¾—è®¸å¯å¹¶å¯åŠ¨æ‰§è¡Œã€‚</code></pre><h4 id="ä¸‰ç§å†…ç½®é”çš„å¯¹æ¯”"><a href="#ä¸‰ç§å†…ç½®é”çš„å¯¹æ¯”" class="headerlink" title="ä¸‰ç§å†…ç½®é”çš„å¯¹æ¯”"></a>ä¸‰ç§å†…ç½®é”çš„å¯¹æ¯”</h4><table><thead><tr><th>é”</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åå‘é”</td><td>åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·</td><td>å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—</td><td>é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—® ä¸´ç•ŒåŒºåœºæ™¯</td></tr><tr><td>è½»é‡çº§é”</td><td>ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦</td><td>æŠ¢ä¸åˆ°é”çš„çº¿ç¨‹ä¼šCASè‡ªæ—‹ç­‰å¾…ï¼Œæ¶ˆè€—CPU</td><td>é”å ç”¨æ—¶é—´çŸ­ï¼Œååé‡ä½</td></tr><tr><td>é‡é‡çº§é”</td><td>çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPU</td><td>çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢</td><td>é”å ç”¨æ—¶é—´è¾ƒé•¿ï¼Œååé‡é«˜</td></tr></tbody></table><h4 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h4><pre><code class="textmate">å®šä¹‰:å½“å¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œå…±äº«çš„èµ„æºæ—¶ï¼Œçº¿ç¨‹é—´é€šè¿‡æŸç§æ–¹å¼äº’ç›¸å‘Š çŸ¥è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥é¿å…æ— æ•ˆçš„èµ„æºäº‰å¤ºã€‚åˆ†ç±»:ç­‰å¾…-é€šçŸ¥ã€å…±äº«å†…å­˜ã€ç®¡é“æµã€‚1.ç­‰å¾…-é€šçŸ¥    &quot;ç­‰å¾…-é€šçŸ¥&quot; æ˜¯Javaä¸­ä½¿ç”¨æœ€ä¸ºæ™®éçš„çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œå…¶æœ€ä¸ºç»å…¸çš„æ¡ˆä¾‹å°±æ˜¯ â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ã€‚2.å…±äº«å†…å­˜    é€šè¿‡å®ç°Runnableæˆ–å†…éƒ¨ç±»çš„å½¢å¼ï¼Œå…±äº«åŒä¸€ä¸ªå˜é‡3.ç®¡é“é€šä¿¡å°±æ˜¯ä½¿ç”¨java.io.PipedInputStream å’Œ java.io.PipedOutputStreamè¿›è¡Œé€šä¿¡wait æ–¹æ³•çš„åŸç†:    é¦–å…ˆ JVM ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹çš„å¯¹è±¡é” Monitor çš„ Owner èµ„æ ¼;å…¶æ¬¡ JVM ä¼š å½“å‰çº¿ç¨‹ç§»å…¥ Monitor çš„ WaitSet é˜Ÿåˆ—ï¼Œè€Œè¿™äº›æ“ä½œéƒ½å’Œå¯¹è±¡é” Monitor æ˜¯ç›¸å…³çš„ã€‚    æ‰€ä»¥ï¼Œwait æ–¹æ³•å¿…é¡»åœ¨ synchronized åŒæ­¥å—çš„å†…éƒ¨ä½¿ç”¨ã€‚åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ wait æ–¹æ³•å‰ï¼Œå¿…é¡» é€šè¿‡ synchronized æ–¹æ³•æˆä¸ºå¯¹è±¡é”çš„ Monitor çš„ Ownerã€‚notify æ–¹æ³•çš„åŸç†:    JVM ä»å¯¹è±¡é”çš„ Monitor çš„ WaitSet é˜Ÿåˆ—ï¼Œç§»åŠ¨ä¸€æ¡çº¿ç¨‹åˆ°å…¶ EntryList é˜Ÿåˆ—ï¼Œè¿™äº›æ“ä½œéƒ½ä¸å¯¹è±¡é”çš„ Monitor æœ‰å…³ã€‚    æ‰€ä»¥ï¼Œnotify æ–¹æ³•ä¹Ÿå¿…é¡»åœ¨ synchronized åŒæ­¥å—çš„å†…éƒ¨ä½¿ç”¨ã€‚åœ¨æ‰§è¡Œ notify æ–¹æ³•å‰ï¼Œå½“å‰çº¿ ç¨‹ä¹Ÿå¿…é¡»é€šè¿‡ synchronized æ–¹æ³•æˆä¸ºå¯¹è±¡é”çš„ Monitor çš„ Ownerã€‚</code></pre><h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><h4 id="ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ</h4><pre><code class="textmate">AtomicStampedReference  compareAndSetAtomicMarkableReference       AtomicMarkableReferenceé€‚ç”¨åªè¦çŸ¥é“å¯¹è±¡æ˜¯å¦æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œè€Œä¸é€‚ç”¨äºå¯¹è±¡è¢«åå¤ä¿®æ”¹çš„ åœºæ™¯ã€‚</code></pre><h4 id="æé«˜é«˜å¹¶å‘åœºæ™¯ä¸‹CASæ“ä½œæ€§èƒ½"><a href="#æé«˜é«˜å¹¶å‘åœºæ™¯ä¸‹CASæ“ä½œæ€§èƒ½" class="headerlink" title="æé«˜é«˜å¹¶å‘åœºæ™¯ä¸‹CASæ“ä½œæ€§èƒ½"></a>æé«˜é«˜å¹¶å‘åœºæ™¯ä¸‹CASæ“ä½œæ€§èƒ½</h4><pre><code class="textmate">LongAdder ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼æå‡é«˜å¹¶å‘åœºæ™¯ä¸‹ CAS æ“ä½œæ€§èƒ½    LongAdder çš„å®ç°æ€è·¯ï¼Œä¸ ConcurrentHashMap ä¸­åˆ†æ®µé”åŸºæœ¬åŸç†éå¸¸ç›¸ä¼¼ï¼Œæœ¬è´¨ä¸Šï¼Œéƒ½æ˜¯ä¸åŒçš„çº¿ç¨‹åœ¨ä¸åŒçš„å•å…ƒä¸Šè¿›è¡Œæ“ä½œï¼Œè¿™æ ·å‡å°‘äº†çº¿ç¨‹ç«äº‰ï¼Œæé«˜äº†å¹¶å‘æ•ˆç‡</code></pre><h3 id="å¯è§æ€§å’Œç¼“å­˜ä¸€è‡´æ€§"><a href="#å¯è§æ€§å’Œç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="å¯è§æ€§å’Œç¼“å­˜ä¸€è‡´æ€§"></a>å¯è§æ€§å’Œç¼“å­˜ä¸€è‡´æ€§</h3><pre><code class="textmate">1. æ€»çº¿é”    æ•ˆç‡ä½ï¼Œå¼€é”€å¤§2. ç¼“å­˜é”     MESI åè®®ï¼Œä¿è¯ç¼“å­˜ä¸€è‡´æ€§     ç¼“å­˜ä¸€è‡´æ€§:ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶å°±æ•´ä½“æ¥è¯´ï¼Œæ˜¯å½“æŸå—CPUå¯¹ç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œäº†ä¹‹åï¼Œ å°±é€šçŸ¥å…¶ä»– CPU æ”¾å¼ƒå‚¨å­˜åœ¨å®ƒä»¬å†…éƒ¨çš„ç¼“å­˜ï¼Œæˆ–è€…ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–    CPU å¯¹ Cache å‰¯ æœ¬å¦‚ä½•ä¸ä¸»å­˜å†…å®¹ä¿æŒä¸€è‡´æœ‰å‡ ç§å†™å…¥æ–¹å¼å¯ä¾›é€‰æ‹©ï¼Œä¸»è¦çš„å†™å…¥æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§    1)Write-through(ç›´å†™æ¨¡å¼)  æ›´æ–°ä½ä¸€çº§ç¼“å­˜å’Œå­˜å‚¨å™¨ï¼Œæ•°æ®å†™å…¥é€Ÿåº¦æ…¢    2)Write-back(å›å†™æ¨¡å¼)  åªå†™å…¥ç¼“å­˜ï¼Œå‘ç°æ•°æ®æœ‰å˜åŠ¨ï¼Œæ‰å°†æ•°æ®æ›´æ–°åˆ°å­˜å‚¨å™¨</code></pre><h4 id="MESIåè®®è§£é‡Š"><a href="#MESIåè®®è§£é‡Š" class="headerlink" title="MESIåè®®è§£é‡Š"></a>MESIåè®®è§£é‡Š</h4><pre><code class="textmate">M: è¢«ä¿®æ”¹(Modified)E: ç‹¬äº«çš„(Exclusive)S: å…±äº«çš„(Shared)I: æ— æ•ˆçš„(Invalid)</code></pre><h4 id="æŒ‡ä»¤é‡æ’"><a href="#æŒ‡ä»¤é‡æ’" class="headerlink" title="æŒ‡ä»¤é‡æ’"></a>æŒ‡ä»¤é‡æ’</h4><pre><code class="textmate">As-if-Serialè§„åˆ™ï¼š ä¸ç®¡å¦‚ä½•é‡æ’åºï¼Œéƒ½å¿…é¡»ä¿è¯ä»£ç åœ¨å•çº¿ç¨‹ä¸‹çš„è¿è¡Œæ­£ç¡®ã€‚æ‰©å±•:    JIT æ˜¯ Just In Time çš„ç¼©å†™, ä¹Ÿå°±æ˜¯â€œå³æ—¶ç¼–è¯‘å™¨â€ã€‚JVM è¯»å…¥â€œ.classâ€ æ–‡ä»¶çš„å­— èŠ‚ç åï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è§£é‡Šæ‰§è¡Œçš„ã€‚ä½†æ˜¯å¯¹äºè¿è¡Œé¢‘ç‡å¾ˆé«˜(å¦‚&gt;5000 æ¬¡)çš„å­—èŠ‚ç ï¼Œ JVM é‡‡ç”¨äº† JIT æŠ€æœ¯ï¼Œå°†ç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</code></pre><h4 id="ç¡¬ä»¶å±‚é¢çš„å†…å­˜å±éšœ"><a href="#ç¡¬ä»¶å±‚é¢çš„å†…å­˜å±éšœ" class="headerlink" title="ç¡¬ä»¶å±‚é¢çš„å†…å­˜å±éšœ"></a>ç¡¬ä»¶å±‚é¢çš„å†…å­˜å±éšœ</h4><pre><code class="texxtmate">1. ç¡¬ä»¶å±‚çš„å†…å­˜å±éšœå®šä¹‰    å†…å­˜å±éšœ(Memory Barrier)åˆç§°å†…å­˜æ …æ (Memory Fences)ï¼Œæ˜¯è®©ä¸€ä¸ª CPU é«˜é€Ÿç¼“å­˜çš„å†… å­˜çŠ¶æ€å¯¹å…¶ä»– CPU å†…æ ¸å¯è§çš„ä¸€é¡¹æŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä¸€é¡¹ä¿éšœè·¨ CPU å†…æ ¸æœ‰åºæ‰§è¡ŒæŒ‡ä»¤çš„æŠ€æœ¯ã€‚    ç¡¬ä»¶å±‚å¸¸ç”¨çš„å†…å­˜å±éšœåˆ†ä¸ºä¸‰ç§:è¯»å±éšœ(Load Barrier)ã€å†™å±éšœ(Store Barrier)ã€å…¨å±éšœ (Full Barrier)ã€‚2.ä½œç”¨    1).é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æ’åº    2).å¼ºåˆ¶è®©é«˜é€Ÿç¼“å­˜çš„æ•°æ®å¤±æ•ˆ</code></pre><h4 id="JMM-Javaå†…å­˜æ¨¡å‹"><a href="#JMM-Javaå†…å­˜æ¨¡å‹" class="headerlink" title="JMM(Javaå†…å­˜æ¨¡å‹)"></a>JMM(Javaå†…å­˜æ¨¡å‹)</h4><blockquote><p>JMM å¹¶ä¸åƒ JVM å†…å­˜ç»“æ„ä¸€æ ·æ˜¯çœŸå®å­˜åœ¨çš„è¿è¡Œå®ä½“ï¼Œæ›´å¤šä½“ç°ä¸ºä¸€ç§è§„èŒƒå’Œè§„åˆ™</p></blockquote><pre><code class="textmate">1.æ ¸å¿ƒçš„ä»·å€¼åœ¨äºè§£å†³å¯è§æ€§å’Œæœ‰åºæ€§ã€‚2.JMMçš„å¦ä¸€å¤§ä»·å€¼ï¼Œåœ¨äºèƒ½å±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æœ€ç»ˆçš„ä¸€è‡´ã€‚Java å†…å­˜æ¨¡å‹çš„è§„å®š:    (1)æ‰€æœ‰å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚     (2)æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œä¸”å¯¹å˜é‡çš„æ“ä½œéƒ½æ˜¯åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œã€‚     (3)ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å½¼æ­¤å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œè¦æƒ³è®¿é—®åªèƒ½é€šè¿‡ä¸»å†…å­˜æ¥ä¼ é€’ã€‚volatileå†…å­˜å±éšœæ“ä½œ    LoadLoadã€LoadStoreã€StoreStoreã€StoreLoadHappens-Before(å…ˆè¡Œå‘ç”Ÿ)è§„åˆ™</code></pre><h2 id="æ˜¾å¼é”"><a href="#æ˜¾å¼é”" class="headerlink" title="æ˜¾å¼é”"></a>æ˜¾å¼é”</h2><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><pre><code class="textmate">Locké”å¯¹æ¯”Javaå†…ç½®é”1.å¯ä¸­æ–­è·å–é”2.å¯éé˜»å¡è·å–é”3.å¯é™æ—¶æŠ¢é”</code></pre><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><pre><code class="textmate">1)â€œå¯é‡å…¥â€å«ä¹‰:è¡¨ç¤ºè¯¥é”èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„é‡å¤åŠ é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹ å¯ä»¥å¤šæ¬¡è¿›å…¥åŒä¸€ä¸ªé”æ‰€åŒæ­¥çš„ä¸´ç•ŒåŒºä»£ç å—ã€‚æ¯”å¦‚ï¼ŒåŒä¸€çº¿ç¨‹åœ¨å¤–å±‚å‡½æ•°è·å¾—é”åï¼Œåœ¨å†…å±‚å‡½ æ•°èƒ½å†æ¬¡è·å–è¯¥é”ï¼Œç”šè‡³å¤šæ¬¡æŠ¢å åˆ°åŒä¸€æŠŠé”ã€‚2)â€œç‹¬å â€å«ä¹‰:åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”ï¼Œè€Œå…¶ä»–è·å–é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œ åªæœ‰æ‹¥æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†é”åï¼Œå…¶ä»–çš„çº¿ç¨‹æ‰èƒ½å¤Ÿè·å–é”ã€‚</code></pre><h3 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h3><blockquote><p> Lockä»£æ›¿äº†synchronizedæ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼Œè€ŒConditionä»£æ›¿äº†å¯¹è±¡ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨</p></blockquote><pre><code class="textmate">Conditionå®ä¾‹æœ¬è´¨ä¸Šç»‘å®šåˆ°ä¸€ä¸ªé”ã€‚è¦è·å–ç‰¹å®šLockå®ä¾‹çš„Conditionå®ä¾‹ï¼Œè¯·ä½¿ç”¨å…¶newCondition()æ–¹æ³•ã€‚åŸºäºæ˜¾ç¤ºé”è¿›è¡Œâ€œç­‰å¾…-é€šçŸ¥â€æ–¹å¼çš„çº¿ç¨‹é—´é€šä¿¡æ¥å£Condition çš„â€œç­‰å¾…-é€šçŸ¥â€æ–¹æ³•å’Œ Object çš„â€œç­‰å¾…-é€šçŸ¥â€æ–¹æ³•çš„è¯­ä¹‰ç­‰æ•ˆå…³ç³»ä¸º:    - Condition ç±»çš„ awiat æ–¹æ³•å’Œ Object ç±»çš„ wait æ–¹æ³•ç­‰æ•ˆã€‚    - Condition ç±»çš„ signal æ–¹æ³•å’Œ Object ç±»çš„ notify æ–¹æ³•ç­‰æ•ˆã€‚    - Condition ç±»çš„ signalAll æ–¹æ³•å’Œ Object ç±»çš„ notifyAll æ–¹æ³•ç­‰æ•ˆã€‚Condition å¯¹è±¡çš„ signal(é€šçŸ¥)æ–¹æ³•å’ŒåŒä¸€ä¸ªå¯¹è±¡çš„ await(ç­‰å¾…)æ–¹æ³•æ˜¯ä¸€ä¸€é…å¯¹ä½¿ç”¨çš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª Condition å¯¹è±¡çš„ signal(æˆ– signalAll)æ–¹æ³•ï¼Œä¸èƒ½å»å”¤é†’å…¶ä»– Condition å¯¹è±¡ä¸Šçš„ await çº¿ç¨‹ã€‚</code></pre><h3 id="LockSupport"><a href="#LockSupport" class="headerlink" title="LockSupport"></a>LockSupport</h3><blockquote><p>LockSupport æ˜¯ JUC æä¾›çš„ä¸€çº¿ç¨‹é˜»å¡ä¸å”¤é†’çš„å·¥å…·ç±»ï¼Œè¯¥å·¥å…·ç±»å¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜» å¡å’Œå”¤é†’ï¼Œå…¶æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ã€‚</p></blockquote><ul><li><p>LockSupport.park()å’Œ Thread.sleep()çš„åŒºåˆ«</p><pre><code class="textmate">ä»åŠŸèƒ½ä¸Šè¯´ï¼ŒLockSupport.park()ä¸ Thread.sleep()æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯è®©çº¿ç¨‹é˜»å¡ï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹:(1)Thread.sleep()æ²¡æ³•ä»å¤–éƒ¨å”¤é†’ï¼Œåªèƒ½è‡ªå·±é†’è¿‡æ¥;è€Œè¢«LockSupport.park()æ–¹æ³•é˜»å¡çš„çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨LockSupport.unpark()æ–¹æ³•å»å”¤é†’ã€‚(2)Thread.sleep()æ–¹æ³•å£°æ˜äº† InterruptedException ä¸­æ–­å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªå—æ£€å¼‚å¸¸ï¼Œè°ƒç”¨è€…éœ€è¦æ•è·è¿™ä¸ªå¼‚å¸¸æˆ–è€…å†æŠ›å‡º;è€Œä½¿ç”¨ LockSupport.park()æ–¹æ³•æ—¶ï¼Œä¸éœ€è¦æ•è·ä¸­æ–­å¼‚å¸¸ã€‚(3)LockSupport.park()æ–¹æ³•ã€Thread.sleep()æ–¹æ³•æ‰€é˜»å¡çš„çº¿ç¨‹ï¼Œå½“è¢«é˜»å¡çº¿ç¨‹çš„ Thread.interrup(tæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè¢«é˜»å¡çº¿ç¨‹éƒ½ä¼šå“åº”çº¿ç¨‹çš„ä¸­æ–­ä¿¡å·ï¼Œå”¤é†’çº¿ç¨‹çš„æ‰§è¡Œã€‚ä¸åŒçš„æ˜¯ï¼Œ äºŒè€…å¯¹ä¸­æ–­ä¿¡å·çš„å“åº”çš„æ–¹å¼ä¸åŒã€‚LockSupport.park( )æ–¹æ³•ä¸ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œ ä»…ä»…è®¾ç½®äº†çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—;è€ŒThread.sleep()æ–¹æ³•è¿˜ä¼šæŠ›å‡ºInterruptedException å¼‚å¸¸ã€‚(4)ä¸ Thread.sleep()ç›¸æ¯”ï¼Œä½¿ç”¨ LockSupport.park()èƒ½æ›´ç²¾å‡†ã€æ›´åŠ çµæ´»çš„é˜»å¡ã€å”¤é†’æŒ‡å®š çº¿ç¨‹ã€‚(5)Thread.sleep()æœ¬èº«å°±æ˜¯ä¸€ä¸ª Native æ–¹æ³•;LockSupport.park()å¹¶ä¸æ˜¯ä¸€ä¸ª Native æ–¹æ³•ï¼Œåªæ˜¯è°ƒç”¨äº†ä¸€ä¸ªUnsafe ç±»çš„Nativeæ–¹æ³•(åå­—ä¹Ÿå« park)å»å®ç°ã€‚(6)LockSupport.park()æ–¹æ³•è¿˜å…è®¸è®¾ç½®ä¸€ä¸ª Blocker å¯¹è±¡ï¼Œä¸»è¦ç”¨æ¥ç»™ç›‘è§†å·¥å…·æˆ–è¯Šæ–­å·¥å…· ç¡®å®šçº¿ç¨‹å—é˜»å¡çš„åŸå› ã€‚</code></pre></li><li><p> LockSupport.park( )ä¸ Object.wait()çš„åŒºåˆ«</p><pre><code class="textmate">LockSupport.park()ä¸ Object.wait()æ–¹æ³•ä¹Ÿç±»ä¼¼ï¼Œéƒ½æ˜¯è®©çº¿ç¨‹é˜»å¡ï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹:(1)Object.wait()æ–¹æ³•éœ€è¦åœ¨synchronizedå—ä¸­æ‰§è¡Œ;è€ŒLockSupport.park()å¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ‰§è¡Œã€‚(2)å½“è¢«é˜»å¡çº¿ç¨‹è¢«ä¸­æ–­æ—¶ï¼ŒObject.wait()æ–¹æ³•æŠ›å‡ºäº†ä¸­æ–­å¼‚å¸¸ï¼Œè°ƒç”¨è€…éœ€è¦æ•è·æˆ–è€…å†æŠ›å‡º;å½“è¢«é˜»å¡çº¿ç¨‹è¢«ä¸­æ–­æ—¶ï¼ŒLockSupport.park()ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦å¤„ç†ä¸­æ–­å¼‚å¸¸ã€‚(3)çº¿ç¨‹å¦‚æœåœ¨Object.wait()æ‰§è¡Œä¹‹å‰å»æ‰§è¡ŒObject.notify()ï¼Œä¼šæŠ›å‡º IllegalMonitorStateExceptionå¼‚å¸¸ï¼Œæ˜¯ä¸è¢«å…è®¸çš„;è€Œçº¿ç¨‹å¦‚æœåœ¨LockSupport.park()æ‰§è¡Œä¹‹å‰å»æ‰§è¡ŒLockSupport.unPark()ï¼Œä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œæ˜¯è¢«å…è®¸çš„ã€‚</code></pre></li></ul><h3 id="æ˜¾å¼é”åˆ†ç±»"><a href="#æ˜¾å¼é”åˆ†ç±»" class="headerlink" title="æ˜¾å¼é”åˆ†ç±»"></a>æ˜¾å¼é”åˆ†ç±»</h3><pre><code class="textmate">1. å¯é‡å…¥é”ä¸ä¸å¯é‡å…¥é”    å¯é‡å…¥: é€’å½’é”ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯é‡å¤è·å–å½“å‰å¯¹è±¡çš„é”    ä¸å¯é‡å…¥: åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰å¯¹è±¡çš„é”2. æ‚²è§‚é”å’Œä¹è§‚é”    æ‚²è§‚é”: æ¯æ¬¡æ“ä½œéƒ½ä¼šåŠ é”    ä¹è§‚é”: åŸºäºAQSå®ç°çš„é”éƒ½æ˜¯ä¹è§‚é”ï¼Œæ“ä½œä¸ä¼šåŠ é”ï¼Œé‡‡å–åœ¨å†™æ—¶å…ˆè¯»å‡ºå½“å‰ç‰ˆæœ¬å·ï¼Œç„¶ååŠ é”æ“ä½œ(å¤±è´¥åˆ™é‡å¤è¯¥æ“ä½œ)    æ‚²è§‚é”é€‚ç”¨äºå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œé‡åˆ°é«˜å¹¶å‘å†™æ—¶æ€§èƒ½é«˜ï¼›ä¹è§‚é”ç”¨äºè¯»å¤šå†™å°‘çš„æƒ…å†µ3. å…¬å¹³é”å’Œéå…¬å¹³é”    å…¬å¹³é”å°±æ˜¯ä¿éšœäº†å„ä¸ªçº¿ç¨‹è·å–é”éƒ½æ˜¯æŒ‰ç…§é¡ºåºæ¥çš„ï¼Œå…ˆåˆ°çš„çº¿ç¨‹å…ˆè·å–é”ï¼ŒæŠ¢é”æˆåŠŸçš„æ¬¡åºä½“ç°ä¸º FIFO(å…ˆè¿›å…ˆå‡º)é¡ºåº4. å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”    åœ¨æŠ¢é”è¿‡ç¨‹ä¸­èƒ½é€šè¿‡æŸäº›æ–¹æ³•å»ç»ˆæ­¢æŠ¢å è¿‡ç¨‹ï¼Œé‚£å°±æ˜¯å¯ä¸­æ–­é”ï¼Œå¦åˆ™å°±æ˜¯ä¸å¯ ä¸­æ–­é”ã€‚5. å…±äº«é”å’Œç‹¬å é”    â€œç‹¬å é”â€æŒ‡çš„æ˜¯æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰çš„é”ã€‚    â€œå…±äº«é”â€å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–é”ï¼Œå®¹è®¸çº¿ç¨‹å¹¶å‘è¿›å…¥ä¸´ç•ŒåŒºã€‚å…¶ä»–    CASè‡ªæ—‹é”å¯èƒ½ä¼šå¯¼è‡´&quot;æ€»çº¿é£æš´&quot;ï¼ŒCLH è‡ªæ—‹é”(åŸºäºé˜Ÿåˆ—(å…·ä½“ä¸ºå•å‘é“¾è¡¨)æ’é˜Ÿçš„ä¸€ç§è‡ªæ—‹é”),é¿å…äº†æ€»çº¿é£æš´    AQSæ˜¯CLHçš„ä¸€ä¸ªå˜ç§</code></pre><h3 id="é«˜å¹¶å‘è®¾è®¡æ¨¡å¼"><a href="#é«˜å¹¶å‘è®¾è®¡æ¨¡å¼" class="headerlink" title="é«˜å¹¶å‘è®¾è®¡æ¨¡å¼"></a>é«˜å¹¶å‘è®¾è®¡æ¨¡å¼</h3><pre><code class="textmate">1.å®‰å…¨çš„å•ä¾‹æ¨¡å¼2.Master-Workeræ¨¡å¼3.ForkJoinæ¨¡å¼4.ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼5.Futureæ¨¡å¼</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> é«˜å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ‹è¯•ç›¸å…³</title>
      <link href="/2021/11/15/test/test/"/>
      <url>/2021/11/15/test/test/</url>
      
        <content type="html"><![CDATA[<h3 id="åç«¯æµ‹è¯•å·¥å…·"><a href="#åç«¯æµ‹è¯•å·¥å…·" class="headerlink" title="åç«¯æµ‹è¯•å·¥å…·"></a>åç«¯æµ‹è¯•å·¥å…·</h3><ul><li>PostMan</li><li><a href="https://blog.csdn.net/weixin_43767015/article/details/104758415">JMH-æ€§èƒ½ä¼˜åŒ–æµ‹è¯•(è½¬)</a></li><li>Jmeter(æ¥å£æµ‹è¯•)</li></ul><h3 id="ç§»åŠ¨ç«¯æµ‹è¯•"><a href="#ç§»åŠ¨ç«¯æµ‹è¯•" class="headerlink" title="ç§»åŠ¨ç«¯æµ‹è¯•"></a>ç§»åŠ¨ç«¯æµ‹è¯•</h3><ul><li>Charles(æŠ“åŒ…)</li><li><a href="https://perfdog.qq.com/">Perfdog(è½¯ä»¶æ€§èƒ½)</a></li><li><a href="https://testerhome.com/topics/19832">Androidä¸“é¡¹æµ‹è¯•å·¥å…·</a></li><li>Monkey</li></ul>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arthas-é—®é¢˜æ’æŸ¥å·¥å…·</title>
      <link href="/2021/10/13/devops/arthas/"/>
      <url>/2021/10/13/devops/arthas/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><pre><code class="textmate">çº¿ä¸Šé—®é¢˜æ’æŸ¥å·¥å…·ï¼Œæ— ä¾µå…¥ï¼›æ”¯æŒæŸ¥çœ‹æœåŠ¡jvmä¿¡æ¯ã€æ–¹æ³•å‡ºå…¥å‚æ•°ä¿¡æ¯ã€æ¥å£è€—æ—¶ç­‰</code></pre><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li><a href="https://arthas.aliyun.com/doc/quick-start.html">å®˜ç½‘</a></li><li><a href="https://github.com/alibaba/arthas/issues?q=label:user-case">ç”¨æˆ·æ¡ˆä¾‹</a></li><li><a href="https://github.com/alibaba/arthas/issues?utf8=%E2%9C%93&q=label:question-answered+">å¸¸è§é—®é¢˜å›ç­”</a></li></ul><h2 id="å®‰è£…å¯åŠ¨"><a href="#å®‰è£…å¯åŠ¨" class="headerlink" title="å®‰è£…å¯åŠ¨"></a>å®‰è£…å¯åŠ¨</h2><pre><code class="textmate">1.arthas-bootæ–¹å¼å®‰è£…curl -O https://arthas.aliyun.com/arthas-boot.jarjava -jar arthas-boot.jar -h-h: æ‰“å°å¸®åŠ©ä¿¡æ¯</code></pre><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤åç§°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>thread</td><td>æŸ¥çœ‹å½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆ</td><td>thread -n 3 æŒ‡å®šæœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ<br/>thread -b æŸ¥æ‰¾é˜»å¡çš„çº¿ç¨‹</td></tr><tr><td>jvm</td><td>æ˜¾ç¤ºjvmä¿¡æ¯</td><td></td></tr><tr><td>watch</td><td>æ–¹æ³•æ‰§è¡Œæ•°æ®è§‚æµ‹</td><td>watch com.xxx.xxService æ–¹æ³•å -x 3 (å‚æ•°éå†æ·±åº¦3ï¼Œé»˜è®¤1)</td></tr><tr><td>trace</td><td>æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</td><td>trace com.xxx.xxService æ–¹æ³•å</td></tr><tr><td>stack</td><td>è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</td><td>stack com.xxx.xxService æ–¹æ³•å</td></tr></tbody></table><h2 id="å®Œæ•´å‘½ä»¤ä»‹ç»"><a href="#å®Œæ•´å‘½ä»¤ä»‹ç»" class="headerlink" title="å®Œæ•´å‘½ä»¤ä»‹ç»"></a>å®Œæ•´å‘½ä»¤ä»‹ç»</h2><blockquote><p><a href="https://arthas.aliyun.com/doc/commands.html">å®Œæ•´å‘½ä»¤è¯¦ç»†æ–‡æ¡£</a></p></blockquote><table><thead><tr><th>å‘½ä»¤åç§°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>help</td><td>æ˜¾ç¤ºarthaså¸®åŠ©</td><td></td></tr><tr><td>auth</td><td>éªŒè¯å½“å‰ä¼šè¯</td><td></td></tr><tr><td>keymap</td><td>æ˜¾ç¤ºæŒ‡å®šè¿æ¥çš„æ‰€æœ‰å¯ç”¨é”®å›¾ã€‚</td><td></td></tr><tr><td>sc</td><td>æœç´¢JVMåŠ è½½çš„æ‰€æœ‰ç±»</td><td></td></tr><tr><td>sm</td><td>æœç´¢JVMåŠ è½½çš„ç±»çš„æ–¹æ³•</td><td></td></tr><tr><td>classloader</td><td>æ˜¾ç¤ºç±»åŠ è½½å™¨ä¿¡æ¯</td><td></td></tr><tr><td>jad</td><td>åç¼–è¯‘ç±»</td><td></td></tr><tr><td>getstatic</td><td>æ˜¾ç¤ºç±»çš„é™æ€å­—æ®µ</td><td></td></tr><tr><td>monitor</td><td>ç›‘æ§æ–¹æ³•æ‰§è¡Œç»Ÿè®¡æ•°æ®ï¼Œä¾‹å¦‚æ€»/æˆåŠŸ/å¤±è´¥è®¡æ•°ï¼Œå¹³å‡rtï¼Œå¤±è´¥ç‡ç­‰ã€‚</td><td></td></tr><tr><td>stack</td><td>æ˜¾ç¤ºæŒ‡å®šç±»å’Œæ–¹æ³•çš„å †æ ˆè·Ÿè¸ª</td><td></td></tr><tr><td>thread</td><td>æ˜¾ç¤ºçº¿ç¨‹ä¿¡æ¯ï¼Œçº¿ç¨‹å †æ ˆ</td><td></td></tr><tr><td>trace</td><td>è·Ÿè¸ªæŒ‡å®šæ–¹æ³•è°ƒç”¨çš„æ‰§è¡Œæ—¶é—´ã€‚</td><td></td></tr><tr><td>watch</td><td>æ˜¾ç¤ºæŒ‡å®šæ–¹æ³•è°ƒç”¨çš„è¾“å…¥/è¾“å‡ºå‚æ•°ã€è¿”å›å¯¹è±¡å’ŒæŠ›å‡ºå¼‚å¸¸</td><td></td></tr><tr><td>tt</td><td>æ—¶é—´éš§é“</td><td></td></tr><tr><td>jvm</td><td>æ˜¾ç¤ºç›®æ ‡JVMä¿¡æ¯</td><td></td></tr><tr><td>perfcounter</td><td>æ˜¾ç¤ºæ€§èƒ½è®¡æ•°å™¨ä¿¡æ¯ã€‚</td><td></td></tr><tr><td>ognl</td><td>æ‰§è¡Œognlè¡¨è¾¾å¼ã€‚</td><td></td></tr><tr><td>mc</td><td>å†…å­˜ç¼–è¯‘å™¨ï¼Œåœ¨å†…å­˜ä¸­å°†javaæ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç å’Œç±»æ–‡ä»¶ã€‚</td><td></td></tr><tr><td>redefine</td><td>é‡æ–°å®šä¹‰ç±»ã€‚@seeä»ªè¡¨# redefineClasses (ClassDefinitionâ€¦)</td><td></td></tr><tr><td>retransform</td><td>ä½¿å˜å›åŸå½¢ç±»ã€‚@seeä»ªè¡¨# retransformClasses(ç±»â€¦)</td><td></td></tr><tr><td>dashboard</td><td>ç›®æ ‡jvmçš„çº¿ç¨‹ï¼Œå†…å­˜ï¼Œgc, vm, tomcatä¿¡æ¯çš„æ¦‚è¿°ã€‚</td><td></td></tr><tr><td>dump</td><td>ä»JVMä¸­è½¬å‚¨ç±»å­—èŠ‚æ•°ç»„</td><td></td></tr><tr><td>heapdump</td><td>å †è½¬å‚¨</td><td></td></tr><tr><td>options</td><td>æŸ¥çœ‹å’Œæ”¹å˜å„ç§é˜¿å°”è¨æ–¯é€‰é¡¹</td><td></td></tr><tr><td>cls</td><td>æ¸…ç†å±å¹•ä¿¡æ¯</td><td></td></tr><tr><td>reset</td><td>é‡ç½®æ‰€æœ‰å¢å¼ºç±»</td><td></td></tr><tr><td>version</td><td>æ˜¾ç¤ºarthasç‰ˆæœ¬</td><td></td></tr><tr><td>session</td><td>æ˜¾ç¤ºå½“å‰ä¼šè¯ä¿¡æ¯</td><td></td></tr><tr><td>sysprop</td><td>æ˜¾ç¤ºå’Œæ›´æ”¹ç³»ç»Ÿå±æ€§ã€‚</td><td></td></tr><tr><td>sysenv</td><td>æ˜¾ç¤ºç³»ç»Ÿenvã€‚</td><td></td></tr><tr><td>vmoption</td><td>æ˜¾ç¤ºå’Œæ›´æ–°è™šæ‹Ÿæœºè¯Šæ–­é€‰é¡¹ã€‚</td><td></td></tr><tr><td>logger</td><td>æ‰“å°è®°å½•å™¨ä¿¡æ¯ï¼Œå¹¶æ›´æ–°è®°å½•å™¨çº§åˆ«</td><td></td></tr><tr><td>history</td><td>æ˜¾ç¤ºå‘½ä»¤å†å²</td><td></td></tr><tr><td>cat</td><td>è¿æ¥å’Œæ‰“å°æ–‡ä»¶</td><td></td></tr><tr><td>base64</td><td>ä½¿ç”¨Base64è¡¨ç¤ºè¿›è¡Œç¼–ç å’Œè§£ç </td><td></td></tr><tr><td>echo</td><td>å°†å‚æ•°å†™å…¥æ ‡å‡†è¾“å‡º</td><td></td></tr><tr><td>pwd</td><td>è¿”å›å·¥ä½œç›®å½•å</td><td></td></tr><tr><td>mbean</td><td>æ˜¾ç¤ºmbeanä¿¡æ¯</td><td></td></tr><tr><td>grep</td><td>ç”¨äºç®¡é“çš„Grepå‘½ä»¤ã€‚</td><td></td></tr><tr><td>tee</td><td>teeå‘½ä»¤ç”¨äºç®¡é“ã€‚</td><td></td></tr><tr><td>profiler</td><td>å¼‚æ­¥åˆ†æå™¨ã€‚<a href="https://github.com/jvm-profiling-tools/async-profiler">https://github.com/jvm-profiling-tools/async-profiler</a></td><td></td></tr><tr><td>vmtool</td><td>jvmçš„å·¥å…·</td><td></td></tr><tr><td>stop</td><td>åœæ­¢/å…³é—­ArthasæœåŠ¡å™¨å¹¶é€€å‡ºæ§åˆ¶å°ã€‚</td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> arthas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IO</title>
      <link href="/2021/08/11/backend/java/netty/io/"/>
      <url>/2021/08/11/backend/java/netty/io/</url>
      
        <content type="html"><![CDATA[<h3 id="IOæ¨¡å‹"><a href="#IOæ¨¡å‹" class="headerlink" title="IOæ¨¡å‹"></a>IOæ¨¡å‹</h3><table><thead><tr><th>ç±»å‹</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>é˜»å¡IO</td><td>è¿”å›æ•°æ®å°±ç»ªçŠ¶æ€åï¼Œç”¨æˆ·çº¿ç¨‹æ‰èƒ½åšå…¶ä»–åŠ¨ä½œ</td></tr><tr><td>éé˜»å¡IO</td><td>ç”¨æˆ·çº¿ç¨‹ä¸æ–­è¯¢é—®æ•°æ®æ˜¯å¦å°±ç»ª</td></tr><tr><td>å¤šè·¯å¤ç”¨IO</td><td>å³NIO(NewIO)  æœ‰ä¸€ä¸ªçº¿ç¨‹ä¸æ–­å»è½®è¯¢å¤šä¸ª socket çš„çŠ¶æ€ï¼Œåªæœ‰å½“ socket çœŸæ­£æœ‰è¯»å†™äº‹ä»¶æ—¶ï¼Œæ‰çœŸæ­£è°ƒç”¨å®é™…çš„ IO è¯»å†™æ“ä½œï¼Œè¿™ä¸ªæ“ä½œåœ¨å†…æ ¸ä¸­ï¼Œæ¯”ç”¨æˆ·çº¿ç¨‹æ•ˆç‡é«˜<br/>ç¼ºç‚¹ï¼šä¸€æ—¦äº‹ä»¶å“åº”ä½“å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åç»­çš„äº‹ä»¶è¿Ÿè¿Ÿå¾—ä¸åˆ°å¤„ç†ï¼Œå¹¶ä¸”ä¼šå½±å“æ–°çš„äº‹ä»¶è½®è¯¢ã€‚</td></tr><tr><td>ä¿¡å·é©±åŠ¨IO</td><td>å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ª IO è¯·æ±‚æ“ä½œï¼Œä¼šç»™å¯¹åº”çš„ socket æ³¨å†Œä¸€ä¸ªä¿¡å·å‡½æ•°ï¼Œç„¶åç”¨æˆ·çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œï¼Œå½“å†…æ ¸æ•°æ®å°±ç»ªæ—¶ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹æ¥æ”¶åˆ°ä¹‹åï¼Œåœ¨ä¿¡å·å‡½æ•°ä¸­è°ƒç”¨ IO è¯»å†™æ“ä½œæ¥è¿›è¡Œå®é™…çš„ IO è¯·æ±‚æ“ä½œ</td></tr><tr><td>å¼‚æ­¥IO</td><td>æœ€ç†æƒ³çš„IOæ¨¡å‹  <br/>1.ç”¨æˆ·çº¿ç¨‹å‘èµ·readæ“ä½œï¼Œå†…æ ¸ç«‹å³è¿”å›å“åº”ã€‚<br/>2.å†…æ ¸æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå‡†å¤‡æ•°æ®-&gt;copyè‡³ç”¨æˆ·çº¿ç¨‹-&gt;ç»™ç”¨æˆ·çº¿ç¨‹å‘ä¿¡å·<br/>æ¯”è¾ƒï¼š   ä¿¡å·é©±åŠ¨IOæ˜¯éœ€è¦clientç«¯è°ƒç”¨å‡½æ•°æ“ä½œIOï¼Œå¼‚æ­¥IOæ˜¯å†…æ ¸å¼‚æ­¥å¤„ç†ï¼Œclientç«¯æ— éœ€å¤„ç†</td></tr></tbody></table><ul><li>å¤šè·¯å¤ç”¨IO</li></ul><pre><code class="textmate">IOå¤šè·¯å¤ç”¨æ¨¡å‹çš„IOæ¶‰åŠä¸¤ç§ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€ç§æ˜¯IOæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦ä¸€ç§æ˜¯select/epollå°±ç»ªæŸ¥è¯¢ç³»ç»Ÿè°ƒç”¨ã€‚IOå¤šè·¯å¤ç”¨æ¨¡å‹å»ºç«‹åœ¨æ“ä½œç³»ç»Ÿçš„åŸºç¡€ è®¾æ–½ä¹‹ä¸Šï¼Œå³æ“ä½œç³»ç»Ÿçš„å†…æ ¸å¿…é¡»èƒ½å¤Ÿæä¾›å¤šè·¯åˆ†ç¦»çš„ç³»ç»Ÿè°ƒç”¨select/epollã€‚ä¼˜ç‚¹:ä¸€ä¸ªé€‰æ‹©å™¨æŸ¥è¯¢çº¿ç¨‹ï¼Œå¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡çš„ç½‘ç»œè¿æ¥ï¼Œ æ‰€ä»¥ï¼Œç”¨æˆ·ç¨‹åºä¸å¿…åˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€ é”€ã€‚è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªè¿æ¥çš„é˜»å¡IOæ¨¡å¼ç›¸æ¯”ï¼Œä½¿ç”¨å¤šè·¯IOå¤ç”¨æ¨¡å‹çš„æœ€å¤§ä¼˜åŠ¿ã€‚ç¼ºç‚¹:æœ¬è´¨ä¸Šï¼Œselect/epollç³»ç»Ÿè°ƒç”¨æ˜¯é˜»å¡å¼çš„ï¼Œå±äºåŒæ­¥IOã€‚éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåï¼Œç”±ç³»ç»Ÿè°ƒç”¨æœ¬èº«è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡ çš„</code></pre><h3 id="IOåŒ…"><a href="#IOåŒ…" class="headerlink" title="IOåŒ…"></a>IOåŒ…</h3><table><thead><tr><th>åŒ…å</th><th>ç±»å‹/åŒ…</th><th>ç±»å</th></tr></thead><tbody><tr><td>java.io</td><td>å­—èŠ‚æµ</td><td>InputStream</td></tr><tr><td></td><td></td><td>OutputStream</td></tr><tr><td></td><td>å­—ç¬¦æµ</td><td>Reader</td></tr><tr><td></td><td></td><td>Writer</td></tr><tr><td>java.nio</td><td>channelsåŒ…</td><td></td></tr><tr><td>java.nio</td><td>charsetåŒ…</td><td></td></tr><tr><td>java.nio</td><td>BufferåŒ…</td><td></td></tr><tr><td>java.nio</td><td>ByteOrder</td><td></td></tr><tr><td>java.nio</td><td>MappedByteBuffer</td><td></td></tr></tbody></table><h3 id="æ–‡ä»¶å¥æŸ„-æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶å¥æŸ„-æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶å¥æŸ„(æ–‡ä»¶æè¿°ç¬¦)"></a>æ–‡ä»¶å¥æŸ„(æ–‡ä»¶æè¿°ç¬¦)</h3><ul><li><p>è§£é‡Š</p><pre><code class="textmate">æ–‡ä»¶å¥æŸ„ï¼Œä¹Ÿå«æ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å¯åˆ†ä¸º:æ™®é€šæ–‡ä»¶ã€ç›®å½•æ–‡ä»¶ã€é“¾ æ¥æ–‡ä»¶å’Œè®¾å¤‡æ–‡ä»¶ã€‚æ–‡ä»¶æè¿°ç¬¦(File Descriptor)æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€ åˆ›å»ºçš„ç´¢å¼•ï¼Œå®ƒæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°(é€šå¸¸æ˜¯å°æ•´æ•°)ï¼Œç”¨äºæŒ‡ä»£è¢«æ‰“å¼€çš„æ–‡ä»¶ã€‚æ‰€æœ‰çš„IOç³» ç»Ÿè°ƒç”¨ï¼ŒåŒ…æ‹¬socketçš„è¯»å†™è°ƒç”¨ï¼Œéƒ½æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦å®Œæˆçš„ã€‚</code></pre></li><li><p>Linuxçš„ç³»ç»Ÿé»˜è®¤å€¼ä¸º1024ï¼Œéœ€è¦è§£é™¤æ–‡ä»¶å¥æŸ„æ•°çš„é™åˆ¶</p></li><li><p>è°ƒæ•´æ­¥éª¤</p></li></ul><pre><code class="textmate">1.æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡  ulimit -n2.è°ƒæ•´æœ€å¤§å¥æŸ„æ•°(å½“æœŸä¼šè¯æœ‰æ•ˆ)  ulimit -n 10000003.æ°¸ä¹…è°ƒæ•´æœ€å¤§å¥æŸ„æ•°(rootæƒé™)    vim /etc/rc.local    æ·»åŠ   ulimit -SHn 1000000    è§£é‡Š: é€‰é¡¹-Sè¡¨ç¤ºè½¯æ€§æé™å€¼ï¼Œ-Hè¡¨ç¤ºç¡¬æ€§æé™å€¼ã€‚ç¡¬ æ€§æé™æ˜¯å®é™…çš„é™åˆ¶ï¼Œå°±æ˜¯æœ€å¤§å¯ä»¥æ˜¯100ä¸‡ï¼Œä¸èƒ½å†å¤šäº†ã€‚è½¯æ€§æé™å€¼åˆ™æ˜¯ç³»ç»Ÿå‘å‡ºè­¦å‘Š (Warning)çš„æé™å€¼ï¼Œè¶…è¿‡è¿™ä¸ªæé™å€¼ï¼Œå†…æ ¸ä¼šå‘å‡ºè­¦å‘Šã€‚4.ç»ˆæè§£é™¤Linuxç³»ç»Ÿçš„æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°é‡çš„é™åˆ¶    vim /etc/security/limits.conf    æ·»åŠ          soft nofile 1000000        hard nofile 1000000    è§£é‡Š: soft nofileè¡¨ç¤ºè½¯æ€§æé™ï¼Œhard nofileè¡¨ç¤ºç¡¬æ€§æé™ã€‚</code></pre><h3 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h3><h4 id="Java-NIOç±»åº“åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶"><a href="#Java-NIOç±»åº“åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶" class="headerlink" title="Java NIOç±»åº“åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶"></a>Java NIOç±»åº“åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶</h4><ul><li>Channel(é€šé“)</li><li>Buffer(ç¼“å†²åŒº)</li><li>Selector(é€‰æ‹©å™¨)</li></ul><h4 id="NIOä¸OIO-Old-IO-å¯¹æ¯”"><a href="#NIOä¸OIO-Old-IO-å¯¹æ¯”" class="headerlink" title="NIOä¸OIO(Old IO)å¯¹æ¯”"></a>NIOä¸OIO(Old IO)å¯¹æ¯”</h4><pre><code class="textmate">1)OIOæ˜¯é¢å‘æµ(Stream Oriented)çš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒº(Buffer Oriented)çš„ã€‚ é¢å‘æµ:    åœ¨ä¸€èˆ¬çš„OIOæ“ä½œä¸­ï¼Œé¢å‘å­—èŠ‚æµæˆ–å­—ç¬¦æµçš„IOæ“ä½œï¼Œæ€»æ˜¯ä»¥æµå¼çš„æ–¹å¼é¡ºåºåœ°ä»ä¸€ä¸ªæµ(Stream)ä¸­è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½éšæ„åœ°æ”¹å˜è¯»å–æŒ‡é’ˆçš„ä½ç½®ã€‚é¢å‘ç¼“å†²åŒº:    åœ¨NIOæ“ä½œä¸­åˆ™ä¸åŒï¼ŒNIOä¸­å¼•å…¥äº†Channel(é€šé“)å’ŒBuffer(ç¼“å†²åŒº)çš„æ¦‚å¿µã€‚é¢å‘ç¼“å†² åŒºçš„è¯»å–å’Œå†™å…¥ï¼Œåªéœ€è¦ä»é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–å°†æ•°æ®ä»ç¼“å†²åŒºä¸­å†™å…¥åˆ°é€šé“ ä¸­ã€‚    NIOä¸åƒOIOé‚£æ ·æ˜¯é¡ºåºæ“ä½œï¼Œå¯ä»¥éšæ„åœ°è¯»å–Bufferä¸­ä»»æ„ä½ç½®çš„æ•°æ®ã€‚(2)OIOçš„æ“ä½œæ˜¯é˜»å¡çš„ï¼Œè€ŒNIOçš„æ“ä½œæ˜¯éé˜»å¡çš„ã€‚    OIOæ“ä½œéƒ½æ˜¯é˜»å¡çš„ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª readæ–¹æ³•è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œé‚£ä¹ˆè°ƒç”¨readçš„çº¿ç¨‹ä¼šè¢«é˜»å¡ä½ï¼Œç›´åˆ°readæ“ä½œå®Œæˆã€‚    è€Œåœ¨NIOçš„éé˜»å¡æ¨¡å¼ä¸­ï¼Œå½“æˆ‘ä»¬è°ƒç”¨readæ–¹æ³•æ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰æ•°æ®ï¼Œåˆ™readè¯»å–æ•°æ®å¹¶è¿”å›;å¦‚æœæ­¤æ—¶æ²¡æœ‰æ•°æ®ï¼Œåˆ™readä¹Ÿä¼šç›´æ¥è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚    NIOçš„éé˜»å¡: NIOä½¿ç”¨äº†é€šé“å’Œ é€šé“çš„å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚(3)OIOæ²¡æœ‰é€‰æ‹©å™¨(Selector)æ¦‚å¿µï¼Œè€ŒNIOæœ‰é€‰æ‹©å™¨çš„æ¦‚å¿µã€‚NIOçš„å®ç°æ˜¯åŸºäºåº•å±‚çš„é€‰æ‹©å™¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥NIOçš„éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿæä¾›æ”¯æŒã€‚</code></pre><h4 id="é€šé“-Channel"><a href="#é€šé“-Channel" class="headerlink" title="é€šé“(Channel)"></a>é€šé“(Channel)</h4><pre><code class="textmate">OIO: InputStreamã€OutputStreamNIO: å‘é€šé“ä¸­å†™å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®</code></pre><h4 id="ç¼“å†²åŒº-Buffer"><a href="#ç¼“å†²åŒº-Buffer" class="headerlink" title="ç¼“å†²åŒº(Buffer)"></a>ç¼“å†²åŒº(Buffer)</h4><pre><code class="textmate">æ‰€è°“é€šé“çš„è¯»å–ï¼Œå°±æ˜¯å°†æ•°æ®ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­;æ‰€è°“é€šé“çš„å†™å…¥ï¼Œå°±æ˜¯å°† æ•°æ®ä»ç¼“å†²åŒºä¸­å†™å…¥åˆ°é€šé“ä¸­ã€‚</code></pre><h3 id="é€‰æ‹©å™¨-Selector"><a href="#é€‰æ‹©å™¨-Selector" class="headerlink" title="é€‰æ‹©å™¨(Selector)"></a>é€‰æ‹©å™¨(Selector)</h3><pre><code class="textmate">Selector é€‰æ‹©å™¨å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªIOäº‹ä»¶çš„ç›‘å¬ä¸æŸ¥è¯¢ å™¨ã€‚é€šè¿‡é€‰æ‹©å™¨ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŸ¥è¯¢å¤šä¸ªé€šé“çš„IOäº‹ä»¶çš„å°±ç»ªçŠ¶æ€</code></pre><h2 id="Bufferç±»"><a href="#Bufferç±»" class="headerlink" title="Bufferç±»"></a>Bufferç±»</h2><table><thead><tr><th align="center">å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td align="center">capacity</td><td>å®¹é‡ï¼Œå³å¯ä»¥å®¹çº³çš„æœ€å¤§æ•°æ®é‡;åœ¨ç¼“å†²åŒºåˆ›å»ºæ—¶è®¾ç½®å¹¶ä¸”ä¸èƒ½æ”¹å˜</td></tr><tr><td align="center">limit</td><td>ä¸Šé™ï¼Œç¼“å†²åŒºä¸­å½“å‰çš„æ•°æ®é‡</td></tr><tr><td align="center">position</td><td>ä½ç½®ï¼Œç¼“å†²åŒºä¸­ä¸‹ä¸€ä¸ªè¦è¢«è¯»æˆ–å†™çš„å…ƒç´ çš„ç´¢å¼•</td></tr><tr><td align="center">mark</td><td>è°ƒç”¨ mark()æ–¹æ³•æ¥è®¾ç½® mark=positionï¼Œå†è°ƒç”¨ reset()å¯ä»¥è®© position æ¢å¤åˆ° mark æ ‡è®°çš„ä½ç½®ï¼Œå³ position=mark</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> io </category>
          
      </categories>
      
      
        <tags>
            
            <tag> io </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é›†æˆJimuæŠ¥è¡¨</title>
      <link href="/2021/08/04/backend/other/jimu-report/"/>
      <url>/2021/08/04/backend/other/jimu-report/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://www.jimureport.com/">å®˜ç½‘</a></li><li><a href="http://report.jeecg.com/2078875">å®˜æ–¹æ–‡æ¡£</a></li></ul><h3 id="é›†æˆæ­¥éª¤"><a href="#é›†æˆæ­¥éª¤" class="headerlink" title="é›†æˆæ­¥éª¤"></a>é›†æˆæ­¥éª¤</h3><blockquote><p>è§å®˜ç½‘æ–‡æ¡£</p></blockquote><h3 id="é›†æˆæ—¶é‡åˆ°çš„é—®é¢˜"><a href="#é›†æˆæ—¶é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é›†æˆæ—¶é‡åˆ°çš„é—®é¢˜"></a>é›†æˆæ—¶é‡åˆ°çš„é—®é¢˜</h3><ul><li>é›†æˆåå¯åŠ¨æŠ¥é”™ï¼ŒUnable to load cache item<blockquote><p><a href="https://docs.spring.io/spring-boot/docs/1.5.16.RELEASE/reference/html/using-boot-devtools.html">å¯¼è‡´é—®é¢˜äº§ç”Ÿçš„åŸå› </a></p></blockquote><pre><code class="textmate">è§£å†³æ–¹æ³•: å»æ‰devtoolså³å¯</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> ä¸‰æ–¹é›†æˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸‰æ–¹é›†æˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringFrameworkæºç å­¦ä¹ </title>
      <link href="/2021/07/26/backend/spring/framework/springframework-2/"/>
      <url>/2021/07/26/backend/spring/framework/springframework-2/</url>
      
        <content type="html"><![CDATA[<h3 id="StartDemo"><a href="#StartDemo" class="headerlink" title="StartDemo"></a>StartDemo</h3><pre><code class="java">public class StartDemo &#123;   public static void main(String[] args) &#123;      ApplicationContext context =            new AnnotationConfigApplicationContext(&quot;com.my.config&quot;);      TestConfig testConfig = context.getBean(TestConfig.class);      System.out.println(&quot;==========&gt;main&quot;);      System.out.println(testConfig.getValue());   &#125;&#125;</code></pre><h3 id="å…³é”®ç±»"><a href="#å…³é”®ç±»" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h3><ul><li>AnnotationConfigApplicationContext<pre><code class="textmate">æ ¹æ®åŒ…æ‰«æå¯¹è±¡</code></pre></li><li>RootBeanDefinition<pre><code class="textmate">è®°å½•æ‰«æåˆ°çš„ç±»çš„å…·ä½“ä¿¡æ¯(æè¿°ç±»)</code></pre></li><li>BeanFactoryPostProcessor<pre><code class="textmate">æ¥å£ï¼Œå¯è‡ªå®šä¹‰å‚ä¸ç±»åˆå§‹åŒ–è¿‡ç¨‹é€»è¾‘  å·¥å‚é’©å­ï¼Œå…è®¸è‡ªå®šä¹‰ä¿®æ”¹åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„ bean å®šä¹‰ï¼Œè°ƒæ•´ä¸Šä¸‹æ–‡åº•å±‚ bean å·¥å‚çš„ bean å±æ€§å€¼ã€‚  BeanFactoryPostProcessoræ˜¯åœ¨springå®¹å™¨åŠ è½½äº†beançš„å®šä¹‰æ–‡ä»¶ä¹‹åï¼Œåœ¨beanå®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œçš„ã€‚æ¥å£æ–¹æ³•çš„å…¥å‚æ˜¯ConfigurrableListableBeanFactoryï¼Œä½¿ç”¨è¯¥å‚æ•°ï¼Œå¯ä»¥è·å–åˆ°ç›¸å…³beançš„å®šä¹‰ä¿¡æ¯</code></pre></li><li>BeanPostProcessor<pre><code class="textmate">åç½®å¤„ç†å™¨çˆ¶ç±»ï¼Œæœ‰å¾ˆå¤šå­ç±»ï¼›ä¸åŒå­ç±»æä¾›äº†ä¸åŒçš„å®ç°æ–¹æ³•ï¼Œå‚ä¸åˆ°beanåˆå§‹åŒ–è¿‡ç¨‹ä¸­  ä¾‹ï¼šAutowiredAnnotationBeanPostProcessor  å¯ä»¥åœ¨springå®¹å™¨å®ä¾‹åŒ–beanä¹‹åï¼Œåœ¨æ‰§è¡Œbeançš„åˆå§‹åŒ–æ–¹æ³•å‰åï¼Œæ·»åŠ ä¸€äº›è‡ªå·±çš„å¤„ç†é€»è¾‘ã€‚  BeanPostProcessorçš„æ‰§è¡Œé¡ºåºæ˜¯åœ¨BeanFactoryPostProcessorä¹‹åã€‚  å†…ç½®å®ç°:   org.springframework.context.annotation.CommonAnnotationBeanPostProcessorï¼šæ”¯æŒ@Resourceæ³¨è§£çš„æ³¨å…¥  org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessorï¼šæ”¯æŒ@Requiredæ³¨è§£çš„æ³¨å…¥  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessorï¼šæ”¯æŒ@Autowiredæ³¨è§£çš„æ³¨å…¥</code></pre></li></ul><pre><code>### ç®€æ˜“æµç¨‹```textmateç”Ÿå‘½å‘¨æœŸ åŠ è½½ -&gt; å®ä¾‹åŒ– -&gt; åˆå§‹åŒ– -&gt; ä½¿ç”¨ -&gt; é”€æ¯scan -&gt; beanPorcessor(æè¿°beanä¿¡æ¯) -&gt; æ”¾åˆ° configMap ä¸­ -&gt; refresh -&gt; é€šè¿‡beanå·¥å‚å®ä¾‹åŒ–ç±» -&gt; æ”¾åˆ°å•ä¾‹æ± ä¸­</code></pre><h3 id="AnnotationConfigApplicationContextè¯¦è§£"><a href="#AnnotationConfigApplicationContextè¯¦è§£" class="headerlink" title="AnnotationConfigApplicationContextè¯¦è§£"></a>AnnotationConfigApplicationContextè¯¦è§£</h3><ul><li>ç±»å›¾<br><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/springframework-bean-uml.png" alt="ç±»å›¾"></li><li>æµç¨‹å›¾<br><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/spring-start-process.png" alt="æ‰§è¡Œæµç¨‹"></li></ul><h3 id="è§£å†³å¾ªç¯ä¾èµ–"><a href="#è§£å†³å¾ªç¯ä¾èµ–" class="headerlink" title="è§£å†³å¾ªç¯ä¾èµ–"></a>è§£å†³å¾ªç¯ä¾èµ–</h3><ul><li><p><a href="https://www.cnblogs.com/crazymakercircle/p/14465630.html">ç–¯ç‹‚åˆ›å®¢åœˆ(è½¬)</a></p></li><li><p>ä¸»è¦æµç¨‹å›¾<br><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/spring-cycle-refrence.png" alt="springè§£å†³å¾ªç¯ä¾èµ–æµç¨‹(è½¬)"></p></li><li><p>è§£é‡Š<br>```textmate</p></li></ul><p>1.ä¸‰çº§ç¼“å­˜ä¸­åˆ†åˆ«å­˜æ”¾çš„æ˜¯ä»€ä¹ˆï¼Ÿ<br>  ä¸€çº§ç¼“å­˜å­˜æ”¾å®ä¾‹åŒ–å®Œæˆï¼Œä¸”å±æ€§å¡«å……åçš„å¯¹è±¡ã€‚<br>  äºŒçº§ç¼“å­˜å­˜æ”¾å¯¹è±¡å®ä¾‹åŒ–å®Œæˆåï¼Œè¿˜æ²¡æœ‰å¡«å……å®Œå±æ€§å€¼çš„å¯¹è±¡ã€‚<br>  ä¸‰çº§ç¼“å­˜å­˜æ”¾çš„æ˜¯å·¥å‚å¯¹è±¡ã€‚å­˜æ”¾å®ä¾‹åŒ–å¯¹è±¡æ‰€éœ€è¦çš„å·¥å‚ã€‚</p><p>2.å¦‚æœåªæœ‰ä¸€çº§ç¼“å­˜è¡Œä¸è¡Œï¼Ÿ<br>    ä¸è¡Œï¼Œå› ä¸ºå®Œæ•´çš„å¯¹è±¡ä¼šå’Œæœªåˆå§‹åŒ–çš„å¯¹è±¡æ”¾åˆ°ä¸€èµ·ï¼Œåœ¨è¿›è¡Œè·å–çš„æ—¶å€™æœ‰å¯èƒ½ä¼šè·å–åˆ°ä¸ºåˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå¯¹è±¡æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼›</p><p>3.å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜è¡Œä¸è¡Œï¼Ÿ<br>    åªè¦æœ‰äºŒçº§ç¼“å­˜å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½†æ˜¯æ·»åŠ aopçš„å®ç°ä¹‹åï¼Œä¼šæŠ¥é”™ã€‚</p><p>4.ä¸‰çº§ç¼“å­˜åˆ°åº•åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ<br>    åœ¨ä¸‰çº§ç¼“å­˜ä¸­å®Œæˆäº†ä»£ç†å¯¹è±¡æ›¿æ¢éä»£ç†å¯¹è±¡çš„å·¥ä½œã€‚<br>    ä¸‰çº§ç¼“å­˜æ˜¯ä¸ºäº†è§£å†³åœ¨aopä»£ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰aopçš„è¯ï¼ŒäºŒçº§ç¼“å­˜å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><pre><code>- [ä¸‰çº§ç¼“å­˜å‚è€ƒèµ„æ–™](https://blog.csdn.net/weixin_44390164/article/details/119350651)</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringFramework </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç›¸å…³-çŸ¥è¯†ç‚¹</title>
      <link href="/2021/07/20/backend/storage/mysql/"/>
      <url>/2021/07/20/backend/storage/mysql/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h3><ul><li><a href="https://blog.jcole.us/innodb">Jeremy Coleçš„åšå®¢</a></li><li><a href="https://dev.mysql.com/doc/dev/mysql-server">MySQL8.0çš„æºç æ–‡æ¡£</a></li><li><a href="https://publications.sba-research.org/publications/WSDF2012_InnoDB.pdf">mariadb-innodbåŸç†æ–‡æ¡£(å¸¦å›¾)</a></li><li><a href="http://mysqlserverteam.com/">MySQL Team Blog</a></li><li><a href="http://www.unofficialmysqlguide.com/optimizer-trace.html">éå®˜æ–¹MySQL8.0ä¼˜åŒ–å™¨æŒ‡å—</a></li></ul><h2 id="éƒ¨åˆ†æ€»ç»“"><a href="#éƒ¨åˆ†æ€»ç»“" class="headerlink" title="éƒ¨åˆ†æ€»ç»“"></a>éƒ¨åˆ†æ€»ç»“</h2><h3 id="Innodbå¼•æ“çš„4å¤§ç‰¹æ€§"><a href="#Innodbå¼•æ“çš„4å¤§ç‰¹æ€§" class="headerlink" title="Innodbå¼•æ“çš„4å¤§ç‰¹æ€§"></a>Innodbå¼•æ“çš„4å¤§ç‰¹æ€§</h3><blockquote><p><a href="https://www.cnblogs.com/zhs0/p/10528520.html">å‚è€ƒæ–‡æ¡£</a></p></blockquote><ul><li>æ’å…¥ç¼“å†²</li><li>äºŒæ¬¡å†™</li><li>è‡ªé€‚åº”å“ˆå¸Œ</li><li>é¢„è¯»</li></ul><h4 id="æ’å…¥ç¼“å†²"><a href="#æ’å…¥ç¼“å†²" class="headerlink" title="æ’å…¥ç¼“å†²"></a>æ’å…¥ç¼“å†²</h4><pre><code class="textmate">ç”¨äºæå‡æ’å…¥æ€§èƒ½ï¼Œåˆ†ä¸ºInsert Bufferã€Change Bufferchange bufferingæ˜¯insert bufferçš„åŠ å¼ºï¼Œinsert bufferåªé’ˆå¯¹insertæœ‰æ•ˆï¼Œchange bufferingå¯¹insertã€deleteã€update(delete+insert)ã€purgeéƒ½æœ‰æ•ˆä½¿ç”¨æ’å…¥ç¼“å†²çš„æ¡ä»¶ï¼š* éèšé›†ç´¢å¼•* éå”¯ä¸€ç´¢å¼•</code></pre><h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h4><ul><li><p>äº‹åŠ¡çš„ç‰¹æ€§ACID</p><pre><code class="textmate">åŸå­æ€§(atomicity)ï¼šä¸€ä¸ªäº‹åŠ¡è¢«äº‹åŠ¡ä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚ä¸€è‡´æ€§(consistency)ï¼šæ•°æ®åº“æ€»æ˜¯ä»ä¸€è‡´æ€§çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œå®ƒåªåŒ…å«æˆåŠŸäº‹åŠ¡æäº¤çš„ç»“æœéš”ç¦»å‹(isolation)ï¼šäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä¸€èµ·ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„æŒä¹…æ€§(durability)ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</code></pre></li><li><p>äº‹åŠ¡éš”ç¦»çº§åˆ« </p></li></ul><table><thead><tr><th></th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th><th>è§£å†³åŸç†</th></tr></thead><tbody><tr><td>è¯»æœªæäº¤</td><td>x</td><td>x</td><td>x</td><td></td></tr><tr><td>è¯»å·²æäº¤</td><td>âˆš</td><td>x</td><td>x</td><td></td></tr><tr><td>å¯é‡å¤è¯»</td><td>âˆš</td><td>âˆš</td><td>x</td><td>gapé” (mysqlé»˜è®¤çº§åˆ«)</td></tr><tr><td>ä¸²è¡ŒåŒ–</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td>è¯»é”</td></tr></tbody></table><h4 id="é‡è¦æ–‡ä»¶"><a href="#é‡è¦æ–‡ä»¶" class="headerlink" title="é‡è¦æ–‡ä»¶"></a>é‡è¦æ–‡ä»¶</h4><ul><li>undolog</li><li>redolog</li><li>binlog</li></ul><h4 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h4><pre><code class="sql">show engines;</code></pre><table><thead><tr><th>ç±»å‹</th><th>ç£ç›˜æ–‡ä»¶</th><th>ç‰¹æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>FEDERATED</td><td>ç”¨æ¥è®¿é—®è¿œç¨‹è¡¨å­˜å‚¨å¼•æ“</td><td>è®¿é—®è¿œç¨‹è¡¨</td><td></td></tr><tr><td>MRG_MYISAM</td><td>æŠŠå¤šä¸ªMyISAMè¡¨åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘å•å…ƒï¼›æŸ¥è¯¢ä¸€ä¸ªè¡¨æ—¶ï¼Œç›¸å½“ä¸æŸ¥è¯¢å…¶æ‰€æœ‰æˆå‘˜è¡¨</td><td>å¯ä»¥ç”¨åˆ†åŒºè¡¨æ›¿æ¢mergeè¡¨</td><td></td></tr><tr><td>MyISAM</td><td>.MDYæ•°æ®)<br/> .MYI(ç´¢å¼•)</td><td>ä¸»è¦çš„éå®ç‰©å¤„ç†å­˜å‚¨å¼•æ“</td><td></td></tr><tr><td>BLACKHOLE</td><td>ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œè¿”å›ç©ºå†…å®¹</td><td></td><td></td></tr><tr><td>CSV</td><td>.CSV(æ•°æ®)<br/>.CSM(å…ƒæ•°æ®)</td><td>å­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šä»¥é€—å·ä½œä¸ºæ•°æ®é¡¹ä¹‹é—´çš„åˆ†å‰²ç¬¦å·</td><td>ä¸æ”¯æŒç´¢å¼•ï¼Œæ•°æ®å­˜åœ¨ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶</td></tr><tr><td>MEMORY</td><td></td><td>ç½®äºå†…å­˜çš„è¡¨</td><td></td></tr><tr><td>ARCHIVE</td><td></td><td>ç”¨äºæ•°æ®å­˜æ¡£(è¡Œæ’å…¥åä¸èƒ½å†ä¿®æ”¹)</td><td>æ•°æ®å½’æ¡£ï¼Œå¤§æ‰¹é‡å­˜å‚¨åä¸ä¿®æ”¹</td></tr><tr><td>InnoDB</td><td>.ibd(æ•°æ®&amp;ç´¢å¼•)</td><td>å…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å¤„ç†å¼•æ“</td><td></td></tr><tr><td>PERFORMANCE_SCHEMA</td><td></td><td>ç”¨äºç›‘è§†MySQLæœåŠ¡å™¨</td><td></td></tr><tr><td>NDB</td><td></td><td>é›†ç¾¤å­˜å‚¨å¼•æ“</td><td></td></tr><tr><td>TokuDB</td><td></td><td>å­˜å‚¨é€Ÿåº¦å¿«ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç•¥æ…¢ä¸InnoDB,æ”¯æŒäº‹åŠ¡ç­‰ï¼Œæœªæ¥æ›¿ä»£InnoDB</td><td></td></tr></tbody></table><h2 id="ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹ä¸Šç†è§£MySQLã€‹-è¯»ä¹¦ç¬”è®°"><a href="#ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹ä¸Šç†è§£MySQLã€‹-è¯»ä¹¦ç¬”è®°" class="headerlink" title="ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹ä¸Šç†è§£MySQLã€‹ è¯»ä¹¦ç¬”è®°"></a>ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹ä¸Šç†è§£MySQLã€‹ è¯»ä¹¦ç¬”è®°</h2><blockquote><p>ç¬¬ä¸€æ¬¡è¯»ï¼Œæ‘˜å½•äº†å…¶ä¸­éƒ¨åˆ†çŸ¥è¯†ç‚¹ 2021-09-13è¯»å®Œ</p></blockquote><h3 id="InnoDBæ•°æ®æ ¼å¼"><a href="#InnoDBæ•°æ®æ ¼å¼" class="headerlink" title="InnoDBæ•°æ®æ ¼å¼"></a>InnoDBæ•°æ®æ ¼å¼</h3><ul><li><p>å†…å­˜ä¸ç£ç›˜äº¤äº’æ–¹å¼</p><pre><code class="textmate">InnoDB é‡‡å–çš„æ–¹å¼æ˜¯:å°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼ŒInnoDBä¸­é¡µçš„å¤§å° ä¸€èˆ¬ä¸º 16 KBã€‚ä¹Ÿå°±æ˜¯åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KB å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</code></pre></li><li><p>è¡Œæ ¼å¼<br><br/><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/mysql-compact%E8%A1%8C%E6%A0%BC%E5%BC%8F.png">Compactè¡Œ</a></p><pre><code class="textmate">Compact ã€ Redundant ã€Dynamic å’Œ Compressedå˜é•¿å­—æ®µ(varchar(n)ã€textç­‰)å ç”¨å†…å­˜ï¼š1. çœŸæ­£çš„æ•°æ®å†…å®¹ 2. å ç”¨çš„å­—èŠ‚æ•°å¯¹äº CHAR(M) ç±»å‹çš„åˆ—æ¥è¯´ï¼Œå½“åˆ—é‡‡ç”¨çš„æ˜¯å®šé•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¸ä¼šè¢«åŠ åˆ°å˜é•¿å­— æ®µé•¿åº¦åˆ—è¡¨ï¼Œè€Œå¦‚æœé‡‡ç”¨å˜é•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿä¼šè¢«åŠ åˆ°å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚</code></pre></li><li><p>æ•°æ®å¤ªå¤šé€ æˆçš„æº¢å‡º</p><pre><code class="textmate">è¡Œæº¢å‡ºï¼šä¸€ä¸ªé¡µä¸€èˆ¬æ˜¯ 16KB ï¼Œå½“è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šï¼Œå½“å‰é¡µæ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼šæŠŠå¤šä½™çš„æ•°æ®å­˜å‚¨åˆ°å…¶ä»–é¡µä¸­ï¼›MySQL æ˜¯ä»¥ é¡µä¸ºå•ä½ç®¡ç†å­˜å‚¨ç©ºé—´ï¼Œä¸€ä¸ªé¡µä¸€èˆ¬16kb,16384å­—èŠ‚ï¼Œä¸€ä¸ªvarcharæœ€å¤šå­˜å‚¨65532ä¸ªå­—èŠ‚å¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨ è®°å½•çš„çœŸå®æ•°æ® å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨ åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œç„¶åè®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨20ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ (å½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•°)ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µï¼Œ</code></pre></li><li><p>è¡Œæº¢å‡ºçš„ä¸´ç•Œç‚¹</p><pre><code class="textmate">MySQL ä¸­è§„å®šä¸€ä¸ªé¡µä¸­è‡³å°‘å­˜æ”¾ä¸¤è¡Œè®°å½•å¯¹äºåªæœ‰ä¸€ä¸ªåˆ—çš„è¡¨ï¼Œå‘ç”Ÿè¡Œæº¢å‡ºç°è±¡æ—¶éœ€è¦æ»¡è¶³è¿™ä¸ªå¼å­: 136 + 2Ã—(27 + n) &gt; 16384 ï¼Œ n &gt; 8098é‡ç‚¹:  ä¸ç”¨å…³æ³¨è¿™ä¸ªä¸´ç•Œç‚¹æ˜¯ä»€ä¹ˆï¼Œåªè¦çŸ¥é“å¦‚æœæˆ‘ä»¬å‘ä¸€ä¸ªè¡Œä¸­å­˜å‚¨äº†å¾ˆå¤§çš„æ•°æ®æ—¶ï¼Œå¯èƒ½å‘ç”Ÿ è¡Œæº¢å‡º çš„ç°è±¡ä¸è®ºæˆ‘ä»¬æ€ä¹ˆå¯¹é¡µä¸­çš„è®°å½•åšå¢åˆ æ”¹æ“ä½œï¼ŒInnoDBå§‹ç»ˆä¼šç»´æŠ¤ä¸€æ¡è®°å½•çš„å•é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„å„ä¸ª èŠ‚ç‚¹æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºè¿æ¥èµ·æ¥çš„</code></pre></li><li><p>æ€»ç»“<br><br/><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/InnoDB_data_page.png">InnoDBæ•°æ®é¡µç»“æ„</a></p></li></ul><pre><code class="textmate">1. InnoDBä¸ºäº†ä¸åŒçš„ç›®çš„è€Œè®¾è®¡äº†ä¸åŒç±»å‹çš„é¡µï¼Œæˆ‘ä»¬æŠŠç”¨äºå­˜æ”¾è®°å½•çš„é¡µå«åš æ•°æ®é¡µ ã€‚2. ä¸€ä¸ªæ•°æ®é¡µå¯ä»¥è¢«å¤§è‡´åˆ’åˆ†ä¸º7ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯   File Header ï¼Œè¡¨ç¤ºé¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ï¼Œå å›ºå®šçš„38å­—èŠ‚ã€‚   Page Header ï¼Œè¡¨ç¤ºæ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ï¼Œå å›ºå®šçš„56ä¸ªå­—èŠ‚ã€‚   Infimum + Supremum ï¼Œä¸¤ä¸ªè™šæ‹Ÿçš„ä¼ªè®°å½•ï¼Œåˆ†åˆ«è¡¨ç¤ºé¡µä¸­çš„æœ€å°å’Œæœ€å¤§è®°å½•ï¼Œå å›ºå®šçš„ 26 ä¸ªå­—èŠ‚ã€‚   User Records :çœŸå®å­˜å‚¨æˆ‘ä»¬æ’å…¥çš„è®°å½•çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸å›ºå®šã€‚   Free Space :é¡µä¸­å°šæœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸ç¡®å®šã€‚   Page Directory: é¡µä¸­çš„æŸäº›è®°å½•ç›¸å¯¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªæ§½åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡ï¼Œå¤§å°ä¸å›ºå®šï¼Œæ’å…¥çš„è®°å½•è¶Šå¤šï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨çš„ç©ºé—´è¶Šå¤šã€‚   File Trailer :ç”¨äºæ£€éªŒé¡µæ˜¯å¦å®Œæ•´çš„éƒ¨åˆ†ï¼Œå ç”¨å›ºå®šçš„8ä¸ªå­—èŠ‚ã€‚3. æ¯ä¸ªè®°å½•çš„å¤´ä¿¡æ¯ä¸­éƒ½æœ‰ä¸€ä¸ª next_record å±æ€§ï¼Œä»è€Œä½¿é¡µä¸­çš„æ‰€æœ‰è®°å½•ä¸²è”æˆä¸€ä¸ª å•é“¾è¡¨ ã€‚4. InnoDB ä¼šä¸ºæŠŠé¡µä¸­çš„è®°å½•åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„çš„æœ€åä¸€ä¸ªè®°å½•çš„åœ°å€åç§»é‡ä½œä¸ºä¸€ä¸ª æ§½ ï¼Œå­˜æ”¾åœ¨   Page Directory ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªé¡µä¸­æ ¹æ®ä¸»é”®æŸ¥æ‰¾è®°å½•æ˜¯éå¸¸å¿«çš„ï¼Œåˆ†ä¸ºä¸¤æ­¥:   4.1 é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ã€‚   4.2 é€šè¿‡è®°å½•çš„next_recordå±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•ã€‚5. æ¯ä¸ªæ•°æ®é¡µçš„ File Header éƒ¨åˆ†éƒ½æœ‰ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®é¡µä¼šç»„æˆä¸€ä¸ª åŒé“¾è¡¨ ã€‚6. ä¸ºä¿è¯ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç£ç›˜çš„é¡µçš„å®Œæ•´æ€§ï¼Œåœ¨é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨éƒ½ä¼šå­˜å‚¨é¡µä¸­æ•°æ®çš„æ ¡éªŒå’Œå’Œé¡µé¢æœ€åä¿®æ”¹æ—¶   å¯¹åº”çš„ LSN å€¼ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œå’Œ LSN å€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚</code></pre><ul><li>Innodbé€šç”¨é¡µç»“æ„<br><br/><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png">Innodbé€šç”¨é¡µç»“æ„</a><br><br/><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/Innodb%E9%80%9A%E7%94%A8%E9%A1%B5%E7%BB%93%E6%9E%84-%E8%A7%A3%E9%87%8A.png">Innodbé€šç”¨é¡µç»“æ„-è§£é‡Š</a></li></ul><pre><code class="textmate">è¡¨ç©ºé—´ç»“æ„(ç³»ç»Ÿè¡¨ç©ºé—´/ç‹¬ç«‹è¡¨ç©ºé—´)è¿ç»­64ä¸ªé¡µé¢ = ä¸€ä¸ªåŒº(é»˜è®¤1MB)æ¯256ä¸ªåŒºè¢«åˆ’åˆ†ä¸ºä¸€ä¸ªç»„æ¯ä¸ªç»„çš„æœ€å¼€å§‹çš„å‡ ä¸ªé¡µé¢ç±»å‹æ˜¯å›ºå®šçš„1.FSP_HDR ç±»å‹:è¿™ä¸ªç±»å‹çš„é¡µé¢æ˜¯ç”¨æ¥ç™»è®°æ•´ä¸ªè¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§ä»¥åŠæœ¬ç»„æ‰€æœ‰çš„ åŒº ï¼Œä¹Ÿå°±æ˜¯  extent 0 ~ extent 255 è¿™256ä¸ªåŒºçš„å±æ€§ï¼Œç¨åè¯¦ç»†å” å¨ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ•´ä¸ªè¡¨ç©ºé—´åªæœ‰ä¸€ ä¸ª FSP_HDR ç±»å‹çš„é¡µé¢ã€‚2.IBUF_BITMAP ç±»å‹:è¿™ä¸ªç±»å‹çš„é¡µé¢æ˜¯å­˜å‚¨æœ¬ç»„æ‰€æœ‰çš„åŒºçš„æ‰€æœ‰é¡µé¢å…³äº INSERT BUFFER çš„ä¿¡æ¯ã€‚3.INODE ç±»å‹:è¿™ä¸ªç±»å‹çš„é¡µé¢å­˜å‚¨äº†è®¸å¤šç§°ä¸º INODE çš„æ•°æ®ç»“æ„ï¼Œå…¶ä½™å„ç»„æœ€å¼€å§‹çš„2ä¸ªé¡µé¢çš„ç±»å‹æ˜¯å›ºå®šçš„1.DES ç±»å‹:å…¨ç§°æ˜¯ extent descriptor ï¼Œç”¨æ¥ç™»è®°æœ¬ç»„256ä¸ªåŒºçš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºåœ¨ extent 256 åŒºä¸­çš„è¯¥ç±»å‹é¡µé¢å­˜å‚¨çš„å°±æ˜¯ extent 256 ~ extent 511 è¿™äº›åŒºçš„å±æ€§ï¼Œå¯¹äºåœ¨ extent 512 åŒºä¸­çš„è¯¥ ç±»å‹é¡µé¢å­˜å‚¨çš„å°±æ˜¯ extent 512 ~ extent 767 è¿™äº›åŒºçš„å±æ€§ã€‚ä¸Šè¾¹ä»‹ç»çš„ FSP_HDR ç±»å‹çš„é¡µé¢å…¶å® å’Œ XDES ç±»å‹çš„é¡µé¢çš„ä½œç”¨ç±»ä¼¼ï¼Œåªä¸è¿‡ FSP_HDR ç±»å‹çš„é¡µé¢è¿˜ä¼šé¢å¤–å­˜å‚¨ä¸€äº›è¡¨ç©ºé—´çš„å±æ€§ã€‚2.IBUF_BITMAP</code></pre><ul><li><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/mysql-innondb%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png">InnonDBæ–‡ä»¶ç»“æ„æ€»ç»“</a></li></ul><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><pre><code class="textmate">SHOW INDEX FROM è¡¨å - ç´¢å¼•ç»Ÿè®¡æ•°æ®    å¯¹äºInnoDBå­˜å‚¨å¼•æ“æ¥è¯´ï¼Œä½¿ç”¨SHOW INDEXè¯­å¥å±•ç¤ºå‡ºæ¥çš„æŸä¸ªç´¢å¼•åˆ—çš„Cardinalityå±æ€§æ˜¯ä¸€ä¸ªä¼°è®¡ å€¼ï¼Œå¹¶ä¸æ˜¯ç²¾ç¡®çš„æ³¨æ„ï¼š    åœ¨MySQL 5.7.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œeq_range_index_dive_limitçš„é»˜è®¤å€¼ä¸º10ï¼Œä¹‹ åçš„ç‰ˆæœ¬é»˜è®¤å€¼ä¸º200ã€‚    æ‰€ä»¥å¦‚æœå¤§å®¶é‡‡ç”¨çš„æ˜¯5.7.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬çš„è¯ï¼Œå¾ˆå®¹æ˜“é‡‡ç”¨ç´¢å¼•ç»Ÿè®¡æ•°æ®è€Œ ä¸æ˜¯index diveçš„æ–¹å¼æ¥è®¡ç®—æŸ¥è¯¢æˆæœ¬ã€‚å½“ä½ çš„æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†INæŸ¥è¯¢ï¼Œä½†æ˜¯å´å®é™…æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå°± åº”è¯¥è€ƒè™‘ä¸€ä¸‹æ˜¯ä¸æ˜¯ç”±äº eq_range_index_dive_limit å€¼å¤ªå°å¯¼è‡´çš„ã€‚è¿æ¥æŸ¥è¯¢çš„æˆæœ¬è®¡ç®—å…¬å¼:    è¿æ¥æŸ¥è¯¢æ€»æˆæœ¬ = å•æ¬¡è®¿é—®é©±åŠ¨è¡¨çš„æˆæœ¬ + é©±åŠ¨è¡¨æ‰‡å‡ºæ•° x å•æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬</code></pre><h4 id="InnoDBç»Ÿè®¡æ•°æ®çš„æ–¹å¼"><a href="#InnoDBç»Ÿè®¡æ•°æ®çš„æ–¹å¼" class="headerlink" title="InnoDBç»Ÿè®¡æ•°æ®çš„æ–¹å¼"></a>InnoDBç»Ÿè®¡æ•°æ®çš„æ–¹å¼</h4><pre><code class="textmate">InnoDB ä»¥è¡¨ä¸ºå•ä½æ¥æ”¶é›†ç»Ÿè®¡æ•°æ®ï¼Œè¿™äº›ç»Ÿè®¡æ•°æ®å¯ä»¥æ˜¯åŸºäºç£ç›˜çš„æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºå†…å­˜ çš„éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®ã€‚    innodb_stats_persistent æ§åˆ¶ç€ä½¿ç”¨æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®è¿˜æ˜¯éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®;     innodb_stats_persistent_sample_pages æ§åˆ¶ç€æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®çš„é‡‡æ ·é¡µé¢æ•°é‡;     innodb_stats_transient_sample_pages æ§åˆ¶ç€éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®çš„é‡‡æ ·é¡µé¢æ•°é‡;     innodb_stats_auto_recalc æ§åˆ¶ç€æ˜¯å¦è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æŸä¸ªå…·ä½“çš„è¡¨ï¼Œåœ¨åˆ›å»ºå’Œä¿®æ”¹è¡¨æ—¶é€šè¿‡æŒ‡å®š STATS_PERSISTENT ã€ STATS_AUTO_RECALC ã€ STATS_SAMPLE_PAGES çš„å€¼æ¥æ§åˆ¶ç›¸å…³ç»Ÿè®¡æ•°æ®å±æ€§ã€‚    innodb_stats_method å†³å®šç€åœ¨ç»Ÿè®¡æŸä¸ªç´¢å¼•åˆ—ä¸é‡å¤å€¼çš„æ•°é‡æ—¶å¦‚ä½•å¯¹å¾… NULL å€¼ã€‚é€šè¿‡é…ç½®å°†å†³å®šæƒäº¤ç»™ç”¨æˆ·    1.nulls_equal :è®¤ä¸ºæ‰€æœ‰ NULL å€¼éƒ½æ˜¯ç›¸ç­‰çš„ã€‚è¿™ä¸ªå€¼ä¹Ÿæ˜¯ innodb_stats_method çš„é»˜è®¤å€¼ã€‚å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­ NULL å€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ« å¤šï¼Œæ‰€ä»¥å€¾å‘äºä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚    2.nulls_unequal :è®¤ä¸ºæ‰€æœ‰ NULL å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­ NULL å€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ« å°‘ï¼Œæ‰€ä»¥å€¾å‘äºä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚    3.nulls_ignored :ç›´æ¥æŠŠ NULL å€¼å¿½ç•¥æ‰ã€‚</code></pre><h4 id="SQLé‡å†™æ–¹å¼"><a href="#SQLé‡å†™æ–¹å¼" class="headerlink" title="SQLé‡å†™æ–¹å¼"></a>SQLé‡å†™æ–¹å¼</h4><h5 id="æ¡ä»¶åŒ–ç®€"><a href="#æ¡ä»¶åŒ–ç®€" class="headerlink" title="æ¡ä»¶åŒ–ç®€"></a>æ¡ä»¶åŒ–ç®€</h5><pre><code class="textmate">1.ç§»é™¤ä¸å¿…è¦çš„æ‹¬å·2.å¸¸é‡ä¼ é€’    a = 5 AND b &gt; a æ”¹å†™ä¸º a = 5 AND b &gt; 53.ç­‰å€¼ä¼ é€’    a = b and b = c and c = 5 æ”¹å†™ä¸º a = 5 and b = 5 and c = 54.ç§»é™¤æ²¡ç”¨çš„æ¡ä»¶    (a &lt; 1 and b = b) OR (a = 6 OR 5 != 5) æ”¹å†™ä¸º (a &lt; 1 and TRUE) OR (a = 6 OR FALSE)  ==&gt;  a &lt; 1 OR a = 65.è¡¨è¾¾å¼è®¡ç®—    a =5 + 1 æ”¹å†™ä¸º a=66.havingå’Œwhereå­å¥åˆå¹¶7.å¸¸é‡è¡¨æ£€æµ‹</code></pre><h5 id="å¤–è¿æ¥æ¶ˆé™¤"><a href="#å¤–è¿æ¥æ¶ˆé™¤" class="headerlink" title="å¤–è¿æ¥æ¶ˆé™¤"></a>å¤–è¿æ¥æ¶ˆé™¤</h5><ul><li>å¤–è¿æ¥å’Œå†…è¿æ¥åŒºåˆ«<pre><code class="textmate">å¤–è¿æ¥å’Œå†…è¿æ¥çš„æœ¬è´¨åŒºåˆ«å°±æ˜¯:  å¯¹äºå¤–è¿æ¥çš„é©±åŠ¨è¡¨çš„è®°å½•æ¥è¯´ï¼Œå¦‚æœæ— æ³•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾åˆ° åŒ¹é…ONå­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•ï¼Œé‚£ä¹ˆè¯¥è®°å½•ä»ç„¶ä¼šè¢«åŠ å…¥åˆ°ç»“æœé›†ä¸­ï¼Œå¯¹åº”çš„è¢«é©±åŠ¨è¡¨è®°å½•çš„å„ä¸ªå­—æ®µä½¿ç”¨ NULLå€¼å¡«å……;  è€Œå†…è¿æ¥çš„é©±åŠ¨è¡¨çš„è®°å½•å¦‚æœæ— æ³•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾åˆ°åŒ¹é…ONå­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•ï¼Œé‚£ä¹ˆè¯¥è®° å½•ä¼šè¢«èˆå¼ƒç©ºå€¼æ‹’ç»:  åœ¨è¢«é©±åŠ¨è¡¨çš„WHEREå­å¥ç¬¦åˆç©ºå€¼æ‹’ç»çš„æ¡ä»¶åï¼Œå¤–è¿æ¥å’Œå†…è¿æ¥å¯ä»¥ç›¸äº’è½¬ æ¢ã€‚è¿™ç§è½¬æ¢å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥é€šè¿‡è¯„ä¼°è¡¨çš„ä¸åŒè¿æ¥é¡ºåºçš„æˆæœ¬ï¼Œé€‰å‡ºæˆæœ¬æœ€ä½çš„é‚£ç§è¿æ¥é¡ºåº æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚</code></pre></li></ul><h5 id="å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="å­æŸ¥è¯¢ä¼˜åŒ–"></a>å­æŸ¥è¯¢ä¼˜åŒ–</h5><pre><code class="textmate">1.æŒ‰è¿”å›çš„ç»“æœé›†åŒºåˆ†å­æŸ¥è¯¢    æ ‡é‡å­æŸ¥è¯¢    è¡Œå­æŸ¥è¯¢    åˆ—å­æŸ¥è¯¢    è¡¨å­æŸ¥è¯¢2.æŒ‰ä¸å¤–å±‚æŸ¥è¯¢å…³ç³»æ¥åŒºåˆ†å­æŸ¥è¯¢    ä¸ç›¸å…³å­æŸ¥è¯¢    ç›¸å…³å­æŸ¥è¯¢3.å­æŸ¥è¯¢åœ¨å¸ƒå°”è¡¨è¾¾å¼ä¸­çš„ä½¿ç”¨4.å­æŸ¥è¯¢è¯­æ³•æ³¨æ„äº‹é¡¹    4.1 å­æŸ¥è¯¢å¿…é¡»ç”¨å°æ‹¬å·æ‰©èµ·æ¥    4.2 åœ¨ SELECT å­å¥ä¸­çš„å­æŸ¥è¯¢å¿…é¡»æ˜¯æ ‡é‡å­æŸ¥è¯¢    4.3 åœ¨æƒ³è¦å¾—åˆ°æ ‡é‡å­æŸ¥è¯¢æˆ–è€…è¡Œå­æŸ¥è¯¢ï¼Œä½†åˆä¸èƒ½ä¿è¯å­æŸ¥è¯¢çš„ç»“æœé›†åªæœ‰ä¸€æ¡è®°å½•æ—¶ï¼Œåº”è¯¥ä½¿ç”¨LIMIT 1è¯­å¥æ¥é™åˆ¶è®°å½•æ•°é‡ã€‚    4.4 å¯¹äº[NOT]IN/ANY/SOME/ALL å­æŸ¥è¯¢æ¥è¯´ï¼Œå­æŸ¥è¯¢ä¸­ä¸å…è®¸æœ‰ LIMIT è¯­å¥ã€‚    4.5 ä¸å…è®¸åœ¨ä¸€æ¡è¯­å¥ä¸­å¢åˆ æ”¹æŸä¸ªè¡¨çš„è®°å½•æ—¶åŒæ—¶è¿˜å¯¹è¯¥è¡¨è¿›è¡Œå­æŸ¥è¯¢ã€‚    å¦‚æœ IN å­æŸ¥è¯¢ç¬¦åˆè½¬æ¢ä¸º semi-join çš„æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä¼˜å…ˆæŠŠè¯¥å­æŸ¥è¯¢ä¸º semi-join ï¼Œç„¶åå†è€ƒè™‘ä¸‹è¾¹5ç§æ‰§è¡ŒåŠè¿æ¥çš„ç­–ç•¥ä¸­å“ªä¸ªæˆæœ¬æœ€ä½:    Table pullout    DuplicateWeedout     LooseScan     Materialization     FirstMatch    é€‰æ‹©æˆæœ¬æœ€ä½çš„é‚£ç§æ‰§è¡Œç­–ç•¥æ¥æ‰§è¡Œå­æŸ¥è¯¢ã€‚    å¦‚æœ IN å­æŸ¥è¯¢ä¸ç¬¦åˆè½¬æ¢ä¸º semi-join çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä»ä¸‹è¾¹ä¸¤ç§ç­–ç•¥ä¸­æ‰¾å‡ºä¸€ç§æˆæœ¬æ›´ä½çš„ æ–¹å¼æ‰§è¡Œå­æŸ¥è¯¢:    å…ˆå°†å­æŸ¥è¯¢ç‰©åŒ–ä¹‹åå†æ‰§è¡ŒæŸ¥è¯¢ æ‰§è¡Œ IN to EXISTS è½¬æ¢ã€‚5.[NOT] EXISTSå­æŸ¥è¯¢çš„æ‰§è¡Œ    å¦‚æœ [NOT] EXISTS å­æŸ¥è¯¢æ˜¯ä¸ç›¸å…³å­æŸ¥è¯¢ï¼Œå¯ä»¥å…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œå¾—å‡ºè¯¥ [NOT] EXISTS å­æŸ¥è¯¢çš„ç»“æœæ˜¯ TRUE è¿˜    æ˜¯ FALSE ï¼Œå¹¶é‡å†™åŸå…ˆçš„æŸ¥è¯¢è¯­å¥6.å¯¹äºæ´¾ç”Ÿè¡¨çš„ä¼˜åŒ–    6.1 æœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯æŠŠæ´¾ç”Ÿè¡¨ç‰©åŒ–    6.2å°†æ´¾ç”Ÿè¡¨å’Œå¤–å±‚çš„è¡¨åˆå¹¶ï¼Œä¹Ÿå°±æ˜¯å°†æŸ¥è¯¢é‡å†™ä¸ºæ²¡æœ‰æ´¾ç”Ÿè¡¨çš„å½¢å¼</code></pre><h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><h5 id="æŸ¥çœ‹ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹"><a href="#æŸ¥çœ‹ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹" class="headerlink" title="æŸ¥çœ‹ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹"></a>æŸ¥çœ‹ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹</h5><pre><code class="textmate">SHOW VARIABLES LIKE &#39;optimizer_trace&#39;; 1. æ‰“å¼€optimizer traceåŠŸèƒ½ (é»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯å…³é—­çš„):    SET optimizer_trace=&quot;enabled=on&quot;; 2. è¿™é‡Œè¾“å…¥ä½ è‡ªå·±çš„æŸ¥è¯¢è¯­å¥ SELECT ...; 3. ä»OPTIMIZER_TRACEè¡¨ä¸­æŸ¥çœ‹ä¸Šä¸€ä¸ªæŸ¥è¯¢çš„ä¼˜åŒ–è¿‡ç¨‹     SELECT * FROM information_schema.OPTIMIZER_TRACE; 4. å¯èƒ½ä½ è¿˜è¦è§‚å¯Ÿå…¶ä»–è¯­å¥æ‰§è¡Œçš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œé‡å¤ä¸Šè¾¹çš„ç¬¬2ã€3æ­¥ ... 5. å½“ä½ åœæ­¢æŸ¥çœ‹è¯­å¥çš„ä¼˜åŒ–è¿‡ç¨‹æ—¶ï¼ŒæŠŠoptimizer traceåŠŸèƒ½å…³é—­ SET optimizer_trace=&quot;enabled=off&quot;;</code></pre><h3 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h3><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><pre><code class="textmate">1. ç£ç›˜å¤ªæ…¢ï¼Œç”¨å†…å­˜ä½œä¸ºç¼“å­˜å¾ˆæœ‰å¿…è¦ã€‚2. Buffer Pool æœ¬è´¨ä¸Šæ˜¯ InnoDB å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡   innodb_buffer_pool_size æ¥è°ƒæ•´å®ƒçš„å¤§å°ã€‚3. Buffer Pool å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„è¿ç»­å†…å­˜ç”±æ§åˆ¶å—å’Œç¼“å­˜é¡µç»„æˆï¼Œæ¯ä¸ªæ§åˆ¶å—å’Œç¼“å­˜é¡µéƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨   å¡«å……è¶³å¤Ÿå¤šçš„æ§åˆ¶å—å’Œç¼“å­˜é¡µçš„ç»„åˆåï¼Œ Buffer Pool å‰©ä½™çš„ç©ºé—´å¯èƒ½äº§ç”Ÿä¸å¤Ÿå¡«å……ä¸€ç»„æ§åˆ¶å—å’Œç¼“å­˜é¡µï¼Œ   è¿™éƒ¨åˆ†ç©ºé—´ä¸èƒ½è¢«ä½¿ç”¨ï¼Œä¹Ÿè¢«ç§°ä¸º ç¢ç‰‡ ã€‚4. InnoDB ä½¿ç”¨äº†è®¸å¤š é“¾è¡¨ æ¥ç®¡ç† Buffer Pool ã€‚5. freeé“¾è¡¨ ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œåœ¨å°†ç£ç›˜ä¸­çš„é¡µåŠ è½½åˆ° Buffer Pool æ—¶ï¼Œä¼šä» freeé“¾ è¡¨ ä¸­å¯»æ‰¾ç©ºé—²çš„ç¼“å­˜é¡µã€‚6. ä¸ºäº†å¿«é€Ÿå®šä½æŸä¸ªé¡µæ˜¯å¦è¢«åŠ è½½åˆ° Buffer Pool ï¼Œä½¿ç”¨ è¡¨ç©ºé—´å· + é¡µå· ä½œä¸º key ï¼Œç¼“å­˜é¡µä½œä¸º value ï¼Œ å»ºç«‹å“ˆå¸Œè¡¨ã€‚7. åœ¨ Buffer Pool ä¸­è¢«ä¿®æ”¹çš„é¡µç§°ä¸º è„é¡µ ï¼Œè„é¡µå¹¶ä¸æ˜¯ç«‹å³åˆ·æ–°ï¼Œè€Œæ˜¯è¢«åŠ å…¥åˆ° flushé“¾è¡¨ ä¸­ï¼Œå¾…ä¹‹åçš„æŸ ä¸ªæ—¶åˆ»åŒæ­¥åˆ°ç£ç›˜ä¸Šã€‚8. LRUé“¾è¡¨ åˆ†ä¸º young å’Œ old ä¸¤ä¸ªåŒºåŸŸï¼Œå¯ä»¥é€šè¿‡ innodb_old_blocks_pct æ¥è°ƒèŠ‚ old åŒºåŸŸæ‰€å çš„æ¯”ä¾‹ã€‚   é¦–æ¬¡ä»ç£ç›˜ä¸ŠåŠ è½½åˆ° Buffer Pool çš„é¡µä¼šè¢«æ”¾åˆ° old åŒºåŸŸçš„å¤´éƒ¨ï¼Œåœ¨ innodb_old_blocks_time é—´éš”æ—¶é—´å†…è®¿ é—®è¯¥é¡µä¸ä¼šæŠŠå®ƒç§»åŠ¨åˆ° young åŒºåŸŸå¤´éƒ¨ã€‚åœ¨ Buffer Pool æ²¡æœ‰å¯ç”¨çš„ç©ºé—²ç¼“å­˜é¡µæ—¶ï¼Œä¼šé¦–å…ˆæ·˜æ±°æ‰ old åŒº åŸŸçš„ä¸€äº›é¡µã€‚9. æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®š innodb_buffer_pool_instances æ¥æ§åˆ¶ Buffer Pool å®ä¾‹çš„ä¸ªæ•°ï¼Œæ¯ä¸ª Buffer Pool å® ä¾‹ä¸­éƒ½æœ‰å„è‡ªç‹¬ç«‹çš„é“¾è¡¨ï¼Œäº’ä¸å¹²æ‰°ã€‚10. è‡ª MySQL 5.7.5 ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒæ•´ Buffer Pool å¤§å°ã€‚æ¯ä¸ª Buffer Pool å®ä¾‹ç”±è‹¥ å¹²ä¸ª chunk ç»„æˆï¼Œæ¯ä¸ª chunk çš„å¤§å°å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶é€šè¿‡å¯åŠ¨å‚æ•°è°ƒæ•´ã€‚11. å¯ä»¥ç”¨ä¸‹è¾¹çš„å‘½ä»¤æŸ¥çœ‹ Buffer Pool çš„çŠ¶æ€ä¿¡æ¯: SHOW ENGINE INNODB STATUS\G</code></pre><h3 id="äº‹åŠ¡-1"><a href="#äº‹åŠ¡-1" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><h4 id="ReadView"><a href="#ReadView" class="headerlink" title="ReadView"></a>ReadView</h4><ul><li><a href="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/mysql-innodb-%E7%89%88%E6%9C%AC%E9%93%BE.png">ç‰ˆæœ¬é“¾</a></li></ul><pre><code class="textmate">READ COMMITTED å’Œ REPEATABLE READ éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œæ ¸å¿ƒé—®é¢˜å°±æ˜¯:éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„;</code></pre><ul><li>ReadViewåŒ…å«ä¿¡æ¯</li></ul><pre><code class="textmate">1.m_ids :è¡¨ç¤ºåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„ äº‹åŠ¡id åˆ—è¡¨ã€‚2.min_trx_id :è¡¨ç¤ºåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡ä¸­æœ€å°çš„ äº‹åŠ¡id ï¼Œä¹Ÿå°±æ˜¯ m_ids ä¸­çš„æœ€ å°å€¼ã€‚3.max_trx_id :è¡¨ç¤ºç”Ÿæˆ ReadView æ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼ã€‚  å°è´´å£«:  æ³¨æ„max_trx_idå¹¶ä¸æ˜¯m_idsä¸­çš„æœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„ã€‚æ¯”æ–¹è¯´ç°åœ¨æœ‰idä¸º1ï¼Œ2ï¼Œ3è¿™ä¸‰ ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ã€‚é‚£ä¹ˆä¸€ä¸ªæ–°çš„è¯»äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œm_idså°±åŒ…æ‹¬1å’Œ2ï¼Œmi n_trx_idçš„å€¼å°±æ˜¯1ï¼Œmax_trx_idçš„å€¼å°±æ˜¯4ã€‚4.creator_trx_id :è¡¨ç¤ºç”Ÿæˆè¯¥ ReadView çš„äº‹åŠ¡çš„ äº‹åŠ¡id ã€‚</code></pre><ul><li>åŒºåˆ«</li></ul><pre><code class="textmate">READ COMMITTED å’Œ REPEATABLE READ éš”ç¦»çº§åˆ«çš„çš„ä¸€ä¸ªéå¸¸å¤§çš„åŒºåˆ«å°±æ˜¯å®ƒä»¬ç”ŸæˆReadViewçš„ æ—¶æœºä¸åŒREAD COMMITTED â€”â€” åŒä¸€äº‹åŠ¡æ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadViewREPEATABLE READ â€”â€” åŒä¸€äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ªReadView</code></pre><ul><li>ReadViewåˆ¤æ–­æ­¥éª¤</li></ul><pre><code class="textmate">1.å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼ä¸ ReadView ä¸­çš„ creator_trx_id å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·± ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚2.å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼å°äº ReadView ä¸­çš„ min_trx_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿ æˆ ReadView å‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚3.å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼å¤§äº ReadView ä¸­çš„ max_trx_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿ æˆ ReadView åæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚4.å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼åœ¨ ReadView çš„ min_trx_id å’Œ max_trx_id ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹ trx_id å±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ m_ids åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥  ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®;å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚MVCC (Multi-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)æŒ‡çš„å°± æ˜¯åœ¨ä½¿ç”¨ READ COMMITTD ã€ REPEATABLE READ è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œæ™®é€šçš„ SEELCT æ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆ æœ¬é“¾çš„è¿‡ç¨‹ï¼Œè¿™æ ·å­å¯ä»¥ä½¿ä¸åŒäº‹åŠ¡çš„ è¯»-å†™ ã€ å†™-è¯» æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</code></pre><ul><li><p>purge</p><pre><code class="textmate">insert undo åœ¨äº‹åŠ¡æäº¤ä¹‹åå°±å¯ä»¥è¢«é‡Šæ”¾æ‰äº†ï¼Œè€Œ update undo ç”±äºè¿˜éœ€è¦æ”¯æŒ MVCC ï¼Œä¸èƒ½ç«‹å³ åˆ é™¤æ‰ã€‚ä¸ºäº†æ”¯æŒ MVCC ï¼Œå¯¹äº delete mark æ“ä½œæ¥è¯´ï¼Œä»…ä»…æ˜¯åœ¨è®°å½•ä¸Šæ‰“ä¸€ä¸ªåˆ é™¤æ ‡è®°ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å°†å®ƒåˆ é™¤æ‰ã€‚éšç€ç³»ç»Ÿçš„è¿è¡Œï¼Œåœ¨ç¡®å®šç³»ç»Ÿä¸­åŒ…å«æœ€æ—©äº§ç”Ÿçš„é‚£ä¸ª ReadView çš„äº‹åŠ¡ä¸ä¼šå†è®¿é—®æŸäº› update undoæ—¥å¿— ä»¥åŠè¢« æ‰“äº†åˆ é™¤æ ‡è®°çš„è®°å½•åï¼Œæœ‰ä¸€ä¸ªåå°è¿è¡Œçš„ purgeçº¿ç¨‹ ä¼šæŠŠå®ƒä»¬çœŸæ­£çš„åˆ é™¤æ‰</code></pre><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><h4 id="é”åˆ†ç±»"><a href="#é”åˆ†ç±»" class="headerlink" title="é”åˆ†ç±»"></a>é”åˆ†ç±»</h4><pre><code class="textmate">è¡Œçº§é”ã€è¡¨é”(Sé”-å…±äº«é”ã€Xé”-ç‹¬å é”ã€IS-æ„å‘å…±äº«ã€IX-æ„å‘ç‹¬å )æ€»ç»“:  ISã€IXé”æ˜¯è¡¨çº§é”ï¼Œå®ƒä»¬çš„æå‡ºä»…ä»…ä¸ºäº†åœ¨ä¹‹ååŠ è¡¨çº§åˆ«çš„Sé”å’ŒXé”æ—¶å¯ä»¥å¿«é€Ÿåˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ˜¯å¦ è¢«ä¸Šé”ï¼Œ  ä»¥é¿å…ç”¨éå†çš„æ–¹å¼æ¥æŸ¥çœ‹è¡¨ä¸­æœ‰æ²¡æœ‰ä¸Šé”çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶å®ISé”å’ŒIXé”æ˜¯å…¼å®¹çš„ï¼ŒIXé”å’ŒIXé”æ˜¯ å…¼å®¹çš„</code></pre></li><li><p>å…¼å®¹æ€§</p></li></ul><table><thead><tr><th>æ˜¯å¦å…¼å®¹</th><th>X</th><th>IX</th><th>S</th><th>IS</th></tr></thead><tbody><tr><td>X</td><td>å¦</td><td>å¦</td><td>å¦</td><td>å¦</td></tr><tr><td>IX</td><td>å¦</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>S</td><td>å¦</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>IS</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table><ul><li>é”ç»“æ„(ç®€æ˜“)<pre><code class="textmate">trxä¿¡æ¯ :ä»£è¡¨è¿™ä¸ªé”ç»“æ„æ˜¯å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚is_waiting :ä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾…ã€‚</code></pre></li><li>æ“ä½œé”æ­¥éª¤<pre><code class="textmate">åœ¨äº‹åŠ¡ T1 æäº¤ä¹‹åï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„ é”ç»“æ„ é‡Šæ”¾æ‰ï¼Œç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œ å‘ç°äº†äº‹åŠ¡ T2 è¿˜åœ¨ç­‰å¾…è·å–é”ï¼Œæ‰€ä»¥æŠŠäº‹åŠ¡ T2 å¯¹åº”çš„é”ç»“æ„çš„ is_waiting å±æ€§è®¾ç½®ä¸º false ï¼Œç„¶å æŠŠè¯¥äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹å”¤é†’ï¼Œè®©å®ƒç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶äº‹åŠ¡ T2 å°±ç®—è·å–åˆ°é”äº†</code></pre></li></ul><h4 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><pre><code class="textmate">åœ¨ READ UNCOMMITTED éš”ç¦»çº§åˆ«ä¸‹ï¼Œ è„è¯» ã€ ä¸å¯é‡å¤è¯» ã€ å¹»è¯» éƒ½å¯èƒ½å‘ç”Ÿã€‚åœ¨ READ COMMITTED éš”ç¦»çº§åˆ«ä¸‹ï¼Œ ä¸å¯é‡å¤è¯» ã€ å¹»è¯» å¯èƒ½å‘ç”Ÿï¼Œ è„è¯» ä¸å¯ä»¥å‘ç”Ÿã€‚åœ¨ REPEATABLE READ éš”ç¦»çº§åˆ«ä¸‹ï¼Œ å¹»è¯» å¯èƒ½å‘ç”Ÿï¼Œ è„è¯» å’Œ ä¸å¯é‡å¤è¯» ä¸å¯ä»¥å‘ç”Ÿã€‚åœ¨ SERIALIZABLE éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸Šè¿°é—®é¢˜éƒ½ä¸å¯ä»¥å‘ç”Ÿã€‚è„è¯»ï¼šè¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ä¸å¯é‡å¤è¯»: åŒä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡æäº¤çš„æ•°æ®å¹»è¯»: åŒä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–èŒƒå›´æ•°æ®ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°æ–°çš„è®°å½•</code></pre>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringFrameworkæºç ç¼–è¯‘</title>
      <link href="/2021/06/26/backend/spring/framework/springframework-1/"/>
      <url>/2021/06/26/backend/spring/framework/springframework-1/</url>
      
        <content type="html"><![CDATA[<h2 id="SpringFramework5-2-xç¼–è¯‘æ­¥éª¤-Macä¸‹"><a href="#SpringFramework5-2-xç¼–è¯‘æ­¥éª¤-Macä¸‹" class="headerlink" title="SpringFramework5.2.xç¼–è¯‘æ­¥éª¤(Macä¸‹)"></a>SpringFramework5.2.xç¼–è¯‘æ­¥éª¤(Macä¸‹)</h2><h3 id="ä½¿ç”¨å·¥å…·"><a href="#ä½¿ç”¨å·¥å…·" class="headerlink" title="ä½¿ç”¨å·¥å…·"></a>ä½¿ç”¨å·¥å…·</h3><ul><li>jdk1.8</li><li>Spring-Framework5.2.x æºç </li><li>Gradle 5.6.4</li><li>Idea2021</li></ul><h3 id="Gradleå®‰è£…é…ç½®-ç¼–è¯‘å·¥å…·"><a href="#Gradleå®‰è£…é…ç½®-ç¼–è¯‘å·¥å…·" class="headerlink" title="Gradleå®‰è£…é…ç½®(ç¼–è¯‘å·¥å…·)"></a>Gradleå®‰è£…é…ç½®(ç¼–è¯‘å·¥å…·)</h3><ul><li><a href="https://gradle.org/">Gradleå®˜ç½‘</a></li><li><a href="https://gradle.org/releases/">ä¸‹è½½é¡µé¢</a></li></ul><h4 id="æ–¹å¼ä¸€ã€å‹ç¼©åŒ…-æ¨è"><a href="#æ–¹å¼ä¸€ã€å‹ç¼©åŒ…-æ¨è" class="headerlink" title="æ–¹å¼ä¸€ã€å‹ç¼©åŒ…(æ¨è)"></a>æ–¹å¼ä¸€ã€å‹ç¼©åŒ…(æ¨è)</h4><blockquote><p>å»ºè®®ä¸‹è½½æºç ä¸­æ ‡è¯†çš„gradleç‰ˆæœ¬(æºç gradle/wrapper/gradle-wrapper.propertiesä¸­)</p></blockquote><pre><code class="textmate">1.ä¸‹è½½å‹ç¼©åŒ…ï¼Œè§£å‹è‡³~/software/æ–‡ä»¶å¤¹ä¸‹2.è®¾ç½®ç¯å¢ƒå˜é‡   echo $SHELL å…ˆæŸ¥çœ‹å½“å‰shell   /bin/bash åˆ™ä¿®æ”¹ ~/.bash_profile æ–‡ä»¶   /bin/zsh åˆ™ä¿®æ”¹ ~/.zshrc æ–‡ä»¶   æ·»åŠ ä»¥ä¸‹é…ç½®:        export GRADLE_HOME=/Users/mac/software/gradle        export PATH=$PATH:$GRADLE_HOME/bin    source ~/.zshrc æˆ– source ~/.bash_profile åˆ·æ–°3.éªŒè¯å®‰è£…  gradle -v</code></pre><ul><li>æ·»åŠ Gradleé…ç½®<pre><code class="groovy">allprojects&#123; repositories &#123;     def REPOSITORY_URL = &#39;http://maven.aliyun.com/nexus/content/groups/public/&#39;     all &#123; ArtifactRepository repo -&gt;         if(repo instanceof MavenArtifactRepository)&#123;             def url = repo.url.toString()             if (url.startsWith(&#39;https://repo1.maven.org/maven2&#39;) || url.startsWith(&#39;https://jcenter.bintray.com/&#39;)) &#123;                 project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL.&quot;                 remove repo             &#125;         &#125;     &#125;     maven &#123;         url REPOSITORY_URL     &#125; &#125;&#125;</code></pre></li></ul><h4 id="æ–¹å¼äºŒã€brewå®‰è£…"><a href="#æ–¹å¼äºŒã€brewå®‰è£…" class="headerlink" title="æ–¹å¼äºŒã€brewå®‰è£…"></a>æ–¹å¼äºŒã€brewå®‰è£…</h4><blockquote><p>å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ç‰ˆæœ¬ï¼Œæ³¨æ„ï¼ï¼ï¼</p></blockquote><pre><code class="shell">brew install gradle</code></pre><h4 id="æ–¹å¼ä¸‰ã€æ—§ç‰ˆæœ¬å‡çº§å‘½ä»¤-æ²¡è¯•è¿‡"><a href="#æ–¹å¼ä¸‰ã€æ—§ç‰ˆæœ¬å‡çº§å‘½ä»¤-æ²¡è¯•è¿‡" class="headerlink" title="æ–¹å¼ä¸‰ã€æ—§ç‰ˆæœ¬å‡çº§å‘½ä»¤(æ²¡è¯•è¿‡)"></a>æ–¹å¼ä¸‰ã€æ—§ç‰ˆæœ¬å‡çº§å‘½ä»¤(æ²¡è¯•è¿‡)</h4><pre><code class="shell">./gradlew wrapper --gradle-version=7.1 --distribution-type=bin</code></pre><h3 id="Ideaå®‰è£…é…ç½®Gradle"><a href="#Ideaå®‰è£…é…ç½®Gradle" class="headerlink" title="Ideaå®‰è£…é…ç½®Gradle"></a>Ideaå®‰è£…é…ç½®Gradle</h3><pre><code class="textmate">1.æœç´¢å¹¶å®‰è£…æ’ä»¶     èœå•: Preferences -&gt; Plugins    æ’ä»¶å(2ä¸ª): Gradle / Gradle Extension2.é…ç½®    èœå•: Preferences -&gt; Build -&gt; Build Tools -&gt; Gradle    é…ç½®é¡¹: è®¾ç½®Gradle user home(ä»“åº“ç›®å½•)</code></pre><h3 id="Ideaç¼–è¯‘é¡¹ç›®"><a href="#Ideaç¼–è¯‘é¡¹ç›®" class="headerlink" title="Ideaç¼–è¯‘é¡¹ç›®"></a>Ideaç¼–è¯‘é¡¹ç›®</h3><pre><code class="textmate">1.å¯¼å…¥   File -&gt; Open -&gt; æ‰“å¼€ Spring-Framework5.2xæºç ä¸­ build.gradle2.ç­‰å¾…ç¼–è¯‘å®Œæˆ   æ­£å¸¸æƒ…å†µä¸‹ä¸€æ¬¡ç¼–è¯‘é€šè¿‡ï¼Œä¸ç†Ÿæ‚‰gradleçš„è¯å»ºè®®å…ˆä¸è¦æ”¹ settings.gradle å’Œ build.gradle å†…å®¹ï¼Œå¦åˆ™ä¼šç¼–è¯‘å¤±è´¥ï¼›3.å…¶ä»–   å‡ºç°å…¶ä»–å¼‚å¸¸å…ˆå‚è€ƒæºç ä¸­ import-into-XXX.md æ–‡æ¡£</code></pre><h3 id="æ–°å»ºé¡¹ç›®æµ‹è¯•"><a href="#æ–°å»ºé¡¹ç›®æµ‹è¯•" class="headerlink" title="æ–°å»ºé¡¹ç›®æµ‹è¯•"></a>æ–°å»ºé¡¹ç›®æµ‹è¯•</h3><ul><li>1.æ–°å»ºæ¨¡å—my-demoï¼Œç±»å‹é€‰Gradle</li><li>2.å°†æ–°å»ºçš„æ¨¡å—åŠ åˆ°é¡¹ç›®ä¸­(ideaè‡ªåŠ¨æ–°å¢)<pre><code class="textmate">settings.gradle ä¸­æ–°å¢ include &#39;my-demo&#39;</code></pre></li><li>3.å¼•å…¥æ¨¡å—<pre><code class="groovy">// my-demo/build.gradleä¸­å¼•å…¥æ¨¡å—dependencies ä¸‹æ–°å¢ compile(project(&quot;:spring-context&quot;))</code></pre></li><li>4.æ–°å»ºé…ç½®ç±»åŠæµ‹è¯•ä»£ç <pre><code class="java">//é…ç½®ç±»//å¦‚æœæ³¨è§£å¼•å…¥å¤±è´¥ï¼Œåˆ™åœ¨@Componentpublic class TestConfig &#123;&#125;</code></pre></li></ul><p>//æµ‹è¯•ç±»ï¼Œæ‰“å°æˆåŠŸåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸ<br>public class StartDemo {<br>    public static void main(String[] args) {<br>        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(â€œcom.my.configâ€);<br>        System.out.println(context.getBean(TestConfig.class));<br>    }<br>}</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringFramework </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringClougGateway</title>
      <link href="/2021/06/15/backend/spring/springcloud-gateway/"/>
      <url>/2021/06/15/backend/spring/springcloud-gateway/</url>
      
        <content type="html"><![CDATA[<h3 id="æ–‡ç« æ”¶é›†"><a href="#æ–‡ç« æ”¶é›†" class="headerlink" title="æ–‡ç« æ”¶é›†"></a>æ–‡ç« æ”¶é›†</h3><ul><li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RC3/multi/multi_spring-cloud-gateway.html">SpringCloudGateway-2.1.0.RC3</a></li><li><a href="https://spring.io/projects/spring-cloud-gateway">SpringCloudGatewayå®˜ç½‘</a></li><li><a href="https://www.haoyizebo.com/posts/876ed1e8/">SpringCloudGateway(è¯»å–ã€ä¿®æ”¹RequestBody)(è½¬)</a></li></ul><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre><code class="yaml">spring:  application:    name: cloud-gateway  cloud:    httpclient:      connect-timeout: 20000      pool:        max-idle-time: 20000    #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±#    discovery:#      locator:#        lower-case-service-id: true#        enabled: true    # ç›¸å…³æ–‡æ¡£ https://www.cnblogs.com/crazymakercircle/p/11704077.html    # uriç›¸åŒæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆ    #ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„æ–­è¨€æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘ï¼›    #predicatesæ–­è¨€ï¼Œå¯æ ¹æ®datetimeã€Cookieã€Headerã€Hostã€Methodã€Pathã€Queryparamã€RemoteAddråŒ¹é…    #filter: æ”¯æŒPrefixPathã€RewritePathã€SetPathã€RedirectToã€RemoveRequestHeaderã€    #RemoveResponseHeaderã€SetStatusã€StripPrefixã€RequestSizeã€Default-filters    gateway:      routes:      #æ ¹æ®urlæ‹¦æˆª      - id: service1_v1        uri: https://www.so.com/?quanso.com.cn        predicates:          - Path=/360#      - id: service1_v2#        uri: http://localhost:8080/api/v2#        predicates:#          - Path=/v2      #æ‹¦æˆªv1è¯·æ±‚ï¼Œå¹¶å¸¦ä¸Š/apiï¼Œè½¬å‘åˆ°8080ç«¯å£ä¸Š#      - id: service1_v3#        uri: http://localhost:8080#        predicates:#          - Path=/v1#        filters:#          - PrefixPath=/api      #predicatesæ–­è¨€ï¼Œå¯æ ¹æ®datetime/Cookie/Header/Host/Method/Path/Queryparam/RemoteAddråŒ¹é…      - id: queryParam-baidu-route        uri: https://www.baidu.com        predicates:          - Query=baidu      - id: queryParam-bing-route        uri: https://bing.com/        predicates:          - Query=bing, tr. #å‚æ•°ä¸­åŒ…å«bing,ä¸”å€¼ä¸ºtrå¼€å¤´çš„ä¸‰ä½å‚æ•° æ‰èƒ½åŒ¹é…åˆ°#      - id: queryParam-release2-route#        uri: http://localhost:8080/api/v2#        predicates:#          - Path=/api#          - Weight=service2, 90#      - id: queryParam-head-route#        uri: http://localhost:8080#        predicates:#          - Header=Jump, 1001 #è¯·æ±‚å¤´ä¸­åŒ…å«ä¿¡æ¯æ‰æ ¡éªŒé€šè¿‡#        filters:#          - PrefixPath=/api#      - id: queryParam-host-route#        uri: http://localhost:8080#        predicates:#          - Host=*.apix #è¯·æ±‚å¤´ä¸­åŒ…å«ä¿¡æ¯æ‰æ ¡éªŒé€šè¿‡#        filters:#          - PrefixPath=/api      #æµ‹è¯•StripPrefix#      - id: full-route#        uri: http://localhost:8080#        predicates:#          - Query=full#        filters:#          - PrefixPath=/full#          - StripPrefix=0      # ç†”æ–­é™çº§#      - id: queryParam-fallback-route#        uri: http://localhost:8080#        predicates:#          - Path=/test#        filters:#          - name: Hystrix#            args:#              name: default#              fallbackUri: forward:/fallback#      - id: fallback-route#        uri: http://localhost:8080/fallback#        predicates:#          - Path=/fallback        # é‡‘ä¸é›€å‘å¸ƒ      - id: release1-route        uri: http://localhost:8080        predicates:          - Path=/v1          - Weight=service1, 50        filters:          - PrefixPath=/api      - id: release2-route        uri: http://localhost:8081        predicates:          - Path=/v1          - Weight=service1, 50        filters:          - PrefixPath=/api#hystrix.command.fallbackA.execution.isolation.thread.timeoutInMilliseconds: 5000# hystrix ä¿¡å·é‡éš”ç¦»ï¼Œ1.5ç§’åè‡ªåŠ¨è¶…æ—¶hystrix:  command:    default:      execution:        isolation:          strategy: SEMAPHORE          thread:            timeoutInMilliseconds: 1500</code></pre><h3 id="è·å–åŠæ”¹å†™RequestBodyç¤ºä¾‹"><a href="#è·å–åŠæ”¹å†™RequestBodyç¤ºä¾‹" class="headerlink" title="è·å–åŠæ”¹å†™RequestBodyç¤ºä¾‹"></a>è·å–åŠæ”¹å†™RequestBodyç¤ºä¾‹</h3><pre><code class="java">class DemoFilter implements GlobalFilter, Ordered&#123;    @Resource    private ServerCodecConfigurer configurer;    @Override    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;        ServerRequest serverRequest = ServerRequest.create(exchange, configurer.getReaders());        // read &amp; modify body        Mono&lt;String&gt; modifiedBody = serverRequest.bodyToMono(String.class)                .flatMap(body -&gt; &#123;                    //ä¾‹å­ï¼šéªŒç­¾                    boolean checkFlag = paramSignCheck(jsonParam);                    if(!checkFlag)&#123;                        return Mono.error(new Exception(&quot;éªŒç­¾å¤±è´¥&quot;));                    &#125;                    return Mono.just(body);                &#125;);        BodyInserter bodyInserter = BodyInserters.fromPublisher(modifiedBody,String.class);        HttpHeaders headers = new HttpHeaders();        headers.putAll(exchange.getRequest().getHeaders());        //é‡è¦ ä¸å¤„ç†ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥        headers.remove(HttpHeaders.CONTENT_LENGTH);        CachedBodyOutputMessage outputMessage = new CachedBodyOutputMessage(exchange, headers);        return bodyInserter.insert(outputMessage, new BodyInserterContext())                .then(Mono.defer(() -&gt; &#123;                    ServerHttpRequestDecorator decorator = new ServerHttpRequestDecorator(                            exchange.getRequest()) &#123;                        @Override                        public HttpHeaders getHeaders() &#123;                            long contentLength = headers.getContentLength();                            HttpHeaders httpHeaders = new HttpHeaders();                            httpHeaders.putAll(super.getHeaders());                            if (contentLength &gt; 0) &#123;                                httpHeaders.setContentLength(contentLength);                            &#125;                            return httpHeaders;                        &#125;                        @Override                        public Flux&lt;DataBuffer&gt; getBody() &#123;                            return outputMessage.getBody();                        &#125;                    &#125;;                    ServerHttpResponse decoratedResponse = decorate(exchange, trace);                    return chain.filter(exchange.mutate().request(decorator).response(decoratedResponse).build());                &#125;));    &#125;&#125;</code></pre><h3 id="æ–°å¢headers"><a href="#æ–°å¢headers" class="headerlink" title="æ–°å¢headers"></a>æ–°å¢headers</h3><pre><code class="java">@Configurationpublic class AuthGatewayFilter implements GlobalFilter, Ordered &#123;    @Override    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;        Consumer&lt;HttpHeaders&gt; httpHeaders = httpHeader -&gt; &#123;            // å­˜åœ¨ç›¸åŒçš„key,ç›´æ¥æ·»åŠ ä¼šæŠ¥é”™            if(StringUtils.isBlank(httpHeader.getFirst(&quot;xxx&quot;)))&#123;                httpHeader.add(&quot;xxx&quot;, &quot;xxx&quot;);            &#125;        &#125;;        ServerHttpRequest serverHttpRequest = exchange.getRequest().mutate().headers(httpHeaders).build();        exchange = exchange.mutate().request(serverHttpRequest).build();        return chain.filter(exchange);    &#125;    @Override    public int getOrder() &#123;        return Ordered.HIGHEST_PRECEDENCE - 1;    &#125;&#125;</code></pre><h3 id="è¯·æ±‚éjsonæ ¼å¼è½¬jsondemo"><a href="#è¯·æ±‚éjsonæ ¼å¼è½¬jsondemo" class="headerlink" title="è¯·æ±‚éjsonæ ¼å¼è½¬jsondemo"></a>è¯·æ±‚éjsonæ ¼å¼è½¬jsondemo</h3><pre><code class="java">class Demo&#123;    /** application/x-www-form-urlencoded è½¬json **/    private Map&lt;String, Object&gt; decodeBody(String body) &#123;        return Arrays.stream(body.split(&quot;&amp;&quot;))                .map(s -&gt; s.split(&quot;=&quot;))                .collect(Collectors.toMap(arr -&gt; arr[0], arr -&gt; arr[1]));    &#125;    /** fomrData(éæ–‡ä»¶)è½¬ json æ•°æ® **/    private String parseFormData2Json(String requestParam)&#123;        if(StringUtils.isBlank(requestParam)                 &amp;&amp; !requestParam.contains(&quot;filename&quot;))&#123;            return requestParam;        &#125;        try&#123;            requestParam = requestParam.replace(&quot;-&quot;,&quot;&quot;).split(&quot;-&quot;)[0];            String code = requestParam.split(&quot;\n&quot;)[0];            requestParam = requestParam.replaceAll(code,&quot;&quot;)                    .replaceAll(&quot;ContentDisposition: formdata;&quot;,&quot;&quot;)                    .replaceAll(&quot;\n&quot;,&quot;&quot;)                    .replaceAll(&quot;name=&quot;,&quot;,&quot;)                    .replaceAll(&quot;\&quot;\r\r&quot;,&quot;\&quot;:\&quot;&quot;)                    .replaceFirst(&quot;,&quot;,&quot;&quot;)                    .replaceAll(&quot;\r&quot;,&quot;\&quot;&quot;)            ;            requestParam = &quot;&#123;&quot; + requestParam + &quot;\&quot;&#125;&quot;;        &#125; catch (Exception e)&#123;            e.printStackTrace();        &#125;        return requestParam;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ƒç”¨é“¾ç›‘æ§-skywalking</title>
      <link href="/2021/05/19/devops/skywalking/"/>
      <url>/2021/05/19/devops/skywalking/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://skywalking.apache.org/">å®˜ç½‘</a></li><li><a href="http://skywalking.apache.org/downloads/">ä¸‹è½½åœ°å€</a></li><li><a href="https://www.jianshu.com/p/8b9aad4210c5">éƒ¨ç½²åŠä½¿ç”¨æ–‡æ¡£(è½¬)</a></li></ul><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ul><li>é‡å¯<pre><code class="textmate">åŸè„šæœ¬ä¸­æ²¡æœ‰æ€æ‰æ—§è¿›ç¨‹ï¼Œä½¿ç”¨jpsæ‰¾åˆ°å¯¹åº”æœåŠ¡ï¼Œç„¶åkillæ‰å†æ‰§è¡Œbin/startup.sh</code></pre></li><li>æ”¯æŒSpringCloudGateway<pre><code class="textmate">é»˜è®¤æƒ…å†µagentæ˜¯ä¸æ”¯æŒå¯¹spring-cloud-gatewayçš„ç›‘æ§çš„ï¼Œéœ€è¦æ’ä»¶çš„æ”¯æŒã€‚æˆ‘ä»¬è¦å°†optional-pluginsä¸‹çš„æ’ä»¶apm-spring-cloud-gateway-2.x-plugin-6.5.0.jaræ‹·è´åˆ°pluginsä¸‹</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> skywalking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>istio</title>
      <link href="/2021/05/18/devops/istio/"/>
      <url>/2021/05/18/devops/istio/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://istio.io/latest/zh/docs/examples/bookinfo/">å®˜ç½‘</a></li><li><a href="https://www.jianshu.com/p/1f3f62ce3ea9">istioæ€§èƒ½æµ‹è¯•</a></li></ul><h3 id="æ ¸å¿ƒç»„ä»¶-V1-5ä¹‹å‰"><a href="#æ ¸å¿ƒç»„ä»¶-V1-5ä¹‹å‰" class="headerlink" title="æ ¸å¿ƒç»„ä»¶-V1.5ä¹‹å‰"></a>æ ¸å¿ƒç»„ä»¶-V1.5ä¹‹å‰</h3><h4 id="1-æ•°æ®å¹³é¢"><a href="#1-æ•°æ®å¹³é¢" class="headerlink" title="1.æ•°æ®å¹³é¢"></a>1.æ•°æ®å¹³é¢</h4><blockquote><p><a href="https://www.envoyproxy.io/">Envoyå®˜ç½‘</a></p></blockquote><pre><code class="textmate">Istio çš„æ•°æ®å¹³é¢ä¸»æµé€‰ç”¨ Lyft çš„ Envoyï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„æ•°æ®å¹³é¢ï¼Œä¾‹å¦‚ MOSNã€‚Envoyæä¾›äº†åŠ¨æ€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€TLSã€HTTP/2åŠGRPCä»£ç†ã€ç†”æ–­å™¨ã€å¥åº·æ£€æŸ¥ã€æµé‡æ‹†åˆ†ã€ç°åº¦å‘å¸ƒã€æ•…éšœæ³¨å…¥ç­‰åŠŸèƒ½</code></pre><h4 id="2-Pilot"><a href="#2-Pilot" class="headerlink" title="2.Pilot"></a>2.Pilot</h4><pre><code class="textmate">Istio çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦è´Ÿè´£æ ¸å¿ƒæ²»ç†ã€æµé‡æ§åˆ¶ã€å°†é…ç½®è½¬æ¢ä¸ºæ•°æ®å¹³é¢å¯è¯†åˆ«çš„ xDS åè®®åˆ†å‘é…ç½®åˆ°æ•°æ®å¹³é¢æ¯”å¦‚ï¼šA/Bæµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒä¸€äº›ç›¸å…³é…ç½®çš„</code></pre><h4 id="3-Citadel"><a href="#3-Citadel" class="headerlink" title="3.Citadel"></a>3.Citadel</h4><pre><code class="textmate">å¯é€‰å¼€å¯æˆ–å…³é—­ï¼Œè´Ÿè´£å®‰å…¨ç›¸å…³çš„è¯ä¹¦å’Œå¯†é’¥ç®¡ç†ã€‚</code></pre><h4 id="4-Galley"><a href="#4-Galley" class="headerlink" title="4.Galley"></a>4.Galley</h4><pre><code class="textmate">ç”¨äºé…ç½®ã€éªŒè¯ã€æ³¨å…¥ã€å¤„ç†å’Œåˆ†å‘ç»„ä»¶çš„ã€‚ä½œä¸ºsidecarä»£ç†çš„åˆ†å‘ä»¥åŠæ³¨å…¥ç­‰ç›¸å…³ç®¡ç†çš„ã€‚</code></pre><h4 id="5-Mixer"><a href="#5-Mixer" class="headerlink" title="5.Mixer"></a>5.Mixer</h4><pre><code class="textmate">é»˜è®¤å…³é—­ï¼Œè´Ÿè´£æä¾›ç­–ç•¥æ§åˆ¶å’Œé¥æµ‹æ”¶é›†çš„ç»„ä»¶ï¼Œå†…éƒ¨åŒ…å« Policy å’Œ Telemetry 2ä¸ªå­æ¨¡å—ï¼›Policy è´Ÿè´£åœ¨æœåŠ¡ç›¸äº’è°ƒç”¨è¿‡ç¨‹ä¸­å¯¹è¯·æ±‚è¿›è¡Œç­–ç•¥æ£€æŸ¥ï¼Œä¾‹å¦‚é‰´æƒã€é™æµï¼ŒTelemetry è´Ÿè´£ç›‘æ§ç›¸å…³çš„é‡‡é›†æ•°æ®çš„ä¿¡æ¯èšåˆä»¥ç”¨äºå¯¹æ¥å„ç§åç«¯ã€‚</code></pre><h4 id="6-Injector"><a href="#6-Injector" class="headerlink" title="6.Injector"></a>6.Injector</h4><pre><code class="textmate">è´Ÿè´£æ•°æ®å¹³é¢çš„åˆå§‹åŒ–ç›¸å…³çš„åŠ¨ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨æ³¨å…¥ sidecar å°±æ˜¯ä½¿ç”¨è¯¥ç»„ä»¶å®Œæˆçš„ã€‚</code></pre><h3 id="æ ¸å¿ƒç»„ä»¶-V1-5åŠä»¥å"><a href="#æ ¸å¿ƒç»„ä»¶-V1-5åŠä»¥å" class="headerlink" title="æ ¸å¿ƒç»„ä»¶-V1.5åŠä»¥å"></a>æ ¸å¿ƒç»„ä»¶-V1.5åŠä»¥å</h3><blockquote><p>ç®€å•åœ°è¯´ï¼Œåªæ˜¯å°†åŸæœ‰çš„å¤šè¿›ç¨‹è®¾è®¡æ¨¡å¼ä¼˜åŒ–æˆäº†å•è¿›ç¨‹çš„å½¢æ€ï¼Œä¹‹å‰å„ä¸ªç»„ä»¶è¢«è®¾è®¡æˆäº† istio çš„å†…éƒ¨å­æ¨¡å—è€Œå·²</p></blockquote><h3 id="æµé‡ç®¡ç†"><a href="#æµé‡ç®¡ç†" class="headerlink" title="æµé‡ç®¡ç†"></a>æµé‡ç®¡ç†</h3><ul><li><p>é…ç½®åŸºæœ¬è¯·æ±‚è·¯ç”±</p><pre><code class="yaml">spec:hosts:  - reviewshttp:  - route:      - destination:          host: reviews          subset: v1</code></pre></li><li><p>æŒ‰ç…§è¯·æ±‚å¤´ä¸­ç”¨æˆ·ä¿¡æ¯è¿‡æ»¤</p><pre><code class="yaml">spec:hosts:  - reviewshttp:  - match:      - headers:          end-user:            exact: jason    route:      - destination:          host: reviews          subset: v2  - match:      - headers:          end-user:            exact: aaa    route:      - destination:          host: reviews          subset: v2  - route:      - destination:          host: reviews          subset: v3</code></pre></li><li><p>æ•…éšœæ³¨å…¥-å»¶è¿Ÿ(jasonç™»å½•ï¼Œè®¿é—®6såé¡µé¢æ‰åŠ è½½å‡ºæ¥)</p><pre><code class="yaml">spec:hosts:  - ratingshttp:  - fault:      delay:        fixedDelay: 7s # 7så»¶è¿Ÿ        percentage:          value: 100    match:      - headers:          end-user:            exact: jason    route:      - destination:          host: ratings          subset: v1  - route:      - destination:          host: ratings          subset: v1</code></pre></li><li><p>æ•…éšœæ³¨å…¥-å¼‚å¸¸(jasonç™»å½•ï¼Œ50å‡ ç‡è®¿é—®è¿”å›500)</p><pre><code class="yaml">spec:hosts:- ratingshttp:- match:  - headers:      end-user:        exact: jason  fault:    abort:      percentage:        value: 50      httpStatus: 500 #æ³¨å…¥500é”™è¯¯  route:  - destination:      host: ratings      subset: v1- route:  - destination:      host: ratings      subset: v1</code></pre></li><li><p>æµé‡è½¬ç§»</p><pre><code class="yaml">spec:hosts:  - reviewshttp:- route:  - destination:      host: reviews      subset: v1    weight: 50  - destination:      host: reviews      subset: v3    weight: 50</code></pre></li><li><p>è®¾ç½®è¯·æ±‚è¶…æ—¶(2så»¶è¿Ÿ)</p><pre><code class="yaml">spec:hosts:- ratingshttp:- fault:    delay:      percent: 100      fixedDelay: 2s  route:  - destination:      host: ratings      subset: v1</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> istio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue</title>
      <link href="/2021/04/28/frontend/vue/"/>
      <url>/2021/04/28/frontend/vue/</url>
      
        <content type="html"><![CDATA[<h3 id="vue-es6æ¥å…¥Echarts"><a href="#vue-es6æ¥å…¥Echarts" class="headerlink" title="vue+es6æ¥å…¥Echarts"></a>vue+es6æ¥å…¥Echarts</h3><h4 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h4><pre><code class="shell"># echarsnpm install echarts --save</code></pre><h4 id="2-å®ç°å›¾è¡¨ä¸‹é’»åŠè¿˜åŸdemo"><a href="#2-å®ç°å›¾è¡¨ä¸‹é’»åŠè¿˜åŸdemo" class="headerlink" title="2.å®ç°å›¾è¡¨ä¸‹é’»åŠè¿˜åŸdemo"></a>2.å®ç°å›¾è¡¨ä¸‹é’»åŠè¿˜åŸdemo</h4><pre><code class="textmate">&lt;template&gt;    &lt;div style=&quot;display: inline-block&quot; v-show=&quot;optionShow&quot; &gt;        &lt;div id=&quot;option&quot; :style=&quot;&#123;width: &#39;800px&#39;, height: &#39;600px&#39;&#125;&quot;&gt;&lt;/div&gt;    &lt;/div&gt;    &lt;div style=&quot;display: inline-block&quot; v-show=&quot;optionSecondShow&quot; &gt;        &lt;div id=&quot;secondOption&quot; :style=&quot;&#123;width: &#39;800px&#39;, height: &#39;600px&#39;&#125;&quot;&gt;&lt;/div&gt;    &lt;/div&gt;&lt;/template&gt;&lt;script&gt;    import * as echarts from &#39;echarts&#39;;    export default &#123;        name: &#39;dashboard&#39;,        data() &#123;            return &#123;                optionShow: true,                // echartsæŠ¥è¡¨                option: &#123;&#125;,                optionSecond: &#123;&#125;,            &#125;        &#125;,        created()&#123;        &#125;,        mounted()&#123;            //è°ƒç”¨methodä¸­æ–¹æ³•ï¼ï¼ï¼            let that = this;            //æ¸²æŸ“æŠ¥è¡¨ä¸€            let myChart = echarts.init(document.getElementById(&#39;option&#39;))            that.initEcharts();            myChart.setOption(that.option);            //æŠ¥è¡¨äºŒ            let myChartSecond = echarts.init(document.getElementById(&#39;secondOption&#39;))            //å›¾è¡¨ä¸€ä¸‹é’»            myChart.on(&#39;click&#39;, function (params) &#123;                console.log(params.name,params.value,params.seriesName);                //é‡ç½®å€¼                that.secondShowFun()                myChartSecond.setOption(that.optionSecond)            &#125;);            //ç‚¹å‡»å›¾è¡¨äºŒè¿˜åŸæ•°æ®            myChartSecond.getZr().on(&#39;click&#39;, function (event) &#123;                if (!event.target) &#123;                    that.initEcharts();                    myChart.setOption(that.option)                &#125;            &#125;);            //ç‚¹å‡»å›¾è¡¨äºŒä¸‹é’»            myChartSecond.on(&#39;click&#39;, function (params) &#123;                console.log(params.name,params.value,params.seriesName);                //å±•ç¤ºåˆ—è¡¨                that.showTabFun()            &#125;);        &#125;,        methods: &#123;            initEcharts()&#123;                this.optionShow = true;                this.optionSecondShow = false;                this.tableShow = false;                this.option = &#123;                    tooltip: &#123;                        trigger: &#39;axis&#39;,                        axisPointer: &#123;            // Use axis to trigger tooltip                            type: &#39;shadow&#39;        // &#39;shadow&#39; as default; can also be &#39;line&#39; or &#39;shadow&#39;                        &#125;                    &#125;,                    legend: &#123;                        data: [&#39;é¡¹ç›®ä¸€&#39;, &#39;é¡¹ç›®äºŒ&#39;, &#39;é¡¹ç›®ä¸‰&#39;]                    &#125;,                    grid: &#123;                        left: &#39;3%&#39;,                        right: &#39;4%&#39;,                        bottom: &#39;3%&#39;,                        containLabel: true                    &#125;,                    xAxis: &#123;                        type: &#39;value&#39;                    &#125;,                    yAxis: &#123;                        type: &#39;category&#39;,                        data: [&#39;user-center&#39;, &#39;user-auth&#39;, &#39;uaa-gateway&#39;, &#39;crm&#39;, &#39;ims&#39;, &#39;fms&#39;, &#39;cloud-gateway&#39;]                    &#125;,                    series: [                        &#123;                            name: &#39;é¡¹ç›®ä¸€&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true,                                valueAnimation: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [320, 302, 301, 334, 390, 330, 320]                        &#125;,                        &#123;                            name: &#39;é¡¹ç›®äºŒ&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true,                                valueAnimation: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [120, 132, 101, 134, 90, 230, 210]                        &#125;,                        &#123;                            name: &#39;é¡¹ç›®ä¸‰&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true,                                valueAnimation: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [220, 182, 191, 234, 290, 330, 310]                        &#125;                    ],                &#125;;            &#125;,            secondShowFun()&#123;                this.optionShow = false;                this.optionSecondShow = true;                this.optionSecond = &#123;                    tooltip: &#123;                        trigger: &#39;axis&#39;,                        axisPointer: &#123;            // Use axis to trigger tooltip                            type: &#39;shadow&#39;        // &#39;shadow&#39; as default; can also be &#39;line&#39; or &#39;shadow&#39;                        &#125;                    &#125;,                    legend: &#123;                        data: [&#39;åˆ†ç±»ä¸€&#39;,&#39;åˆ†ç±»äºŒ&#39;,&#39;åˆ†ç±»ä¸‰&#39;]                    &#125;,                    grid: &#123;                        left: &#39;3%&#39;,                        right: &#39;4%&#39;,                        bottom: &#39;3%&#39;,                        containLabel: true                    &#125;,                    xAxis: &#123;                        type: &#39;value&#39;                    &#125;,                    yAxis: &#123;                        type: &#39;category&#39;,                        data: [&#39;å­é¡¹ä¸€&#39;, &#39;å­é¡¹äºŒ&#39;, &#39;å­é¡¹ä¸‰&#39;]                    &#125;,                    series : [                        &#123;                            name: &#39;å­é¡¹ä¸€&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [10,2,3]                        &#125;,                        &#123;                            name: &#39;å­é¡¹äºŒ&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [1,3,4]                        &#125;,                        &#123;                            name: &#39;å­é¡¹ä¸‰&#39;,                            type: &#39;bar&#39;,                            stack: &#39;total&#39;,                            label: &#123;                                show: true                            &#125;,                            emphasis: &#123;                                focus: &#39;series&#39;                            &#125;,                            data: [2,5,6]                        &#125;,                    ],                &#125;;            &#125;,        &#125;    &#125;&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;    .dashboard-editor-container &#123;        padding: 32px;        background-color: rgb(240, 242, 245);        position: relative;    .chart-wrapper &#123;        background: #fff;        padding: 16px 16px 0;        margin-bottom: 32px;    &#125;    &#125;    @media (max-width:1024px) &#123;        .chart-wrapper &#123;            padding: 8px;        &#125;    &#125;&lt;/style&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´ç›¸å…³</title>
      <link href="/2021/04/16/devops/docker/"/>
      <url>/2021/04/16/devops/docker/</url>
      
        <content type="html"><![CDATA[<h3 id="K8Sç›¸å…³"><a href="#K8Sç›¸å…³" class="headerlink" title="K8Sç›¸å…³"></a>K8Sç›¸å…³</h3><ul><li><a href="https://k8s.imroc.io/troubleshooting/">k8så®è·µ(è½¬)</a></li><li><a href="https://www.processon.com/view/link/5e4662ade4b0d86ec4018e50#map">k8sé—®é¢˜å®šä½æ‰‹å†Œ(è½¬)</a></li></ul><h3 id="Dockerç›¸å…³"><a href="#Dockerç›¸å…³" class="headerlink" title="Dockerç›¸å…³"></a>Dockerç›¸å…³</h3><ul><li><a href="https://dockerwebdev.com/tutorials/clean-up-docker/">æ¸…ç†Docker</a></li><li><a href="https://www.kubernetes.org.cn/kubernetes-pod">Kubernetesä¸­æ–‡ç¤¾åŒº</a></li><li><a href="https://istio.io/latest/zh/docs/setup/getting-started/">Istio(ServiceMesh)</a></li><li><a href="https://kiali.io/documentation/latest/runtimes-monitoring/#_quarkus">Kiali</a></li></ul><h4 id="æœ¬åœ°å¯åŠ¨K8S"><a href="#æœ¬åœ°å¯åŠ¨K8S" class="headerlink" title="æœ¬åœ°å¯åŠ¨K8S"></a>æœ¬åœ°å¯åŠ¨K8S</h4><pre><code class="textmate">1.å…ˆä¸‹è½½å®‰è£…docker desktop(å»ºè®®3.2.2ä»¥ä¸Š)    https://www.docker.com/products/docker-desktop2.å®‰è£…å¥½åå¯åŠ¨docker desktop3.è®¾ç½®    3.1 Perferences ==&gt; Kubernetes ==&gt; å¼€å¯Enable Kubernetesï¼ŒShow system containers    3.2 å¦‚æœå¼€å¯ä¸äº†å°è¯•æ‰‹åŠ¨ä¸‹è½½k8sç›¸å…³è¿›è¡Œå¹¶é‡å¯docker desktop    3.3 ä¸‹è½½ä¸docker desktopä¸­Kubernetesä¸€è‡´çš„ç‰ˆæœ¬        https://github.com/maguowei/k8s-docker-desktop-for-mac        </code></pre><h4 id="dockerè®¾ç½®"><a href="#dockerè®¾ç½®" class="headerlink" title="dockerè®¾ç½®"></a>dockerè®¾ç½®</h4><pre><code class="textmate">1.è®¾ç½®å¼€æœºè‡ªå¯    sudo systemctl enable xx2.é…ç½®dockerå®¹å™¨è‡ªåŠ¨é‡å¯    docker update xx --restart=always</code></pre><h4 id="æ¸…ç†Docker"><a href="#æ¸…ç†Docker" class="headerlink" title="æ¸…ç†Docker"></a>æ¸…ç†Docker</h4><pre><code class="textmate">https://dockerwebdev.com/tutorials/clean-up-docker</code></pre><h4 id="é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h4><pre><code class="textmate">é˜¿é‡Œäº‘æ§åˆ¶å°-&gt;å®¹å™¨æœåŠ¡-&gt;é•œåƒåŠ é€Ÿå™¨-&gt;é€‰æ‹©ä¸åŒç³»ç»Ÿçš„å‘½ä»¤å¹¶æ‰§è¡Œ</code></pre><h4 id="Dockerè¸©å‘"><a href="#Dockerè¸©å‘" class="headerlink" title="Dockerè¸©å‘"></a>Dockerè¸©å‘</h4><pre><code class="textmate">1.ç›®å½•æŒ‚è½½é—®é¢˜    å¦‚æœè¦æ˜ å°„å…·ä½“æ–‡ä»¶ï¼Œéœ€è¦å…ˆæ‰‹å·¥åˆ›å»ºå¥½ï¼Œå¦åˆ™é»˜è®¤æ˜¯ä½œä¸ºæ–‡ä»¶å¤¹åˆ›å»ºçš„</code></pre><h3 id="è™šæ‹Ÿæœº-VirtualBox"><a href="#è™šæ‹Ÿæœº-VirtualBox" class="headerlink" title="è™šæ‹Ÿæœº-VirtualBox"></a>è™šæ‹Ÿæœº-VirtualBox</h3><h4 id="VirtualBoxè™šæ‹Ÿæœºé•œåƒå®‰è£…å·¥å…·"><a href="#VirtualBoxè™šæ‹Ÿæœºé•œåƒå®‰è£…å·¥å…·" class="headerlink" title="VirtualBoxè™šæ‹Ÿæœºé•œåƒå®‰è£…å·¥å…·"></a>VirtualBoxè™šæ‹Ÿæœºé•œåƒå®‰è£…å·¥å…·</h4><pre><code class="textmate">   vargrant è½¯ä»¶(æœ‰å¯¹åº”çš„é•œåƒä»“åº“)   vargrant init center/7  ---&gt; ä¼šç”Ÿæˆç±»ä¼¼dockerfileçš„æ–‡ä»¶,æ”¯æŒä¿®æ”¹é…ç½®   vargrant up --&gt; å¯åŠ¨ï¼Œç›¸å½“äºç‚¹è™šæ‹Ÿæœºå¼€æœº   vargrant ssh  ---&gt; sshé“¾æ¥è™šæ‹Ÿæœº   vargrant reload ---&gt; é‡å¯è™šæ‹Ÿæœº</code></pre>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nacos</title>
      <link href="/2021/04/13/backend/service/nacos/"/>
      <url>/2021/04/13/backend/service/nacos/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><h3 id="ä¸»è¦ä½œç”¨"><a href="#ä¸»è¦ä½œç”¨" class="headerlink" title="ä¸»è¦ä½œç”¨"></a>ä¸»è¦ä½œç”¨</h3><pre><code class="textmate">1.è‡´åŠ›äºå‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡    æä¾›äº†ä¸€ç»„ç®€å•æ˜“ç”¨çš„ç‰¹æ€§é›†ï¼Œå¸®åŠ©ä½¿ç”¨è€…å¿«é€Ÿå®ç°åŠ¨æ€æœåŠ¡å‘ç°ã€æœåŠ¡é…ç½®ã€æœåŠ¡å…ƒæ•°æ®åŠæµé‡ç®¡ç†ã€‚2.æ›´æ•æ·å’Œå®¹æ˜“åœ°æ„å»ºã€äº¤ä»˜å’Œç®¡ç†å¾®æœåŠ¡å¹³å°    æ„å»ºä»¥â€œæœåŠ¡â€ä¸ºä¸­å¿ƒçš„ç°ä»£åº”ç”¨æ¶æ„ (ä¾‹å¦‚å¾®æœåŠ¡èŒƒå¼ã€äº‘åŸç”ŸèŒƒå¼) çš„æœåŠ¡åŸºç¡€è®¾æ–½æœåŠ¡ï¼ˆServiceï¼‰æ˜¯ Nacos ä¸–ç•Œçš„ä¸€ç­‰å…¬æ°‘ã€‚Nacos æ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµç±»å‹çš„â€œæœåŠ¡â€çš„å‘ç°ã€é…ç½®å’Œç®¡ç†</code></pre><h3 id="å…³é”®ç‰¹æ€§"><a href="#å…³é”®ç‰¹æ€§" class="headerlink" title="å…³é”®ç‰¹æ€§"></a>å…³é”®ç‰¹æ€§</h3><ul><li>æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹</li><li>åŠ¨æ€é…ç½®æœåŠ¡</li><li>åŠ¨æ€ DNS æœåŠ¡</li><li>æœåŠ¡åŠå…¶å…ƒæ•°æ®ç®¡ç†</li></ul><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><pre><code class="textmate">1.ä¸eurekaç›¸æ¯”    nacosåŸºäºraftåè®®ï¼Œé›†ç¾¤ä¸€è‡´æ€§é«˜ï¼›    eureka2.0é—­æºäº†    ç†è®ºä¸Šæ”¯æŒçš„å®ä¾‹æ•°å¤§äºeureka2.ä¸SpringCloud Configç›¸æ¯”    æ— éœ€åŸºäºgitä»“åº“å­˜å‚¨é…ç½®ï¼›    æœ‰å¯è§†åŒ–æ“ä½œç•Œé¢    nacosåŸºäºé•¿è¿æ¥ï¼Œé…ç½®å˜åŠ¨åç«‹å³é€šçŸ¥Proivder</code></pre><h3 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h3><ul><li><p>NacosæœåŠ¡æ¨¡å‹</p>  <img alt="NacosæœåŠ¡æ¨¡å‹" width="600px" height="400px" src="https://raw.githubusercontent.com/im-fan/fan-pic/release/imagesnacos-server-module.jpg"/></li><li><p>raftåè®®</p><pre><code class="textmate">Raft åè®®å¼ºä¾èµ– Leader èŠ‚ç‚¹æ¥ç¡®ä¿é›†ç¾¤æ•°æ®ä¸€è‡´æ€§ã€‚æ­¥éª¤:  1.client å‘é€è¿‡æ¥çš„æ•°æ®å‡å…ˆåˆ°è¾¾ Leader èŠ‚ç‚¹ï¼ŒLeader æ¥æ”¶åˆ°æ•°æ®åï¼Œå…ˆå°†æ•°æ®æ ‡è®°ä¸º uncommitted çŠ¶æ€ï¼Œ  2.Leader å¼€å§‹å‘æ‰€æœ‰ Follower å¤åˆ¶æ•°æ®å¹¶ç­‰å¾…å“åº”ï¼Œé›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„ Follower æˆåŠŸæ¥æ”¶æ•°æ®å¹¶å“åº”åï¼ŒLeader å°†æ•°æ®çš„çŠ¶æ€æ ‡è®°ä¸º committedï¼Œ  3.Leader éšåå‘ client å‘é€æ•°æ®å·²æ¥æ”¶ç¡®è®¤ï¼Œclient å‘é€å‡ºå·²æ•°æ®æ¥æ”¶åï¼Œå†å‘æ‰€æœ‰ Follower èŠ‚ç‚¹å‘é€é€šçŸ¥è¡¨æ˜è¯¥æ•°æ®çŠ¶æ€ä¸ºcommittedã€‚</code></pre></li></ul><h3 id="nacosæºç æ‹†è§£"><a href="#nacosæºç æ‹†è§£" class="headerlink" title="nacosæºç æ‹†è§£"></a>nacosæºç æ‹†è§£</h3>  <img alt="NacosæœåŠ¡æ¨¡å‹" width="600px" height="400px" src="/docImg/nacosæºç .png"/><h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><ul><li><a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">Nacoså®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://mp.weixin.qq.com/s/S8HI7DG5v9C2IfjXtkVjuQ">å°ç™½ä¹Ÿèƒ½æ‡‚çš„ Nacos æœåŠ¡æ¨¡å‹ä»‹ç»(è½¬)</a></li><li><a href="https://blog.csdn.net/wangwei19871103/article/details/105775039/">åŠ¨æ€åˆ·æ–°åŸç†(è½¬)</a></li><li><a href="https://www.baidu.com/s?ie=UTF-8&wd=Raft%E7%AE%97%E6%B3%95">ç›¸å…³-Raftç®—æ³•(è½¬)</a></li><li><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki">Spring-Cloud-Alibaba</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nacos </tag>
            
            <tag> åŠ¨æ€é…ç½® </tag>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx</title>
      <link href="/2021/04/05/devops/nginx/"/>
      <url>/2021/04/05/devops/nginx/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://nginx.org/">å®˜ç½‘</a></li><li><a href="https://www.runoob.com/linux/nginx-install-setup.html">èœé¸Ÿæ•™ç¨‹-Nginx å®‰è£…é…ç½®</a></li><li><a href="https://cloud.tencent.com/document/product/400/35244">NginxæœåŠ¡å™¨SSLè¯ä¹¦å®‰è£…éƒ¨ç½²-è…¾è®¯äº‘</a></li></ul><h3 id="nginxå‘½ä»¤"><a href="#nginxå‘½ä»¤" class="headerlink" title="nginxå‘½ä»¤"></a>nginxå‘½ä»¤</h3><pre><code class="textmate">1.æ£€æµ‹é…ç½®æ˜¯å¦æ­£å¸¸nginx -t 2.çƒ­éƒ¨ç½²é…ç½®nginx -s reload</code></pre><h3 id="ssl-nginxé…ç½®"><a href="#ssl-nginxé…ç½®" class="headerlink" title="ssl-nginxé…ç½®"></a>ssl-nginxé…ç½®</h3><pre><code class="textmate">å…·ä½“å‚è€ƒäº‘å‚å•†sslè¯ä¹¦å®‰è£…æ­¥éª¤1.ä¸‹è½½sslç›¸å…³æ–‡ä»¶,æœåŠ¡å™¨å¼€å¯443ç«¯å£æƒé™2.è§£å‹åå°†æ–‡ä»¶å¤¹Nginxä¸­æ–‡ä»¶æ”¾åˆ°nginxå®‰è£…ç›®å½•ä¸‹(æˆ–å…¶ä»–åœ°æ–¹)3.æ·»åŠ nginxé…ç½®æ–‡ä»¶4.é‡å¯ç”Ÿæ•ˆ</code></pre><h3 id="åŒä¸€åŸŸåä¸åŒæœåŠ¡é…ç½®"><a href="#åŒä¸€åŸŸåä¸åŒæœåŠ¡é…ç½®" class="headerlink" title="åŒä¸€åŸŸåä¸åŒæœåŠ¡é…ç½®"></a>åŒä¸€åŸŸåä¸åŒæœåŠ¡é…ç½®</h3><pre><code class="textmate">server &#123;    listen       8888;    server_name  localhost;    location /service1/ &#123;         proxy_pass http://localhost:7001/;    &#125;        location /service2/ &#123;         proxy_pass http://localhost:7002/;    &#125;&#125;</code></pre><h3 id="å…³äºè¯·æ±‚å¤´ç»è¿‡nginxä¼šè¢«è½¬ä¸ºå°å†™çš„åŸå› "><a href="#å…³äºè¯·æ±‚å¤´ç»è¿‡nginxä¼šè¢«è½¬ä¸ºå°å†™çš„åŸå› " class="headerlink" title="å…³äºè¯·æ±‚å¤´ç»è¿‡nginxä¼šè¢«è½¬ä¸ºå°å†™çš„åŸå› "></a>å…³äºè¯·æ±‚å¤´ç»è¿‡nginxä¼šè¢«è½¬ä¸ºå°å†™çš„åŸå› </h3><ul><li><a href="https://blog.csdn.net/qq_32771571/article/details/95903909">å…³äºè¯·æ±‚å¤´ç»è¿‡nginxä¼šè¢«è½¬ä¸ºå°å†™çš„åŸå› -è½¬</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot</title>
      <link href="/2021/03/22/backend/spring/spring-boot/"/>
      <url>/2021/03/22/backend/spring/spring-boot/</url>
      
        <content type="html"><![CDATA[<h3 id="æ–‡ç« æ”¶é›†"><a href="#æ–‡ç« æ”¶é›†" class="headerlink" title="æ–‡ç« æ”¶é›†"></a>æ–‡ç« æ”¶é›†</h3><ul><li><a href="https://www.jianshu.com/p/603d125f21b3">SpringBootå¯åŠ¨è¿‡ç¨‹(è½¬)</a></li><li><a href="https://www.processon.com/view/link/59812124e4b0de2518b32b6e">æµç¨‹å›¾(è½¬)</a></li><li><a href="https://blog.csdn.net/youanyyou/article/details/103562907">@RefreshScopeåŸç†</a></li><li><a href="https://www.cnblogs.com/sword-successful/p/11383723.html">SpringBootå†…ç½®Tomcatå¯åŠ¨æºç åˆ†æ</a></li><li><a href="https://blog.csdn.net/qq_28289405/article/details/81302498">@SpringBootApplication(è½¬)</a></li></ul><h3 id="é›†æˆPageHelper"><a href="#é›†æˆPageHelper" class="headerlink" title="é›†æˆPageHelper"></a>é›†æˆPageHelper</h3><ul><li><p>é…ç½®</p><pre><code class="pom">&lt;!--åŸºç¡€æ¡†æ¶åŒ…--&gt;&lt;dependency&gt;  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;  &lt;version&gt;2.3.4.RELEASE&lt;/version&gt;  &lt;type&gt;pom&lt;/type&gt;  &lt;scope&gt;import&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;  &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;  &lt;version&gt;Hoxton.SR8&lt;/version&gt;  &lt;type&gt;pom&lt;/type&gt;  &lt;scope&gt;import&lt;/scope&gt;&lt;/dependency&gt;&lt;!--page helperä¾èµ–--&gt;&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper-spring-boot-starter --&gt;&lt;dependency&gt;  &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;  &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;  &lt;version&gt;1.3.0&lt;/version&gt;&lt;/dependency&gt;</code></pre></li><li><p>ä½¿ç”¨</p><pre><code class="java">class XXService&#123;  public Result list(QueryParam param)&#123;      PageMethod.startPage(param.getPageNumber(),param.getPageSize());      List result = mapper.list(param);      PageInfo pageInfo = new PageInfo(result);      return PageDTO.result(pageInfo.getTotal(),result);  &#125;&#125;</code></pre></li><li><p>æ³¨æ„äº‹é¡¹</p></li></ul><pre><code class="textmate">1.æ³¨æ„pomç‰ˆæœ¬å·2.ä½¿ç”¨pagehelper-spring-boot-starter pomåï¼Œä¸éœ€è¦åœ¨ymlä¸­é…ç½®pagehelperç›¸å…³å‚æ•°ï¼Œå¦åˆ™åˆ†é¡µä¼šæœ‰é—®é¢˜(äº²æµ‹)  ä¾‹å¦‚: æ°¸è¿œåªåœ¨ç¬¬ä¸€é¡µ</code></pre><h3 id="è‡ªåŠ¨è£…é…åŸç†"><a href="#è‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="è‡ªåŠ¨è£…é…åŸç†"></a>è‡ªåŠ¨è£…é…åŸç†</h3><pre><code class="textmate">@EnableAutoConfigurationæ¡ä»¶æ³¨è§£ @ConditionalOnBeanç­‰@EnableAutoConfigurationæ³¨è§£(æ‰¾META-INF/spring.factoriesé…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»)</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹è±¡è½¬æ¢å·¥å…·-Orika</title>
      <link href="/2021/03/20/backend/java/utils/convert/orika/"/>
      <url>/2021/03/20/backend/java/utils/convert/orika/</url>
      
        <content type="html"><![CDATA[<h3 id="æä¾›çš„èƒ½åŠ›"><a href="#æä¾›çš„èƒ½åŠ›" class="headerlink" title="æä¾›çš„èƒ½åŠ›"></a>æä¾›çš„èƒ½åŠ›</h3><pre><code class="textmate">Orikaä¸ºå¼€å‘è€…æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š1.æ˜ å°„å¤æ‚çš„ã€æ·±å±‚æ¬¡ç»“æ„æ€§å¯¹è±¡ã€‚2.é€šè¿‡å°†åµŒå¥—å±æ€§æ˜ å°„åˆ°é¡¶çº§å±æ€§ï¼Œâ€œæ‹‰å¹³â€æˆ–â€œå±•å¼€â€å¯¹è±¡ã€‚3.è‡ªåŠ¨åˆ›å»ºæ˜ å°„ï¼Œå¹¶ä¸”åœ¨éƒ¨åˆ†æˆ–æ‰€æœ‰æ˜ å°„ä¸Šè‡ªå®šä¹‰ã€‚4.åˆ›å»ºè½¬æ¢å™¨ï¼Œä»¥å®Œå…¨æ§åˆ¶å¯¹è±¡å›¾ä¸­çš„ä»»ä½•ç‰¹å®šå¯¹è±¡é›†åˆçš„æ˜ å°„â€”â€”æŒ‰ç±»å‹ï¼Œç”šè‡³æ˜¯é€šè¿‡ç‰¹å®šçš„å±æ€§åã€‚5.å¤„ç†ä»£ç†æˆ–å¢å¼ºå¯¹è±¡ï¼ˆå¦‚Hibernateæˆ–å„ç§æ¨¡æ‹Ÿæ¡†æ¶ï¼‰6.ç”¨ä¸€ä¸ªé…ç½®åº”ç”¨åŒå‘æ˜ å°„ã€‚7.ä¸ºä¸€ä¸ªç›®æ ‡æŠ½è±¡ç±»æˆ–æ¥å£æ˜ å°„åˆ°å…·ä½“çš„å®ç°ç±»ã€‚8.æ˜ å°„POJOå±æ€§åˆ°Lists, Arrays, and Mapsã€‚</code></pre><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><h4 id="pomå¼•ç”¨"><a href="#pomå¼•ç”¨" class="headerlink" title="pomå¼•ç”¨"></a>pomå¼•ç”¨</h4><pre><code class="textmate">&lt;!-- æ–¹å¼ä¸€(æ¨è) --&gt;&lt;dependency&gt;    &lt;groupId&gt;net.rakugakibox.spring.boot&lt;/groupId&gt;    &lt;artifactId&gt;orika-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;1.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æ–¹å¼äºŒï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­åŠ å…¥é…ç½®ç±» --&gt;&lt;dependency&gt;    &lt;groupId&gt;ma.glasnost.orika&lt;/groupId&gt;    &lt;artifactId&gt;orika-core&lt;/artifactId&gt;    &lt;version&gt;1.5.4&lt;/version&gt;    &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt;</code></pre><h4 id="æ–¹å¼äºŒæ‰€éœ€é…ç½®ç±»-å¯é€‰"><a href="#æ–¹å¼äºŒæ‰€éœ€é…ç½®ç±»-å¯é€‰" class="headerlink" title="æ–¹å¼äºŒæ‰€éœ€é…ç½®ç±»(å¯é€‰)"></a>æ–¹å¼äºŒæ‰€éœ€é…ç½®ç±»(å¯é€‰)</h4><pre><code class="java">/** * å¯è‡ªå®šä¹‰è½¬æ¢è§„åˆ™ * **/@Configurationpublic class MapperFactoryAware &#123;    @Autowired    private MapperFactory mapperFactory;    @PostConstruct    public void init()&#123;        mapperFactory.getConverterFactory().registerConverter(new BooleanConvert());    &#125;    /** Boolean &lt;=&gt; Integer äº’è½¬ **/    private class BooleanConvert extends BidirectionalConverter&lt;Boolean,Integer&gt;&#123;        @Override        public Integer convertTo(Boolean source, Type&lt;Integer&gt; destinationType, MappingContext mappingContext) &#123;            return source ? 1 : 0;        &#125;        @Override        public Boolean convertFrom(Integer source, Type&lt;Boolean&gt; destinationType, MappingContext mappingContext) &#123;            return source == 1;        &#125;    &#125;&#125;</code></pre><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h4 id="åŸºç¡€æµ‹è¯•ç±»"><a href="#åŸºç¡€æµ‹è¯•ç±»" class="headerlink" title="åŸºç¡€æµ‹è¯•ç±»"></a>åŸºç¡€æµ‹è¯•ç±»</h4><pre><code class="java">// dtoå¯¹è±¡@Getter@Setter@AllArgsConstructor@NoArgsConstructor@Builderpublic class UserInfoDTO &#123;    private String userId;    private String userName;    private String createTime;    private List&lt;String&gt; ids;    private String dtoName;    private Integer sex;&#125;// poå¯¹è±¡@Getter@Setter@AllArgsConstructor@NoArgsConstructor@Builderpublic class UserInfo &#123;    private Integer userId;    private String userName;    private Date createTime;    private List&lt;Integer&gt; ids;    private String poName;    private Boolean sex;&#125;</code></pre><h4 id="ç®€æ˜“demo-æ›´å¤šç”¨æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£"><a href="#ç®€æ˜“demo-æ›´å¤šç”¨æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£" class="headerlink" title="ç®€æ˜“demo(æ›´å¤šç”¨æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£)"></a>ç®€æ˜“demo(æ›´å¤šç”¨æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£)</h4><pre><code class="java">@Slf4j@RunWith(SpringRunner.class)@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT,        classes = DemoApplication.class)public class ConvertTest&#123;    @Autowired    private MapperFacade mapperFacade;    @Autowired    private MapperFactory mapperFactory;    //ç®€æ˜“æ¡ˆä¾‹ï¼Œå±æ€§åç›¸åŒï¼Œç±»å‹ä¸åŒ    @Test    public void testSimple()&#123;        UserInfo userInfo = UserInfo.builder()                .userId(10001)                .ids(Arrays.asList(1002,1003,1004,1005))                .userName(&quot;aaaa&quot;)                .createTime(new Date())                .build();        //po 2 dto        UserInfoDTO result = mapperFacade.map(userInfo, UserInfoDTO.class);        log.info(&quot;po 2 dto =====&gt; &#123;&#125;&quot;, JSON.toJSONString(result));        //dto 2 po        UserInfo info = mapperFacade.map(result, UserInfo.class);        log.info(&quot;dto 2 po =====&gt; &#123;&#125;&quot;, JSON.toJSONString(info));        // pos 2 dtos        List&lt;UserInfo&gt; pos = new ArrayList&lt;&gt;();        pos.add(userInfo);        List&lt;UserInfoDTO&gt; dtos = mapperFacade.mapAsList(pos,UserInfoDTO.class);        log.info(&quot;pos 2 dtos =====&gt; &#123;&#125;&quot;, JSON.toJSONString(dtos));        // pos 2 dtos        pos = mapperFacade.mapAsList(dtos, UserInfo.class);        log.info(&quot;pos 2 dtos =====&gt; &#123;&#125;&quot;, JSON.toJSONString(pos));    &#125;    //å±æ€§åä¸åŒï¼Œéœ€è¦å…ˆåœ¨mapperFactoryä¸­è®¾ç½®ï¼Œç„¶åè·å–åˆ°mapperFacadeå†ä½¿ç”¨    @Test    public void testDiff()&#123;        UserInfo userInfo = UserInfo.builder()                .userId(10001)                .ids(Arrays.asList(1002,1003,1004,1005))                .userName(&quot;aaaa&quot;)                .createTime(new Date())                .poName(&quot;this is po&quot;)                .build();        //ä¸åŒå­—æ®µäº’è½¬        mapperFactory.classMap(UserInfo.class, UserInfoDTO.class)                .field(&quot;poName&quot;, &quot;dtoName&quot;)                .byDefault()                .register();        MapperFacade mapperFacade = mapperFactory.getMapperFacade();        //po 2 dto        UserInfoDTO result = mapperFacade.map(userInfo, UserInfoDTO.class);        log.info(&quot;po 2 dto =====&gt; &#123;&#125;&quot;, JSON.toJSONString(result));        //dto 2 po        UserInfo info = mapperFacade.map(result, UserInfo.class);        log.info(&quot;dto 2 po =====&gt; &#123;&#125;&quot;, JSON.toJSONString(info));        // pos 2 dtos        List&lt;UserInfo&gt; pos = new ArrayList&lt;&gt;();        pos.add(userInfo);        List&lt;UserInfoDTO&gt; dtos = mapperFacade.mapAsList(pos,UserInfoDTO.class);        log.info(&quot;pos 2 dtos =====&gt; &#123;&#125;&quot;, JSON.toJSONString(dtos));        // pos 2 dtos        pos = mapperFacade.mapAsList(dtos, UserInfo.class);        log.info(&quot;pos 2 dtos =====&gt; &#123;&#125;&quot;, JSON.toJSONString(pos));    &#125;&#125;</code></pre><h4 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h4><pre><code class="textmate">testSimple æ‰§è¡Œç»“æœ:-po 2 dto =====&gt; &#123;&quot;createTime&quot;:&quot;Wed Jun 02 10:11:51 CST 2021&quot;,&quot;ids&quot;:[&quot;1002&quot;,&quot;1003&quot;,&quot;1004&quot;,&quot;1005&quot;],&quot;userId&quot;:&quot;10001&quot;,&quot;userName&quot;:&quot;aaaa&quot;&#125;-dto 2 po =====&gt; &#123;&quot;createTime&quot;:1622650311000,&quot;ids&quot;:[1002,1003,1004,1005],&quot;userId&quot;:10001,&quot;userName&quot;:&quot;aaaa&quot;&#125;-pos 2 dtos =====&gt; [&#123;&quot;createTime&quot;:&quot;Wed Jun 02 10:11:51 CST 2021&quot;,&quot;ids&quot;:[&quot;1002&quot;,&quot;1003&quot;,&quot;1004&quot;,&quot;1005&quot;],&quot;userId&quot;:&quot;10001&quot;,&quot;userName&quot;:&quot;aaaa&quot;&#125;]-pos 2 dtos =====&gt; [&#123;&quot;createTime&quot;:1622650311000,&quot;ids&quot;:[1002,1003,1004,1005],&quot;userId&quot;:10001,&quot;userName&quot;:&quot;aaaa&quot;&#125;]testDiff æ‰§è¡Œç»“æœ:po 2 dto =====&gt; &#123;&quot;createTime&quot;:&quot;Sat Mar 20 14:30:46 CST 2021&quot;,&quot;dtoName&quot;:&quot;this is po&quot;,&quot;ids&quot;:[&quot;1002&quot;,&quot;1003&quot;,&quot;1004&quot;,&quot;1005&quot;],&quot;userId&quot;:&quot;10001&quot;,&quot;userName&quot;:&quot;aaaa&quot;&#125;dto 2 po =====&gt; &#123;&quot;createTime&quot;:1616272246000,&quot;ids&quot;:[1002,1003,1004,1005],&quot;poName&quot;:&quot;this is po&quot;,&quot;userId&quot;:10001,&quot;userName&quot;:&quot;aaaa&quot;&#125;pos 2 dtos =====&gt; [&#123;&quot;createTime&quot;:&quot;Sat Mar 20 14:30:46 CST 2021&quot;,&quot;dtoName&quot;:&quot;this is po&quot;,&quot;ids&quot;:[&quot;1002&quot;,&quot;1003&quot;,&quot;1004&quot;,&quot;1005&quot;],&quot;userId&quot;:&quot;10001&quot;,&quot;userName&quot;:&quot;aaaa&quot;&#125;]pos 2 dtos =====&gt; [&#123;&quot;createTime&quot;:1616272246000,&quot;ids&quot;:[1002,1003,1004,1005],&quot;poName&quot;:&quot;this is po&quot;,&quot;userId&quot;:10001,&quot;userName&quot;:&quot;aaaa&quot;&#125;]</code></pre><h4 id="Orikaç›¸å…³æ–‡æ¡£"><a href="#Orikaç›¸å…³æ–‡æ¡£" class="headerlink" title="Orikaç›¸å…³æ–‡æ¡£"></a>Orikaç›¸å…³æ–‡æ¡£</h4><ul><li><a href="http://orika-mapper.github.io/orika-docs/">å®˜æ–¹æ–‡æ¡£</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LDAPå­¦ä¹ ç¬”è®°</title>
      <link href="/2021/02/18/devops/ldap/"/>
      <url>/2021/02/18/devops/ldap/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://www.openldap.org/">OpenLDAP</a></li><li><a href="https://www.cnblogs.com/xiaomifeng0510/p/9564688.html">LDAP-adminæ“ä½œæŒ‡å—</a></li><li><a href="https://blog.csdn.net/weixin_30338461/article/details/98920690">CSDN-Demo</a></li><li><a href="http://docs.spring.io/spring-ldap/docs/2.1.0.RELEASE/reference/">å®˜æ–¹æ–‡æ¡£åŠä¾‹å­(é‡è¦)</a></li><li><a href="http://docs.spring.io/spring-ldap/docs/2.1.0.RELEASE/apidocs/">JAVAæ–‡æ¡£ï¼ˆé‡è¦ï¼‰</a></li><li><a href="https://github.com/spring-projects/spring-ldap">GitHubï¼ˆå¤§é‡ä¾‹å­ï¼‰</a></li></ul><h3 id="å¸¸ç”¨åè¯"><a href="#å¸¸ç”¨åè¯" class="headerlink" title="å¸¸ç”¨åè¯"></a>å¸¸ç”¨åè¯</h3><pre><code class="textmate">oâ€“ organizationï¼ˆç»„ç»‡-å…¬å¸ï¼‰ou â€“ organization unitï¼ˆç»„ç»‡å•å…ƒ-éƒ¨é—¨ï¼‰c - countryNameï¼ˆå›½å®¶ï¼‰dc - domainComponentï¼ˆåŸŸåï¼‰sn â€“ suer nameï¼ˆçœŸå®åç§°ï¼‰cn - common nameï¼ˆå¸¸ç”¨åç§°)</code></pre><h3 id="Dockeréƒ¨ç½²LDAP"><a href="#Dockeréƒ¨ç½²LDAP" class="headerlink" title="Dockeréƒ¨ç½²LDAP"></a>Dockeréƒ¨ç½²LDAP</h3><ul><li><p>ldap<br>```shell<br>#ç”¨æˆ·å cn=admin,dc=company,dc=com<br>#å¯†ç  123456<br>#æ³¨æ„ï¼Œ\åé¢ä¸èƒ½æœ‰ç©ºæ ¼<br>docker run \</p></li><li><p>p 389:389 \</p></li><li><p>p 636:636 \</p></li><li><p>-name my-ldap \</p></li><li><p>-network bridge \</p></li><li><p>-hostname openldap-host \</p></li><li><p>-env LDAP_ORGANISATION=â€companyâ€ \</p></li><li><p>-env LDAP_DOMAIN=â€company.comâ€ \</p></li><li><p>-env LDAP_ADMIN_PASSWORD=â€123456â€ \</p></li><li><p>-detach osixia/openldap</p><pre><code></code></pre></li><li><p>ldap-admin</p></li></ul><pre><code class="shell">#å¯åŠ¨åæµè§ˆå™¨è®¿é—®http://localhost:8080docker run \-d \--privileged \-p 8080:80 \--name ldap-admin \--env PHPLDAPADMIN_HTTPS=false \--env PHPLDAPADMIN_LDAP_HOSTS=LDAPæœåŠ¡IP \--detach osixia/phpldapadmin</code></pre><h3 id="æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"><a href="#æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"></a>æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</h3><h4 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h4><pre><code class="java">@Slf4jpublic class ldapService&#123;    public static void main(String[] args) &#123;        try &#123;            String bindUserDN = &quot;cn=admin,dc=company,dc=com&quot;;            //ç”¨æˆ·å¯†ç             String bindPassword = &quot;123456&quot;;            //ldapæœåŠ¡å™¨IP            String url = &quot;ldap://127.0.0.1:389/dc=company,dc=com&quot;;            Hashtable&lt;String, String&gt; env = new Hashtable&lt;&gt;();            env.put(javax.naming.Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);            env.put(javax.naming.Context.PROVIDER_URL, url);            env.put(javax.naming.Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);            env.put(javax.naming.Context.SECURITY_PRINCIPAL, bindUserDN);            env.put(javax.naming.Context.SECURITY_CREDENTIALS, bindPassword);            env.put(&quot;java.naming.referral&quot;, &quot;follow&quot;);            DirContext ctx = new InitialDirContext(env);            log.info(&quot;ctx=&#123;&#125;&quot;, JSON.toJSONString(ctx));        &#125; catch (Exception e) &#123;            log.info(&quot;LDAPç™»å½•å¤±è´¥ userName=&#123;&#125;,passWord=&#123;&#125;,error=&#123;&#125;&quot;,username,password,e);        &#125;            &#125;&#125;</code></pre><h5 id="æ–¹å¼äºŒ-ldapTemplate"><a href="#æ–¹å¼äºŒ-ldapTemplate" class="headerlink" title="æ–¹å¼äºŒ(ldapTemplate)"></a>æ–¹å¼äºŒ(ldapTemplate)</h5><ul><li><p>é…ç½®</p><pre><code class="xml">&lt;!-- ldap --&gt;&lt;dependency&gt;  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  &lt;artifactId&gt;spring-boot-starter-data-ldap&lt;/artifactId&gt;  &lt;version&gt;2.3.2.RELEASE&lt;/version&gt;&lt;/dependency&gt;</code></pre><pre><code class="yaml"># LDAPè¿æ¥é…ç½®,é…ç½®çš„baseæ˜¯ä¸åº”è¯¥å†åŠ åˆ°èŠ‚ç‚¹çš„dné‡Œé¢å»çš„(dc=company,dc=com)spring:ldap:  urls: ldap://127.0.0.1:389  base: dc=company,dc=com  username: cn=admin,dc=company,dc=com  password: 123456</code></pre></li><li><p>ä»£ç (model)</p><pre><code class="java">@Getter@Setter@ToString@Entry(objectClasses = &#123;&quot;simpleSecurityObject&quot;, &quot;organizationalRole&quot;,&quot;top&quot;&#125;, base = &quot;ou=cmdb,ou=People&quot;)public class LdapPerson &#123;  @Id  @JsonIgnore  private Name dn;  /** ç”¨æˆ·å **/  @Attribute(name=&quot;cn&quot;)  private String personName;  @Attribute(name=&quot;sn&quot;)  private String sn;  @Attribute(name=&quot;email&quot;)  private String email;  /** æ˜µç§° **/  @Attribute(name=&quot;displayName&quot;)  private String displayName;  @Attribute(name=&quot;password&quot;)  private String password;&#125;</code></pre></li><li><p>ä»£ç (dao)</p><pre><code class="java">@Slf4jpublic class PersonAttributesMapper implements AttributesMapper&lt;LdapPerson&gt; &#123;  @Override  public LdapPerson mapFromAttributes(Attributes attrs) throws NamingException &#123;      LdapPerson person = new LdapPerson();      person.setPersonName((String)attrs.get(&quot;cn&quot;).get());      //è·å–å¯†ç       byte[] bts = (byte[]) attrs.get(&quot;userpassword&quot;).get();      String password = &quot;&quot;;      for(byte bt : bts)&#123;          password = password + (char)bt;      &#125;      person.setPassword(password);      return person;  &#125;&#125;</code></pre></li><li><p>ä»£ç (service)</p><pre><code class="java">public class LoginService&#123;    //lookupæŸ¥è¯¢(ç²¾ç¡®å®šä½æŸ¥è¯¢)  public AjaxResult&lt;LdapPerson&gt; ldapCheck(String username, String password) &#123;      String dn = String.format(userDN,username);      LdapPerson person = ldapTemplate.lookup(dn, new PersonAttributesMapper());      log.info(&quot;LDAPç™»å½• username:&#123;&#125;,person=&#123;&#125;&quot;,username,JSON.toJSONString(person));      if(person == null)&#123;          return AjaxResult.error(&quot;è´¦å·ä¸å­˜åœ¨&quot;);      &#125;      if(!password.equals(person.getPassword()))&#123;          log.error(&quot;LDAPè´¦å·å¯¹åº”å¯†ç é”™è¯¯,username=&#123;&#125;,password=&#123;&#125;,realPwd=&#123;&#125;&quot;,username,password,person.getPassword());          return AjaxResult.error(&quot;å¯†ç é”™è¯¯&quot;);      &#125;      return AjaxResult.success(person);  &#125;    //search(éå†æ‰€æœ‰èŠ‚ç‚¹åŒ¹é…)  public LdapPerson getLdapAccountByName(String name) &#123;      LdapQuery query = query()              .where(&quot;objectclass&quot;).is(objectclass)              .and(&quot;cn&quot;).is(name);      List&lt;LdapPerson&gt; persons = ldapTemplate.search(query,new PersonAttributesMapper());      if(CollectionUtils.isEmpty(persons))&#123;          return null;      &#125;      return persons.get(0);  &#125;&#125;</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ldap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡å¸¸è§é—®é¢˜æ’æŸ¥</title>
      <link href="/2021/02/09/devops/check/"/>
      <url>/2021/02/09/devops/check/</url>
      
        <content type="html"><![CDATA[<h3 id="æ­»é”é—®é¢˜æ’æŸ¥"><a href="#æ­»é”é—®é¢˜æ’æŸ¥" class="headerlink" title="æ­»é”é—®é¢˜æ’æŸ¥"></a>æ­»é”é—®é¢˜æ’æŸ¥</h3><ul><li>æ¨¡æ‹Ÿæ­»é”</li></ul><pre><code class="java">@Slf4jpublic class ThreadTest &#123;    public static String a1 = &quot;a1&quot;;    public static String a2 = &quot;a2&quot;;    public static void main(String[] args) &#123;        new Thread(new PrintA()).start();        new Thread(new PrintB()).start();    &#125;&#125;</code></pre><pre><code class="java">@Slf4jclass PrintA implements Runnable&#123;    @SneakyThrows    @Override    public void run() &#123;        synchronized (ThreadTest.a1)&#123;            log.info(&quot;PrintA =====&gt; a1&quot;);            Thread.sleep(3000);            synchronized (ThreadTest.a2)&#123;                log.info(&quot;PrintA =====&gt; a2&quot;);            &#125;        &#125;    &#125;&#125;</code></pre><pre><code class="java">@Slf4jclass PrintB implements Runnable&#123;    @SneakyThrows    @Override    public void run() &#123;        synchronized (ThreadTest.a2)&#123;            log.info(&quot;PrintB =====&gt; a2&quot;);            Thread.sleep(3000);            synchronized (ThreadTest.a1)&#123;                log.info(&quot;PrintB =====&gt; a1&quot;);            &#125;        &#125;    &#125;&#125;</code></pre><ul><li>æ’æŸ¥å‘½ä»¤</li></ul><pre><code class="shell"># æŸ¥æ‰¾åˆ°è¿è¡Œä¸­javaè¿›ç¨‹jps -l# æŸ¥çœ‹è¿›ç¨‹å †æ ˆä¿¡æ¯jstack pid# æŸ¥çœ‹æœåŠ¡gcæƒ…å†µjstat -gcutil pid 1000</code></pre><ul><li>å·¥å…·</li></ul><pre><code class="textmate">1.gceasyç½‘ç«™ https://www.gceasy.io 2.jconsole æˆ–è€… jvisualvm</code></pre><h3 id="é¢‘ç¹FullGCé—®é¢˜æ’æŸ¥"><a href="#é¢‘ç¹FullGCé—®é¢˜æ’æŸ¥" class="headerlink" title="é¢‘ç¹FullGCé—®é¢˜æ’æŸ¥"></a>é¢‘ç¹FullGCé—®é¢˜æ’æŸ¥</h3><ul><li>æ¨¡æ‹Ÿé¢‘ç¹GC</li></ul><pre><code class="java">@Slf4jpublic class OOMTest extends TestCore &#123;    @Autowired    private ThreadPoolConfig poolConfig;    @Test    public void newInstance()&#123;        for(;;)&#123;            ConcurrentHashMap map = new ConcurrentHashMap&lt;&gt;(3000);            map.put(&quot;a&quot;,&quot;b&quot;);            log.info(&quot;&#123;&#125; size=&#123;&#125;&quot;,map.toString(),map.size());        &#125;    &#125;&#125;</code></pre><ul><li>æ’æŸ¥</li></ul><pre><code class="textmate">1.é…ç½®é¡¹ç›®å¯åŠ¨å‚æ•°    #å‡ºç° OOM æ—¶ç”Ÿæˆå † dump:     -XX:+HeapDumpOnOutOfMemoryError    #ç”Ÿæˆå †æ–‡ä»¶åœ°å€ï¼š    -XX:HeapDumpPath=/home/project/jvmlogs/2.æŸ¥çœ‹å“ªäº›å¯¹è±¡è¾ƒå¤§    jmap -histo pid | head -203.é€šè¿‡æŒ‡ä»¤æ’æŸ¥(å †æ ˆè¾ƒå¤§çš„è¯å¯èƒ½ä¼šå°†ç³»ç»Ÿå¡æ­»)    jmap -dump:file=æ–‡ä»¶å.dump [pid]    # format=b æŒ‡å®šä¸ºäºŒè¿›åˆ¶æ–‡ä»¶    jmap -dump:format=b,file=æ–‡ä»¶å [pid]</code></pre><ul><li>åˆ†æ</li></ul><pre><code class="textmate">å·¥å…·     1.jhat - jdkè‡ªå¸¦åˆ†æå·¥å…·        jhat &lt;heap-dump-file&gt;  heap-dump-file æ˜¯æ–‡ä»¶çš„è·¯å¾„å’Œæ–‡ä»¶å        æ‰§è¡Œåè®¿é—®æµè§ˆå™¨è®¿é—® http://localhost:7000/ æŸ¥çœ‹     2.Eclipse Memory Analyzer(MAT)        https://www.eclipse.org/mat/downloads.php    3.IBM Heap Analyzer</code></pre>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> devops </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadPoolè¯¦è§£</title>
      <link href="/2021/02/09/backend/java/thread/threadPool/"/>
      <url>/2021/02/09/backend/java/thread/threadPool/</url>
      
        <content type="html"><![CDATA[<h4 id="æ„é€ æ–¹æ³•ç­¾å"><a href="#æ„é€ æ–¹æ³•ç­¾å" class="headerlink" title="æ„é€ æ–¹æ³•ç­¾å"></a>æ„é€ æ–¹æ³•ç­¾å</h4><pre><code class="textmate">ThreadPoolExecutor(int corePoolSize,        int maximumPoolSize,        long keepAliveTime,        TimeUnit unit,        BlockingQueue&lt;Runnable&gt; workQueue,        ThreadFactory threadFactory,        RejectedExecutionHandler handler)        corePoolSize - æ± ä¸­æ‰€ä¿å­˜çš„çº¿ç¨‹æ•°ï¼ŒåŒ…æ‹¬ç©ºé—²çº¿ç¨‹ã€‚maximumPoolSize - æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚keepAliveTime - å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œæ­¤ä¸ºç»ˆæ­¢å‰å¤šä½™çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚unit - keepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ã€‚workQueue - æ‰§è¡Œå‰ç”¨äºä¿æŒä»»åŠ¡çš„é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—ä»…ä¿æŒç”± executeæ–¹æ³•æäº¤çš„ Runnableä»»åŠ¡ã€‚threadFactory - æ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ã€‚handler - ç”±äºè¶…å‡ºçº¿ç¨‹èŒƒå›´å’Œé˜Ÿåˆ—å®¹é‡è€Œä½¿æ‰§è¡Œè¢«é˜»å¡æ—¶æ‰€ä½¿ç”¨çš„å¤„ç†ç¨‹åºã€‚</code></pre><h4 id="å®˜æ–¹å°è£…å¥½çš„çº¿ç¨‹æ± "><a href="#å®˜æ–¹å°è£…å¥½çš„çº¿ç¨‹æ± " class="headerlink" title="å®˜æ–¹å°è£…å¥½çš„çº¿ç¨‹æ± "></a>å®˜æ–¹å°è£…å¥½çš„çº¿ç¨‹æ± </h4><pre><code class="textmate">ThreadPoolExecutoræ˜¯Executorsç±»çš„åº•å±‚å®ç°ã€‚1. newSingleThreadExecutorï¼ˆå•ä¸ªåå°çº¿ç¨‹ï¼‰    åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒã€‚    æ­¤çº¿ç¨‹æ± ä¿è¯æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºæ‰§è¡Œã€‚2.newFixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰    åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œ    å¦‚æœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚3. newCachedThreadPoolï¼ˆæ— ç•Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶ï¼‰    åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹æ± çš„å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹ï¼Œ    é‚£ä¹ˆå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆ60ç§’ä¸æ‰§è¡Œä»»åŠ¡ï¼‰çš„çº¿ç¨‹ï¼Œå½“ä»»åŠ¡æ•°å¢åŠ æ—¶ï¼Œæ­¤çº¿ç¨‹æ± åˆå¯ä»¥æ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚    æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚4.newScheduledThreadPool    åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚</code></pre><h4 id="æ’é˜Ÿç­–ç•¥"><a href="#æ’é˜Ÿç­–ç•¥" class="headerlink" title="æ’é˜Ÿç­–ç•¥"></a>æ’é˜Ÿç­–ç•¥</h4><pre><code class="textmate">æ’é˜Ÿæœ‰ä¸‰ç§é€šç”¨ç­–ç•¥ï¼š1.ç›´æ¥æäº¤    å·¥ä½œé˜Ÿåˆ—çš„é»˜è®¤é€‰é¡¹æ˜¯ SynchronousQueueï¼Œå®ƒå°†ä»»åŠ¡ç›´æ¥æäº¤ç»™çº¿ç¨‹è€Œä¸ä¿æŒå®ƒä»¬ã€‚åœ¨æ­¤ï¼Œå¦‚æœä¸å­˜åœ¨å¯ç”¨äºç«‹å³è¿è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œ    åˆ™è¯•å›¾æŠŠä»»åŠ¡åŠ å…¥é˜Ÿåˆ—å°†å¤±è´¥ï¼Œå› æ­¤ä¼šæ„é€ ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚æ­¤ç­–ç•¥å¯ä»¥é¿å…åœ¨å¤„ç†å¯èƒ½å…·æœ‰å†…éƒ¨ä¾èµ–æ€§çš„è¯·æ±‚é›†æ—¶å‡ºç°é”ã€‚    ç›´æ¥æäº¤é€šå¸¸è¦æ±‚æ— ç•Œ maximumPoolSizes ä»¥é¿å…æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚å½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚    2.æ— ç•Œé˜Ÿåˆ—ã€‚    ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ï¼Œä¸å…·æœ‰é¢„å®šä¹‰å®¹é‡çš„ LinkedBlockingQueueï¼‰å°†å¯¼è‡´åœ¨æ‰€æœ‰ corePoolSize çº¿ç¨‹éƒ½å¿™æ—¶æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚    è¿™æ ·ï¼Œåˆ›å»ºçš„çº¿ç¨‹å°±ä¸ä¼šè¶…è¿‡ corePoolSizeã€‚ï¼ˆå› æ­¤ï¼ŒmaximumPoolSizeçš„å€¼ä¹Ÿå°±æ— æ•ˆäº†ã€‚ï¼‰å½“æ¯ä¸ªä»»åŠ¡å®Œå…¨ç‹¬ç«‹äºå…¶ä»–ä»»åŠ¡ï¼Œå³ä»»åŠ¡æ‰§è¡Œäº’ä¸å½±å“æ—¶ï¼Œ    é€‚åˆäºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼›ä¾‹å¦‚ï¼Œåœ¨ Webé¡µæœåŠ¡å™¨ä¸­ã€‚è¿™ç§æ’é˜Ÿå¯ç”¨äºå¤„ç†ç¬æ€çªå‘è¯·æ±‚ï¼Œå½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚3.æœ‰ç•Œé˜Ÿåˆ—ã€‚    å½“ä½¿ç”¨æœ‰é™çš„ maximumPoolSizesæ—¶ï¼Œæœ‰ç•Œé˜Ÿåˆ—ï¼ˆå¦‚ ArrayBlockingQueueï¼‰æœ‰åŠ©äºé˜²æ­¢èµ„æºè€—å°½ï¼Œä½†æ˜¯å¯èƒ½è¾ƒéš¾è°ƒæ•´å’Œæ§åˆ¶ã€‚    é˜Ÿåˆ—å¤§å°å’Œæœ€å¤§æ± å¤§å°å¯èƒ½éœ€è¦ç›¸äº’æŠ˜è¡·ï¼šä½¿ç”¨å¤§å‹é˜Ÿåˆ—å’Œå°å‹æ± å¯ä»¥æœ€å¤§é™åº¦åœ°é™ä½ CPU ä½¿ç”¨ç‡ã€æ“ä½œç³»ç»Ÿèµ„æºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´äººå·¥é™ä½ååé‡ã€‚    å¦‚æœä»»åŠ¡é¢‘ç¹é˜»å¡ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬æ˜¯ I/Oè¾¹ç•Œï¼‰ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¸ºè¶…è¿‡æ‚¨è®¸å¯çš„æ›´å¤šçº¿ç¨‹å®‰æ’æ—¶é—´ã€‚ä½¿ç”¨å°å‹é˜Ÿåˆ—é€šå¸¸è¦æ±‚è¾ƒå¤§çš„æ± å¤§å°ï¼ŒCPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œ    ä½†æ˜¯å¯èƒ½é‡åˆ°ä¸å¯æ¥å—çš„è°ƒåº¦å¼€é”€ï¼Œè¿™æ ·ä¹Ÿä¼šé™ä½ååé‡ã€‚</code></pre><h4 id="BlockingQueueçš„é€‰æ‹©"><a href="#BlockingQueueçš„é€‰æ‹©" class="headerlink" title="BlockingQueueçš„é€‰æ‹©"></a>BlockingQueueçš„é€‰æ‹©</h4><pre><code class="textmate">ä¾‹å­ä¸€ï¼šä½¿ç”¨ç›´æ¥æäº¤ç­–ç•¥ï¼Œä¹Ÿå³SynchronousQueueã€‚    é¦–å…ˆSynchronousQueueæ˜¯æ— ç•Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å­˜æ•°ä»»åŠ¡çš„èƒ½åŠ›æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œä½†æ˜¯ç”±äºè¯¥Queueæœ¬èº«çš„ç‰¹æ€§ï¼Œåœ¨æŸæ¬¡æ·»åŠ å…ƒç´ åå¿…é¡»ç­‰å¾…å…¶ä»–çº¿ç¨‹å–èµ°åæ‰èƒ½ç»§ç»­æ·»åŠ ã€‚ä¾‹å­äºŒï¼šä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ç­–ç•¥ï¼Œå³LinkedBlockingQueue    corePoolSizeå¤§å°çš„çº¿ç¨‹æ•°ä¼šä¸€ç›´è¿è¡Œï¼Œå¿™å®Œå½“å‰çš„ï¼Œå°±ä»é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡å¼€å§‹è¿è¡Œã€‚è¦é˜²æ­¢ä»»åŠ¡ç–¯é•¿ï¼Œæ¯”å¦‚ä»»åŠ¡è¿è¡Œçš„å®è¡Œæ¯”è¾ƒé•¿ä¾‹å­ä¸‰ï¼šæœ‰ç•Œé˜Ÿåˆ—ï¼Œä½¿ç”¨ArrayBlockingQueueã€‚    è¿™ä¸ªæ˜¯æœ€ä¸ºå¤æ‚çš„ä½¿ç”¨ï¼Œæ‰€ä»¥JDKä¸æ¨èä½¿ç”¨ã€‚ä¸ä¸Šé¢çš„ç›¸æ¯”ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ä¾¿æ˜¯å¯ä»¥é˜²æ­¢èµ„æºè€—å°½çš„æƒ…å†µå‘ç”Ÿã€‚å‡è®¾ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ°¸è¿œæ— æ³•æ‰§è¡Œå®Œã€‚    å¯¹äºé¦–å…ˆæ¥çš„A,Bæ¥è¯´ç›´æ¥è¿è¡Œï¼Œæ¥ä¸‹æ¥ï¼Œå¦‚æœæ¥äº†C,Dï¼Œä»–ä»¬ä¼šè¢«æ”¾åˆ°queueä¸­ï¼Œå¦‚æœæ¥ä¸‹æ¥å†æ¥E,Fï¼Œåˆ™å¢åŠ çº¿ç¨‹è¿è¡ŒEï¼ŒFã€‚ä½†æ˜¯å¦‚æœå†æ¥ä»»åŠ¡ï¼Œé˜Ÿåˆ—æ— æ³•å†æ¥å—äº†ï¼Œ    çº¿ç¨‹æ•°ä¹Ÿåˆ°è¾¾æœ€å¤§çš„é™åˆ¶äº†ï¼Œæ‰€ä»¥å°±ä¼šä½¿ç”¨æ‹’ç»ç­–ç•¥æ¥å¤„ç†ã€‚</code></pre><h4 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h4><pre><code class="textmate">åœ¨ThreadPoolExecutorä¸­å·²ç»é»˜è®¤åŒ…å«äº†4ä¸­æ‹’ç»ç­–ç•¥1.CallerRunsPolicy    çº¿ç¨‹è°ƒç”¨è¿è¡Œè¯¥ä»»åŠ¡çš„ execute æœ¬èº«ã€‚æ­¤ç­–ç•¥æä¾›ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œèƒ½å¤Ÿå‡ç¼“æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;        if (!e.isShutdown()) &#123;             r.run();         &#125;    &#125;è¿™ä¸ªç­–ç•¥æ˜¾ç„¶ä¸æƒ³æ”¾å¼ƒæ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ç”±äºæ± ä¸­å·²ç»æ²¡æœ‰ä»»ä½•èµ„æºäº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨è°ƒç”¨è¯¥executeçš„çº¿ç¨‹æœ¬èº«æ¥æ‰§è¡Œã€‚2.AbortPolicy    å¤„ç†ç¨‹åºé­åˆ°æ‹’ç»å°†æŠ›å‡ºè¿è¡Œæ—¶RejectedExecutionException    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;       throw new RejectedExecutionException();    &#125;    è¿™ç§ç­–ç•¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸¢å¼ƒä»»åŠ¡ã€‚3.DiscardPolicy    ä¸èƒ½æ‰§è¡Œçš„ä»»åŠ¡å°†è¢«åˆ é™¤    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;&#125;    è¿™ç§ç­–ç•¥å’ŒAbortPolicyå‡ ä¹ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œåªä¸è¿‡ä»–ä¸æŠ›å‡ºå¼‚å¸¸ã€‚4.DiscardOldestPolicy    å¦‚æœæ‰§è¡Œç¨‹åºå°šæœªå…³é—­ï¼Œåˆ™ä½äºå·¥ä½œé˜Ÿåˆ—å¤´éƒ¨çš„ä»»åŠ¡å°†è¢«åˆ é™¤ï¼Œç„¶åé‡è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œåˆ™é‡å¤æ­¤è¿‡ç¨‹ï¼‰    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;        if (!e.isShutdown()) &#123;            e.getQueue().poll();            e.execute(r);        &#125;    &#125;    è¯¥ç­–ç•¥å°±ç¨å¾®å¤æ‚ä¸€äº›ï¼Œåœ¨poolæ²¡æœ‰å…³é—­çš„å‰æä¸‹é¦–å…ˆä¸¢æ‰ç¼“å­˜åœ¨é˜Ÿåˆ—ä¸­çš„æœ€æ—©çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•è¿è¡Œè¯¥ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥éœ€è¦é€‚å½“å°å¿ƒã€‚    è®¾æƒ³:å¦‚æœå…¶ä»–çº¿ç¨‹éƒ½è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆæ–°æ¥ä»»åŠ¡è¸¢æ‰æ—§ä»»åŠ¡ï¼Œç¼“å­˜åœ¨queueä¸­ï¼Œå†æ¥ä¸€ä¸ªä»»åŠ¡åˆä¼šè¸¢æ‰queueä¸­æœ€è€ä»»åŠ¡ã€‚</code></pre><h4 id="è‡ªå®šä¹‰çº¿ç¨‹æ± åç§°"><a href="#è‡ªå®šä¹‰çº¿ç¨‹æ± åç§°" class="headerlink" title="è‡ªå®šä¹‰çº¿ç¨‹æ± åç§°"></a>è‡ªå®šä¹‰çº¿ç¨‹æ± åç§°</h4><pre><code class="textmate">ThreadFactory springThreadFactory = new CustomizableThreadFactory(&quot;xxx-pool-&quot;);</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><pre><code class="textmate">æ€»ç»“ï¼škeepAliveTimeå’ŒmaximumPoolSizeåŠBlockingQueueçš„ç±»å‹å‡æœ‰å…³ç³»ã€‚å¦‚æœBlockingQueueæ˜¯æ— ç•Œçš„ï¼Œé‚£ä¹ˆæ°¸è¿œä¸ä¼šè§¦å‘maximumPoolSizeï¼Œè‡ªç„¶keepAliveTimeä¹Ÿå°±æ²¡æœ‰äº†æ„ä¹‰ã€‚åä¹‹ï¼Œå¦‚æœæ ¸å¿ƒæ•°è¾ƒå°ï¼Œæœ‰ç•ŒBlockingQueueæ•°å€¼åˆè¾ƒå°ï¼ŒåŒæ—¶keepAliveTimeåˆè®¾çš„å¾ˆå°ï¼Œå¦‚æœä»»åŠ¡é¢‘ç¹ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šé¢‘ç¹çš„ç”³è¯·å›æ”¶çº¿ç¨‹</code></pre><h4 id="é…ç½®è®¡ç®—å…¬å¼"><a href="#é…ç½®è®¡ç®—å…¬å¼" class="headerlink" title="é…ç½®è®¡ç®—å…¬å¼"></a>é…ç½®è®¡ç®—å…¬å¼</h4><pre><code class="textmate">ä¸ºäº†ä½¿CPUè¾¾åˆ°æœŸæœ›ä½¿ç”¨ç‡ï¼Œçº¿ç¨‹æ± çš„æœ€ä¼˜å¤§å°ä¸ºçº¿ç¨‹ä¸ªæ•° = cpuä¸ªæ•° * cpuåˆ©ç”¨ç‡ * ï¼ˆ1+ IOå¤„ç†æ—¶é—´ / CPUå¤„ç†æ—¶é—´)</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> çº¿ç¨‹æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çº¿ç¨‹æ±  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBooté›†æˆKafka</title>
      <link href="/2021/02/03/backend/mq/kafka/"/>
      <url>/2021/02/03/backend/mq/kafka/</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€å•æ¡ˆä¾‹"><a href="#ç®€å•æ¡ˆä¾‹" class="headerlink" title="ç®€å•æ¡ˆä¾‹"></a>ç®€å•æ¡ˆä¾‹</h3><h4 id="å¼•ç”¨åŒ…"><a href="#å¼•ç”¨åŒ…" class="headerlink" title="å¼•ç”¨åŒ…"></a>å¼•ç”¨åŒ…</h4><pre><code class="xml">&lt;!-- è®¾ç½®äº†ç‰ˆæœ¬å·ï¼Œæœ‰å¯èƒ½ä¼šæŠ¥é”™ClassNotFound --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><pre><code class="yaml">spring:  kafka:  topic: testTopic  bootstrap-servers: 127.0.0.1:9092  producer:    retries: 0    batch-size: 50    buffer-memory: 6554432    key-serializer: org.apache.kafka.common.serialization.StringSerializer    value-serializer: org.apache.kafka.common.serialization.StringSerializer    properties:      max:        request:          size: 5242880      linger.ms: 1</code></pre><h4 id="å‘é€æ¶ˆæ¯"><a href="#å‘é€æ¶ˆæ¯" class="headerlink" title="å‘é€æ¶ˆæ¯"></a>å‘é€æ¶ˆæ¯</h4><pre><code class="java">@Slf4j@Componentpublic class MessageService&#123;        @Autowired    private KafkaTemplate kafkaTemplate;    @Value(&quot;$&#123;spring.kafka.topic&#125;&quot;)    private String topics;        public void sendSyncMessage(String resourceName)&#123;        try&#123;            kafkaTemplate.send(topics,resourceName);        &#125; catch (Exception e) &#123;            log.error(&quot;message send failed, error=&#123;&#125;&quot;, e);        &#125;    &#125;&#125;</code></pre><h4 id="ç›‘å¬æ¶ˆæ¯"><a href="#ç›‘å¬æ¶ˆæ¯" class="headerlink" title="ç›‘å¬æ¶ˆæ¯"></a>ç›‘å¬æ¶ˆæ¯</h4><pre><code class="java">@Slf4j@Componentpublic class MessageListener &#123;    @KafkaListener(topics = &#123;&quot;testTopic&quot;&#125;, groupId = &quot;testGroupId&quot;)    public void annul1(ConsumerRecord&lt;String, String&gt; record) &#123;        log.info(&quot;groupId = myContainer2, message = &quot; + record.toString());    &#125;&#125;</code></pre><h3 id="åŒkafkaæ¡ˆä¾‹"><a href="#åŒkafkaæ¡ˆä¾‹" class="headerlink" title="åŒkafkaæ¡ˆä¾‹"></a>åŒkafkaæ¡ˆä¾‹</h3><ul><li><a href="https://www.byteblogs.com/article/434">SpringBootå¤škafkaé…ç½®</a><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><pre><code class="yaml">spring:kafka:  kafka1:    bootstrap-servers: 127.0.0.1:9092    producer:      retries: 0      batch-size: 50      buffer-memory: 6554432      key-serializer: org.apache.kafka.common.serialization.StringSerializer      value-serializer: org.apache.kafka.common.serialization.StringSerializer      properties:        max:          request:            size: 5242880        linger.ms: 1  kafka2:    bootstrap-servers: 127.0.0.1:9092    producer:      retries: 0      batch-size: 50      buffer-memory: 6554432      key-serializer: org.apache.kafka.common.serialization.StringSerializer      value-serializer: org.apache.kafka.common.serialization.StringSerializer      properties:        max:          request:            size: 5242880        linger.ms: 1</code></pre></li></ul><h4 id="ä»£ç é…ç½®"><a href="#ä»£ç é…ç½®" class="headerlink" title="ä»£ç é…ç½®"></a>ä»£ç é…ç½®</h4><ul><li><p>å®ä¾‹1é…ç½®</p><pre><code class="java">@Configuration@EnableKafkapublic class Kafka1Config &#123;  @Bean(&quot;kafka1ExtListenerKafkaProperties&quot;)  @Primary  @ConfigurationProperties(prefix = &quot;spring.kafka.kafka1&quot;)  public KafkaProperties kafka1ExtListenerKafkaProperties() &#123;      return new KafkaProperties();  &#125;  @Bean(&quot;kafka1ListenerContainerFactory&quot;)  @Primary  KafkaListenerContainerFactory&lt;ConcurrentMessageListenerContainer&lt;Integer, String&gt;&gt; kafkaListenerContainerFactory() &#123;      ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();      factory.setConsumerFactory(consumerFactory());      factory.setConcurrency(3);      factory.getContainerProperties().setPollTimeout(3000);      return factory;  &#125;  private ConsumerFactory&lt;Integer, String&gt; consumerFactory() &#123;      return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());  &#125;  private Map&lt;String, Object&gt; consumerConfigs() &#123;      return kafka1ExtListenerKafkaProperties().buildConsumerProperties();  &#125;  @Bean(&quot;kafkaTemplate&quot;)  @Primary  public KafkaTemplate&lt;String, String&gt; kafkaTemplate() &#123;      return new KafkaTemplate&lt;&gt;(producerFactory());  &#125;  private ProducerFactory&lt;String, String&gt; producerFactory() &#123;      DefaultKafkaProducerFactory&lt;String, String&gt; producerFactory = new DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());      return producerFactory;  &#125;  private Map&lt;String, Object&gt; producerConfigs() &#123;      return kafka1ExtListenerKafkaProperties().buildProducerProperties();  &#125;&#125;</code></pre></li><li><p>å®ä¾‹2é…ç½®</p><pre><code class="java">@Configuration@EnableKafkapublic class Kafka2Config &#123;  @Bean(&quot;kafka2ListenerKafkaProperties&quot;)  @ConfigurationProperties(prefix = &quot;spring.kafka.kafka2&quot;)  public KafkaProperties kafka2ListenerKafkaProperties() &#123;      return new KafkaProperties();  &#125;  @Bean(&quot;kafka2ListenerContainerFactory&quot;)  public KafkaListenerContainerFactory&lt;ConcurrentMessageListenerContainer&lt;Integer, String&gt;&gt; kafka2ListenerContainerFactory() &#123;      ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();      factory.setConsumerFactory(consumerFactory());      factory.setConcurrency(3);      factory.getContainerProperties().setPollTimeout(3000);      return factory;  &#125;  /**   * æ¶ˆè´¹è€…å·¥å‚çš„bean   *   * @return   */  private ConsumerFactory&lt;Integer, String&gt; consumerFactory() &#123;      return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());  &#125;  private Map&lt;String, Object&gt; consumerConfigs() &#123;      return kafka2ListenerKafkaProperties().buildConsumerProperties();  &#125;  @Bean(&quot;kafka2Template&quot;)  public KafkaTemplate&lt;String, String&gt; kafka2Template() &#123;      return new KafkaTemplate&lt;&gt;(producerFactory());  &#125;  private ProducerFactory&lt;String, String&gt; producerFactory() &#123;      DefaultKafkaProducerFactory&lt;String, String&gt; producerFactory = new DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());      return producerFactory;  &#125;  private Map&lt;String, Object&gt; producerConfigs() &#123;      return kafka2ListenerKafkaProperties().buildProducerProperties();  &#125;&#125;</code></pre></li></ul><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><pre><code class="java">@Slf4j@Servicepublic class MessageSendService&#123;    @Resource(name = &quot;kafkaTemplate&quot;)    private KafkaTemplate&lt;String, Object&gt; kafkaTemplate;    @Resource(name = &quot;kafkaTemplateForMonitor&quot;)    private KafkaTemplate&lt;String, Object&gt; kafkaTemplateForMonitor;    public boolean kafka1Send(String topic, String message) &#123;        try &#123;            if (kafkaMq) &#123;                kafkaTemplate.send(topic, message);            &#125;        &#125; catch (Exception e) &#123;            log.warn(&quot;kafka1 å‘é€kafkaæ¶ˆæ¯å¤±è´¥ topic=&#123;&#125;,error=&#123;&#125;&quot;,topic,e);        &#125;        return true;    &#125;        public boolean kafka2Send(String topic, String message)&#123;        try &#123;            kafkaTemplateForMonitor.send(topic, message);        &#125; catch (Exception e) &#123;            log.warn(&quot;kafka2 å‘é€kafkaæ¶ˆæ¯å¤±è´¥ topic=&#123;&#125;,error=&#123;&#125;&quot;,topic,e);        &#125;        return true;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> message </tag>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQç›¸å…³æ–‡æ¡£</title>
      <link href="/2021/02/03/backend/mq/rocketmq/"/>
      <url>/2021/02/03/backend/mq/rocketmq/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ä¸“ä¸šæœ¯è¯­"><a href="#ä¸€ã€ä¸“ä¸šæœ¯è¯­" class="headerlink" title="ä¸€ã€ä¸“ä¸šæœ¯è¯­"></a>ä¸€ã€ä¸“ä¸šæœ¯è¯­</h2><h3 id="1-è§’è‰²åç§°"><a href="#1-è§’è‰²åç§°" class="headerlink" title="1. è§’è‰²åç§°"></a>1. è§’è‰²åç§°</h3><pre><code class="textmate">- Product    æ¶ˆæ¯ç”Ÿäº§è€…- Consumer    æ¶ˆæ¯æ¶ˆè´¹è€…- Push Consumer    æ¶ˆæ¯æ¶ˆè´¹-æ¨æ¨¡å¼ï¼Œåº”ç”¨é€šå¸¸å‘ Consumer å¯¹è±¡æ³¨å†Œä¸€ä¸ªListeneræ¥å£ï¼Œä¸€æ—¦æ”¶åˆ°æ¶ˆæ¯ï¼ŒConsumerå¯¹è±¡ç«‹åˆ»å›è°ƒListeneræ¥å£æ–¹æ³•ã€‚- Pull Consumer    æ¶ˆæ¯æ¶ˆè´¹-æ‹‰æ¨¡å¼ï¼Œåº”ç”¨é€šå¸¸ä¸»åŠ¨è°ƒç”¨ Consumer çš„æ‹‰æ¶ˆæ¯æ–¹æ³•ä» Broker æ‹‰æ¶ˆæ¯ï¼Œä¸»åŠ¨æƒç”±åº”ç”¨æ§åˆ¶ã€‚- ProducerGroup    ä¸€ç±» Producer çš„é›†åˆåç§°ï¼Œè¿™ç±» Producer é€šå¸¸å‘é€ä¸€ç±»æ¶ˆæ¯ï¼Œä¸”å‘é€é€»è¾‘ä¸€è‡´ã€‚- ConsumerGroup    ä¸€ç±» Consumer çš„é›†åˆåç§°ï¼Œè¿™ç±» Consumer é€šå¸¸æ¶ˆè´¹ä¸€ç±»æ¶ˆæ¯ï¼Œä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚- Broker    æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ï¼Œè½¬å‘æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¹Ÿç§°ä¸º Serverã€‚åœ¨ JMS è§„èŒƒä¸­ç§°ä¸º Providerã€‚- Message Queue    æ¶ˆæ¯å­˜å‚¨é˜Ÿåˆ—ï¼Œé•¿åº¦æ— çº¿(offsetä½œä¸ºæ•°æ®ä¸‹æ ‡ï¼Œlongç±»å‹64ä½ï¼Œç†è®ºä¸Šåœ¨ 100 å¹´å†…ä¸ä¼šæº¢å‡ºï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯é•¿åº¦æ— é™)</code></pre><h3 id="2-æ¶ˆè´¹æ¨¡å¼"><a href="#2-æ¶ˆè´¹æ¨¡å¼" class="headerlink" title="2. æ¶ˆè´¹æ¨¡å¼"></a>2. æ¶ˆè´¹æ¨¡å¼</h3><pre><code class="textmate">- å¹¿æ’­æ¶ˆè´¹    ä¸€æ¡æ¶ˆæ¯è¢«å¤šä¸ª Consumer æ¶ˆè´¹ï¼Œæ¯ä¸ªConsumeréƒ½ä¼šè‡³å°‘æ¶ˆè´¹ä¸€æ¬¡æ¶ˆæ¯ï¼Œå¹¿æ’­æ¶ˆè´¹ä¸­çš„ Consumer Group æ¦‚å¿µå¯ä»¥è®¤ä¸ºåœ¨æ¶ˆæ¯åˆ’åˆ†æ–¹é¢æ— æ„ä¹‰ã€‚    åœ¨ CORBA Notification è§„èŒƒä¸­ï¼Œæ¶ˆè´¹æ–¹å¼éƒ½å±äºå¹¿æ’­æ¶ˆè´¹ã€‚åœ¨ JMS è§„èŒƒä¸­ï¼Œç›¸å½“äºJMS publish/subscribe model- é›†ç¾¤æ¶ˆè´¹    ä¸€ä¸ª Consumer Group ä¸­çš„ Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆè´¹æ¶ˆæ¯ã€‚- é¡ºåºæ¶ˆè´¹    æ¶ˆè´¹æ¶ˆæ¯çš„é¡ºåºè¦åŒå‘é€æ¶ˆæ¯çš„é¡ºåºä¸€è‡´(å±€éƒ¨é¡ºåº)ï¼Œä¸€ç±»æ¶ˆæ¯ä¸ºæ»¡è¶³é¡ºåºæ€§ï¼Œå¿…é¡»Producerå•çº¿ç¨‹é¡ºåºå‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œ    è¿™æ · Consumer å°±å¯ä»¥æŒ‰ç…§ Producer å‘é€ çš„é¡ºåºå»æ¶ˆè´¹æ¶ˆæ¯ã€‚- æ™®é€šé¡ºåºæ¶ˆæ¯    é¡ºåºæ¶ˆæ¯çš„ä¸€ç§ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥ä¿è¯å®Œå…¨çš„é¡ºåºæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿé€šä¿¡å¼‚å¸¸ï¼ŒBroker é‡å¯ï¼Œç”±äºé˜Ÿåˆ— æ€»æ•°å‘ç”Ÿå‘åŒ–ï¼Œå“ˆå¸Œå–æ¨¡åå®šä½çš„é˜Ÿåˆ—ä¼šå‘åŒ–ï¼Œäº§ç”ŸçŸ­æš‚çš„æ¶ˆæ¯é¡ºåºä¸ä¸€è‡´ã€‚- ä¸¥æ ¼é¡ºåºæ¶ˆæ¯    é¡ºåºæ¶ˆæ¯çš„ä¸€ç§ï¼Œæ— è®ºæ­£å¸¸å¼‚å¸¸æƒ…å†µéƒ½èƒ½ä¿è¯é¡ºåºï¼Œä½†æ˜¯ç‰ºç‰²äº†åˆ†å¸ƒå¼ Failover(æ•…éšœè½¬ç§») ç‰¹æ€§ï¼Œå³ Broker é›†ç¾¤ä¸­åª è¦æœ‰ä¸€å°æœºå™¨ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¸å¯ç”¨ï¼ŒæœåŠ¡å¯ç”¨æ€§å¤§å¤§é™ä½ã€‚ å¦‚æœæœåŠ¡å™¨éƒ¨ç½²ä¸ºåŒæ­¥åŒå†™æ¨¡å¼ï¼Œæ­¤ç¼ºé™·å¯é€šè¿‡å¤‡æœºè‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»é¿å…ï¼Œä¸è¿‡ä»ç„¶ä¼šå­˜åœ¨å‡ åˆ†é’Ÿçš„æœåŠ¡ä¸å¯ç”¨ã€‚    ç›®å‰å·²çŸ¥çš„åº”ç”¨åªæœ‰æ•°æ®åº“ binlog åŒæ­¥å¼ºä¾èµ–ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼Œå…¶ä»–åº”ç”¨ç»å¤§éƒ¨åˆ†éƒ½å¯ä»¥å®¹å¿çŸ­æš‚ä¹±åºï¼Œæ¨    èä½¿ç”¨æ™®é€šçš„é¡ºåºæ¶ˆæ¯ã€‚</code></pre><h2 id="äºŒã€éƒ¨ç½²"><a href="#äºŒã€éƒ¨ç½²" class="headerlink" title="äºŒã€éƒ¨ç½²"></a>äºŒã€éƒ¨ç½²</h2><ul><li>é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å®æ—¶ã€åˆ†å¸ƒå¼ç‰¹ç‚¹</li><li>Producerã€Consumerã€é˜Ÿåˆ—éƒ½å¯ä»¥åˆ†å¸ƒå¼</li><li>èƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº</li><li>æä¾›æ¶ˆæ¯æ¨æ‹‰æ¶ˆæ¯æ¨¡å¼</li><li>äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ›</li><li>è¾ƒå°‘ä¾èµ–</li></ul><h3 id="1-ç‰©ç†éƒ¨ç½²ç»“æ„"><a href="#1-ç‰©ç†éƒ¨ç½²ç»“æ„" class="headerlink" title="1.ç‰©ç†éƒ¨ç½²ç»“æ„"></a>1.ç‰©ç†éƒ¨ç½²ç»“æ„</h3><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/rocketmq-deploy.jpg" alt="ç‰©ç†éƒ¨ç½²ç»“æ„å›¾"/><pre><code class="textmate">1.NameServer     æ— çŠ¶æ€èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— é€šä¿¡2.Broker    åˆ†ä¸ºMasterå’ŒSlave,ä¸€ä¸ªmasterå¯ä»¥å¯¹åº”å¤šä¸ªslaveï¼Œä½†æ˜¯ä¸€ä¸ªslaveåªèƒ½å¯¹åº”ä¸€ä¸ªmaster; masterå’Œslaveçš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„BrokerNameä¸åŒçš„BrokerIdæ¥å®šä¹‰ï¼ŒBorkerIdä¸º0æ ‡è¯†master,é0æ ‡è¯†slaveã€‚masterå¯ä»¥éƒ¨ç½²å¤šä¸ªã€‚    æ¯ä¸ªBrokerå’ŒNameServeré›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†ŒTopicä¿¡æ¯åˆ°æ‰€æœ‰çš„NameServerä¸­3.Producer    Producerä¸NameServeré›†ç¾¤ä¸­å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹(éšæœºé€‰æ‹©)å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸæ‹‰å–Topicè·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾›TopicæœåŠ¡çš„Masterå»ºç«‹é•¿è¿æ¥ï¼Œå¹¶å®šæ—¶å‘é€å¿ƒè·³ã€‚Producerå®Œå…¨æ— çŠ¶æ€ï¼Œå¯é›†ç¾¤éƒ¨ç½²4.Consumer    Consumerä¸NameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸè·å–Topicè·¯ç”±ï¼Œå¹¶å‘æä¾›TopicæœåŠ¡çš„Masterã€Slaveå»ºç«‹é•¿è¿æ¥ï¼Œå¹¶å®šæ—¶å‘é€å¿ƒè·³ã€‚Consumerè®¢é˜…è§„åˆ™ç”±Brokeré…ç½®å†³å®šï¼Œæ—¢å¯ä»¥ä»Masterè®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä»Salveæ¶ˆæ¯</code></pre><h3 id="2-é€»è¾‘éƒ¨ç½²ç»“æ„"><a href="#2-é€»è¾‘éƒ¨ç½²ç»“æ„" class="headerlink" title="2.é€»è¾‘éƒ¨ç½²ç»“æ„"></a>2.é€»è¾‘éƒ¨ç½²ç»“æ„</h3><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/rocketmq-logic-deploy.png" alt="é€»è¾‘éƒ¨ç½²ç»“æ„å›¾"/><h2 id="ä¸‰ã€å­˜å‚¨ç‰¹ç‚¹"><a href="#ä¸‰ã€å­˜å‚¨ç‰¹ç‚¹" class="headerlink" title="ä¸‰ã€å­˜å‚¨ç‰¹ç‚¹"></a>ä¸‰ã€å­˜å‚¨ç‰¹ç‚¹</h2><h3 id="1-é›¶æ‹·è´åŸç†"><a href="#1-é›¶æ‹·è´åŸç†" class="headerlink" title="1.é›¶æ‹·è´åŸç†"></a>1.é›¶æ‹·è´åŸç†</h3><blockquote><p>Consumeræ¶ˆè´¹æ¶ˆæ¯è¿‡ç¨‹ä¸­ä½¿ç”¨äº†é›¶æ‹·è´</p></blockquote><ul><li><a href="https://www.linuxjournal.com/article/6345">é›¶æ‹·è´ç›¸å…³é“¾æ¥</a></li><li>é›¶æ‹·è´æ–¹å¼</li></ul><pre><code class="textmate">1.mmap+writeæ–¹å¼(mmapå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„è¿›å†…å­˜)    ä¼˜ç‚¹ï¼šä½¿ç”¨å°å—æ–‡ä»¶ä¼ è¾“ï¼Œæ•ˆç‡é«˜ï¼Œæ”¯æŒé¢‘ç¹è°ƒç”¨    ç¼ºç‚¹ï¼šä¸èƒ½å¾ˆå¥½çš„åˆ©ç”¨DMAæ–¹å¼(Direct Memory Accessï¼Œç›´æ¥å­˜å‚¨å™¨è®¿é—®),ä¼šæ¯”sendfileå¤šæ¶ˆè€—CPU,å†…å­˜å®‰å…¨æ€§æ§åˆ¶å¤æ‚ï¼Œéœ€è¦é¿å…JVM Crashæ–‡ä»¶2.ä½¿ç”¨sendfileæ–¹å¼    ä¼˜ç‚¹ï¼šå¯ä»¥åˆ©ç”¨DMAæ–¹å¼ï¼Œæ¶ˆè€—CPUè¾ƒå°‘ï¼Œå¤§å—æ–‡ä»¶ä¼ è¾“æ•ˆç‡é«˜ï¼Œæ— å†…å­˜å®‰å…¨é—®é¢˜    ç¼ºç‚¹ï¼šå°å—æ–‡ä»¶æ•ˆç‡ä½äºmmapæ–¹å¼ï¼Œåªèƒ½BIOæ–¹å¼ä¼ é€’ï¼Œä¸èƒ½ä½¿ç”¨NIOã€‚RocketMQé€‰æ‹©äº†mmap+writeæ–¹å¼ï¼Œå› ä¸ºç°æœ‰å°å—æ•°æ®ä¼ è¾“éœ€æ±‚ï¼Œæ•ˆæœæ¯”sendfileæ›´å¥½</code></pre><h3 id="2-æ–‡ä»¶ç³»ç»Ÿ"><a href="#2-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="2.æ–‡ä»¶ç³»ç»Ÿ"></a>2.æ–‡ä»¶ç³»ç»Ÿ</h3><pre><code class="textmate">RocketMQ é€‰æ‹© Linux Ext4 æ–‡ä»¶ç³»ç»ŸåŸå› ï¼š    Ext4 æ–‡ä»¶ç³»ç»Ÿåˆ é™¤ 1G å¤§å°çš„æ–‡ä»¶é€šå¸¸è€—æ—¶å°äº50msï¼Œè€Œ Ext3 æ–‡ä»¶ç³»ç»Ÿè€—æ—¶çº¦ 1s å·¦å³ï¼Œä¸”åˆ é™¤æ–‡ä»¶æ—¶ï¼Œç£ç›˜ IO å‹åŠ›æå¤§ï¼Œä¼šå¯¼è‡´IOå†™å…¥è¶…æ—¶ã€‚  æ–‡ä»¶ç³»ç»Ÿå±‚é¢éœ€è¦åšä»¥ä¸‹è°ƒä¼˜æªæ–½    æ–‡ä»¶ç³»ç»Ÿ IO è°ƒåº¦ç®—æ³•éœ€è¦è°ƒæ•´ä¸º deadlineï¼Œå› ä¸º deadline ç®—æ³•åœ¨éšæœºè¯»æƒ…å†´ä¸‹ï¼Œå¯ä»¥åˆå¹¶è¯»è¯·æ±‚ä¸ºé¡ºåºè·³è·ƒæ–¹å¼ï¼Œä»è€Œæé«˜è¯» IO ååé‡ã€‚</code></pre><h3 id="3-æ•°æ®å­˜å‚¨ç»“æ„-amp-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#3-æ•°æ®å­˜å‚¨ç»“æ„-amp-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="3.æ•°æ®å­˜å‚¨ç»“æ„&amp;å­˜å‚¨ç›®å½•ç»“æ„"></a>3.æ•°æ®å­˜å‚¨ç»“æ„&amp;å­˜å‚¨ç›®å½•ç»“æ„</h3><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/rocketmq-data.jpg" alt="æ•°æ®å­˜å‚¨ç»“æ„" width="600px" height="400px"/><img src="https://raw.githubusercontent.com/im-fan/fan-pic/release/images/rocketmq-file.png" alt="å­˜å‚¨ç›®å½•ç»“æ„" width="600px" height="400px" /><h2 id="å››ã€å…³é”®ç‰¹æ€§"><a href="#å››ã€å…³é”®ç‰¹æ€§" class="headerlink" title="å››ã€å…³é”®ç‰¹æ€§"></a>å››ã€å…³é”®ç‰¹æ€§</h2><h3 id="1-å•æœºæ”¯æŒ1ä¸‡ä»¥ä¸ŠæŒä¹…åŒ–é˜Ÿåˆ—"><a href="#1-å•æœºæ”¯æŒ1ä¸‡ä»¥ä¸ŠæŒä¹…åŒ–é˜Ÿåˆ—" class="headerlink" title="1.å•æœºæ”¯æŒ1ä¸‡ä»¥ä¸ŠæŒä¹…åŒ–é˜Ÿåˆ—"></a>1.å•æœºæ”¯æŒ1ä¸‡ä»¥ä¸ŠæŒä¹…åŒ–é˜Ÿåˆ—</h3><pre><code class="textmate">|       8Byte     | 4Byte |        8Byte        || CommitLogOffset | Size  | Message Tag Hashcode|1.æ‰€æœ‰æ•°æ®å•ç‹¬å­˜å‚¨åˆ°CommitLogæ–‡ä»¶ä¸­ï¼Œå®Œå…¨é¡ºåºå†™ï¼Œéšæœºè¯»2.å¯¹æœ€ç»ˆç”¨æˆ·å±•ç°çš„é˜Ÿåˆ—å®é™…åªå­˜å‚¨æ¶ˆæ¯åœ¨CommitLogçš„ä½ç½®ä¿¡æ¯ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼åˆ·ç›˜</code></pre><h3 id="2-åˆ·ç›˜ç­–ç•¥"><a href="#2-åˆ·ç›˜ç­–ç•¥" class="headerlink" title="2.åˆ·ç›˜ç­–ç•¥"></a>2.åˆ·ç›˜ç­–ç•¥</h3><pre><code class="textmate">å…ˆå†™å…¥ç³»ç»ŸpageCache ç„¶ååˆ·ç›˜ï¼Œä¿è¯å†…å­˜ä¸ç£ç›˜éƒ½æœ‰ä¸€ä»½æ•°æ®ï¼Œè®¿é—®æ—¶ä»å†…å­˜ä¸­è¯»å–- åŒæ­¥åˆ·ç›˜    1. å†™å…¥ PAGECACHE åï¼Œçº¿ç¨‹ç­‰å¾…ï¼Œé€šçŸ¥åˆ·ç›˜çº¿ç¨‹åˆ·ç›˜ã€‚     2. åˆ·ç›˜çº¿ç¨‹åˆ·ç›˜åï¼Œå”¤é†’å‰ç«¯ç­‰å¾…çº¿ç¨‹ï¼Œå¯èƒ½æ˜¯ä¸€æ‰¹çº¿ç¨‹ã€‚     3. å‰ç«¯ç­‰å¾…çº¿ç¨‹åç”¨æˆ·è¿’å›æˆåŠŸã€‚- å¼‚æ­¥åˆ·ç›˜åŒæ­¥åˆ·ç›˜ä¸å¼‚æ­¥åˆ·ç›˜çš„å”¯ä¸€åŒºåˆ«æ˜¯å¼‚æ­¥åˆ·ç›˜å†™å®Œ PAGECACHE ç›´æ¥è¿”å›ï¼Œè€ŒåŒæ­¥åˆ·ç›˜éœ€è¦ç­‰å¾…åˆ·ç›˜å®Œæˆæ‰è¿”å›</code></pre><h3 id="3-æ¶ˆæ¯æŸ¥è¯¢"><a href="#3-æ¶ˆæ¯æŸ¥è¯¢" class="headerlink" title="3.æ¶ˆæ¯æŸ¥è¯¢"></a>3.æ¶ˆæ¯æŸ¥è¯¢</h3><pre><code class="textmate">- æŒ‰ç…§MessageIdæŸ¥è¯¢æ¶ˆæ¯    | 8Byte | 8Byte |    |æ¶ˆæ¯æ‰€å±Brokeråœ°å€|CommitLogOffset|- æŒ‰ç…§MessageKeyæŸ¥è¯¢æ¶ˆæ¯    |4Byte|8Byte|4Byte|4Byte|    |keyHash|CommitLogOffset|Timestamp|NextIndexOffset|</code></pre><h2 id="äº”ã€æ¶ˆæ¯è¿‡æ»¤"><a href="#äº”ã€æ¶ˆæ¯è¿‡æ»¤" class="headerlink" title="äº”ã€æ¶ˆæ¯è¿‡æ»¤"></a>äº”ã€æ¶ˆæ¯è¿‡æ»¤</h2><h3 id="1-ç®€å•æ¶ˆæ¯è¿‡æ»¤"><a href="#1-ç®€å•æ¶ˆæ¯è¿‡æ»¤" class="headerlink" title="1.ç®€å•æ¶ˆæ¯è¿‡æ»¤"></a>1.ç®€å•æ¶ˆæ¯è¿‡æ»¤</h3><pre><code class="textmate">é€šè¿‡topicå’Œ tagsè¿›è¡Œè¿‡æ»¤consumer.subscribe(&quot;TopicTest1&quot;,&quot;TagA || TagB&quot;);</code></pre><h3 id="2-é«˜çº§è¿‡æ»¤æ–¹å¼"><a href="#2-é«˜çº§è¿‡æ»¤æ–¹å¼" class="headerlink" title="2.é«˜çº§è¿‡æ»¤æ–¹å¼"></a>2.é«˜çº§è¿‡æ»¤æ–¹å¼</h3><pre><code class="textmate">RocketMQ æä¾›äº†åŸºäºè¡¨è¾¾å¼ä¸åŸºäºç±»æ¨¡å¼ä¸¤ç§è¿‡æ»¤æ¨¡å¼å¯ä»¥å®ç° MessageFilter æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰è¿‡æ»¤</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> message </tag>
            
            <tag> rocketmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså­¦ä¹ ç¬”è®°</title>
      <link href="/2021/02/02/backend/storage/redis/"/>
      <url>/2021/02/02/backend/storage/redis/</url>
      
        <content type="html"><![CDATA[<h3 id="Redisç›¸å…³"><a href="#Redisç›¸å…³" class="headerlink" title="Redisç›¸å…³"></a>Redisç›¸å…³</h3><h4 id="RedisTemplateé…ç½®"><a href="#RedisTemplateé…ç½®" class="headerlink" title="RedisTemplateé…ç½®"></a>RedisTemplateé…ç½®</h4><pre><code class="java">@Configuration@EnableCachingpublic class RedisConfig extends CachingConfigurerSupport &#123;    @Bean    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory)&#123;        RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;();        template.setConnectionFactory(connectionFactory);        //keyçš„åºåˆ—åŒ–æ–¹å¼        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();        // stringçš„keyåºåˆ—åŒ–æ–¹å¼        template.setKeySerializer(stringRedisSerializer);        // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼        template.setHashKeySerializer(stringRedisSerializer);        //valueçš„åºåˆ—åŒ–æ–¹å¼        FastJson2JsonRedisSerializer serializer = new FastJson2JsonRedisSerializer(Object.class);        ObjectMapper om = new ObjectMapper();        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);        om.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);        om.registerModule(new JavaTimeModule());        serializer.setObjectMapper(om);        //stringçš„valueåºåˆ—åŒ–æ–¹å¼        template.setValueSerializer(serializer);        // hashçš„valueåºåˆ—åŒ–æ–¹å¼        template.setHashValueSerializer(stringRedisSerializer);                template.afterPropertiesSet();        return template;    &#125;&#125;</code></pre><h3 id="RedisTemplate-k-våºåˆ—åŒ–å·®å¼‚"><a href="#RedisTemplate-k-våºåˆ—åŒ–å·®å¼‚" class="headerlink" title="RedisTemplate k-våºåˆ—åŒ–å·®å¼‚"></a>RedisTemplate k-våºåˆ—åŒ–å·®å¼‚</h3><img src="https://im-fan.gitee.io/img/cache/redisTemplate-serialize.png"/><h3 id="RedisTemplate-æ“ä½œhash"><a href="#RedisTemplate-æ“ä½œhash" class="headerlink" title="RedisTemplate æ“ä½œhash"></a>RedisTemplate æ“ä½œhash</h3><pre><code class="java">//redisä¸­çš„hashç›¸å½“äºjavaä¸­çš„HashMapString key = &quot;key&quot;;Map&lt;String,String&gt; hashMap = new HashMap&lt;&gt;();hashMap.put(&quot;a&quot;,JSON.toJSONString(new Object()));hashMap.put(&quot;b&quot;,JSON.toJSONString(new Object()));//æ‰€æœ‰å€¼redisTemplate.opsForHash().putAll(key,hashMap);//è·å–å•ä¸ªå€¼List&lt;String&gt; hashKey = new ArrayList&lt;&gt;();hashKey.add(&quot;a&quot;); // è·å–hashä¸­çš„æŸä¸ªkeyä¸‹çš„å€¼redisTemplate.opsForHash().multiGet(key,hashKey);//è®¾ç½®å•ä¸ªå€¼String hk = &quot;hash çš„key&quot;;String hv = &quot;hash çš„value&quot;;redisTemplate.opsForHash().put(key,hk,hv);//åˆ é™¤keyString[] hkeys = &#123;hk&#125;;redisTemplate.opsForHash().delete(key, hkeys);</code></pre><h3 id="RedisåŸå­æ“ä½œçš„ä¸¤ç§æ–¹å¼"><a href="#RedisåŸå­æ“ä½œçš„ä¸¤ç§æ–¹å¼" class="headerlink" title="RedisåŸå­æ“ä½œçš„ä¸¤ç§æ–¹å¼"></a>RedisåŸå­æ“ä½œçš„ä¸¤ç§æ–¹å¼</h3><h4 id="Luaè„šæœ¬"><a href="#Luaè„šæœ¬" class="headerlink" title="Luaè„šæœ¬"></a>Luaè„šæœ¬</h4><pre><code class="shell">-- luaè¯­æ³• https://www.runoob.com/lua/lua-tutorial.html-- å®ç°ä¸€ä¸ªåŸå­é”,å­˜åœ¨keyåˆ™è¿”å›å¤±è´¥,å¦åˆ™è¿”å›å­˜å‚¨å¹¶è¿”å›æˆåŠŸ-- å…³é”®å­—å¿…é¡»å¤§å†™ å‚æ•°1:value å‚æ•°2:æœ‰æ•ˆæ—¶é•¿-- call ä¸ pcallåŒºåˆ«  callæ‰§è¡Œé”™è¯¯å°±ç›´æ¥è¿”å›,pcallé”™è¯¯åˆ™è¿”å›ä¸€ä¸ªå¸¦ err åŸŸçš„ Lua è¡¨(table),ç”¨äºè¡¨ç¤ºé”™è¯¯-- å­˜åœ¨åˆ™ç›´æ¥è¿”å›å¤±è´¥local val = redis.call(&quot;get&quot;,KEYS[1])-- ä¸å­˜åœ¨,åˆ™è·å–é”if val then    return 0else    redis.call(&quot;set&quot;,KEYS[1],ARGV[1])    redis.call(&#39;expire&#39;,KEYS[1],ARGV[2])    return 1end</code></pre><pre><code class="java">@Servicepublic class LuaService &#123;    @Autowired    private RedisTemplate redisTemplate;    /**     * luaæ–‡ä»¶æ‰€åœ¨è·¯å¾„     * @parm key é”®     * @param ttl è¿‡æœŸæ—¶é—´ï¼Œç§’     **/    public boolean getAtomLock(String key,long ttl)&#123;        String lockKey = &quot;my:lock:&quot; + key;        // luaè„šæœ¬æ‰€åœ¨resourceç›®å½•ä¸‹çš„ç›¸å¯¹è·¯å¾„        String luaName = &quot;lua/atom_lock.lua&quot;;        // æ‰§è¡Œ lua è„šæœ¬        DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;();        // æŒ‡å®š lua è„šæœ¬        redisScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(luaName)));        // æŒ‡å®šè¿”å›ç±»å‹        redisScript.setResultType(Long.class);        // å‚æ•°ä¸€ï¼šredisScriptï¼Œå‚æ•°äºŒï¼škeyåˆ—è¡¨ï¼Œå‚æ•°ä¸‰ï¼šargï¼ˆå¯å¤šä¸ªï¼‰        Long result = (Long) redisTemplate.execute(redisScript, Collections.singletonList(lockKey),1,ttl);        return result != null &amp;&amp; result == 1L;    &#125;&#125;</code></pre><h4 id="äº‹åŠ¡æ“ä½œ"><a href="#äº‹åŠ¡æ“ä½œ" class="headerlink" title="äº‹åŠ¡æ“ä½œ"></a>äº‹åŠ¡æ“ä½œ</h4><ul><li><p>executeæ–¹å¼</p><pre><code class="java">@Servicepublic class RedisService &#123;  @Autowired  private RedisTemplate redisTemplate;  /**   * ä¸å­˜åˆ™åœ¨è·å–é”   * @param key   * @param value å€¼   * @param expire è¿‡æœŸæ—¶é—´ï¼Œç§’   * **/  public boolean setAndExpireIfAbsent(final String key, final String value, final long expire) &#123;      boolean isSuccess = (boolean) redisTemplate.execute((RedisCallback) connection -&gt; &#123;          Object object = connection.execute(&quot;set&quot;,                  key.getBytes(),                  value.getBytes(),                  SafeEncoder.encode(&quot;NX&quot;),                  SafeEncoder.encode(&quot;EX&quot;),                  Protocol.toByteArray(expire));          return null != object;      &#125;);      return isSuccess;  &#125;&#125;</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gradleå­¦ä¹ ç¬”è®°</title>
      <link href="/2021/01/21/backend/java/build/gradle/"/>
      <url>/2021/01/21/backend/java/build/gradle/</url>
      
        <content type="html"><![CDATA[<h3 id="å…³é”®å­—è§£é‡Š"><a href="#å…³é”®å­—è§£é‡Š" class="headerlink" title="å…³é”®å­—è§£é‡Š"></a>å…³é”®å­—è§£é‡Š</h3><table><thead><tr><th>å…³é”®å­—</th><th align="center">å…³é”®å­—è§£é‡Š</th><th>å€¼</th><th align="center">å€¼è§£é‡Š</th></tr></thead><tbody><tr><td>plugins</td><td align="center"></td><td>id</td><td align="center"></td></tr><tr><td>group</td><td align="center">å®šä¹‰æ¨¡å—</td><td></td><td align="center"></td></tr><tr><td>version</td><td align="center">æ¨¡å—ç‰ˆæœ¬å·</td><td></td><td align="center"></td></tr><tr><td>sourceCompatibility</td><td align="center"></td><td></td><td align="center"></td></tr><tr><td>configurations</td><td align="center">ä¸åŒçš„ configuration ç”¨æ¥å¼•ç”¨ä¸åŒé¢†åŸŸ</br>ï¼ˆæˆ–ä¸åŒç”¨é€”ï¼‰çš„ dependencies</td><td></td><td align="center"></td></tr><tr><td>buildscript</td><td align="center">ç”¨äºå£°æ˜gradleè‡ªèº«ä¾èµ–çš„æ’ä»¶ï¼Œä¼˜å…ˆæ‰§è¡Œ</td><td>ext</td><td align="center"></td></tr><tr><td></td><td align="center"></td><td>repositories</td><td align="center"></td></tr><tr><td></td><td align="center"></td><td>dependencies</td><td align="center"></td></tr><tr><td>allprojects</td><td align="center">å¯¹æ‰€æœ‰projectçš„é…ç½®,åŒ…æ‹¬root project</td><td>repositories</td><td align="center"></td></tr><tr><td>subprojects</td><td align="center">å¯¹æ‰€æœ‰Child Projectçš„é…ç½®</td><td></td><td align="center"></td></tr><tr><td>repositories</td><td align="center">æŸ¥æ‰¾jaråŒ…é¡ºåº</td><td></td><td align="center"></td></tr><tr><td>dependencies</td><td align="center">å®šä¹‰ä¾èµ–</td><td></td><td align="center"></td></tr><tr><td>test</td><td align="center">å®šä¹‰æµ‹è¯•ä¾èµ–ä¿¡æ¯</td><td></td><td align="center"></td></tr></tbody></table><h3 id="dependenciesä¾èµ–å…³é”®å­—"><a href="#dependenciesä¾èµ–å…³é”®å­—" class="headerlink" title="dependenciesä¾èµ–å…³é”®å­—"></a>dependenciesä¾èµ–å…³é”®å­—</h3><table><thead><tr><th>3+</th><th>2.+</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td>implementation</td><td></td><td align="center">æ‰€ä¾èµ–çš„åº“ä»…å¯åœ¨å½“å‰moduleä½¿ç”¨ï¼Œç¼–è¯‘é€Ÿåº¦å¿«</td></tr><tr><td>api</td><td>compile</td><td align="center">æ‰€ä¾èµ–çš„åº“å¯åœ¨æ•´å·¥ç¨‹ä½¿ç”¨ï¼Œç¼–è¯‘é€Ÿåº¦è¾ƒimplementationæ…¢</td></tr><tr><td>provided</td><td>compileOnly</td><td align="center">ä»…åœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼Œä¸å‚ä¸æ‰“åŒ…ï¼Œä¸€èˆ¬åœ¨å‘å¸ƒno jarçš„åº“æ—¶å€™ä¼šç”¨åˆ°ï¼Œå¾ˆå°‘ç”¨</td></tr><tr><td>apk</td><td>runtimeOnly</td><td align="center">ä»…åœ¨ç”Ÿæˆapkçš„æ—¶å€™å‚ä¸æ‰“åŒ…ï¼Œç¼–è¯‘æ—¶ä¸å‚ä¸</td></tr><tr><td>testImplementation</td><td>testCompile</td><td align="center">ä»…åœ¨å•å…ƒæµ‹è¯•ä»£ç çš„ç¼–è¯‘ä»¥åŠæœ€ç»ˆæ‰“åŒ…æµ‹è¯•apkæ—¶æœ‰æ•ˆ</td></tr><tr><td>debugImplementation</td><td>debugCompile</td><td align="center">ä»…åœ¨debugæ¨¡å¼çš„ç¼–è¯‘å’Œæœ€ç»ˆçš„debug apkæ‰“åŒ…æ—¶æœ‰æ•ˆ</td></tr><tr><td>releaseImplementation</td><td>releaseCompile</td><td align="center">ä»…åœ¨Releaseæ¨¡å¼çš„ç¼–è¯‘å’Œæœ€ç»ˆçš„Release apkæ‰“åŒ…æ—¶æœ‰æ•ˆ</td></tr></tbody></table><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://blog.csdn.net/gdeer/article/details/104815986">Gradleç†è§£ï¼šconfigurationã€dependency</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> é¡¹ç›®ç¼–è¯‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®ç¼–è¯‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŠ€æœ¯æ–‡æ¡£</title>
      <link href="/2020/12/25/framework/design/uml/"/>
      <url>/2020/12/25/framework/design/uml/</url>
      
        <content type="html"><![CDATA[<h2 id="æŠ€æœ¯æ–‡æ¡£è®¾è®¡"><a href="#æŠ€æœ¯æ–‡æ¡£è®¾è®¡" class="headerlink" title="æŠ€æœ¯æ–‡æ¡£è®¾è®¡"></a>æŠ€æœ¯æ–‡æ¡£è®¾è®¡</h2><h3 id="æ–‡æ¡£æ ¼å¼"><a href="#æ–‡æ¡£æ ¼å¼" class="headerlink" title="æ–‡æ¡£æ ¼å¼"></a>æ–‡æ¡£æ ¼å¼</h3><ul><li>æ–‡æ¡£ç‰ˆæœ¬</li><li>å‚è€ƒèµ„æº<ul><li>ç›¸å…³æ–‡æ¡£åœ°å€</li><li>å…³é”®åè¯è§£é‡Š</li></ul></li><li>èƒŒæ™¯åŠç›®æ ‡</li><li>ç³»ç»Ÿè®¾è®¡<ul><li>ç³»ç»Ÿæ¶æ„å›¾(å¯é€‰)</li><li>ç»„ä»¶å…³ç³»å›¾(å¯é€‰)</li><li>ç”¨ä¾‹å›¾</li><li>æµç¨‹å›¾</li><li>æ—¶åºå›¾</li><li>çŠ¶æ€å›¾(å¯é€‰)</li><li>é¢†åŸŸå»ºæ¨¡</li><li>ERå›¾</li></ul></li></ul><h2 id="UMLå›¾ç›¸å…³"><a href="#UMLå›¾ç›¸å…³" class="headerlink" title="UMLå›¾ç›¸å…³"></a>UMLå›¾ç›¸å…³</h2><h3 id="å¸¸ç”¨å…ƒç´ "><a href="#å¸¸ç”¨å…ƒç´ " class="headerlink" title="å¸¸ç”¨å…ƒç´ "></a>å¸¸ç”¨å…ƒç´ </h3><pre><code class="textmate">1.ç±»  ç”¨ä¸‰å±‚çŸ©å½¢æ¡†è¡¨ç¤ºï¼Œç¬¬ä¸€å±‚ç±»ååŠè§£é‡Š(æ–œä½“è¡¨ç¤ºæŠ½è±¡ç±»)ã€ç¬¬äºŒå±‚å­—æ®µå’Œå±æ€§ã€ç¬¬ä¸‰å±‚æ–¹æ³•  å‰é¢çš„ç¬¦å·ï¼Œâ€˜+â€™è¡¨ç¤ºpublicï¼Œâ€˜-â€™è¡¨ç¤ºprivateï¼Œâ€˜#â€™è¡¨ç¤ºprotectedã€‚2.æ¥å£  ç”¨ä¸¤å±‚çŸ©å½¢æ¡†è¡¨ç¤ºï¼Œç¬¬ä¸€å±‚æ¥å£ååŠè§£é‡Šã€ç¬¬äºŒå±‚æ–¹æ³•</code></pre><h3 id="å¸¸è§çš„å‡ ç§å…³ç³»"><a href="#å¸¸è§çš„å‡ ç§å…³ç³»" class="headerlink" title="å¸¸è§çš„å‡ ç§å…³ç³»"></a>å¸¸è§çš„å‡ ç§å…³ç³»</h3><pre><code class="textmate">1.æ³›åŒ–(Generalization)    è¡¨ç¤ºç»§æ‰¿ã€‚æ˜¯is-açš„å…³ç³»ã€‚ ç”¨ ç©ºå¿ƒä¸‰è§’ç®­å¤´+å®çº¿ è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘ç»§æ‰¿çš„ç±»2.ä¾èµ–(Dependency)    æ˜¯ä¸€ç§ç±»ä¸æ¥å£çš„å…³ç³»ï¼Œè¡¨ç¤ºç±»æ˜¯æ¥å£æ‰€æœ‰ç‰¹å¾å’Œè¡Œä¸ºçš„å®ç°. ç©ºå¿ƒä¸‰è§’ç®­å¤´+è™šçº¿ ç®­å¤´æŒ‡å‘æ¥å£3.å…³è”(Association)    æè¿°ç±»ä¸ç±»ä¹‹é—´çš„è¿æ¥ï¼Œæ˜¯hasÂ­-açš„å…³ç³»ã€‚å®ƒä½¿ä¸€ä¸ªç±»çŸ¥é“å¦ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•; å®å¿ƒä¸‰è§’ç®­å¤´+å®çº¿ï¼Œä¸¤è¾¹å…³è”åˆ™æœ‰ä¸¤ä¸ªç®­å¤´4.èšåˆ(Aggregation)    æ˜¯æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä¸”éƒ¨åˆ†å¯ä»¥ç¦»å¼€æ•´ä½“è€Œå•ç‹¬å­˜åœ¨ã€‚ç©ºå¿ƒè±å½¢+å®çº¿ï¼Œè±å½¢æŒ‡å‘æ•´ä½“5.ç»„åˆ(Composition)    æ˜¯æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä½†éƒ¨åˆ†ä¸èƒ½ç¦»å¼€æ•´ä½“è€Œå•ç‹¬å­˜åœ¨ã€‚å®å¿ƒè±å½¢+å®çº¿ï¼Œè±å½¢æŒ‡å‘æ•´ä½“6. å®ç°(Realization)    æ˜¯ä¸€ç§ç±»ä¸æ¥å£çš„å…³ç³»ï¼Œè¡¨ç¤ºç±»æ˜¯æ¥å£æ‰€æœ‰ç‰¹å¾å’Œè¡Œä¸ºçš„å®ç°ã€‚ç©ºå¿ƒä¸‰è§’ç®­å¤´+è™šçº¿ï¼Œç®­å¤´æŒ‡å‘æ¥å£åŸºæ•°: çº¿ä¸¤ç«¯çš„æ•°å­—è¡¨æ˜è¿™ä¸€ç«¯çš„ç±»å¯ä»¥æœ‰å‡ ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªé¸Ÿåº”è¯¥æœ‰ä¸¤åªç¿…è†€ã€‚å¦‚æœä¸€ä¸ªç±»å¯èƒ½æœ‰æ— æ•°ä¸ªå®ä¾‹ï¼Œåˆ™å°±ç”¨â€˜nâ€™æ¥è¡¨ç¤ºã€‚å…³è”ã€èšåˆã€ç»„åˆæ˜¯æœ‰åŸºæ•°çš„ã€‚</code></pre><img src="https://im-fan.gitee.io/img/uml/uml-line.png" width="500" height="300"/><h3 id="ç¤ºä¾‹-æ ‡è¯†äº†æ‰€æœ‰å…³ç³»"><a href="#ç¤ºä¾‹-æ ‡è¯†äº†æ‰€æœ‰å…³ç³»" class="headerlink" title="ç¤ºä¾‹-æ ‡è¯†äº†æ‰€æœ‰å…³ç³»"></a>ç¤ºä¾‹-æ ‡è¯†äº†æ‰€æœ‰å…³ç³»</h3><img src="https://im-fan.gitee.io/img/uml/uml.png"/><h2 id="è®¾è®¡å·¥å…·"><a href="#è®¾è®¡å·¥å…·" class="headerlink" title="è®¾è®¡å·¥å…·"></a>è®¾è®¡å·¥å…·</h2><h3 id="åœ¨çº¿ç‰ˆ"><a href="#åœ¨çº¿ç‰ˆ" class="headerlink" title="åœ¨çº¿ç‰ˆ"></a>åœ¨çº¿ç‰ˆ</h3><ul><li><a href="https://www.processon.com/">Processon-æ¨è</a></li><li><a href="https://app.diagrams.net/">Draw.io</a></li><li><a href="https://online.visual-paradigm.com/cn/drive/#diagramlist:proj=0&new">Visual-Paradigm</a></li></ul><h3 id="è½¯ä»¶"><a href="#è½¯ä»¶" class="headerlink" title="è½¯ä»¶"></a>è½¯ä»¶</h3><ul><li>VisualParadigm(åŠŸèƒ½å¼ºå¤§ï¼Œç›¸æ¯”å…¶ä»–è½¯ä»¶æ ·å¼å¯èƒ½æœ‰ç‚¹ä¸‘)</li><li>draw.io(ç®€å•æ˜“ç”¨ï¼Œæ ·å¼ç¾è§‚)</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢†åŸŸå»ºæ¨¡&amp;ä¸šåŠ¡å»ºæ¨¡æ–¹æ³•è®º</title>
      <link href="/2020/12/15/framework/cola/"/>
      <url>/2020/12/15/framework/cola/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›¸å…³ç½‘å€"><a href="#ç›¸å…³ç½‘å€" class="headerlink" title="ç›¸å…³ç½‘å€"></a>ç›¸å…³ç½‘å€</h3><ul><li><a href="https://github.com/alibaba/COLA">COLA 4.0</a></li><li><a href="https://blog.csdn.net/significantfrank/article/details/110934799?utm_source=app">COLA 4.0ï¼šåº”ç”¨æ¶æ„çš„æœ€ä½³å®è·µ</a></li><li><a href="https://zhuanlan.zhihu.com/p/361448445">8XFlowä¸šåŠ¡å»ºæ¨¡æ³•</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> COLA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MybatisPlusä½¿ç”¨ç¬”è®°</title>
      <link href="/2020/12/10/backend/java/utils/mybatis-plus/"/>
      <url>/2020/12/10/backend/java/utils/mybatis-plus/</url>
      
        <content type="html"><![CDATA[<h3 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h3><pre><code class="yaml">#mybatis# é…ç½®æ˜¯å¦æ‰“å°æ—¥å¿— true-æ‰“å°  false-ä¸æ‰“å°# paginationInterceptor-true æ”¹ä¸ºfalseåˆ™åˆ†é¡µåŠŸèƒ½æ— æ•ˆsql:  performanceInterceptor: truemybatis-plus:  mapper-locations: classpath*:/mapper/**/*.xml  #å®ä½“æ‰«æï¼Œå¤šä¸ªpackageç”¨é€—å·æˆ–è€…åˆ†å·åˆ†éš”  typeAliasesPackage: com.ruoyi.**.domain  global-config:    #æ•°æ®åº“ç›¸å…³é…ç½®    db-config:      #ä¸»é”®ç±»å‹  AUTO:&quot;æ•°æ®åº“IDè‡ªå¢&quot;, INPUT:&quot;ç”¨æˆ·è¾“å…¥ID&quot;, ID_WORKER:&quot;å…¨å±€å”¯ä¸€ID (æ•°å­—ç±»å‹å”¯ä¸€ID)&quot;, UUID:&quot;å…¨å±€å”¯ä¸€ID UUID&quot;;      id-type: AUTO      #å­—æ®µç­–ç•¥ IGNORED:&quot;å¿½ç•¥åˆ¤æ–­&quot;,NOT_NULL:&quot;é NULL åˆ¤æ–­&quot;),NOT_EMPTY:&quot;éç©ºåˆ¤æ–­&quot;      field-strategy: NOT_NULL      #é©¼å³°ä¸‹åˆ’çº¿è½¬æ¢      column-underline: true      logic-delete-value: -1      logic-not-delete-value: 0    banner: false  #åŸç”Ÿé…ç½®  configuration:    #ä¸åŠ æ— æ³•æ‰“å°æ‰§è¡Œè„šæœ¬åŠå†…å®¹    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl    map-underscore-to-camel-case: true    cache-enabled: false    call-setters-on-nulls: true    jdbc-type-for-null: &#39;null&#39;</code></pre><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ul><li><p>1.selectOne() æŸ¥è¯¢å‡ºå¤šæ¡æ•°æ®ä¼šæŠ¥é”™</p><pre><code class="textmate">selectOneä¸æ˜¯å­˜åœ¨å¤šæ¡æ•°æ®æ—¶åªè¿”å›ä¸€æ¡ï¼ï¼ï¼æŠ¥é”™ä¿¡æ¯ï¼š org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.TooManyResultsException: Expected one result (or null) to be returned by selectOne(), but found: 2è§£å†³æ–¹æ³•:  1.æ‰‹åŠ¨æ·»åŠ   wrapperæœ€ååŠ ä¸Š(æœ€å¥½å¸¦ä¸Šæ’åºï¼Œæ¯æ¬¡è¿”å›å›ºå®šçš„å€¼) .last(&quot;limit 1&quot;)  2.åˆ‡é¢ç»Ÿä¸€å¤„ç†,å¦‚ä¸‹</code></pre><pre><code class="java">@Aspect@Componentpublic class MybatisPlusAspect &#123;  // é…ç½®ç»‡å…¥ç‚¹  @Pointcut(&quot;execution(public * com.baomidou.mybatisplus.core.mapper.BaseMapper.selectOne(..))&quot;)  public void selectOneAspect() &#123;  &#125;  @Before(&quot;selectOneAspect()&quot;)  public void beforeSelect(JoinPoint point) &#123;      Object arg = point.getArgs()[0];      if (arg instanceof AbstractWrapper) &#123;          arg = (AbstractWrapper) arg;          ((AbstractWrapper) arg).last(&quot;limit 1&quot;);      &#125;  &#125;&#125;</code></pre></li></ul><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://plugins.jetbrains.com/plugin/13847-easycode-mybatiscodehelper">Ideaç”Ÿæˆä»£ç æ’ä»¶-EasyCode-MybatisCodeHelper</a></li><li><a href="https://mp.baomidou.com/">å®˜ç½‘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OAuth2å­¦ä¹ ç¬”è®°</title>
      <link href="/2020/11/17/framework/oauth2/"/>
      <url>/2020/11/17/framework/oauth2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://github.com/lexburner/oauth2-demo">å‚è€ƒdemo</a></li><li><a href="https://colobu.com/2017/04/28/oauth2-rfc6749/">OAuth2 RFC6749ä¸­æ–‡ç¿»è¯‘</a></li><li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">ç†è§£OAuth 2.0-é˜®ä¸€å³°</a></li><li><a href="https://github.com/im-fan/my-project/tree/release/1.0/my-oauth2">æ–‡æ¡£å¯¹åº”demo</a></li></ul><h4 id="æ¡†æ¶ç›¸å…³"><a href="#æ¡†æ¶ç›¸å…³" class="headerlink" title="æ¡†æ¶ç›¸å…³"></a>æ¡†æ¶ç›¸å…³</h4><ul><li>OAuth2<pre><code>è§£é‡Šï¼š  OAuth 2.0æ˜¯ä¸€ä¸ªå…³äºæˆæƒçš„å¼€æ”¾ç½‘ç»œåè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·è®©ç¬¬ä¸‰æ–¹ç½‘ç«™è®¿é—®è¯¥ç”¨æˆ·åœ¨æŸä¸€ç½‘ç«™ä¸Šå­˜å‚¨çš„ä¿¡æ¯å’Œèµ„æºï¼Œ  å¦‚è´¦æˆ·ä¿¡æ¯ï¼Œç…§ç‰‡ï¼Œè”ç³»äººç­‰ï¼Œè€Œä¸éœ€è¦ç»™ç¬¬ä¸‰æ–¹ç½‘ç«™æä¾›æŸä¸€ç½‘ç«™ä¸Šçš„è´¦æˆ·å’Œå¯†ç ã€‚æµç¨‹ï¼š  1ã€ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¦æ±‚æˆæƒã€‚  2ã€ç”¨æˆ·åŒæ„å®¢æˆ·ç«¯æˆæƒã€‚  3ã€å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥æä¾›çš„æˆæƒï¼Œå‘æœåŠ¡å™¨æˆæƒå±‚ç”³è¯·ä»¤ç‰Œã€‚  4ã€æˆæƒæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯åï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚  5ã€å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·èµ„æºã€‚  6ã€èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œï¼Œå‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚</code></pre></li><li>LDAP<pre><code>è§£é‡Šï¼š  LDAPæ˜¯ä¸€ç§åŸºäºè½»é‡ç›®å½•è®¿é—®åè®®ï¼Œå…¨ç§°æ˜¯Lightweight Directory Access Protocolï¼Œæ˜¯ç”±ä¸€ä¸ªä¸ºæŸ¥è¯¢ã€  æµè§ˆå’Œæœç´¢è€Œä¼˜åŒ–çš„æ•°æ®åº“æ„æˆï¼Œå®ƒæˆæ ‘çŠ¶ç»“æ„ç»„ç»‡æ•°æ®ï¼Œç±»ä¼¼æ–‡ä»¶ç›®å½•ä¸€æ ·ã€‚  LDAPå•ç‚¹ç™»å½•è®¤è¯ä¸»è¦æ˜¯æ”¹å˜åŸæœ‰çš„è®¤è¯ç­–ç•¥ï¼Œä½¿å¾—éœ€è¦çš„è½¯ä»¶éƒ½é€šè¿‡LDAPæœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œåœ¨ç»Ÿä¸€èº«ä»½è®¤è¯åï¼Œ  ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨AD Serverä¸­ï¼Œç»ˆç«¯ç”¨æˆ·åœ¨éœ€è¦ä½¿ç”¨å…¬å¸å†…éƒ¨æœåŠ¡çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é€šè¿‡ADæœåŠ¡å™¨è¿›è¡Œè®¤è¯ã€‚ç™»å½•æµç¨‹ï¼š  1ã€è¿æ¥åˆ°LDAPæœåŠ¡å™¨ã€‚  2ã€ç»‘å®šåˆ°LDAPæœåŠ¡å™¨ã€‚  3ã€åœ¨LDAPæœåŠ¡å™¨ä¸Šæ‰§è¡Œæ‰€éœ€è¦çš„æ“ä½œã€‚  4ã€é‡Šæ”¾LDAPæœåŠ¡å™¨çš„è¿æ¥ã€‚</code></pre></li><li><a href="https://www.cnblogs.com/lihuidu/p/6495247.html">CAS(Central Authentication Service-ä¸­å¤®å¼è®¤è¯æœåŠ¡)</a><pre><code>SSO ä»…ä»…æ˜¯ä¸€ç§æ¶æ„ï¼Œä¸€ç§è®¾è®¡ï¼Œè€Œ CAS åˆ™æ˜¯å®ç° SSO çš„ä¸€ç§æ‰‹æ®µã€‚ä¸¤è€…æ˜¯æŠ½è±¡ä¸å…·ä½“çš„å…³ç³»ã€‚CASå³Central Authentication Serviceæ¨¡å‹ï¼ˆä¸­å¤®å¼è®¤è¯æœåŠ¡ï¼‰ï¼Œè¯¥åè®®æ˜¯ä¸ºåº”ç”¨æä¾›å¯ä¿¡èº«ä»½è®¤è¯çš„å•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œæœ€åˆæ˜¯ç”±è€¶é²å¤§å­¦å¼€å‘çš„ã€‚CAS åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š CAS Server å’Œ CAS Clientã€‚CAS Server éœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸»è¦è´Ÿè´£å¯¹ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼›CAS Client è´Ÿè´£å¤„ç†å¯¹å®¢æˆ·ç«¯å—ä¿æŠ¤èµ„æºçš„è®¿é—®è¯·æ±‚ï¼Œéœ€è¦ç™»å½•æ—¶ï¼Œé‡å®šå‘åˆ° CAS Serverã€‚</code></pre></li><li>é€‚ç”¨åœºæ™¯<pre><code>OAuthåè®®èƒ½å¹¿æ³›åº”ç”¨äºäº’è”ç½‘ä¸­ï¼ŒåŸºäºå¤§ä¼ä¸šçš„å·¨å¤§ç”¨æˆ·é‡ï¼Œèƒ½å‡å°‘å°ç½‘ç«™çš„æ³¨å†Œæ¨å¹¿æˆæœ¬ï¼Œå¹¶ä¸”èƒ½åšåˆ°æ›´åŠ ä¾¿æ·çš„èµ„æºå…±äº«ã€‚LDAPåè®®é€‚ç”¨äºä¼ä¸šç”¨æˆ·ä½¿ç”¨ï¼Œé€šè¿‡LDAPåè®®ï¼Œèƒ½è¾ƒå¥½åœ°ç®¡ç†å‘˜å·¥åœ¨å…¬å¸å„ç³»ç»Ÿä¹‹é—´çš„æˆæƒä¸è®¿é—®ã€‚CASæ¨¡å‹ï¼Œä½œä¸ºæƒå¨æœºæ„å¼€å‘çš„ç³»ç»Ÿï¼Œå…·æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ä¸å®‰å…¨æ€§ï¼Œå¹¿æ³›åº”ç”¨äºå„å¤§é«˜æ ¡ç­‰å¤§å‹ç»„ç»‡ï¼Œèƒ½å¾ˆå¥½åœ°å®Œæˆå¤§é‡ç³»ç»Ÿçš„å¯¹æ¥ä¸å¤§é‡äººå‘˜çš„ä½¿ç”¨ã€‚</code></pre></li></ul><h4 id="æˆæƒæ¨¡å¼"><a href="#æˆæƒæ¨¡å¼" class="headerlink" title="æˆæƒæ¨¡å¼"></a>æˆæƒæ¨¡å¼</h4><ul><li><p>æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰</p><pre><code>åŠŸèƒ½æœ€å®Œæ•´ã€æµç¨‹æœ€ä¸¥å¯†çš„æˆæƒæ¨¡å¼ã€‚å®ƒçš„ç‰¹ç‚¹å°±æ˜¯é€šè¿‡å®¢æˆ·ç«¯çš„åå°æœåŠ¡å™¨ï¼Œä¸&quot;æœåŠ¡æä¾›å•†&quot;çš„è®¤è¯æœåŠ¡å™¨è¿›è¡Œäº’åŠ¨ã€‚</code></pre></li><li><p>ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰</p></li><li><p>å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰</p></li><li><p>å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰</p></li><li><p>ä¸»è¦é…ç½®</p><pre><code>Oauth2ServerConfigWebSecurityConfigurer</code></pre></li></ul><h4 id="ä¸åŒæˆæƒæ¨¡å¼è¯·æ±‚"><a href="#ä¸åŒæˆæƒæ¨¡å¼è¯·æ±‚" class="headerlink" title="ä¸åŒæˆæƒæ¨¡å¼è¯·æ±‚"></a>ä¸åŒæˆæƒæ¨¡å¼è¯·æ±‚</h4><ul><li><p>æˆæƒç æ¨¡å¼(åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ¥å£)</p><pre><code>é…ç½®é¡¹ï¼šéœ€è¦å°†è¿”å›åœ°å€æ·»åŠ åˆ°clientä¸­  clients.redirectUris(&quot;http://www.baidu.com&quot;)  GET http://localhost:8200/oauth/authorize?response_type=code&amp;client_id=client_1&amp;redirect_uri=http://www.baidu.com&amp;state=123æ‰€éœ€å‚æ•°è§£é‡Š  response_typeï¼šè¡¨ç¤ºæˆæƒç±»å‹ï¼Œå¿…é€‰é¡¹ï¼Œæ­¤å¤„çš„å€¼å›ºå®šä¸º&quot;code&quot;  client_idï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„IDï¼Œå¿…é€‰é¡¹  redirect_uriï¼šè¡¨ç¤ºé‡å®šå‘URIï¼Œå¯é€‰é¡¹  scopeï¼šè¡¨ç¤ºç”³è¯·çš„æƒé™èŒƒå›´ï¼Œå¯é€‰é¡¹  stateï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„å½“å‰çŠ¶æ€ï¼Œå¯ä»¥æŒ‡å®šä»»æ„å€¼ï¼Œè®¤è¯æœåŠ¡å™¨ä¼šåŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå€¼ã€‚</code></pre></li><li><p>ç®€åŒ–æ¨¡å¼(åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ¥å£)</p><pre><code>è¯·æ±‚åœ°å€  GET http://localhost:8200/oauth/authorize?response_type=token&amp;client_id=client_1&amp;redirect_uri=http://www.baidu.com&amp;state=123&amp;scope=selectå‚æ•°è§£é‡Šï¼š  response_typeï¼šè¡¨ç¤ºæˆæƒç±»å‹ï¼Œæ­¤å¤„çš„å€¼å›ºå®šä¸º&quot;token&quot;ï¼Œå¿…é€‰é¡¹ã€‚  client_idï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„IDï¼Œå¿…é€‰é¡¹ã€‚  redirect_uriï¼šè¡¨ç¤ºé‡å®šå‘çš„URIï¼Œå¯é€‰é¡¹ã€‚  scopeï¼šè¡¨ç¤ºæƒé™èŒƒå›´ï¼Œå¯é€‰é¡¹ã€‚  stateï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„å½“å‰çŠ¶æ€ï¼Œå¯ä»¥æŒ‡å®šä»»æ„å€¼ï¼Œè®¤è¯æœåŠ¡å™¨ä¼šåŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå€¼ã€‚</code></pre></li><li><p>passwordæ–¹å¼è·å–toke</p><pre><code>è¯·æ±‚åœ°å€  POST http://localhost:8200/oauth/token?grant_type=password&amp;scope=select&amp;client_id=client_1&amp;client_secret=123456&amp;username=user_1&amp;password=123456è¿”å›ä¿¡æ¯  &#123;      &quot;access_token&quot;: &quot;39be5ea6-fdcd-4b15-a4dd-1f3dbaf8fc63&quot;,      &quot;token_type&quot;: &quot;bearer&quot;,      &quot;refresh_token&quot;: &quot;396e6c5e-9d79-420a-8b25-945098b10c82&quot;,      &quot;expires_in&quot;: 43021,      &quot;scope&quot;: &quot;select&quot;  &#125;å‚æ•°è§£é‡Š  grant_typeï¼šè¡¨ç¤ºæˆæƒç±»å‹ï¼Œæ­¤å¤„çš„å€¼å›ºå®šä¸º&quot;password&quot;ï¼Œå¿…é€‰é¡¹ã€‚  usernameï¼šè¡¨ç¤ºç”¨æˆ·åï¼Œå¿…é€‰é¡¹ã€‚  passwordï¼šè¡¨ç¤ºç”¨æˆ·çš„å¯†ç ï¼Œå¿…é€‰é¡¹ã€‚  scopeï¼šè¡¨ç¤ºæƒé™èŒƒå›´ï¼Œå¯é€‰é¡¹ã€‚</code></pre></li><li><p>clientæ–¹å¼è·å–access_token</p><pre><code>è¯·æ±‚åœ°å€  POST http://localhost:8200/oauth/token?grant_type=client_credentials&amp;scope=select&amp;client_id=client_2&amp;client_secret=123456è¿”å›ä¿¡æ¯  &#123;      &quot;access_token&quot;: &quot;17fc17a9-83b2-41c3-8621-c727d8329bbd&quot;,      &quot;token_type&quot;: &quot;bearer&quot;,      &quot;expires_in&quot;: 42400,      &quot;scope&quot;: &quot;select&quot;  &#125;å‚æ•°è§£é‡Š  granttypeï¼šè¡¨ç¤ºæˆæƒç±»å‹ï¼Œæ­¤å¤„çš„å€¼å›ºå®šä¸º&quot;clientcredentials&quot;ï¼Œå¿…é€‰é¡¹ã€‚  scopeï¼šè¡¨ç¤ºæƒé™èŒƒå›´ï¼Œå¯é€‰é¡¹ã€‚</code></pre></li></ul><ul><li>åˆ·æ–°token<pre><code>è¯·æ±‚åœ°å€  POST http://localhost:8200/oauth/token?grant_type=refresh_token&amp;refresh_token=396e6c5e-9d79-420a-8b25-945098b10c82&amp;client_id=client_2&amp;client_secret=123456è¿”å›ä¿¡æ¯  &#123;      &quot;access_token&quot;: &quot;e0e64627-f157-4718-81f0-069ca21549ad&quot;,      &quot;token_type&quot;: &quot;bearer&quot;,      &quot;refresh_token&quot;: &quot;396e6c5e-9d79-420a-8b25-945098b10c82&quot;,      &quot;expires_in&quot;: 43199,      &quot;scope&quot;: &quot;select&quot;  &#125;</code></pre></li></ul><h4 id="è¯·æ±‚ä¸šåŠ¡æ¥å£"><a href="#è¯·æ±‚ä¸šåŠ¡æ¥å£" class="headerlink" title="è¯·æ±‚ä¸šåŠ¡æ¥å£"></a>è¯·æ±‚ä¸šåŠ¡æ¥å£</h4><ul><li>è¯·æ±‚æ¥å£<pre><code>é…ç½®æ‹¦æˆªï¼š  HttpSecurityä¸­é…ç½® http.antMatchers(&quot;/user/**&quot;).authenticated()ä½¿ç”¨clientæ–¹å¼è·å–çš„access_token  GET http://localhost:8200/user/info?access_token=d8f47460-c0a6-4247-9f87-1712bae5325eæ¥å£å¯æ­£å¸¸è¿”å›</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oauth2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SPI-Javaå†…ç½®æœåŠ¡å‘ç°æœºåˆ¶</title>
      <link href="/2020/11/11/backend/java/spi/"/>
      <url>/2020/11/11/backend/java/spi/</url>
      
        <content type="html"><![CDATA[<h2 id="SPIæ¡ˆä¾‹"><a href="#SPIæ¡ˆä¾‹" class="headerlink" title="SPIæ¡ˆä¾‹"></a>SPIæ¡ˆä¾‹</h2><blockquote><p>JavaSPIå®ç°,å¦å¤–è¿˜æœ‰DubboSPIã€SpringSPIç­‰å®ç°</p></blockquote><h3 id="JavaSPI"><a href="#JavaSPI" class="headerlink" title="JavaSPI"></a>JavaSPI</h3><pre><code class="textmate">java.util.ServiceLoaderç±»è§£æclassPathå’ŒjaråŒ…çš„META-INF/services/ç›®å½• ä¸‹çš„ä»¥æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ï¼Œå¹¶åŠ è½½è¯¥æ–‡ä»¶ä¸­æŒ‡å®šçš„æ¥å£å®ç°ç±»ï¼Œä»¥æ­¤å®Œæˆè°ƒç”¨ç¼ºç‚¹ï¼š    1.é…ç½®æ–‡ä»¶åªèƒ½æ”¾åœ¨ META-INF/services/ ç›®å½•ä¸‹    2.ä½¿ç”¨æ‰©å±•ç±»ä¸æ–¹ä¾¿ï¼Œä¸æ”¯æŒæœåŠ¡æä¾›æ¥å£å®ç°ç±»çš„ç›´æ¥è®¿é—®</code></pre><h3 id="DubboSPI"><a href="#DubboSPI" class="headerlink" title="DubboSPI"></a>DubboSPI</h3><pre><code class="textmate">1.@SPIæ³¨è§£ä¿®é¥°å®šä¹‰çš„æ‰©å±•æ¥å£2.æ‰©å±•ç±»åŠ è½½å™¨ï¼šExtensionLoaderï¼Œç›¸å½“äºJavaSPIçš„ ServiceLoader3.æ”¯æŒå¤šæ‰©å±•è·¯å¾„    META-INF/dubbo/internal    //ç”¨æ¥åŠ è½½Dubboå†…éƒ¨çš„æ‰©å±•ç‚¹    META-INF/dubbo   //å¯¹å¼€å‘è€…å¼€æ”¾    META-INF/services   //å…¼å®¹Java SPI4.æ¯ä¸ªæ‰©å±•è·¯å¾„æŒ‡å®šåŠ è½½å™¨    DubboInternalLoadingStrategy    DubboLoadingStrategy    ServicesLoadingStrategy5.æ‰©å±•é…ç½®æ–‡ä»¶    æ”¯æŒåˆ«åå¼•ç”¨    ä¾‹å¦‚:  mysql=com.xxx.support.MySQLConfigDubboä¸­å¯¹SPIçš„åº”ç”¨å¾ˆå¹¿æ³›ï¼Œå¦‚ï¼šåºåˆ—åŒ–ç»„ä»¶ã€è´Ÿè½½å‡è¡¡ç­‰éƒ½åº”ç”¨äº†SPIæŠ€æœ¯ï¼Œè¿˜æœ‰å¾ˆå¤šSPIåŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šè‡ªé€‚åº”æ‰©å±•ã€Activateæ´»æ€§æ‰©å±•ç­‰ç­‰</code></pre><h4 id="JavaSPIå’ŒDubboSPIå·®å¼‚ç‚¹"><a href="#JavaSPIå’ŒDubboSPIå·®å¼‚ç‚¹" class="headerlink" title="JavaSPIå’ŒDubboSPIå·®å¼‚ç‚¹"></a>JavaSPIå’ŒDubboSPIå·®å¼‚ç‚¹</h4><pre><code class="textmate">ç›¸åŒï¼š    æ‰©å±•ç‚¹å³æœåŠ¡æä¾›æ¥å£ã€æ‰©å±•å³æœåŠ¡æä¾›æ¥å£å®ç°ç±»ã€æ‰©å±•é…ç½®æ–‡ä»¶å³servicesç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ ä¸‰è€…ç›¸åŒã€‚    éƒ½æ˜¯å…ˆåˆ›å»ºåŠ è½½å™¨ç„¶åè®¿é—®å…·ä½“çš„æœåŠ¡å®ç°ç±»ï¼ŒåŒ…æ‹¬æ·±å±‚æ¬¡çš„åœ¨åˆå§‹åŒ–åŠ è½½å™¨æ—¶éƒ½æœªå®æ—¶è§£ææ‰©å±•é…ç½®æ–‡ä»¶æ¥è·å–æ‰©å±•ç‚¹å®ç°ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨æ—¶æ‰æ­£å¼è§£æå¹¶è·å–æ‰©å±•ç‚¹å®ç°(å³æ‡’åŠ è½½)ã€‚ä¸åŒï¼š    æ‰©å±•ç‚¹å¿…é¡»ä½¿ç”¨@SPIæ³¨è§£ä¿®é¥°(æºç ä¸­è§£æä¼šå¯¹æ­¤åšæ ¡éªŒ)ã€‚    Dubboä¸­æ‰©å±•é…ç½®æ–‡ä»¶æ¯ä¸ªæ‰©å±•(æœåŠ¡æä¾›æ¥å£å®ç°ç±»)éƒ½æŒ‡å®šäº†ä¸€ä¸ªåç§°ã€‚    Dubbo SPIåœ¨è·å–æ‰©å±•ç±»å®ä¾‹æ—¶ç›´æ¥é€šè¿‡æ‰©å±•é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„åç§°è·å–ï¼Œè€ŒéJava SPIçš„å¾ªç¯éå†ï¼Œåœ¨ä½¿ç”¨ä¸Šæ›´çµæ´»ã€‚</code></pre><h4 id="SpringSPI"><a href="#SpringSPI" class="headerlink" title="SpringSPI"></a>SpringSPI</h4><pre><code class="textmate">1.åŠ è½½è·¯å¾„    META-INF/spring.handlers  //å¯ä»¥é€šè¿‡åˆ›å»ºå®ä¾‹æ—¶é‡æ–°æŒ‡å®š    META-INF/spring.factories2.åŠ è½½ç±»     SpringFactoriesLoader ç±»ä¼¼äºJava SPIçš„ServiceLoaderï¼Œè´Ÿè´£è§£æspring.factoriesï¼Œå¹¶å°†æŒ‡å®šæ¥å£çš„æ‰€æœ‰å®ç°ç±»å®ä¾‹åŒ–åè¿”å›ã€‚    DefaultNamespaceHandlerResolver ç±»ä¼¼äºJava SPIçš„ServiceLoaderï¼Œè´Ÿè´£è§£æspring.handlersé…ç½®æ–‡ä»¶ï¼Œç”ŸæˆnamespaceUriå’ŒNamespaceHandleråç§°çš„æ˜ å°„ï¼Œå¹¶å®ä¾‹åŒ–NamespaceHandlerã€‚    3.è§£æhandlersæ‰©å±•ç±»-è™šç»§æ‰¿æŠ½è±¡ç±»    NamespaceHandlerSupport    DefaultNamespaceHandlerResolveræ˜¯NamespaceHandlerResolveræ¥å£çš„é»˜è®¤å®ç°ç±»ï¼Œç”¨äºè§£æè‡ªå®šä¹‰æ ‡ç­¾ã€‚4.è§£æspring.factoriesæ‰©å±•ç±»    SpringFactoriesLoader.loadFactories()  //ç±»ä¼¼JavaSPI</code></pre><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/529674338">vivoæŠ€æœ¯åšå®¢-SpringSPI</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaè§£æSwaggeræ–‡æ¡£æ¥å£åŠå‚æ•°</title>
      <link href="/2020/11/11/backend/java/utils/swagger/"/>
      <url>/2020/11/11/backend/java/utils/swagger/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›¸å…³ä¾èµ–åŒ…"><a href="#ç›¸å…³ä¾èµ–åŒ…" class="headerlink" title="ç›¸å…³ä¾èµ–åŒ…"></a>ç›¸å…³ä¾èµ–åŒ…</h3><pre><code class="xml">&lt;dependencies&gt;    &lt;!--swaggerä¾èµ–--&gt;    &lt;dependency&gt;        &lt;groupId&gt;io.springfox&lt;/groupId&gt;        &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;io.springfox&lt;/groupId&gt;        &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;        &lt;artifactId&gt;swagger-bootstrap-ui&lt;/artifactId&gt;        &lt;version&gt;1.9.6&lt;/version&gt;    &lt;/dependency&gt;        &lt;dependency&gt;        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;        &lt;version&gt;1.2.73&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><h3 id="Swaggeræ–‡æ¡£ç›¸å…³æ¥å£"><a href="#Swaggeræ–‡æ¡£ç›¸å…³æ¥å£" class="headerlink" title="Swaggeræ–‡æ¡£ç›¸å…³æ¥å£"></a>Swaggeræ–‡æ¡£ç›¸å…³æ¥å£</h3><pre><code class="textmate">1.æ¥å£æ–‡æ¡£åœ°å€    https://localhost:8080/swagger-ui.html    https://localhost:8080/doc.html2.JSONæ ¼å¼æ¥å£æ•°æ®(groupå‚æ•°ç”±é¡¹ç›®ä¸­swaggeré…ç½®å†³å®š)    http://localhost:8080/v2/api-docs?group=V1ç‰ˆæœ¬</code></pre><h3 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h3><pre><code class="java">    class Test&#123;    /**     * åŠ è½½swaggeræ–‡æ¡£ä¸­çš„æ¥å£ä¿¡æ¯     * @Date 2020/11/6 11:31     * @Author fan    **/    public boolean loadSwaggerAPI(Integer lesseeId,String url)&#123;        try &#123;            log.info(&quot;å¼€å§‹åŠ è½½Swaggeræ–‡æ¡£,url=&#123;&#125;&quot;,url);            String result = OkhttpClientUtil.get(url);            JSONObject jsonObject = JSON.parseObject(result);            if(jsonObject == null)&#123;                return false;            &#125;            //ç§»é™¤å¯¹è±¡æè¿°ä¿¡æ¯            String platform = (String) JSON.parseObject(JSON.toJSONString(jsonObject.get(&quot;info&quot;))).get(&quot;title&quot;);            JSONObject paths = (JSONObject) jsonObject.get(&quot;paths&quot;);            JSONObject definitions = (JSONObject) jsonObject.get(&quot;definitions&quot;);            Map&lt;String,JSONObject&gt; paramMap = JSONObject.toJavaObject(definitions,Map.class);                List&lt;PublicResourceInfo&gt; resourceInfos = new ArrayList&lt;&gt;();            for(Map.Entry&lt;String,Object&gt; entry :  paths.entrySet())&#123;                String apiUrl = entry.getKey();                String perms = resourceInfoService.buildPermByApiPath(null,apiUrl);                JSONObject methodInfo = (JSONObject) entry.getValue();                    for(Map.Entry&lt;String,Object&gt; methodEntry : methodInfo.entrySet())&#123;                    String requestType = methodEntry.getKey().toUpperCase();                        JSONObject requestTypeInfo = (JSONObject) methodEntry.getValue();                    String apiName = String.valueOf(requestTypeInfo.get(&quot;summary&quot;));                    String moduleName = StringUtils.join((List&lt;String&gt;)requestTypeInfo.get(&quot;tags&quot;),&quot;,&quot;);                        PublicResourceInfo resourceInfo = new PublicResourceInfo();                    resourceInfo.setPlatformNameCn(platform);                    resourceInfo.setApiPath(apiUrl);                    resourceInfo.setPerms(perms);                    resourceInfo.setApiName(apiName);                    resourceInfo.setRequestType(requestType);                    resourceInfo.setModuleNameCn(moduleName);                        //è§£æswagger-uiä¸­çš„å‡ºå‚å…¥å‚                    JSONArray parameterJson = (JSONArray) requestTypeInfo.get(&quot;parameters&quot;);                    Object requestParam = null;                    Map&lt;String,Object&gt; requestParamMap = new HashMap&lt;&gt;();                    if(parameterJson != null)&#123;                        for(Object object : parameterJson)&#123;                            JSONObject schema = (JSONObject) ((JSONObject) object).get(&quot;schema&quot;);                            if (schema != null)&#123;                                String ref = (String) schema.get(&quot;$ref&quot;);                                requestParam = parseRequestToJson(null,paramMap,ref);                            &#125; else &#123;                                String mapKey = (String) ((JSONObject) object).get(&quot;name&quot;);                                String type = ((JSONObject) object).getString(&quot;type&quot;);                                Object value = setValueByType(type,null);                                requestParamMap.put(mapKey,value);                            &#125;                        &#125;                    &#125;                        if(requestParam != null)&#123;                        resourceInfo.setRequestParam(JSONObject.toJSONString(requestParam));                    &#125; else &#123;                        resourceInfo.setRequestParam(JSONObject.toJSONString(requestParamMap));                    &#125;                        //è¿”å›å€¼ç±»å‹éƒ½ç”¨æ ‡å‡†ç±»å‹ï¼Œä¸è§£æå…¶ä»–æ ¼å¼                    JSONObject response = (JSONObject) requestTypeInfo.get(&quot;responses&quot;);                    Object responseResult = null;                    if(response != null)&#123;                        JSONObject schema = (JSONObject) ((JSONObject)response.get(&quot;200&quot;)).get(&quot;schema&quot;);                        if(schema != null)&#123;                            String ref = (String) schema.get(&quot;$ref&quot;);                            responseResult = parseRequestToJson(null,paramMap,ref);                        &#125;                    &#125;                    if(responseResult != null)&#123;                        resourceInfo.setResponseParam(JSONObject.toJSONString(responseResult));                    &#125;                        resourceInfos.add(resourceInfo);                &#125;            &#125;            log.info(&quot;è§£æå®Œæˆ=====&gt;&#123;&#125;&quot;,JSONObject.toJSONString(resourceInfos));        &#125; catch (IOException e) &#123;            log.error(&quot;åŠ è½½Swaggeræ–‡æ¡£ä¸­æ¥å£å¤±è´¥ï¼Œurl=&#123;&#125;&quot;,url);            return false;        &#125;        return true;    &#125;        /**     * è§£æswagger-uiä¸­å‡ºå‚å’Œå…¥å‚ä¸ºjson     * @param paramMap å…¥å‚å’Œå‡ºå‚å¯¹è±¡map,key-å¯¹è±¡æ ‡è¯†ï¼Œvalue-å¯¹è±¡å±æ€§åŠç±»å‹json     * @param paramRef å…¥å‚å’Œå‡ºå‚å¯¹åº”çš„å¯¹è±¡ä¿¡æ¯ï¼Œ æ ¼å¼: #/definitions/RÂ«PageResultDTOÂ«PublicResourceInfoDTOÂ»Â»     * @Date 2020/11/11 16:01     * @Author fan    **/    private Object parseRequestToJson(Map&lt;String,Integer&gt; forEachCache,Map&lt;String,JSONObject&gt; paramMap, String paramRef)&#123;        if(StringUtils.isBlank(paramRef))&#123;            return &quot;&quot;;        &#125;            //å¯¹è±¡æ ‡è¯†        String paramKey = paramRef.substring(paramRef.lastIndexOf(&quot;/&quot;)+1);            //æ§åˆ¶é€’å½’æ¬¡æ•°ï¼ŒåŒä¸€ä¸ªå¯¹è±¡å¾ªç¯è¶…è¿‡1æ¬¡å°±è¿”å›ç©º        if(forEachCache == null)&#123;            forEachCache = new HashMap&lt;&gt;();        &#125;        Integer forEachCount = forEachCache.get(paramKey);        if(forEachCount != null &amp;&amp; forEachCount &gt;= 1)&#123;            return null;        &#125; else &#123;            forEachCache.put(paramKey,1);        &#125;            //å¯¹è±¡å€¼        JSONObject paramJson = paramMap.get(paramKey);        JSONObject propertiesJson = JSONObject.parseObject(String.valueOf(paramJson.get(&quot;properties&quot;)));            Map&lt;String,Object&gt; columnMap = new HashMap&lt;&gt;();        for(Map.Entry&lt;String,Object&gt; entry : propertiesJson.entrySet())&#123;            String key = entry.getKey();            Object value = new JSONObject();            JSONObject valueJson = JSONObject.parseObject(String.valueOf(entry.getValue()));            String type = valueJson.getString(&quot;type&quot;);            Object obj = valueJson.get(&quot;items&quot;);                if(obj != null)&#123;                JSONObject property = JSONObject.parseObject(String.valueOf(obj));                String ref = (String) property.get(&quot;$ref&quot;);                //æœ‰ä¸‹ä¸€çº§ï¼Œåˆ™é€’å½’                if(StringUtils.isNotBlank(ref))&#123;                    value = parseRequestToJson(forEachCache,paramMap,ref);                &#125;            &#125;            value = setValueByType(type,value);            columnMap.put(key,value);        &#125;        return columnMap;    &#125;        /**  æ ¹æ®å‚æ•°ç±»å‹è®¾ç½®value **/    private Object setValueByType(String type,Object value)&#123;        if(&quot;array&quot;.equals(type))&#123;            JSONArray jsonArray = new JSONArray();            if(value == null)&#123;                value = new JSONObject();            &#125;            jsonArray.add(value);            return JSONArray.toJSONString(jsonArray);        &#125;        if(&quot;integer&quot;.equals(type))&#123;            return 0;        &#125;        if(&quot;boolean&quot;.equals(type))&#123;            return true;        &#125;        if(&quot;object&quot;.equals(type))&#123;            return value;        &#125;        return &quot;&quot;;    &#125;&#125;</code></pre><h3 id="æ‰©å±•ä½¿ç”¨"><a href="#æ‰©å±•ä½¿ç”¨" class="headerlink" title="æ‰©å±•ä½¿ç”¨"></a>æ‰©å±•ä½¿ç”¨</h3><ul><li>å¯¼å…¥å…¶ä»–æ¥å£ç®¡ç†è½¯ä»¶<pre><code class="textmate">  1.æ¥å£ç®¡ç†è½¯ä»¶æ‰¾åˆ°å¯¼å…¥swaggeræ–‡æ¡£çš„å…¥å£  2.è¾“å…¥ https://xxxxx/v2/api-docs (swaggeræ–‡æ¡£jsonç»“æ„æ•°æ®åœ°å€)</code></pre></li></ul><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://swagger.io/">Swaggerå®˜ç½‘</a></li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeperç®€ä»‹</title>
      <link href="/2020/10/29/backend/service/zookeeper/"/>
      <url>/2020/10/29/backend/service/zookeeper/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç†ç›¸å…³"><a href="#åŸç†ç›¸å…³" class="headerlink" title="åŸç†ç›¸å…³"></a>åŸç†ç›¸å…³</h2><h3 id="è§’è‰²"><a href="#è§’è‰²" class="headerlink" title="è§’è‰²"></a>è§’è‰²</h3><table><thead><tr><th>è§’è‰²</th><th></th><th>æè¿°</th></tr></thead><tbody><tr><td>é¢†å¯¼è€…(Leader)</td><td></td><td>é¢†å¯¼è€…è´Ÿè´£æŠ•ç¥¨çš„å‘èµ·å’Œå†³ç­–ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</td></tr><tr><td>å­¦ä¹ è€…(Learner)</td><td>è·Ÿéšè€…(Follower)</td><td>Followeræ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸¾çš„è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</td></tr><tr><td>å­¦ä¹ è€…(Learner)</td><td>è§‚å¯Ÿè€…(ObServer)</td><td>æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶è½¬å‘ç»™Leaderã€‚ ä¸å‚ä¸æŠ•ç¥¨ï¼ŒåªåŒæ­¥LeaderçŠ¶æ€ã€‚<br/>ObServerèŠ‚ç‚¹ç›®çš„æ˜¯æ‰©å±•ç³»ç»Ÿï¼Œæé«˜è¯»å–é€Ÿåº¦</td></tr><tr><td>å®¢æˆ·ç«¯(Client)</td><td></td><td>è¯·æ±‚å‘èµ·æ–¹</td></tr></tbody></table><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li><p>Zabåè®®</p><pre><code class="textmate">Zookeeperçš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ªServerä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åšZabåè®®ã€‚Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼ŒZabå°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•°Serverå®Œæˆäº†å’Œleaderçš„çŠ¶æ€åŒæ­¥ä»¥å ï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº†leaderå’ŒServerå…·æœ‰ç›¸åŒçš„ç³»ç»ŸçŠ¶æ€ã€‚Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ **æ¢å¤æ¨¡å¼** å’Œ **å¹¿æ’­æ¨¡å¼** ã€‚</code></pre></li><li><p>Zxid</p><pre><code class="textmate"> ä¸ºäº†ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§ï¼Œzookeeperé‡‡ç”¨äº†é€’å¢çš„äº‹åŠ¡idå·ï¼ˆzxidï¼‰æ¥æ ‡è¯†äº‹åŠ¡ã€‚æ‰€æœ‰çš„æè®®ï¼ˆproposalï¼‰éƒ½åœ¨è¢«æå‡ºçš„æ—¶å€™åŠ ä¸Šäº†zxidã€‚ å®ç°ä¸­zxidæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œå®ƒé«˜32ä½æ˜¯epochç”¨æ¥æ ‡è¯†leaderå…³ç³»æ˜¯å¦æ”¹å˜ï¼Œæ¯æ¬¡ä¸€ä¸ªleaderè¢«é€‰å‡ºæ¥ï¼Œå®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„epochï¼Œæ ‡è¯†å½“å‰å±äºé‚£ä¸ªleaderçš„ç»Ÿæ²»æ—¶æœŸã€‚ä½32ä½ç”¨äºé€’å¢è®¡æ•°ã€‚</code></pre></li><li><p>ZookeeperèŠ‚ç‚¹</p><pre><code class="textmate">1.Znodeæœ‰ä¸¤ç§ç±»å‹ï¼ŒçŸ­æš‚çš„ï¼ˆephemeralï¼‰å’ŒæŒä¹…çš„ï¼ˆpersistentï¼‰2.Znodeçš„ç±»å‹åœ¨åˆ›å»ºæ—¶ç¡®å®šå¹¶ä¸”ä¹‹åä¸èƒ½å†ä¿®æ”¹3.çŸ­æš‚znodeä¸å¯ä»¥æœ‰å­èŠ‚ç‚¹4.Znodeæœ‰å››ç§å½¢å¼çš„ç›®å½•èŠ‚ç‚¹  PERSISTENT(æŒä¹…åŒ–èŠ‚ç‚¹)  EPHEMERAL(ä¸´æ—¶èŠ‚ç‚¹)  PERSISTENT_SEQUENTIAL(æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹)  EPHEMERAL_SEQUENTIAL(ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹)</code></pre></li><li><p>å·¥ä½œæ—¶çŠ¶æ€</p><pre><code class="textmate">æ¯ä¸ªServeråœ¨å·¥ä½œè¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š  LOOKINGï¼šå½“å‰Serverä¸çŸ¥é“leaderæ˜¯è°ï¼Œæ­£åœ¨æœå¯»  LEADINGï¼šå½“å‰Serverå³ä¸ºé€‰ä¸¾å‡ºæ¥çš„leader  FOLLOWINGï¼šleaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œå½“å‰Serverä¸ä¹‹åŒæ­¥</code></pre></li><li><p>å…¶ä»–ç‰¹æ€§</p><pre><code class="textmate">  1.Zookeeperæ˜¯ä¸€ä¸ªç”±å¤šä¸ªserverç»„æˆçš„é›†ç¾¤  2.ä¸€ä¸ªleaderï¼Œå¤šä¸ªfollower  3.æ¯ä¸ªserverä¿å­˜ä¸€ä»½æ•°æ®å‰¯æœ¬  4.å…¨å±€æ•°æ®ä¸€è‡´  5.åˆ†å¸ƒå¼è¯»å†™  6.æ›´æ–°è¯·æ±‚è½¬å‘ï¼Œç”±leaderå®æ–½</code></pre></li></ul><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li>æœåŠ¡æ³¨å†Œ</li><li>åˆ†å¸ƒå¼é”</li><li>åˆ†å¸ƒå¼IDç”Ÿæˆå™¨</li></ul><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><pre><code class="textmate">1.ä¸‹è½½ xxx-bin.tar.gzåŒ…(è¿™ç§æ˜¯ç¼–è¯‘å¥½çš„)ï¼Œå¦åˆ™å¯åŠ¨æ—¶ä¼šæç¤ºæ‰¾ä¸åˆ°Class2.å¯åŠ¨æ—¶æ³¨æ„ç«¯å£å·æ˜¯å¦å·²ç»è¢«å ç”¨</code></pre><h3 id="å•æœºéƒ¨ç½²æ­¥éª¤"><a href="#å•æœºéƒ¨ç½²æ­¥éª¤" class="headerlink" title="å•æœºéƒ¨ç½²æ­¥éª¤"></a>å•æœºéƒ¨ç½²æ­¥éª¤</h3><pre><code class="textmate">1.è§£å‹æ–‡ä»¶    tar -zxvf xxx-bin.tar.gz zookeeper2.ä¿®æ”¹é…ç½®    cd zookeeper/conf    cp zoo_sample.cfg zoo.cfg    vim zoo.cfg    ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹        dataDir= xxx/dataDir        dataLogDir= xxx/logs/zookeeper3.æ–°å¢é…ç½®    cd xxx/dataDir    echo 1001&gt;myid4.å¯åŠ¨    cd zookeeper/bin    ./zkServer.sh start / restart / stop / status</code></pre><h3 id="zookeeperæ•°æ®æŸ¥çœ‹å·¥å…·"><a href="#zookeeperæ•°æ®æŸ¥çœ‹å·¥å…·" class="headerlink" title="zookeeperæ•°æ®æŸ¥çœ‹å·¥å…·"></a>zookeeperæ•°æ®æŸ¥çœ‹å·¥å…·</h3><blockquote><p><a href="https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip">ä¸‹è½½åœ°å€</a></p></blockquote><ul><li>ä½¿ç”¨</li></ul><pre><code class="textmate">1.è§£å‹åè¿›å…¥buildæ–‡ä»¶å¤¹2.è¿è¡Œjar    nohup java -jar zookeeper-dev-ZooInspector.jar &amp;3.å·¦ä¸Šè§’è¿æ¥æŒ‰é’®ï¼Œè¾“å…¥zkåœ°å€å¹¶è¿æ¥</code></pre><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ul><li>å¯åŠ¨æŠ¥ClassNotFound</li></ul><pre><code class="textmate">é‡æ–°ä¸‹è½½zookeeperåŒ…ï¼Œæ³¨æ„æ˜¯xxxx-bin.tar.gzè¿™ç§çš„</code></pre><ul><li>å¯åŠ¨å¤±è´¥</li></ul><pre><code class="textmate">1.æ£€æŸ¥é…ç½®çš„æ–‡ä»¶å¤¹è·¯å¾„å’Œæƒé™æ˜¯å¦æ­£å¸¸2.æ£€æŸ¥zookeeperæ˜¯å¦å·²ç»è¢«å¯åŠ¨    ps -ef | grep zookeeper    killè¿›ç¨‹3.åˆ é™¤ dataDir å’Œ dataLogDir è·¯å¾„ä¸‹ version-2 æ–‡ä»¶å¤¹åé‡å¯</code></pre><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><blockquote><p><a href="https://zookeeper.apache.org/releases.html">å®˜ç½‘</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> zookeeper </tag>
            
            <tag> åˆ†å¸ƒå¼é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EasyExcelä½¿ç”¨é‡åˆ°çš„é—®é¢˜</title>
      <link href="/2020/10/20/backend/java/utils/excel/"/>
      <url>/2020/10/20/backend/java/utils/excel/</url>
      
        <content type="html"><![CDATA[<h3 id="å¯¼å‡ºè®¾ç½®æ ‡é¢˜æ ¼å¼"><a href="#å¯¼å‡ºè®¾ç½®æ ‡é¢˜æ ¼å¼" class="headerlink" title="å¯¼å‡ºè®¾ç½®æ ‡é¢˜æ ¼å¼"></a>å¯¼å‡ºè®¾ç½®æ ‡é¢˜æ ¼å¼</h3><ul><li><p>TitleHandler</p><pre><code class="java">public class TitleHandler implements CellWriteHandler&#123;  //æ“ä½œåˆ—  private List&lt;Integer&gt; columnIndexs;  //é¢œè‰²  private Short colorIndex;  public TitleHandler(List&lt;Integer&gt; columnIndexs, Short colorIndex) &#123;      this.columnIndexs = columnIndexs;      this.colorIndex = colorIndex;  &#125;  @Override  public void beforeCellCreate(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Row row, Head head, Integer columnIndex, Integer relativeRowIndex, Boolean isHead) &#123;  &#125;  @Override  public void afterCellCreate(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead) &#123;  &#125;  @Override  public void afterCellDataConverted(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, CellData cellData, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead) &#123;  &#125;  @Override  public void afterCellDispose(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, List&lt;CellData&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead) &#123;      if(isHead)&#123;          // è®¾ç½®åˆ—å®½          Sheet sheet = writeSheetHolder.getSheet();          sheet.setColumnWidth(cell.getColumnIndex(), 20 * 256);          writeSheetHolder.getSheet().getRow(0).setHeight((short)(3*256));          Workbook workbook = writeSheetHolder.getSheet().getWorkbook();          // è®¾ç½®æ ‡é¢˜å­—ä½“æ ·å¼          WriteCellStyle headWriteCellStyle = new WriteCellStyle();          WriteFont headWriteFont = new WriteFont();          headWriteFont.setFontName(&quot;å®‹ä½“&quot;);          headWriteFont.setFontHeightInPoints((short)14);          headWriteFont.setBold(true);          if (CollectionUtils.isNotEmpty(columnIndexs) &amp;&amp;                  colorIndex != null &amp;&amp;                  columnIndexs.contains(cell.getColumnIndex())) &#123;              // è®¾ç½®å­—ä½“é¢œè‰²              headWriteFont.setColor(colorIndex);          &#125;          headWriteCellStyle.setWriteFont(headWriteFont);          headWriteCellStyle.setFillForegroundColor(IndexedColors.GREY_25_PERCENT.getIndex());          CellStyle cellStyle = StyleUtil.buildHeadCellStyle(workbook, headWriteCellStyle);          cell.setCellStyle(cellStyle);      &#125;  &#125;&#125;</code></pre></li><li><p>ExcelUtils</p><pre><code class="java">public class ExcelUtils &#123;  /** å¯¼å‡ºExcel **/  public static void exportExcel(String fileName, String sheetName,Class clazz,                                 List data, HttpServletResponse response,                                 CellWriteHandler... cellWriteHandlers) throws IOException &#123;      response.setContentType(&quot;application/vnd.ms-excel&quot;);      response.setCharacterEncoding(&quot;utf-8&quot;);      fileName = URLEncoder.encode(fileName, &quot;UTF-8&quot;).replaceAll(&quot;\\+&quot;, &quot;%20&quot;);      response.setHeader(&quot;Content-disposition&quot;, &quot;attachment;filename*=utf-8&#39;&#39;&quot; + fileName + &quot;.xlsx&quot;);      // åˆ—æ ‡é¢˜çš„ç­–ç•¥      WriteCellStyle headWriteCellStyle = new WriteCellStyle();      // å•å…ƒæ ¼ç­–ç•¥      WriteCellStyle contentWriteCellStyle = new WriteCellStyle();      // åˆå§‹åŒ–è¡¨æ ¼æ ·å¼      HorizontalCellStyleStrategy horizontalCellStyleStrategy = new HorizontalCellStyleStrategy(headWriteCellStyle, contentWriteCellStyle);      ExcelWriterSheetBuilder excelWriterSheetBuilder = EasyExcel.write(response.getOutputStream(), clazz)              .sheet(sheetName)              .registerWriteHandler(horizontalCellStyleStrategy);      if (null != cellWriteHandlers &amp;&amp; cellWriteHandlers.length &gt; 0) &#123;          for (int i = 0; i &lt; cellWriteHandlers.length; i++) &#123;              excelWriterSheetBuilder.registerWriteHandler(cellWriteHandlers[i]);          &#125;      &#125;      // å¼€å§‹å¯¼å‡º      excelWriterSheetBuilder.doWrite(data);  &#125;&#125;</code></pre></li><li><p>ä½¿ç”¨</p><pre><code class="java">class ExcelUtil&#123;  /** å¯¼å‡ºexcelæ¨¡æ¿**/  public void exportTemplate(List&lt;Integer&gt; ids,HttpServletResponse response)&#123;      try &#123;          List&lt;XXX&gt; result = getByIds(ids);          // æŒ‡å®šæ ‡çº¢è‰²çš„åˆ—          List&lt;Integer&gt; columns = Arrays.asList(0,1,2,3);          TitleHandler titleHandler = new TitleHandler(columns, IndexedColors.RED.index);          ExcelUtils.exportExcel(&quot;æ–‡ä»¶å&quot;,&quot;sheetåç§°&quot;,                  XXX.class,result,response,titleHandler);      &#125; catch (IOException e) &#123;          log.warn(&quot;å¯¼å‡ºå¤±è´¥,error=&#123;&#125;&quot;,e);      &#125;  &#125;&#125;</code></pre></li></ul><h3 id="è®¾ç½®ä¸­æ–‡æ–‡ä»¶å"><a href="#è®¾ç½®ä¸­æ–‡æ–‡ä»¶å" class="headerlink" title="è®¾ç½®ä¸­æ–‡æ–‡ä»¶å"></a>è®¾ç½®ä¸­æ–‡æ–‡ä»¶å</h3><pre><code class="textmate">// ä»£ç ä¸­æ·»åŠ response.setContentType(&quot;application/vnd.ms-excel;charset=UTF-8&quot;);response.setCharacterEncoding(&quot;utf-8&quot;);response.setHeader(&quot;Content-disposition&quot;, &quot;attachment;filename*=utf-8&#39;&#39;&quot; + fileName + &quot;.xlsx&quot;);</code></pre><h3 id="å¯¼å‡ºå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯"><a href="#å¯¼å‡ºå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯" class="headerlink" title="å¯¼å‡ºå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯"></a>å¯¼å‡ºå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯</h3><pre><code class="textmate">// é‡å†™å“åº”ä¿¡æ¯æ•°æ®ç±»å‹response.reset();response.setContentType(&quot;application/json&quot;);response.setCharacterEncoding(&quot;utf-8&quot;);try &#123;    response.getWriter().println(result);&#125; catch (IOException ioException) &#123;    log.warn(&quot;ä¸šåŠ¡å¼‚å¸¸  msg=&#123;&#125;&quot;,ioException);&#125;</code></pre><h3 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h3><h4 id="å¯¼å‡ºæˆåŠŸä½†æ˜¯åå°æ—¥å¿—æŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸"><a href="#å¯¼å‡ºæˆåŠŸä½†æ˜¯åå°æ—¥å¿—æŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸" class="headerlink" title="å¯¼å‡ºæˆåŠŸä½†æ˜¯åå°æ—¥å¿—æŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸"></a>å¯¼å‡ºæˆåŠŸä½†æ˜¯åå°æ—¥å¿—æŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸</h4><pre><code class="textmate">é”™è¯¯æ—¥å¿—    No converter for [class com.hzrys.dashboard.common.result.R] with preset Content-Type &#39;application/vnd.ms-excel;charset=utf-8&#39;    org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.hzrys.dashboard.common.result.R] with preset Content-Type &#39;application/vnd.ms-excel;charset=utf-8&#39;åŸå›     å¯¼å‡ºæ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼ï¼Œå¯¼å‡ºæ–‡ä»¶æ—¶ä¼šè®¾ç½®ç›¸åº”å¤´ä¸ºæ–‡ä»¶æ ¼å¼ï¼›å¦‚æœæœ‰è¿”å›å€¼ï¼Œåˆ™å°±ä¼šå‡ºç°æ•°æ®è½¬æ¢å¼‚å¸¸çš„é”™è¯¯è§£å†³æ–¹æ³•    ä¿®æ”¹Controllerä¸­æ–¹æ³•ï¼Œæ”¹ä¸º void å³å¯</code></pre><h4 id="poiæµè½¬å¯¹è±¡é—®é¢˜-ç”¨easy-poiæ—¶é‡åˆ°çš„é—®é¢˜"><a href="#poiæµè½¬å¯¹è±¡é—®é¢˜-ç”¨easy-poiæ—¶é‡åˆ°çš„é—®é¢˜" class="headerlink" title="poiæµè½¬å¯¹è±¡é—®é¢˜(ç”¨easy-poiæ—¶é‡åˆ°çš„é—®é¢˜)"></a>poiæµè½¬å¯¹è±¡é—®é¢˜(ç”¨easy-poiæ—¶é‡åˆ°çš„é—®é¢˜)</h4><pre><code class="textmate">é”™è¯¯æ—¥å¿—    Your stream was neither an OLE2 stream, nor an OOXML stream.åŸå›     å¤šæ¬¡æ“ä½œæµå¯¼è‡´æ–‡ä»¶ç±»å‹å¼‚å¸¸è§£å†³æ–¹æ³•    è¯»å–è¿œç¨‹æµåï¼Œç›´æ¥ç”¨å½“å‰æµè½¬æ¢æˆå¯¹è±¡ä¾‹:    //è¯»å–è¿œç¨‹æ–‡ä»¶å·¥å…·ç±»    public static InputStream readUrlExcelFile(String urlPath) &#123;        try&#123;            URL url = new URL(urlPath);            URLConnection conn = url.openConnection();            int size = conn.getContentLength();            if(size &lt; 0)&#123;                return null;            &#125;            return conn.getInputStream();        &#125; catch (IOException e)&#123;            e.printStackTrace();        &#125;        return null;    &#125;        //å…·ä½“ä¸šåŠ¡é€»è¾‘ æµè½¬å¯¹è±¡ç”¨çš„æ˜¯easy-poi    public static XXService&#123;        public void saveExcel(String url)&#123;            InputStream inputStream;            try&#123;                inputStream = FileUtils.readUrlExcelFile(request.getFilePath());                if(inputStream == null)&#123;                    System.out.println(&quot;æ–‡ä»¶è¯»å–å¤±è´¥&quot;);                    return;                &#125;                    ImportParams importParams = new ImportParams();                //æ ‡è¯†å¼€å§‹è¡Œ                importParams.setStartRows(0);                List&lt;XXX&gt; list = ExcelImportUtil.importExcel(inputStream,                        XXX.class,                        importParams);                                    &#125; catch(Exception e)&#123;                e.printStackTrace();            &#125; finally&#123;                if(inputStream != null)&#123;                    inputStream.close();                &#125;            &#125;        &#125;    &#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDD-é¢†åŸŸé©±åŠ¨è®¾è®¡</title>
      <link href="/2020/10/09/framework/ddd/"/>
      <url>/2020/10/09/framework/ddd/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://mp.weixin.qq.com/s/9eGZZ2wsZoaCVRy0oKt0iw">æœ‰èµDDDå®è·µ</a></li><li><a href="https://www.processon.com/view/5e55d17ee4b069f82a120d06#map">DDDè®¾è®¡</a></li><li><a href="https://segmentfault.com/a/1190000020270851?utm_source=tag-newest">é˜¿é‡ŒæŠ€æœ¯ä¸“å®¶è¯¦è§£ DDD ç³»åˆ—- Domain Primitive</a></li></ul><h3 id="Domain-Primitive"><a href="#Domain-Primitive" class="headerlink" title="Domain Primitive"></a>Domain Primitive</h3><pre><code class="textmate">Domain Primitive :Domain Primitive æ˜¯ä¸€ä¸ªåœ¨ç‰¹å®šé¢†åŸŸé‡Œï¼Œæ‹¥ æœ‰ç²¾å‡†å®šä¹‰çš„ã€å¯è‡ªæˆ‘éªŒè¯çš„ã€æ‹¥æœ‰è¡Œä¸ºçš„ Value Object ã€‚1.DP æ˜¯ä¸€ä¸ªä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ Value Objectï¼Œæ‹¥æœ‰ Immutable çš„ç‰¹æ€§2.DP æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¦‚å¿µæ•´ä½“ï¼Œæ‹¥æœ‰ç²¾å‡†å®šä¹‰3.DP ä½¿ç”¨ä¸šåŠ¡åŸŸä¸­çš„åŸç”Ÿè¯­è¨€4.DP å¯ä»¥æ˜¯ä¸šåŠ¡åŸŸçš„æœ€å°ç»„æˆéƒ¨åˆ†ã€ä¹Ÿå¯ä»¥æ„å»ºå¤æ‚ç»„åˆ</code></pre><h3 id="æ–¹æ³•è®º"><a href="#æ–¹æ³•è®º" class="headerlink" title="æ–¹æ³•è®º"></a>æ–¹æ³•è®º</h3><pre><code class="textmate">å…­è¾¹å½¢æ¶æ„ã€æ´‹è‘±æ¶æ„ã€æ•´æ´æ¶æ„ã€å››è‰²åŸå‹SIDE-EFFECT-FREEæ¨¡å¼è¢«ç§°ä¸ºæ— å‰¯ä½œç”¨æ¨¡å¼ï¼Œç†Ÿæ‚‰å‡½æ•°æ—¶ç¼–ç¨‹çš„æœ‹å‹éƒ½çŸ¥é“ï¼Œä¸¥æ ¼çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„è¾“å…¥ï¼Œæ€»æ˜¯è¿”å›å›ºå®šçš„ç»“æœï¼Œé€šå¸¸æŸ¥è¯¢åŠŸèƒ½å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‘½ä»¤åŠŸèƒ½å°±ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒé€šå¸¸ä¼šæ‰§è¡ŒæŸäº›ä¿®æ”¹ã€‚åœ¨DDDæ¶æ„ä¸­ï¼Œé€šå¸¸ä¼šå°†æŸ¥è¯¢å’Œå‘½ä»¤æ“ä½œåˆ†å¼€ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºCQRS(å‘½ä»¤æŸ¥è¯¢çš„è´£ä»»åˆ†ç¦»Command Query Responsibility Segregation)ï¼Œå…·ä½“è½åœ°æ—¶ï¼Œæ˜¯å¦å°†Commandå’ŒQueryåˆ†å¼€æˆä¸¤ä¸ªé¡¹ç›®å¯ä»¥çœ‹æƒ…å†µå†³å®šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ”¾åœ¨ä¸€ä¸ªé¡¹ç›®å¯ä»¥æé«˜ä¸šåŠ¡å†…èšæ€§ï¼Œ</code></pre><h4 id="å…­è¾¹å½¢æ¶æ„"><a href="#å…­è¾¹å½¢æ¶æ„" class="headerlink" title="å…­è¾¹å½¢æ¶æ„"></a>å…­è¾¹å½¢æ¶æ„</h4><ul><li><a href="http://alistair.cockburn.us/Hexagonal+architecture">èµ·æºæ–‡ç« </a></li><li><a href="https://www.jianshu.com/p/c6bb08d9c613">ç›¸å…³æ–‡ç« &amp;demo</a></li><li>æ‘˜è¦<pre><code class="textmate">å…­è§’æ¶æ„çš„åˆè¡·æ˜¯ï¼šå…è®¸åº”ç”¨ç¨‹åºåŒæ ·ç”±ç”¨æˆ·ï¼Œç¨‹åºï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æˆ–æ‰¹å¤„ç†è„šæœ¬é©±åŠ¨ï¼Œå¹¶ä¸æœ€ç»ˆçš„è¿è¡Œæ—¶è®¾å¤‡å’Œæ•°æ®åº“éš”ç¦»å¼€å‘å’Œæµ‹è¯•ã€‚</code></pre></li></ul><h4 id="æ´‹è‘±æ¶æ„"><a href="#æ´‹è‘±æ¶æ„" class="headerlink" title="æ´‹è‘±æ¶æ„"></a>æ´‹è‘±æ¶æ„</h4><ul><li><a href="https://www.infoq.cn/article/2014/11/ddd-onion-architecture">åœ¨æ´‹è‘±(Onion)æ¶æ„ä¸­å®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡</a></li><li>æ‘˜è¦<pre><code class="textmate">å±‚çº§å…³ç³»  Core ) Domain ) API ) Infrastructure )æ´‹è‘±æ¶æ„ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µæ˜¯ä¾èµ–ï¼Œå¤–éƒ¨çš„å±‚èƒ½å¤Ÿè®¿é—®å†…éƒ¨çš„å±‚ï¼Œè€Œå†…éƒ¨çš„å±‚åˆ™å¯¹å¤–éƒ¨çš„å±‚ä¸€æ— æ‰€çŸ¥ã€‚  æ ¸å¿ƒï¼ˆCoreï¼‰å±‚æ˜¯ä¸é¢†åŸŸæˆ–æŠ€æœ¯æ— å…³çš„åŸºç¡€æ„ä»¶å—ï¼Œå®ƒåŒ…å«äº†ä¸€äº›é€šç”¨çš„æ„ä»¶å—,åŒ…å«ä»»ä½•æŠ€æœ¯å±‚é¢çš„æ¦‚å¿µ  é¢†åŸŸï¼ˆDomainï¼‰å±‚æ˜¯å®šä¹‰ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œæ¯ä¸ªç±»çš„æ–¹æ³•éƒ½æ˜¯æŒ‰ç…§é¢†åŸŸé€šç”¨è¯­è¨€ä¸­çš„æ¦‚å¿µè¿›è¡Œå‘½åçš„  API å±‚æ˜¯é¢†åŸŸå±‚çš„å…¥å£ï¼Œå®ƒä½¿ç”¨é¢†åŸŸä¸­çš„æœ¯è¯­å’Œå¯¹è±¡ã€‚  åŸºç¡€æ¶æ„ï¼ˆInfrastructureï¼‰å±‚æ˜¯æœ€å¤–éƒ¨çš„ä¸€å±‚ï¼Œå®ƒåŒ…å«äº†å¯¹æ¥å„ç§æŠ€æœ¯çš„é€‚é…å™¨ï¼Œä¾‹å¦‚æ•°æ®åº“ã€ç”¨æˆ·ç•Œé¢ä»¥åŠå¤–éƒ¨æœåŠ¡ã€‚</code></pre></li></ul><h4 id="æ•´æ´æ¶æ„"><a href="#æ•´æ´æ¶æ„" class="headerlink" title="æ•´æ´æ¶æ„"></a>æ•´æ´æ¶æ„</h4><ul><li><a href="https://www.jianshu.com/p/b296ceea673b">é˜¿é‡Œäº‘-æ¶æ„æ•´æ´ä¹‹é“</a></li></ul><h4 id="å¼€æºæ¡†æ¶"><a href="#å¼€æºæ¡†æ¶" class="headerlink" title="å¼€æºæ¡†æ¶"></a>å¼€æºæ¡†æ¶</h4><ul><li>cola4 </li><li>DDDLib  </li><li>Koala</li></ul><h4 id="å››è‰²åŸå‹-éœ€æ±‚åˆ†æåˆ©å™¨"><a href="#å››è‰²åŸå‹-éœ€æ±‚åˆ†æåˆ©å™¨" class="headerlink" title="å››è‰²åŸå‹-éœ€æ±‚åˆ†æåˆ©å™¨"></a>å››è‰²åŸå‹-éœ€æ±‚åˆ†æåˆ©å™¨</h4><img src="https://im-fan.gitee.io/img/ddd/four-color.png"/><pre><code class="textmate">æ¦‚å¿µ    â€œå››è‰²åŸå‹â€æ˜¯åœ¨ä½¿ç”¨UMLå»ºæ¨¡çš„æ—¶å€™ï¼ŒæŠŠå®ä½“åˆ†ä¸ºå››ç±»ï¼Œå¹¶æ ‡æ³¨ä¸åŒçš„é¢œè‰²çš„ä¸€ç§å»ºæ¨¡æ–¹æ³•ã€‚    ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å››è‰²åŸå‹å°±æ˜¯ï¼šä¸€ä¸ªä»€ä¹ˆæ ·çš„äººæˆ–ç‰©å“ä»¥æŸç§è§’è‰²åœ¨æŸä¸ªæ—¶åˆ»æˆ–æŸæ®µæ—¶é—´å†…å‚ä¸æŸä¸ªæ´»åŠ¨ã€‚å…¶ä¸­â€œä»€ä¹ˆæ ·çš„â€å°±æ˜¯DESCï¼Œâ€œäººæˆ–ç‰©å“â€å°±æ˜¯PPT,â€è§’è‰²â€å°±æ˜¯ROLE,è€Œâ€œæŸä¸ªæ—¶åˆ»æˆ–æŸä¸ªæ—¶é—´æ®µå†…çš„æŸä¸ªæ´»åŠ¨â€å°±æ˜¯MIã€‚    å››è‰²åŸå‹â€æœ‰ä¸€ä¸ªè§„åˆ™ï¼šå°±æ˜¯MIï¼ˆäº‹ä»¶ï¼‰ä¸èƒ½ä¸PPTï¼ˆäº‹ç‰©ï¼‰ç›´æ¥æ‰“äº¤é“ï¼Œå¿…é¡»é€šè¿‡ROLEï¼ˆè§’è‰²ï¼‰æ¥æ‰“äº¤é“ã€‚ä¾‹å¦‚ï¼šåªæœ‰ä¹°å®¶æ‰èƒ½ä¸‹è®¢å•ï¼Œè®¢å•åªèƒ½é€šè¿‡ä¹°å®¶ä¸ç”¨æˆ·å…³è”å››è‰²å»ºæ¨¡æ³•åŒ…æ‹¬    æ—¶æ ‡å‹ï¼ˆMoment-Intervalï¼‰å¯¹è±¡ï¼šå…·æœ‰å¯è¿½æº¯æ€§çš„è®°å½•è¿è¥æˆ–ç®¡ç†æ•°æ®çš„æ—¶åˆ»æˆ–æ—¶æ®µå¯¹è±¡ï¼Œç”¨ç²‰çº¢è‰²è¡¨ç¤º    PPTï¼ˆParty/Place/Thingï¼‰å¯¹è±¡ï¼šä»£è¡¨å‚ä¸åˆ°æµç¨‹ä¸­çš„å‚ä¸æ–¹/åœ°ç‚¹/ç‰©ï¼Œç”¨ç»¿è‰²è¡¨ç¤º    è§’è‰²ï¼ˆRoleï¼‰å¯¹è±¡ï¼šåœ¨æ—¶æ ‡å‹å¯¹è±¡ä¸ PPT å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯å‚ä¸æ–¹ï¼‰ä¹‹é—´å‚ä¸çš„è§’è‰²ï¼Œç”¨é»„è‰²è¡¨ç¤º    æè¿°ï¼ˆDescriptionï¼‰å¯¹è±¡ï¼šå¯¹ PPT å¯¹è±¡çš„ä¸€ç§è¡¥å……æè¿°ï¼Œç”¨è“è‰²è¡¨ç¤ºå››è‰²åŸå‹æ³•è®¾è®¡é¢†åŸŸæ¨¡å‹çš„æ­¥éª¤ï¼š    1.æ ¹æ®éœ€æ±‚ï¼Œé‡‡ç”¨å››è‰²åŸå‹åˆ†ææ³•å»ºç«‹ä¸€ä¸ªåˆæ­¥çš„é¢†åŸŸæ¨¡å‹ï¼›    2.è¿›ä¸€æ­¥åˆ†æé¢†åŸŸæ¨¡å‹ï¼Œè¯†åˆ«å‡ºå“ªäº›æ˜¯å®ä½“ï¼Œå“ªäº›æ˜¯å€¼å¯¹è±¡ï¼Œå“ªäº›æ˜¯é¢†åŸŸæœåŠ¡ï¼›    3.å¯¹å®ä½“ã€å€¼å¯¹è±¡è¿›è¡Œå…³è”å’Œèšåˆï¼Œæç‚¼å‡ºèšåˆè¾¹ç•Œå’Œèšåˆæ ¹ï¼›    4.ä¸ºèšåˆæ ¹è®¾è®¡ä»“å‚¨ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªèšåˆåˆ†é…ä¸€ä¸ªä»“å‚¨ï¼‰ï¼ŒåŒæ—¶ï¼Œæ€è€ƒå®ä½“ã€å€¼å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼Œæ˜¯é€šè¿‡å·¥å‚åˆ›å»ºï¼Œè¿˜æ˜¯ç›´æ¥é€šè¿‡æ„é€ å‡½æ•°ï¼›    5.èµ°æŸ¥éœ€æ±‚åœºæ™¯ï¼ŒéªŒè¯è®¾è®¡çš„é¢†åŸŸæ¨¡å‹çš„åˆç†æ€§ã€‚</code></pre><h4 id="æ ‡å‡†é¡¹ç›®æ¨¡å—è§£é‡Š"><a href="#æ ‡å‡†é¡¹ç›®æ¨¡å—è§£é‡Š" class="headerlink" title="æ ‡å‡†é¡¹ç›®æ¨¡å—è§£é‡Š"></a>æ ‡å‡†é¡¹ç›®æ¨¡å—è§£é‡Š</h4><pre><code class="textmate">1.Interface     å¯¹å¤–æä¾›æœåŠ¡ï¼ŒåŒ…æ‹¬Controllerã€é˜²è…å±‚-facadeã€å¯¹è±¡è½¬æ¢-assemblerã€å‡ºå‚å…¥å‚å¯¹è±¡-dto2.Application     åº”ç”¨å±‚,åŒ…æ‹¬æœåŠ¡å±‚-service(ä¸»è¦ä½œç”¨æ˜¯æ“ä½œ èšåˆæ ¹+ä»“å‚¨)3.Domain    é¢†åŸŸå±‚,åŒ…æ‹¬é¢†åŸŸå¯¹è±¡-entity(ä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹è±¡å°è£…æ“ä½œ)ã€é¢†åŸŸæœåŠ¡-EntityService(ä¸å±äºä»»ä½•ä¸€ä¸ªé¢†åŸŸå¯¹è±¡çš„å…¶ä»–ä¸šåŠ¡æˆ–å¤æ‚ä¸šåŠ¡é€»è¾‘)ã€å€¼å¯¹è±¡-ValueObjects é¢†åŸŸäº‹ä»¶-DomainEventã€ä»“å‚¨æ¥å£å®šä¹‰-repository4.Infrastructure    åŸºç¡€è®¾æ–½å±‚,åŒ…æ‹¬æŒä¹…åŒ–è®¾ç½®-PersistenceFacilities(ä»“å‚¨å®ç°)ã€å·¥å…·ç±»ç­‰ï¼›æ”¯æŒä»¥ä¸Šæ¨¡å—</code></pre><h3 id="DDDæ ¸å¿ƒæ¦‚å¿µ"><a href="#DDDæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="DDDæ ¸å¿ƒæ¦‚å¿µ"></a>DDDæ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><p>å®ä½“</p></li><li><p>å€¼å¯¹è±¡</p></li><li><p>èšåˆ</p></li><li><p>ä»“å‚¨</p></li><li><p>å·¥å‚</p></li><li><p>ä»“å‚¨</p><pre><code class="textmate">å®ä½“(Entities):å…·æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡å€¼å¯¹è±¡(Value Objects): æ— éœ€å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡é¢†åŸŸæœåŠ¡(Domain Services): ä¸€äº›è¡Œä¸ºæ— æ³•å½’ç±»åˆ°å®ä½“å¯¹è±¡æˆ–å€¼å¯¹è±¡ä¸Š,æœ¬è´¨æ˜¯ä¸€äº›æ“ä½œ,è€Œéäº‹ç‰©èšåˆ/èšåˆæ ¹(Aggregates,Aggregate Roots): èšåˆæ˜¯æŒ‡ä¸€ç»„å…·æœ‰å†…èšå…³ç³»çš„ç›¸å…³å¯¹è±¡çš„é›†åˆ,æ¯ä¸ªèšåˆéƒ½æœ‰ä¸€ä¸ªrootå’Œboundaryå·¥å‚(Factories): åˆ›å»ºå¤æ‚å¯¹è±¡,éšè—åˆ›å»ºç»†èŠ‚ä»“å‚¨(Repository): æä¾›æŸ¥æ‰¾å’ŒæŒä¹…åŒ–å¯¹è±¡çš„æ–¹æ³•</code></pre></li><li><p>DDDæ¶æ„å›¾</p><img src="https://im-fan.gitee.io/img/ddd/ddd-framework.png"/></li></ul><h4 id="è¯†åˆ«é¢†åŸŸæœåŠ¡"><a href="#è¯†åˆ«é¢†åŸŸæœåŠ¡" class="headerlink" title="è¯†åˆ«é¢†åŸŸæœåŠ¡"></a>è¯†åˆ«é¢†åŸŸæœåŠ¡</h4><pre><code class="textmate">ä¸»è¦çœ‹å®ƒæ˜¯å¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªç‰¹å¾ï¼š    1. æœåŠ¡æ‰§è¡Œçš„æ“ä½œä»£è¡¨äº†ä¸€ä¸ªé¢†åŸŸæ¦‚å¿µï¼Œè¿™ä¸ªé¢†åŸŸæ¦‚å¿µæ— æ³•è‡ªç„¶åœ°éš¶å±äºä¸€ä¸ªå®ä½“æˆ–è€…å€¼å¯¹è±¡ã€‚    2. è¢«æ‰§è¡Œçš„æ“ä½œæ¶‰åŠåˆ°é¢†åŸŸä¸­çš„å…¶ä»–çš„å¯¹è±¡ã€‚    3. æ“ä½œæ˜¯æ— çŠ¶æ€çš„ã€‚</code></pre><h4 id="ä»“å‚¨ç›¸å…³"><a href="#ä»“å‚¨ç›¸å…³" class="headerlink" title="ä»“å‚¨ç›¸å…³"></a>ä»“å‚¨ç›¸å…³</h4><ul><li>CQRS<pre><code class="textmate">å°†æŸ¥è¯¢å•ç‹¬åˆ’åˆ†ä¸ºåº”ç”¨ç³»ç»Ÿçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå°†ä¿®æ”¹ï¼ˆå‘½ä»¤ï¼‰å•ç‹¬åˆ’åˆ†ä¸ºå¦å¤–ä¸€ä¸ªåˆ†æ”¯æ¥æ“ä½œé¢†åŸŸå¯¹è±¡ã€‚è¿™æ˜¯DDDçš„å¦å¤–ä¸€ç§æ¨¡å¼ï¼Œè‹±æ–‡ç®€å†™ï¼šCQRS</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>14ç§å¸¸ç”¨è®¾è®¡æ¨¡å¼</title>
      <link href="/2020/10/02/framework/design-model/"/>
      <url>/2020/10/02/framework/design-model/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="http://www.runoob.com/design-pattern">èœé¸Ÿæ•™ç¨‹</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzI4ODQ3NjE2OA==&mid=2247485687&idx=2&sn=d1a405491311488c576197b556d357ec&chksm=ec3c9590db4b1c86a13ff39894dbeead2bbcee738a58da96bcb1bc404b6a948bd1f38312176a&mpshare=1&scene=1&srcid=&sharer_sharetime=1570684867528&sharer_shareid=4c8872b4436b495590f58ccf1453ba58&rd2werd=1#wechat_redirect">è®¾è®¡æ¨¡å¼åœ¨Springæ¡†æ¶ä¸­çš„è‰¯å¥½å®è·µ</a><br><a href="https://github.com/im-fan/my-design-mode.git">å®ç°çš„demo</a></p></blockquote><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="è®¾è®¡æ¨¡å¼çš„ç±»å‹"><a href="#è®¾è®¡æ¨¡å¼çš„ç±»å‹" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„ç±»å‹"></a>è®¾è®¡æ¨¡å¼çš„ç±»å‹</h3><img class="magplus" title="è®¾è®¡æ¨¡å¼ç±»å‹" src="https://im-fan.gitee.io/img/design-model/design-model-type.jpg" alt="è®¾è®¡æ¨¡å¼ç±»å‹" width="700" height="840"><h3 id="è®¾è®¡æ¨¡å¼å®è·µçš„å…³ç³»"><a href="#è®¾è®¡æ¨¡å¼å®è·µçš„å…³ç³»" class="headerlink" title="è®¾è®¡æ¨¡å¼å®è·µçš„å…³ç³»"></a>è®¾è®¡æ¨¡å¼å®è·µçš„å…³ç³»</h3><img class="magplus" title="è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»" src="http://www.runoob.com/wp-content/uploads/2014/08/the-relationship-between-design-patterns.jpg" alt="è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»" width="700" height="840"><h3 id="è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™</h3><pre><code>1ã€å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰    å¼€é—­åŸåˆ™çš„æ„æ€æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ã€‚2ã€é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰    é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“æ´¾ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œä¸”è½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å¼€é—­åŸåˆ™çš„è¡¥å……ã€‚å®ç°å¼€é—­åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ï¼Œè€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚3ã€ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰    è¿™ä¸ªåŸåˆ™æ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚4ã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰    è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€æ˜¯ï¼šé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç”±æ­¤å¯è§ï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ã€ä¾¿äºå‡çº§å’Œç»´æŠ¤çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚5ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆç§°æœ€å°‘çŸ¥é“åŸåˆ™ï¼ˆDemeter Principleï¼‰    æœ€å°‘çŸ¥é“åŸåˆ™æ˜¯æŒ‡ï¼šä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘åœ°ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚6ã€åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰    åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚</code></pre><h2 id="æ¨¡å¼è¯¦è§£"><a href="#æ¨¡å¼è¯¦è§£" class="headerlink" title="æ¨¡å¼è¯¦è§£"></a>æ¨¡å¼è¯¦è§£</h2><h3 id="1-ç­–ç•¥æ¨¡å¼-Strategy"><a href="#1-ç­–ç•¥æ¨¡å¼-Strategy" class="headerlink" title="1.ç­–ç•¥æ¨¡å¼(Strategy)"></a>1.ç­–ç•¥æ¨¡å¼(Strategy)</h3><pre><code>å®šä¹‰ä¸ªç­–ç•¥æ¥å£ï¼Œä¸åŒçš„å®ç°ç±»æä¾›ä¸åŒçš„å…·ä½“ç­–ç•¥ç®—æ³•ï¼Œé€šè¿‡contextæ–¹æ³•ç¡®å®šæ–¹æ³•æ‰§è¡Œæ—¶å…·ä½“æ‰§è¡Œé‚£ä¸ªå­ç±»çš„æ–¹æ³•ï¼Œå±äºè¡Œä¸ºå‹æ¨¡å¼æ··åˆä½¿ç”¨(https://blog.csdn.net/pengpegV5yaya/article/details/25189253)ä¼˜ç‚¹ï¼š 1ã€ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ 2ã€é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚ 3ã€æ‰©å±•æ€§è‰¯å¥½ã€‚ç¼ºç‚¹ï¼š 1ã€ç­–ç•¥ç±»ä¼šå¢å¤šã€‚ 2ã€æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚æ³¨æ„äº‹é¡¹ï¼šå¦‚æœä¸€ä¸ªç³»ç»Ÿçš„ç­–ç•¥å¤šäºå››ä¸ªï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æ··åˆæ¨¡å¼ï¼Œè§£å†³ç­–ç•¥ç±»è†¨èƒ€çš„é—®é¢˜</code></pre><ul><li>ç¤ºä¾‹å›¾ç‰‡<br/><img src="http://www.runoob.com/wp-content/uploads/2014/08/strategy_pattern_uml_diagram.jpg" /></li></ul><h3 id="2-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory"><a href="#2-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory" class="headerlink" title="2.ç®€å•å·¥å‚æ¨¡å¼( Simple Factory )"></a>2.ç®€å•å·¥å‚æ¨¡å¼( Simple Factory )</h3><pre><code>å®šä¹‰ä¸€ä¸ªç”¨ä»¥åˆ›å»ºå¯¹è±¡çš„å·¥å‚, æ ¹æ®ä¸åŒçš„æ¡ä»¶[ä¼ å‚/åå°„]ç”Ÿæˆä¸åŒçš„å¯¹è±¡ï¼Œå±äºåˆ›å»ºå‹æ¨¡å¼- ä¼˜ç‚¹ï¼šå·¥å‚ç±»æ˜¯æ•´ä¸ªæ¨¡å¼çš„å…³é”®.åŒ…å«äº†å¿…è¦çš„é€»è¾‘åˆ¤æ–­,æ ¹æ®å¤–ç•Œç»™å®šçš„ä¿¡æ¯,å†³å®šç©¶ç«Ÿåº”è¯¥åˆ›å»ºå“ªä¸ªå…·ä½“ç±»çš„å¯¹è±¡.é€šè¿‡ä½¿ç”¨å·¥å‚ç±»,å¤–ç•Œä»…ä»…éœ€è¦è´Ÿè´£â€œæ¶ˆè´¹â€å¯¹è±¡å°±å¯ä»¥äº†ã€‚è€Œä¸å¿…ç®¡è¿™äº›å¯¹è±¡ç©¶ç«Ÿå¦‚ä½•åˆ›å»ºåŠå¦‚ä½•ç»„ç»‡çš„ã€‚- ç¼ºç‚¹ï¼šç”±äºå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰å®ä¾‹çš„åˆ›å»ºé€»è¾‘ï¼Œè¿åäº†é«˜å†…èšè´£ä»»åˆ†é…åŸåˆ™ï¼Œå°†å…¨éƒ¨åˆ›å»ºé€»è¾‘é›†ä¸­åˆ°äº†ä¸€ä¸ªå·¥å‚ç±»ä¸­ï¼›å®ƒæ‰€èƒ½åˆ›å»ºçš„ç±»åªèƒ½æ˜¯äº‹å…ˆè€ƒè™‘åˆ°çš„ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°çš„ç±»ï¼Œåˆ™å°±éœ€è¦æ”¹å˜å·¥å‚ç±»äº†ã€‚å½“ç³»ç»Ÿä¸­çš„å…·ä½“äº§å“ç±»ä¸æ–­å¢å¤šæ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°è¦æ±‚å·¥å‚ç±»æ ¹æ®ä¸åŒæ¡ä»¶åˆ›å»ºä¸åŒå®ä¾‹çš„éœ€æ±‚ï¼è¿™ç§å¯¹æ¡ä»¶çš„åˆ¤æ–­å’Œå¯¹å…·ä½“äº§å“ç±»å‹çš„åˆ¤æ–­äº¤é”™åœ¨ä¸€èµ·ï¼Œå¾ˆéš¾é¿å…æ¨¡å—åŠŸèƒ½çš„è”“å»¶ï¼Œå¯¹ç³»ç»Ÿçš„ç»´æŠ¤å’Œæ‰©å±•éå¸¸ä¸åˆ©ï¼›</code></pre><h3 id="3-å·¥å‚æ¨¡å¼-Factory"><a href="#3-å·¥å‚æ¨¡å¼-Factory" class="headerlink" title="3.å·¥å‚æ¨¡å¼( Factory )"></a>3.å·¥å‚æ¨¡å¼( Factory )</h3><pre><code>é’ˆå¯¹æ¯ä¸€ç§äº§å“æä¾›ä¸€ä¸ªå·¥å‚ç±»ï¼Œé€šè¿‡ä¸åŒçš„å·¥å‚å®ä¾‹æ¥åˆ›å»ºä¸åŒçš„äº§å“å®ä¾‹ã€‚ç®€å•å·¥å‚æ˜¯ä¸€ç§äº§å“ï¼Œå·¥å‚æ˜¯å¤šç§äº§å“</code></pre><h3 id="4-æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract-Factory"><a href="#4-æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract-Factory" class="headerlink" title="4.æŠ½è±¡å·¥å‚æ¨¡å¼( Abstract Factory )"></a>4.æŠ½è±¡å·¥å‚æ¨¡å¼( Abstract Factory )</h3><pre><code>https://blog.csdn.net/hguisu/article/details/7505909åº”å¯¹äº§å“æ—æ¦‚å¿µè€Œç”Ÿï¼Œå±äºåˆ›å»ºå‹æ¨¡å¼åŒºåˆ«ç®€å•å·¥å‚ ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„ä»»æ„äº§å“ã€‚ï¼ˆå¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›ï¼‰     ä¾‹ï¼šé€ äº†ä¸€ä¸ªå·¥å‚ï¼Œåªèƒ½ç”Ÿäº§ å®é©¬å’Œæ¯”äºšè¿ªæ±½è½¦ï¼›å¦‚æœéœ€è¦åˆ¶é€ å…¶ä»–è½¦ç³»ï¼Œå·¥å‚è¦æ”¹é€ å‡çº§å·¥å‚æ–¹æ³• ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„å›ºå®šäº§å“ã€‚ï¼ˆæ”¯æŒå¢åŠ ä»»æ„äº§å“ï¼‰     ä¾‹ï¼šæ ¹æ®å·¥å‚å›¾çº¸é€ äº†ä¸¤ä¸ªå·¥å‚ï¼Œåˆ†åˆ«ç”Ÿäº§å®é©¬å’Œæ¯”äºšè¿ªæ±½è½¦ï¼›å¦‚æœéœ€è¦åˆ¶é€ å…¶ä»–è½¦ç³»ï¼ŒæŒ‰ç…§å›¾çº¸å†é€ ä¸€ä¸ªå·¥å‚ï¼› ä½†æ— æ³•ç”Ÿäº§é™¤äº†è½¦ä»¥å¤–çš„å…¶ä»–äº§å“æŠ½è±¡å·¥å‚ ï¼šç”¨æ¥ç”Ÿäº§ä¸åŒäº§å“æ—çš„å…¨éƒ¨äº§å“ã€‚ï¼ˆå¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›ï¼›æ”¯æŒå¢åŠ äº§å“æ—ï¼‰    ä¾‹ï¼šæ”¶è´­äº†ä¸ªæ±½è½¦ç©ºè°ƒå‚ï¼Œå°†å·¥å‚å›¾çº¸å’Œç©ºè°ƒå‚å›¾çº¸åˆå¹¶æˆä¸€ä¸ªå›¾çº¸ï¼›å»ºæ–°å‚æ—¶æŒ‰ç…§æ–°çš„å›¾çº¸ï¼Œå…ˆå»ºé€ å‡ºæœ‰ç©ºè°ƒ+æ±½è½¦ç”Ÿäº§çº¿çš„å‚ï¼Œåœ¨åˆ©ç”¨ä¸åŒç”Ÿäº§çº¿ç”Ÿäº§æ±½è½¦å’Œå¯¹åº”çš„æ±½è½¦ç©ºè°ƒï¼›å¦‚æœéœ€è¦ä¸€ä¸ªäº”è±è½¦å‚ï¼Œä¸æ”¯æŒå•ç‹¬å»ºäº”è±è½¦å‚ï¼Œä½†æ˜¯å¯ä»¥æ–°å»ºå¸¦ç©ºè°ƒçš„äº”è±è½¦å‚1ï¼‰è¿˜æ²¡æœ‰å·¥å‚æ—¶ä»£ï¼šå‡å¦‚è¿˜æ²¡æœ‰å·¥ä¸šé©å‘½ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·è¦ä¸€æ¬¾å®é©¬è½¦,ä¸€èˆ¬çš„åšæ³•æ˜¯å®¢æˆ·å»åˆ›å»ºä¸€æ¬¾å®é©¬è½¦ï¼Œç„¶åæ‹¿æ¥ç”¨ã€‚2ï¼‰ç®€å•å·¥å‚æ¨¡å¼ï¼šåæ¥å‡ºç°å·¥ä¸šé©å‘½ã€‚ç”¨æˆ·ä¸ç”¨å»åˆ›å»ºè½¦ã€‚å› ä¸ºå®¢æˆ·æœ‰ä¸€ä¸ªå·¥å‚æ¥å¸®ä»–åˆ›å»º.æƒ³è¦ä»€ä¹ˆè½¦ï¼Œè¿™ä¸ªå·¥å‚å°±å¯ä»¥å»ºã€‚æ¯”å¦‚æƒ³è¦å®é©¬è½¦ã€‚å·¥å‚å°±åˆ›å»ºè¿™ä¸ªç³»åˆ—çš„è½¦ã€‚å³å·¥å‚å¯ä»¥åˆ›å»ºäº§å“ã€‚3ï¼‰å·¥å‚æ–¹æ³•æ¨¡å¼æ—¶ä»£ï¼šä¸ºäº†æ»¡è¶³å®¢æˆ·ï¼Œè½¦å“ç‰Œè¶Šæ¥è¶Šå¤šï¼Œå¦‚å®é©¬ã€æ¯”äºšè¿ªç­‰ï¼Œä¸€ä¸ªå·¥å‚æ— æ³•åˆ›å»ºæ‰€æœ‰çš„è½¦å‹ã€‚äºæ˜¯ç”±å•ç‹¬åˆ†å‡ºæ¥å¤šä¸ªå…·ä½“çš„å·¥å‚ã€‚æ¯ä¸ªå…·ä½“å·¥å‚åˆ›å»ºä¸€ç§ç³»åˆ—ã€‚å³å…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ã€‚ä½†æ˜¯è½¿è½¦å·¥å‚è¿˜æ˜¯ä¸ªæŠ½è±¡ã€‚ä½ éœ€è¦æŒ‡å®šæŸä¸ªå…·ä½“çš„å·¥å‚æ‰èƒ½ç”Ÿäº§è½¦å‡ºæ¥ã€‚4ï¼‰æŠ½è±¡å·¥å‚æ¨¡å¼æ—¶ä»£ï¼šéšç€å®¢æˆ·çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œè½¿è½¦å¿…é¡»é…ç½®ç©ºè°ƒã€‚äºæ˜¯è¿™ä¸ªå·¥å‚å¼€å§‹ç”Ÿäº§è½¿è½¦å’Œéœ€è¦çš„ç©ºè°ƒã€‚æœ€ç»ˆæ˜¯å®¢æˆ·åªè¦å¯¹è½¿è½¦çš„é”€å”®å‘˜è¯´ï¼šæˆ‘è¦å®é©¬ç©ºè°ƒè½¦ï¼Œé”€å”®å‘˜å°±ç›´æ¥ç»™ä»–å®é©¬ç©ºè°ƒè½¦äº†ã€‚è€Œä¸ç”¨è‡ªå·±å»åˆ›å»ºè½¦.</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/3E13CDD1-2CD2-4C66-BD33-DECBF172AE03.jpg" alt="æŠ½è±¡å·¥å‚æ¨¡å¼çš„ UML å›¾"><h3 id="5-è£…é¥°å™¨æ¨¡å¼-Decorator"><a href="#5-è£…é¥°å™¨æ¨¡å¼-Decorator" class="headerlink" title="5.è£…é¥°å™¨æ¨¡å¼( Decorator )"></a>5.è£…é¥°å™¨æ¨¡å¼( Decorator )</h3><pre><code>åŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå±äºç»“æ„å‹æ¨¡å¼ä¼˜ç‚¹ï¼šè£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚ç¼ºç‚¹ï¼šå¤šå±‚è£…é¥°æ¯”è¾ƒå¤æ‚ã€‚ä½¿ç”¨åœºæ™¯ï¼š 1ã€æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚ 2ã€åŠ¨æ€å¢åŠ åŠŸèƒ½ï¼ŒåŠ¨æ€æ’¤é”€ã€‚æ³¨æ„äº‹é¡¹ï¼šå¯ä»£æ›¿ç»§æ‰¿ã€‚å…¶ä»–ï¼šä¸‹å›¾ï¼ŒRedShapeDecorator extends ShapeDecorator</code></pre><img src="http://www.runoob.com/wp-content/uploads/2014/08/decorator_pattern_uml_diagram.jpg" alt="è£…é¥°å™¨æ¨¡å¼çš„UMLå›¾"/><h3 id="6-ä»£ç†æ¨¡å¼-Proxy"><a href="#6-ä»£ç†æ¨¡å¼-Proxy" class="headerlink" title="6.ä»£ç†æ¨¡å¼( Proxy )"></a>6.ä»£ç†æ¨¡å¼( Proxy )</h3><pre><code>å°è£…è¢«ä»£ç†å¯¹è±¡å¹¶é™åˆ¶å¤–ç•Œå¯¹è¢«ä»£ç†å¯¹è±¡çš„è®¿é—®ï¼Œå±äºç»“æ„å‹æ¨¡å¼å…³é”®ä»£ç ï¼šå®ç°ä¸è¢«ä»£ç†ç±»ç»„åˆã€‚ä¼˜ç‚¹ï¼š 1ã€èŒè´£æ¸…æ™°ã€‚ 2ã€é«˜æ‰©å±•æ€§ã€‚ 3ã€æ™ºèƒ½åŒ–ã€‚ç¼ºç‚¹ï¼š 1ã€ç”±äºåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®ä¸»é¢˜ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤æœ‰äº›ç±»å‹çš„ä»£ç†æ¨¡å¼å¯èƒ½ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚ 2ã€å®ç°ä»£ç†æ¨¡å¼éœ€è¦é¢å¤–çš„å·¥ä½œï¼Œæœ‰äº›ä»£ç†æ¨¡å¼çš„å®ç°éå¸¸å¤æ‚ã€‚æ³¨æ„äº‹é¡¹ï¼š1ã€å’Œé€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šé€‚é…å™¨æ¨¡å¼ä¸»è¦æ”¹å˜æ‰€è€ƒè™‘å¯¹è±¡çš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ä¸èƒ½æ”¹å˜æ‰€ä»£ç†ç±»çš„æ¥å£ã€‚2ã€å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šè£…é¥°å™¨æ¨¡å¼ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†åŠ ä»¥æ§åˆ¶ã€‚</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/20201015-proxy.svg" alt="ä»£ç†æ¨¡å¼çš„UMLå›¾"><h3 id="7-æ¨¡æ¿æ–¹æ³•æ¨¡å¼-Template"><a href="#7-æ¨¡æ¿æ–¹æ³•æ¨¡å¼-Template" class="headerlink" title="7.æ¨¡æ¿æ–¹æ³•æ¨¡å¼( Template )"></a>7.æ¨¡æ¿æ–¹æ³•æ¨¡å¼( Template )</h3><pre><code>1.å®šä¹‰ä¸€ä¸ªæ“ä½œçš„ç®—æ³•éª¨æ¶, å¹¶å°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­2.ä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ–¹å¼/æ¨¡æ¿ã€‚å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚ä¼˜ç‚¹ï¼š 1ã€å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ 2ã€æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ 3ã€è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚ç¼ºç‚¹ï¼šæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚ä½¿ç”¨åœºæ™¯ï¼š 1ã€æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒã€‚ 2ã€é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³•ã€‚æ³¨æ„äº‹é¡¹ï¼šä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ï¼Œå¦åˆ™æ‰©å±•ç±»å°±å¯ä»¥è‡ªå·±å®ç°æ¨¡æ¿æ–¹æ³•ã€‚</code></pre><img src="http://www.runoob.com/wp-content/uploads/2014/08/template_pattern_uml_diagram.jpg" alt="æ¨¡æ¿æ¨¡å¼çš„ UML å›¾"><h3 id="8-å¤–è§‚æ¨¡å¼-Facade"><a href="#8-å¤–è§‚æ¨¡å¼-Facade" class="headerlink" title="8.å¤–è§‚æ¨¡å¼( Facade )"></a>8.å¤–è§‚æ¨¡å¼( Facade )</h3><pre><code>ä¸ºç³»ç»Ÿå‘å¤–ç•Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ï¼ˆå¯¹ä½¿ç”¨è€…æ¥è¯´ï¼Œåªå…³ç³»éœ€è¦çš„ç»“æœï¼Œä¸å…³å¿ƒæ€ä¹ˆå®ç°çš„ï¼‰ï¼›å±äºç»“æ„å‹æ¨¡å¼ç®€å•ç†è§£ï¼šç”µè„‘å¼€æœºå…³æœºå¯åŠ¨ç”µè„‘ï¼ˆæŒ‰ä¸€ä¸‹ç”µæºé”®ï¼‰ï¼šå¯åŠ¨CPUã€å¯åŠ¨å†…å­˜ã€å¯åŠ¨ç¡¬ç›˜å…³é—­ç”µè„‘ï¼ˆæŒ‰ä¸€ä¸‹ç”µæºé”®ï¼‰ï¼šå…³é—­ç¡¬ç›˜ã€å…³é—­å†…å­˜ã€å…³é—­CPUä¼˜ç‚¹ï¼š 1ã€å‡å°‘ç³»ç»Ÿç›¸äº’ä¾èµ–ã€‚ 2ã€æé«˜çµæ´»æ€§ã€‚ 3ã€æé«˜äº†å®‰å…¨æ€§ã€‚ç¼ºç‚¹ï¼šä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœè¦æ”¹ä¸œè¥¿å¾ˆéº»çƒ¦ï¼Œç»§æ‰¿é‡å†™éƒ½ä¸åˆé€‚ã€‚ä½¿ç”¨åœºæ™¯ï¼š 1ã€ä¸ºå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›å¤–ç•Œè®¿é—®çš„æ¨¡å—ã€‚ 2ã€å­ç³»ç»Ÿç›¸å¯¹ç‹¬ç«‹ã€‚ 3ã€é¢„é˜²ä½æ°´å¹³äººå‘˜å¸¦æ¥çš„é£é™©ã€‚æ³¨æ„äº‹é¡¹ï¼šåœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ã€‚</code></pre><h3 id="9-é€‚é…å™¨æ¨¡å¼-Adapter"><a href="#9-é€‚é…å™¨æ¨¡å¼-Adapter" class="headerlink" title="9.é€‚é…å™¨æ¨¡å¼( Adapter )"></a>9.é€‚é…å™¨æ¨¡å¼( Adapter )</h3><pre><code>å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚å±äºç»“æ„å‹æ¨¡å¼ç®€å•ç†è§£ï¼šç”¨äºç°æœ‰ä¸šåŠ¡ç»´æŠ¤ï¼Œæ•´åˆä¸šåŠ¡é€»è¾‘ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥æ‰§è¡Œå…·ä½“æŸä¸ªä¸šåŠ¡ä¼˜ç‚¹ï¼š 1ã€å¯ä»¥è®©ä»»ä½•ä¸¤ä¸ªæ²¡æœ‰å…³è”çš„ç±»ä¸€èµ·è¿è¡Œã€‚ 2ã€æé«˜äº†ç±»çš„å¤ç”¨ã€‚ 3ã€å¢åŠ äº†ç±»çš„é€æ˜åº¦ã€‚ 4ã€çµæ´»æ€§å¥½ã€‚ç¼ºç‚¹ï¼š1ã€è¿‡å¤šåœ°ä½¿ç”¨é€‚é…å™¨ï¼Œä¼šè®©ç³»ç»Ÿéå¸¸é›¶ä¹±ï¼Œä¸æ˜“æ•´ä½“è¿›è¡ŒæŠŠæ¡ã€‚æ¯”å¦‚ï¼Œæ˜æ˜çœ‹åˆ°è°ƒç”¨çš„æ˜¯ A æ¥å£ï¼Œå…¶å®å†…éƒ¨è¢«é€‚é…æˆäº† B æ¥å£çš„å®ç°ã€‚å› æ­¤å¦‚æœä¸æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œå¯ä»¥ä¸ä½¿ç”¨é€‚é…å™¨ï¼Œè€Œæ˜¯ç›´æ¥å¯¹ç³»ç»Ÿè¿›è¡Œé‡æ„ã€‚2.ç”±äº JAVA è‡³å¤šç»§æ‰¿ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è‡³å¤šåªèƒ½é€‚é…ä¸€ä¸ªé€‚é…è€…ç±»ï¼Œè€Œä¸”ç›®æ ‡ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»ã€‚ä½¿ç”¨åœºæ™¯ï¼šæœ‰åŠ¨æœºåœ°ä¿®æ”¹ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç³»ç»Ÿçš„æ¥å£ï¼Œè¿™æ—¶åº”è¯¥è€ƒè™‘ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ã€‚æ³¨æ„äº‹é¡¹ï¼šé€‚é…å™¨ä¸æ˜¯åœ¨è¯¦ç»†è®¾è®¡æ—¶æ·»åŠ çš„ï¼Œè€Œæ˜¯è§£å†³æ­£åœ¨æœå½¹çš„é¡¹ç›®çš„é—®é¢˜ã€‚</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/20201204-adapter.png" alt="é€‚é…å™¨æ¨¡å¼çš„UMLå›¾"><h3 id="10-æ¡¥æ¥æ¨¡å¼-Bridge"><a href="#10-æ¡¥æ¥æ¨¡å¼-Bridge" class="headerlink" title="10.æ¡¥æ¥æ¨¡å¼( Bridge )"></a>10.æ¡¥æ¥æ¨¡å¼( Bridge )</h3><pre><code>å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ã€‚å±äºç»“æ„å‹æ¨¡å¼ä¼˜ç‚¹ï¼š 1ã€æŠ½è±¡å’Œå®ç°çš„åˆ†ç¦»ã€‚ 2ã€ä¼˜ç§€çš„æ‰©å±•èƒ½åŠ›ã€‚ 3ã€å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚ç¼ºç‚¹ï¼šæ¡¥æ¥æ¨¡å¼çš„å¼•å…¥ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œç”±äºèšåˆå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ã€‚ä½¿ç”¨åœºæ™¯ï¼š 1ã€å¦‚æœä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ï¼Œé¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„ç»§æ‰¿è”ç³»ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å¯ä»¥ä½¿å®ƒä»¬åœ¨æŠ½è±¡å±‚å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ã€‚ 2ã€å¯¹äºé‚£äº›ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ çš„ç³»ç»Ÿï¼Œæ¡¥æ¥æ¨¡å¼å°¤ä¸ºé€‚ç”¨ã€‚ 3ã€ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•ã€‚æ³¨æ„äº‹é¡¹ï¼šå¯¹äºä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼å†é€‚åˆä¸è¿‡äº†ã€‚</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/20201015-bridge.svg" alt="æ¡¥æ¥æ¨¡å¼çš„UMLå›¾"><h3 id="11-å»ºé€ è€…æ¨¡å¼-Builder"><a href="#11-å»ºé€ è€…æ¨¡å¼-Builder" class="headerlink" title="11.å»ºé€ è€…æ¨¡å¼( Builder )"></a>11.å»ºé€ è€…æ¨¡å¼( Builder )</h3><pre><code>ä½¿ç”¨å¤šä¸ªç®€å•çš„å¯¹è±¡ä¸€æ­¥ä¸€æ­¥æ„å»ºæˆä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å±äºåˆ›å»ºå‹æ¨¡å¼ä¼˜ç‚¹ï¼š 1ã€å»ºé€ è€…ç‹¬ç«‹ï¼Œæ˜“æ‰©å±•ã€‚ 2ã€ä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ã€‚ç¼ºç‚¹ï¼š 1ã€äº§å“å¿…é¡»æœ‰å…±åŒç‚¹ï¼ŒèŒƒå›´æœ‰é™åˆ¶ã€‚ 2ã€å¦‚å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œä¼šæœ‰å¾ˆå¤šçš„å»ºé€ ç±»ã€‚æ³¨æ„äº‹é¡¹ï¼šä¸å·¥å‚æ¨¡å¼çš„åŒºåˆ«æ˜¯ï¼šå»ºé€ è€…æ¨¡å¼æ›´åŠ å…³æ³¨ä¸é›¶ä»¶è£…é…çš„é¡ºåºã€‚</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/20201015-builder-pattern.svg" alt="å»ºé€ è€…æ¨¡å¼çš„UMLå›¾"><h3 id="12-è§‚å¯Ÿè€…æ¨¡å¼-Observer"><a href="#12-è§‚å¯Ÿè€…æ¨¡å¼-Observer" class="headerlink" title="12.è§‚å¯Ÿè€…æ¨¡å¼( Observer )"></a>12.è§‚å¯Ÿè€…æ¨¡å¼( Observer )</h3><pre><code>å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»,è®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸»é¢˜å¯¹è±¡,åœ¨å®ƒçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶,ä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚è§‚å¯Ÿè€…æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚ä¼˜ç‚¹ï¼š 1ã€è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æŠ½è±¡è€¦åˆçš„ã€‚ 2ã€å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚ç¼ºç‚¹ï¼š    1ã€è§‚å¯Ÿè€…å¤ªå¤šæ—¶ï¼Œé€šçŸ¥è§‚å¯Ÿè€…ä¼šè€—æ—¶æ¯”è¾ƒä¹…    2ã€å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚    3ã€è§‚å¯Ÿè€…æ¨¡å¼ä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚æ³¨æ„äº‹é¡¹ï¼š    1ã€JAVA ä¸­å·²ç»æœ‰äº†å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒç±»ã€‚    2ã€é¿å…å¾ªç¯å¼•ç”¨ã€‚    3ã€å¦‚æœé¡ºåºæ‰§è¡Œï¼ŒæŸä¸€è§‚å¯Ÿè€…é”™è¯¯ä¼šå¯¼è‡´ç³»ç»Ÿå¡å£³ï¼Œä¸€èˆ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚</code></pre><img src="http://www.runoob.com/wp-content/uploads/2014/08/observer_pattern_uml_diagram.jpg" alt="è§‚å¯Ÿè€…æ¨¡å¼çš„ UML å›¾"><h3 id="13-å•ä¾‹æ¨¡å¼-Singleton"><a href="#13-å•ä¾‹æ¨¡å¼-Singleton" class="headerlink" title="13.å•ä¾‹æ¨¡å¼( Singleton )"></a>13.å•ä¾‹æ¨¡å¼( Singleton )</h3><pre><code>ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹,å¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€æ§åˆ¶ç‚¹.ä¼˜ç‚¹ï¼š1ã€åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹ï¼ˆæ¯”å¦‚ç®¡ç†å­¦é™¢é¦–é¡µé¡µé¢ç¼“å­˜ï¼‰ã€‚2ã€é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚   ç¼ºç‚¹ï¼šæ²¡æœ‰æ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸å•ä¸€èŒè´£åŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€ä¹ˆæ ·æ¥å®ä¾‹åŒ–ã€‚å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼1.æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨   ä¸åŠ é” synchronizedï¼Œæ‰€ä»¥ä¸¥æ ¼æ„ä¹‰ä¸Šå®ƒå¹¶ä¸ç®—å•ä¾‹æ¨¡å¼ã€‚è¿™ç§æ–¹å¼ lazy loading å¾ˆæ˜æ˜¾ï¼Œä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ä¸èƒ½æ­£å¸¸å·¥ä½œ2.æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨    åŠ é” synchronizedï¼Œæ–¹å¼å…·å¤‡å¾ˆå¥½çš„ lazy loadingï¼Œèƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ä¸­å¾ˆå¥½çš„å·¥ä½œï¼Œä½†æ˜¯ï¼Œæ•ˆç‡å¾ˆä½ï¼Œ99% æƒ…å†µä¸‹ä¸éœ€è¦åŒæ­¥ã€‚    ä¼˜ç‚¹ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨æ‰åˆå§‹åŒ–ï¼Œé¿å…å†…å­˜æµªè´¹ã€‚    ç¼ºç‚¹ï¼šå¿…é¡»åŠ é” synchronized æ‰èƒ½ä¿è¯å•ä¾‹ï¼Œä½†åŠ é”ä¼šå½±å“æ•ˆç‡ã€‚getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºä¸æ˜¯å¾ˆå…³é”®ï¼ˆè¯¥æ–¹æ³•ä½¿ç”¨ä¸å¤ªé¢‘ç¹ï¼‰ã€‚3ã€é¥¿æ±‰å¼    ä¼˜ç‚¹ï¼šæ²¡æœ‰åŠ é”ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šæé«˜ã€‚    ç¼ºç‚¹ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚4ã€åŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼Œå³ double-checked lockingï¼‰    è¿™ç§æ–¹å¼é‡‡ç”¨åŒé”æœºåˆ¶ï¼Œå®‰å…¨ä¸”åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºå¾ˆå…³é”®ã€‚5ã€ç™»è®°å¼/é™æ€å†…éƒ¨ç±»    è¿™ç§æ–¹å¼èƒ½è¾¾åˆ°åŒæ£€é”æ–¹å¼ä¸€æ ·çš„åŠŸæ•ˆï¼Œä½†å®ç°æ›´ç®€å•ã€‚å¯¹é™æ€åŸŸä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåº”ä½¿ç”¨è¿™ç§æ–¹å¼è€Œä¸æ˜¯åŒæ£€é”æ–¹å¼ã€‚è¿™ç§æ–¹å¼åªé€‚ç”¨äºé™æ€åŸŸçš„æƒ…å†µï¼ŒåŒæ£€é”æ–¹å¼å¯åœ¨å®ä¾‹åŸŸéœ€è¦å»¶è¿Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚6ã€æšä¸¾    è¿™ç§å®ç°æ–¹å¼è¿˜æ²¡æœ‰è¢«å¹¿æ³›é‡‡ç”¨ï¼Œä½†è¿™æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹æ³•ã€‚å®ƒæ›´ç®€æ´ï¼Œè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚ç»éªŒä¹‹è°ˆï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ç¬¬ 1 ç§å’Œç¬¬ 2 ç§æ‡’æ±‰æ–¹å¼ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ 3 ç§é¥¿æ±‰æ–¹å¼ã€‚åªæœ‰åœ¨è¦æ˜ç¡®å®ç° lazy loading æ•ˆæœæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ç¬¬ 5 ç§ç™»è®°æ–¹å¼ã€‚å¦‚æœæ¶‰åŠåˆ°ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç¬¬ 6 ç§æšä¸¾æ–¹å¼ã€‚å¦‚æœæœ‰å…¶ä»–ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ 4 ç§åŒæ£€é”æ–¹å¼ã€‚</code></pre><h3 id="14-å‘½ä»¤æ¨¡å¼-Command"><a href="#14-å‘½ä»¤æ¨¡å¼-Command" class="headerlink" title="14.å‘½ä»¤æ¨¡å¼( Command )"></a>14.å‘½ä»¤æ¨¡å¼( Command )</h3><pre><code>å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸ºä¸€ä¸ªå¯¹è±¡, ä½¿å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ä¼˜ç‚¹ï¼š1ã€é™ä½äº†ç³»ç»Ÿè€¦åˆåº¦ã€‚2ã€æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ åˆ°ç³»ç»Ÿä¸­å»ã€‚ç¼ºç‚¹ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚</code></pre><img src="https://www.runoob.com/wp-content/uploads/2014/08/20201015-command-1.svg" alt="å‘½ä»¤æ¨¡å¼çš„ UML å›¾">]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CanalæœåŠ¡æ­å»º</title>
      <link href="/2020/10/02/backend/storage/canal/"/>
      <url>/2020/10/02/backend/storage/canal/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><h3 id="ä¸»è¦ç”¨é€”"><a href="#ä¸»è¦ç”¨é€”" class="headerlink" title="ä¸»è¦ç”¨é€”"></a>ä¸»è¦ç”¨é€”</h3><pre><code class="textmate">åŸºäº MySQL æ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…å’Œæ¶ˆè´¹ã€‚</code></pre><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><ul><li>æ•°æ®åº“é•œåƒ</li><li>æ•°æ®åº“å®æ—¶å¤‡ä»½</li><li>ç´¢å¼•æ„å»ºå’Œå®æ—¶ç»´æŠ¤(æ‹†åˆ†å¼‚æ„ç´¢å¼•ã€å€’æ’ç´¢å¼•ç­‰)</li><li>ä¸šåŠ¡ cache åˆ·æ–°</li><li>å¸¦ä¸šåŠ¡é€»è¾‘çš„å¢é‡æ•°æ®å¤„ç†</li></ul><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><pre><code class="textmate">åŸºäºMySQLä¸»å¤‡å¤åˆ¶åŸç†,ä¼ªè£…æˆMySQL slave,æ¨¡æ‹ŸMySQL slaveçš„äº¤äº’åè®®,å‘MySQL materå‘é€dumpåè®®,MySQL materæ”¶åˆ°canalå‘é€è¿‡æ¥çš„dumpè¯·æ±‚ï¼Œå¼€å§‹æ¨é€binary logç»™canalï¼Œcanalè§£æbinary logï¼Œå†å‘é€åˆ°å…¶ä»–å­˜å‚¨æœåŠ¡ä¸­ï¼Œå¦‚: MySQLï¼ŒRocketMQï¼ŒESç­‰ç­‰ã€‚</code></pre><h2 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h2><h2 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h2><h3 id="1-ç›´æ¥éƒ¨ç½²"><a href="#1-ç›´æ¥éƒ¨ç½²" class="headerlink" title="1.ç›´æ¥éƒ¨ç½²"></a>1.ç›´æ¥éƒ¨ç½²</h3><pre><code class="textmate">1.ä¸‹è½½å®‰è£…åŒ…(ç‚¹å‡»ä¸Šé¢Release)    è¿™é‡Œç”¨1.1.4ç‰ˆæœ¬,ä¸‹è½½ canal.deployer-1.1.4.tar.gz(ä¸»è¦ç¨‹åº) å’Œ canal.admin-1.1.4.tar.gz(ç®¡ç†ç¨‹åº)2.è§£å‹&amp;é…ç½®    mkdir canal-deployer    mkdir canal-admin    tar -zxvf canal.deployer-1.1.4.tar.gz -C canal-deployer    tar -zxvg canal.admin-1.1.4.tar.gz -C canal-admin    ä¿®æ”¹ canal-deployer/conf ä¸­ canal.properties(å‚è€ƒ å¿«é€Ÿå¼€å§‹ï¼Œæˆ–å‚è€ƒåº•éƒ¨é…ç½®)3.ä¿®æ”¹Instanceé…ç½®    cd cd canal-deployer/conf/example/instance.properties    å‚è€ƒå®˜ç½‘æˆ–åº•éƒ¨instance.peropertiesé…ç½®4.å¤šInstance - å¯é€‰    cd canal-deployer/conf    cp -R example example2    ä¿®æ”¹example2ä¸­é…ç½®5.é…ç½®canal-admin    åˆå§‹åŒ–æ•°æ®è„šæœ¬ï¼Œè„šæœ¬æ‰€åœ¨ä½ç½® canal-admin/conf/canal_manager.sql    ä¿®æ”¹é…ç½®ï¼Œé…ç½®æ‰€åœ¨ä½ç½® canal-admin/conf/application.yml    ä¿®æ”¹å…¶ä¸­çš„æ•°æ®åº“é…ç½®ã€ç«¯å£å·ã€ç”¨æˆ·åå¯†ç ç­‰-å¯é€‰6.å¯åŠ¨    6-1.canal-adminå¯åŠ¨( è®¿é—®é“¾æ¥ localhost:80 )        sh ./canal-admin/bin/startup.sh    6-2.canal-serverå¯åŠ¨        sh ./canal-deployer/bin/startup.sh    6-3.æ—¥å¿—æ‰€åœ¨æ–‡ä»¶å¤¹        cd canal-deployer/logs</code></pre><h3 id="2ã€Dockeræ­å»ºæ­¥éª¤"><a href="#2ã€Dockeræ­å»ºæ­¥éª¤" class="headerlink" title="2ã€Dockeræ­å»ºæ­¥éª¤"></a>2ã€Dockeræ­å»ºæ­¥éª¤</h3><blockquote><p>dockeræ–¹å¼éƒ¨ç½²,æ³¨æ„é…ç½®æ—¶mysqlçš„IPåœ°å€</p></blockquote><h4 id="2-1ã€å‡†å¤‡"><a href="#2-1ã€å‡†å¤‡" class="headerlink" title="2.1ã€å‡†å¤‡"></a>2.1ã€å‡†å¤‡</h4><pre><code class="textmate">1.mysql  éœ€è¦ç¡®è®¤mysqlå·²å¼€å¯binlogè®¾ç½®2.æ‹‰å–canal-serveré•œåƒ  docker pull canal/canal-server:v1.1.43.ä¸‹è½½dockerå¯åŠ¨è„šæœ¬   wget https://github.com/alibaba/canal/blob/master/docker/run.sh4.ä¿®æ”¹å¯åŠ¨è„šæœ¬ä¸­æ•°æ®åº“é…ç½®5.ä¸‹è½½canal-adminåŒ…,ä¿®æ”¹é…ç½®(æˆ–è€…å¤åˆ¶run.shå¹¶ä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼Œå¯åŠ¨canal-admin)-å¯é€‰   wget https://github.com/alibaba/canal/releases/download/canal-1.1.4/canal.admin-1.1.4.tar.gz   mkdir canal-admin   tar -zxvf canal.admin-1.1.4.tar.gz -C canal-admin   ä¿®æ”¹conf/application.ymlä¸­æ•°æ®åº“é…ç½®   åˆå§‹åŒ–mysqlè„šæœ¬ï¼Œconf/canal_manager.sql6.canal-client   å‚è€ƒ Canal Client Example</code></pre><h4 id="2-2ã€å¯åŠ¨å‘½ä»¤"><a href="#2-2ã€å¯åŠ¨å‘½ä»¤" class="headerlink" title="2.2ã€å¯åŠ¨å‘½ä»¤"></a>2.2ã€å¯åŠ¨å‘½ä»¤</h4><pre><code class="textmate">1.canal-server   è¿è¡Œ sh run.sh ä¼šå‡ºç°æç¤ºï¼Œå¤åˆ¶æç¤ºåè¿è¡Œ2.canal-admin   sh bin/startup.sh3.å¯åŠ¨ç¨‹åº(canal-client)    æˆåŠŸåä¼šæ‰“å°å‡ºempty count : xx</code></pre><h3 id="CanalAdminéƒ¨ç½²"><a href="#CanalAdminéƒ¨ç½²" class="headerlink" title="CanalAdminéƒ¨ç½²"></a>CanalAdminéƒ¨ç½²</h3><ul><li><p>1.é›†ç¾¤é…ç½®</p><pre><code class="yaml">#é›†ç¾¤å-local#zkåœ°å€-127.0.0.1:2181 (å¯ä»¥ä¸æ­å»ºzk)#ä»¥ä¸‹ä¸ºé…ç½®é¡¹# register ipcanal.register.ip =# canal admin configcanal.admin.manager = 127.0.0.1:8089canal.admin.port = 11110canal.admin.user = admincanal.admin.passwd = 4ACFE3202A5FF5CF467898FC58AAB1D615029441</code></pre></li><li><p>2.Serverç®¡ç†</p><pre><code class="textmate">ServerIP-127.0.0.1 (åŒä¸€é›†ç¾¤ä¸‹server ipä¸èƒ½é‡å¤)adminç«¯å£å·-11110</code></pre></li><li><p>3.Instanceç®¡ç†</p><pre><code class="textmate">æ³¨æ„ï¼šInstanceåç§°è¦ä¸cancal-serverå®¹å™¨ä¸­æ–‡ä»¶å¤¹ä¸€è‡´ï¼Œé»˜è®¤æœ‰exampleInstanceé…ç½®é¡¹å‚è€ƒå®˜ç½‘æˆ–åº•éƒ¨é…ç½®</code></pre></li></ul><h4 id="ä¸€ä¸ªCanalæœåŠ¡è¯»å–å¤šä¸ªMySQLå®ä¾‹-dockerä¸­æ“ä½œ"><a href="#ä¸€ä¸ªCanalæœåŠ¡è¯»å–å¤šä¸ªMySQLå®ä¾‹-dockerä¸­æ“ä½œ" class="headerlink" title="ä¸€ä¸ªCanalæœåŠ¡è¯»å–å¤šä¸ªMySQLå®ä¾‹(dockerä¸­æ“ä½œ)"></a>ä¸€ä¸ªCanalæœåŠ¡è¯»å–å¤šä¸ªMySQLå®ä¾‹(dockerä¸­æ“ä½œ)</h4><pre><code class="textmate">1.è¿›å…¥canalå®¹å™¨å†…éƒ¨å…³é—­æœåŠ¡(ä¸å…³é—­å¤åˆ¶ä¼šå¯¼è‡´å†™å…¥db2å¤±è´¥)    docker exec -it canal-server bash    ./stop.sh2.å¤åˆ¶ä¸€ä»½Instatnceé…ç½®(æ³¨æ„ç¡®è®¤example2ä¸­æ–‡ä»¶æƒé™ä¸exampleä¸­æ˜¯å¦ä¸€æ ·)    cd canal-server/conf    cp -R example example23.Canal Adminä¸­æ·»åŠ æ–°é…ç½®    Instanceåç§°-example24.é›†æˆzookeeper    ä¿®æ”¹canal-server/conf/ä¸‹é…ç½®canal.properties    canal.register.ip = zkæœåŠ¡å™¨IP    canal.zkServers = zkæœåŠ¡å™¨IP:2181</code></pre><h3 id="å‚è€ƒé…ç½®-åŸºç¡€ç‰ˆï¼Œå…¶ä»–é…ç½®å‚è€ƒå®˜ç½‘"><a href="#å‚è€ƒé…ç½®-åŸºç¡€ç‰ˆï¼Œå…¶ä»–é…ç½®å‚è€ƒå®˜ç½‘" class="headerlink" title="å‚è€ƒé…ç½®(åŸºç¡€ç‰ˆï¼Œå…¶ä»–é…ç½®å‚è€ƒå®˜ç½‘)"></a>å‚è€ƒé…ç½®(åŸºç¡€ç‰ˆï¼Œå…¶ä»–é…ç½®å‚è€ƒå®˜ç½‘)</h3><ul><li><p>canal.properties</p><pre><code class="yaml"># ç”¨ä»¥ä¸‹é…ç½®é¡¹æ˜¯éœ€è¦ä¿®æ”¹çš„ï¼Œå…¶ä»–é»˜è®¤é…ç½®é¡¹ä¿ç•™åŸæ¥è®¾ç½®# canalåœ°å€canal.register.ip = zkæ‰€åœ¨åœ°å€# zké…ç½®ï¼Œå¦‚æœæœ‰ç”¨åˆ°åˆ™é…ç½®ï¼Œæ²¡ç”¨åˆ°åˆ™ä¿ç•™é»˜è®¤è®¾ç½®canal.admin.register.auto = truecanal.admin.register.cluster = 192.168.154.231:2181canal.zkServers = 192.168.154.231:2181</code></pre></li><li><p>instance.properties</p><pre><code class="yaml"># ç”¨ä»¥ä¸‹é…ç½®é¡¹æ˜¯éœ€è¦ä¿®æ”¹çš„ï¼Œå…¶ä»–é»˜è®¤é…ç½®é¡¹ä¿ç•™åŸæ¥è®¾ç½®(example2é…ç½®åŒä¸‹)# æ•°æ®åº“é…ç½®canal.instance.master.address= æ•°æ®åº“IP:ç«¯å£å·canal.instance.dbUsername = ç”¨æˆ·å canal.instance.dbPassword = å¯†ç canal.instance.defaultDatabaseName = è¦ç›‘æ§çš„åº“åï¼Œä¸è®¾ç½®åˆ™ç›‘å¬å½“å‰å®ä¾‹ä¸‹æ‰€æœ‰åº“canal.instance.connectionCharset = UTF-8canal.instance.tsdb.enable=false</code></pre></li></ul><h4 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h4><ul><li><p>æœåŠ¡éƒ½å¯åŠ¨æˆåŠŸï¼Œå®¢æˆ·ç«¯æ‹‰ä¸åˆ°å˜æ›´æ—¥å¿—</p><pre><code class="textmate">æ³¨æ„å®¢æˆ·ç«¯ä¸­ canalConnector.subscribe() ä¸­è®¾ç½®é¡¹ï¼Œè®¾ç½®äº†å€¼åˆ™æœåŠ¡ä¸­é…ç½®çš„è¿‡æ»¤æ¡ä»¶ä¸ç”Ÿæ•ˆå‚è€ƒé…ç½® canalConnector.subscribe(&quot;sap_system\\..*,user_center\\..*&quot;)</code></pre></li><li><p>ä¸€ä¸ªCanal-Service,å¤šä¸ªclientï¼Œè¿è¡Œæ—¶æŠ¥é”™</p><pre><code class="textmate">æ”¹ä¸ºä¸€ä¸ªcanalä¸€ä¸ªclientï¼ŒåŸå› æ˜¯å¤šä¸ªclientåŒæ—¶æäº¤ackæ—¶ï¼Œå¯èƒ½ä¼šå­˜åœ¨é‡å¤æäº¤çš„é—®é¢˜</code></pre></li><li><p>zkä¸­è®°å½•çš„ç‚¹ä½å¼‚å¸¸</p><pre><code class="textmate">è¿›å…¥zookeeperå®‰è£…ç›®å½• cd /bin./zkClient.sh  æˆ–  ./zkCli.shdeleteall /otter/canal/destinations/instanceName(canal-adminä¸­é…ç½®çš„instanceåç§°)</code></pre></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><pre><code class="textmate">1.å¯¹ä¸šåŠ¡ä»£ç æ— ä¾µå…¥ã€å®æ—¶æ€§æ¥è¿‘å‡†å®æ—¶2.æ”¯æŒé›†ç¾¤ï¼Œé›†ç¾¤åŸºäºzkåšé›†ç¾¤ç®¡ç†3.æä¾›å¤šç§æ¥å…¥æ–¹å¼ã€é€‚é…å™¨ç­‰3.ä¸é€‚åˆåšå¤æ‚çš„ä¸šåŠ¡é€»è¾‘åˆ¤æ–­åŠè®¡ç®—ï¼›ç›´æ¥å¯¹è¡¨æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå‡ºé—®é¢˜åå½±å“è¾ƒå¤§</code></pre><h2 id="ç›¸å…³ç½‘å€"><a href="#ç›¸å…³ç½‘å€" class="headerlink" title="ç›¸å…³ç½‘å€"></a>ç›¸å…³ç½‘å€</h2><ul><li><a href="https://github.com/alibaba/canal/wiki/Home">å®˜ç½‘</a></li><li><a href="https://github.com/alibaba/canal/wiki/QuickStart">å¿«é€Ÿå¼€å§‹</a></li><li><a href="https://github.com/alibaba/canal/releases">Releaseä¸‹è½½</a></li><li><a href="https://hub.docker.com/r/canal/canal-server/tags/">Dockeré•œåƒåœ°å€</a></li><li><a href="https://github.com/alibaba/canal/wiki/Canal-Admin-QuickStart">Canal Admin QuickStart</a></li><li><a href="https://github.com/alibaba/canal/wiki/ClientExample">Canal Client Example</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç›¸å…³-å¸¸ç”¨è¯­å¥</title>
      <link href="/2020/10/02/backend/storage/mysql-other/"/>
      <url>/2020/10/02/backend/storage/mysql-other/</url>
      
        <content type="html"><![CDATA[<h3 id="å»ºè¡¨è¯­å¥"><a href="#å»ºè¡¨è¯­å¥" class="headerlink" title="å»ºè¡¨è¯­å¥"></a>å»ºè¡¨è¯­å¥</h3><pre><code class="sql">1.è¡¨ç»“æ„å®Œå…¨å¤åˆ¶create table user_bak LIKE user;2.ä½¿ç”¨æŸäº›å­—æ®µå»ºè¡¨create table user_bak select now() as time ;3.å»ºè¡¨æ—¶å­—æ®µå€¼å¼ºåˆ¶è½¬æ¢create table user_bak select CAST(&#39;2019-8-01&#39; as UNSIGNED) as time;4.ä¸´æ—¶è¡¨è§£é‡Š: åªå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆ,æœ‰åŒåè¡¨åˆ™åŸè¡¨éšè—ä¸å¯è§,ä¼šè¯ç»“æŸè‡ªåŠ¨æ¸…é™¤create temporary table user_bak  like user;drop temporary table user_bak;</code></pre><h3 id="Castç±»å‹å¼ºåˆ¶è½¬æ¢"><a href="#Castç±»å‹å¼ºåˆ¶è½¬æ¢" class="headerlink" title="Castç±»å‹å¼ºåˆ¶è½¬æ¢"></a>Castç±»å‹å¼ºåˆ¶è½¬æ¢</h3><pre><code class="sql">è¯­æ³•:     Cast(å­—æ®µå as è½¬æ¢çš„ç±»å‹ )æ”¯æŒçš„ç±»å‹:    CHAR[(N)] å­—ç¬¦å‹     DATE æ—¥æœŸå‹    DATETIME æ—¥æœŸå’Œæ—¶é—´å‹    DECIMAL floatå‹    SIGNED int    TIME æ—¶é—´å‹åœºæ™¯:    1.è§£å†³utf8å­—ç¬¦æŸ¥è¯¢æ—¶ä¼ å…¥è¡¨æƒ…ç¬¦ï¼Œå¯¼è‡´æŠ¥é”™ï¼›</code></pre><h3 id="æ–°å»ºåˆ†åŒºè¡¨"><a href="#æ–°å»ºåˆ†åŒºè¡¨" class="headerlink" title="æ–°å»ºåˆ†åŒºè¡¨"></a>æ–°å»ºåˆ†åŒºè¡¨</h3><ul><li><p>ç¤ºä¾‹</p><pre><code class="sql">create table user_bak (id int(11) UNSIGNED AUTO_INCREMENT ,`name` varchar(200) DEFAULT null COMMENT &#39;åç§°&#39;,rand_num int(11) DEFAULT NULL COMMENT &#39;éšæœºæ•°&#39;,birthday datetime default null comment &#39;ç”Ÿæ—¥&#39;,PRIMARY KEY (`id`,rand_num)) ENGINE = INNODB partition by RANGE (rand_num)(  PARTITION p0 VALUES less THAN (20),  PARTITION p1 VALUES less THAN (40),  PARTITION p2 VALUES less THAN (60),  PARTITION p3 VALUES less THAN (80),  PARTITION p4 VALUES less THAN MAXVALUE);</code></pre></li><li><p>æ³¨æ„ç‚¹</p></li></ul><pre><code class="textmate">1.PRIMARYå¿…é¡»åŒ…å«åˆ†åŒºçš„å­—æ®µ2.ä¸èƒ½å•ç‹¬åˆ›å»ºåˆ†åŒºï¼Œå»ºè¡¨æ—¶å°±è¦åˆ›å»º</code></pre><ul><li>å¸¸è§å¼‚å¸¸</li></ul><pre><code class="textmate">1.ERROR 1064  ä¸èƒ½å•ç‹¬åˆ›å»ºåˆ†åŒºè§£å†³ï¼šå»ºè¡¨æ—¶å°±è¦æŠŠåˆ†åŒºåˆ›å»ºå¥½2.ERROR 1503 ä¸»é”®å¿…é¡»åŒ…å«åˆ†åŒºå‡½æ•°ä¸­æ‰€æœ‰åˆ—è§£å†³ï¼šåˆ›å»ºåˆ†åŒºçš„å­—æ®µå¿…é¡»æ”¾åœ¨ä¸»é”®ç´¢å¼•ä¸­</code></pre><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><pre><code class="sql">-- 1.ALL - æŸ¥è¯¢è¿”å›å•ä¸ªç»“æœ,ç±»ä¼¼inæ“ä½œselect * from user_bak where (id) &gt;= ALL(select id from user_bak where id = 10)-- 2.ANY &amp; SUM -æ•ˆæœä¸€æ ·,ç±»ä¼¼oræ“ä½œselect * from user_bak where (name,id) = SOME(select name,id from user_bak where id = 1 or name = &#39;eee&#39;)</code></pre><h3 id="FullTextå…¨æ–‡æœç´¢"><a href="#FullTextå…¨æ–‡æœç´¢" class="headerlink" title="FullTextå…¨æ–‡æœç´¢"></a>FullTextå…¨æ–‡æœç´¢</h3><ul><li>å…¨æ–‡æœç´¢ç±»å‹</li></ul><pre><code class="textmate">1.è‡ªç„¶è¯­è¨€æœç´¢-æœç´¢åŒ…å«åŒ¹é…è¯çš„ä¿¡æ¯2.å¸ƒå°”æ¨¡å¼æœç´¢-3.æŸ¥è¯¢æ‰©å±•æœç´¢</code></pre><ul><li>åˆ›å»ºç´¢å¼•éœ€è¦æ»¡è¶³çš„æ¡ä»¶</li></ul><pre><code class="textmate">1.è¡¨ç±»å‹ä¸ºMyISAM,version5.6ä»¥åå¼•å…¥äº†å¯¹InnoDBæ”¯æŒ2.å­—æ®µç±»å‹åªèƒ½æ˜¯char/varchar/textç±»å‹3.å…¨æ–‡æœç´¢ä¼šè‡ªåŠ¨å¿½ç•¥æ‰å¸¸ç”¨è¯(åœ¨è®°å½•ä¸­å‡ºç°å‡ ç‡ä¸º50%ä»¥ä¸Š)-éªŒè¯å¯ä»¥æŸ¥å‡ºæ¥4.åœç”¨è¯ä¼šè¢«è¿‡æ»¤æ‰(the/after/otherç­‰)5.å°‘äº4ä¸ªå­—ç¬¦ä¼šè¢«å¿½ç•¥ï¼ŒæŸ¥ä¸å‡ºæ¥(é»˜è®¤4-84ä¸ªå­—ç¬¦èŒƒå›´ï¼Œå¯æ›´æ”¹)</code></pre><ul><li>è¯­æ³•</li></ul><pre><code class="sql">-- è‡ªç„¶è¯­è¨€select *,match(`name`) against(&#39;good boy&#39;) as &#39;percentage&#39; from `user` where match(`name`) against(&#39;good boy&#39;);-- å¸ƒå°”æ¨¡å¼select *,match(`name`) against(&#39;good boy&#39; in boolean MODE) as &#39;percentage&#39; from `user` where match(`name`) against(&#39;good boy&#39; in boolean MODE);-- å†…å®¹é¡ºåºå®Œå…¨åŒ¹é…select *,match(`name`) against(&#39;&quot;good boy&quot;&#39; in boolean MODE) as &#39;percentage&#39; from `user` where match(`name`) against(&#39;&quot;good boy&quot;&#39; in boolean MODE);-- æ‰©å±•æŸ¥è¯¢select *,match(`name`) against(&#39;good boy&#39; with query expansion) as &#39;percentage&#39; from `user` where match(`name`) against(&#39;good boy&#39;  with query expansion);</code></pre><ul><li>ä¿®æ”¹æŸ¥è¯¢å­—ç¬¦é•¿åº¦</li></ul><pre><code class="textmate">1.my.cnfæ–‡ä»¶ä¸­ft_min_word_len2.é‡å»ºFullTextç´¢å¼•æˆ–è€…å¿«é€Ÿä¿®å¤repair table table_name quick;</code></pre><h2 id="å­—ç¬¦é›†"><a href="#å­—ç¬¦é›†" class="headerlink" title="å­—ç¬¦é›†"></a>å­—ç¬¦é›†</h2><h3 id="æœ‰å­—ç¬¦é›†æœ‰å…³çš„ç³»ç»Ÿè®¾ç½®"><a href="#æœ‰å­—ç¬¦é›†æœ‰å…³çš„ç³»ç»Ÿè®¾ç½®" class="headerlink" title="æœ‰å­—ç¬¦é›†æœ‰å…³çš„ç³»ç»Ÿè®¾ç½®"></a>æœ‰å­—ç¬¦é›†æœ‰å…³çš„ç³»ç»Ÿè®¾ç½®</h3><pre><code class="yaml">character_set_system ç”¨äºå­˜å‚¨çš„å­—ç¬¦é›†character_set_server æœåŠ¡å™¨é»˜è®¤å­—ç¬¦é›†collation_server  ç³»ç»Ÿæ’åºè§„åˆ™character_set_database æ•°æ®åº“å­—ç¬¦é›†collation_database  æ•°æ®åº“æ’åºè§„åˆ™character_set_client å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€SQLæ—¶ä½¿ç”¨çš„å­—ç¬¦é›†character_set_result è¡¨ç¤ºæœåŠ¡å™¨è¿”å›ç»“æœæ—¶ä½¿ç”¨çš„å­—ç¬¦é›†character_set_connection è¿æ¥æ—¶ä½¿ç”¨çš„å­—ç¬¦ä¸²character_set_filesystem æ–‡ä»¶ç³»ç»Ÿå­—ç¬¦é›†</code></pre><h3 id="ç©ºé—´å€¼"><a href="#ç©ºé—´å€¼" class="headerlink" title="ç©ºé—´å€¼"></a>ç©ºé—´å€¼</h3><pre><code class="textmate">OpenGISè§„èŒƒpoint ç±»å‹å€¼,åªæ”¯æŒInnoDB/MyISAM/NDB/ARCHIVEå¼•æ“point(xxxx,xxxx)</code></pre><h3 id="æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢"><a href="#æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢" class="headerlink" title="æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢"></a>æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢</h3><pre><code class="textmate">1.like    % åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦åºåˆ—    _ åªèƒ½åŒ¹é…å•ä¸ªå­—ç¬¦    \%  \_  è½¬ä¹‰2.REGEXP-æ­£åˆ™æŸ¥è¯¢</code></pre><h3 id="æ–°å»ºç”¨æˆ·åæˆæƒ"><a href="#æ–°å»ºç”¨æˆ·åæˆæƒ" class="headerlink" title="æ–°å»ºç”¨æˆ·åæˆæƒ"></a>æ–°å»ºç”¨æˆ·åæˆæƒ</h3><pre><code class="sql">-- %è¡¨ç¤ºæ‰€æœ‰IPå¯è¿æ¥CREATE USER `ç”¨æˆ·å`@`%` IDENTIFIED BY &#39;å¯†ç &#39;;grant all privileges on jwgateway.* to &#39;ç”¨æˆ·å&#39;@&#39;%&#39; identified by &#39;å¯†ç &#39;;select * from mysql.user;</code></pre><h3 id="åˆ¤æ–­æ—¶é—´ä¸å·²æœ‰è®°å½•æ˜¯å¦é‡å "><a href="#åˆ¤æ–­æ—¶é—´ä¸å·²æœ‰è®°å½•æ˜¯å¦é‡å " class="headerlink" title="åˆ¤æ–­æ—¶é—´ä¸å·²æœ‰è®°å½•æ˜¯å¦é‡å "></a>åˆ¤æ–­æ—¶é—´ä¸å·²æœ‰è®°å½•æ˜¯å¦é‡å </h3><pre><code class="sql">-- 1.æ–¹æ³•ä¸€SELECT * FROM test_tableWHERE (start_time &gt;= startT AND start_time &lt; endT)   OR (start_time &lt;= startT AND end_time &gt; endT)   OR (end_time &gt;= startT AND end_time &lt; endT)-- 2.æ–¹æ³•äºŒSELECT * FROM test_table WHERE NOT ( (end_time &lt; startT OR (start_time &gt; endT) )</code></pre><h3 id="åˆ¤æ–­æ—¶é—´é—´éš”ä¸èƒ½é‡å "><a href="#åˆ¤æ–­æ—¶é—´é—´éš”ä¸èƒ½é‡å " class="headerlink" title="åˆ¤æ–­æ—¶é—´é—´éš”ä¸èƒ½é‡å "></a>åˆ¤æ–­æ—¶é—´é—´éš”ä¸èƒ½é‡å </h3><pre><code class="sql">set @start=&#39;2022-06-08&#39;,@end=&#39;2022-06-10&#39;;select * FROM xxx WHERE (    (start_time &lt;= @start and end_time &gt;= @end )     or (start_time &gt;= @start and end_time &gt;= @end and start_time &lt; @end)     or (start_time &lt;= @start and end_time &lt;= @end and end_time &gt; @start )     or (start_time &gt;= @start and end_time &lt;= @end))-- è§£é‡Š/*æ—¶é—´é‡å æƒ…å†µ    startTime    endTime  start |   end     |  start |           |    end        | start end |        |           |*/</code></pre><h3 id="MySQL8-0å¤§æ•°æ®è¡¨æ·»åŠ varcharå­—æ®µ"><a href="#MySQL8-0å¤§æ•°æ®è¡¨æ·»åŠ varcharå­—æ®µ" class="headerlink" title="MySQL8.0å¤§æ•°æ®è¡¨æ·»åŠ varcharå­—æ®µ"></a>MySQL8.0å¤§æ•°æ®è¡¨æ·»åŠ varcharå­—æ®µ</h3><blockquote><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-online-ddl-operations.html">MySQL8.0å®˜ç½‘æ–‡æ¡£</a></p></blockquote><pre><code class="sql">-- åŸç”Ÿåªæ”¯æŒåœ¨è¡¨ä¸­è¿½åŠ å­—æ®µï¼Œä¸å¯ä»¥éšæ„ä½ç½®æ’å…¥å­—æ®µupdate xxx add column name varchar(255),ALGORITHM=INSTANT;/*ä½œç”¨ï¼šæŒ‡å®šæ“ä½œä½¿ç”¨çš„ç®—æ³•ç±»å‹    COPYï¼šå¯¹åŸå§‹è¡¨çš„å‰¯æœ¬æ‰§è¡Œæ“ä½œï¼Œå¹¶å°†è¡¨æ•°æ®ä»åŸå§‹è¡¨é€è¡Œå¤åˆ¶åˆ°æ–°è¡¨ã€‚ä¸å…è®¸å¹¶å‘DMLã€‚    INPLACEï¼šæ“ä½œå¯é¿å…å¤åˆ¶è¡¨æ•°æ®ï¼Œä½†å¯ä»¥åœ¨é€‚å½“ä½ç½®é‡å»ºè¡¨ã€‚åœ¨æ“ä½œçš„å‡†å¤‡å’Œæ‰§è¡Œé˜¶æ®µå¯ä»¥ç®€çŸ­åœ°è·å–è¡¨ä¸Šçš„ç‹¬å å…ƒæ•°æ®é”å®šã€‚é€šå¸¸ï¼Œæ”¯æŒå¹¶å‘DMLã€‚    INSTANTï¼šæ“ä½œåªèƒ½ä¿®æ”¹æ•°æ®å­—å…¸ä¸­çš„å…ƒæ•°æ®ã€‚åœ¨å‡†å¤‡å’Œæ‰§è¡ŒæœŸé—´ï¼Œä¸ä¼šåœ¨è¡¨ä¸Šè·å–ä»»ä½•ç‹¬å å…ƒæ•°æ®é”ï¼Œå¹¶ä¸”è¡¨æ•°æ®ä¸å—å½±å“ï¼Œä»è€Œä½¿æ“ä½œç«‹å³è¿›è¡Œã€‚å…è®¸å¹¶å‘DMLã€‚ï¼ˆåœ¨MySQL 8.0.12ä¸­å¼•å…¥ï¼‰INSTANT åŸç†ï¼š    åœ¨ INNODB_COLUMNS.DEFAULT_VALUEã€INNODB_COLUMNS.HAS_DEFAULTã€INNODB_TABLES.INSTANT_COLS    è¡¨ä¸­æ·»åŠ é…ç½®ä¿¡æ¯ï¼Œæ ‡è¯†æ·»åŠ instantå­—æ®µå‰å­—æ®µæ•°ã€instantå­—æ®µæ˜¯å¦æœ‰é»˜è®¤å€¼ï¼Œinstantæ·»åŠ çš„å­—æ®µå;    ä¸ä¼šå°†æ·»åŠ çš„å­—æ®µå†™å…¥dbæ–‡ä»¶ï¼Œåªæœ‰æ“ä½œäº†æ•°æ®(insert/update)åï¼Œæ‰ä¼šå°†å®Œæ•´ç»“æ„çš„æ•°æ®æ›´æ–°è‡³dbæ–‡ä»¶*/</code></pre><h3 id="æŸ¥çœ‹NavicatPremiumä¸­çš„è¿æ¥å¯†ç "><a href="#æŸ¥çœ‹NavicatPremiumä¸­çš„è¿æ¥å¯†ç " class="headerlink" title="æŸ¥çœ‹NavicatPremiumä¸­çš„è¿æ¥å¯†ç "></a>æŸ¥çœ‹NavicatPremiumä¸­çš„è¿æ¥å¯†ç </h3><h4 id="1-NaivatPremiumå¯¼å‡ºè¿æ¥"><a href="#1-NaivatPremiumå¯¼å‡ºè¿æ¥" class="headerlink" title="1.NaivatPremiumå¯¼å‡ºè¿æ¥"></a>1.NaivatPremiumå¯¼å‡ºè¿æ¥</h4><pre><code class="textmate">æ³¨æ„ï¼šå¯¼å‡ºæ—¶ä¸€å®šè¦å‹¾é€‰ä¸Šå¯¼å‡ºå¯†ç ï¼ï¼ï¼å¯¼å‡ºæ–‡ä»¶ä¸­ Password å€¼æ˜¯åŠ å¯†åçš„å¯†ç </code></pre><h4 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h4><pre><code class="textmate">1.æ‰“å¼€ç½‘å€ https://tool.lu/coderunner/  å·¦ä¸Šè§’é€‰æ‹©php2.å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°ä»£ç æ¡†ä¸­,ä¿®æ”¹å€’æ•°ç¬¬ä¸‰è¡Œä»£ç ä¸­çš„åŠ å¯†ä¸²3.ç‚¹å‡»æ‰§è¡Œ(Run)4.å¦‚æœæ‰§è¡Œå¤±è´¥åˆ™ä¿®æ”¹ä¸‹ç‰ˆæœ¬å· 11/12ps: æ„Ÿè°¢å¤§ä½¬æä¾›çš„ä»£ç ï¼Œå·²ç»æ‰¾ä¸åˆ°å‡ºå¤„äº†</code></pre><pre><code class="php">&lt;?phpclass NavicatPassword&#123;    protected $version = 0;    protected $aesKey = &#39;libcckeylibcckey&#39;;    protected $aesIv = &#39;libcciv libcciv &#39;;    protected $blowString = &#39;3DC5CA39&#39;;    protected $blowKey = null;    protected $blowIv = null;    public function __construct($version = 12)&#123;        $this-&gt;version = $version;        $this-&gt;blowKey = sha1(&#39;3DC5CA39&#39;, true);        $this-&gt;blowIv = hex2bin(&#39;d9c7c3c8870d64bd&#39;);    &#125;    public function encrypt($string)&#123;        $result = FALSE;        switch ($this-&gt;version) &#123;            case 11:                $result = $this-&gt;encryptEleven($string);                break;            case 12:                $result = $this-&gt;encryptTwelve($string);                break;            default:                break;        &#125;        return $result;    &#125;    protected function encryptEleven($string)&#123;        $round = intval(floor(strlen($string) / 8));        $leftLength = strlen($string) % 8;        $result = &#39;&#39;;        $currentVector = $this-&gt;blowIv;        for ($i = 0; $i &lt; $round; $i++) &#123;            $temp = $this-&gt;encryptBlock($this-&gt;xorBytes(substr($string, 8 * $i, 8), $currentVector));            $currentVector = $this-&gt;xorBytes($currentVector, $temp);            $result .= $temp;        &#125;        if ($leftLength) &#123;            $currentVector = $this-&gt;encryptBlock($currentVector);            $result .= $this-&gt;xorBytes(substr($string, 8 * $i, $leftLength), $currentVector);        &#125;        return strtoupper(bin2hex($result));    &#125;    protected function encryptBlock($block)&#123;        return openssl_encrypt($block, &#39;BF-ECB&#39;, $this-&gt;blowKey, OPENSSL_RAW_DATA|OPENSSL_NO_PADDING);    &#125;    protected function decryptBlock($block)&#123;        return openssl_decrypt($block, &#39;BF-ECB&#39;, $this-&gt;blowKey, OPENSSL_RAW_DATA|OPENSSL_NO_PADDING);    &#125;    protected function xorBytes($str1, $str2)&#123;        $result = &#39;&#39;;        for ($i = 0; $i &lt; strlen($str1); $i++) &#123;            $result .= chr(ord($str1[$i]) ^ ord($str2[$i]));        &#125;        return $result;    &#125;    protected function encryptTwelve($string)&#123;        $result = openssl_encrypt($string, &#39;AES-128-CBC&#39;, $this-&gt;aesKey, OPENSSL_RAW_DATA, $this-&gt;aesIv);        return strtoupper(bin2hex($result));    &#125;    public function decrypt($string)&#123;        $result = FALSE;        switch ($this-&gt;version) &#123;            case 11:                $result = $this-&gt;decryptEleven($string);                break;            case 12:                $result = $this-&gt;decryptTwelve($string);                break;            default:                break;        &#125;        return $result;    &#125;    protected function decryptEleven($upperString)&#123;        $string = hex2bin(strtolower($upperString));        $round = intval(floor(strlen($string) / 8));        $leftLength = strlen($string) % 8;        $result = &#39;&#39;;        $currentVector = $this-&gt;blowIv;        for ($i = 0; $i &lt; $round; $i++) &#123;            $encryptedBlock = substr($string, 8 * $i, 8);            $temp = $this-&gt;xorBytes($this-&gt;decryptBlock($encryptedBlock), $currentVector);            $currentVector = $this-&gt;xorBytes($currentVector, $encryptedBlock);            $result .= $temp;        &#125;        if ($leftLength) &#123;            $currentVector = $this-&gt;encryptBlock($currentVector);            $result .= $this-&gt;xorBytes(substr($string, 8 * $i, $leftLength), $currentVector);        &#125;        return $result;    &#125;    protected function decryptTwelve($upperString)&#123;        $string = hex2bin(strtolower($upperString));        return openssl_decrypt($string, &#39;AES-128-CBC&#39;, $this-&gt;aesKey, OPENSSL_RAW_DATA, $this-&gt;aesIv);    &#125;&#125;;//éœ€è¦æŒ‡å®šç‰ˆæœ¬ä¸¤ç§ï¼Œ11æˆ–12$navicatPassword = new NavicatPassword(12);//è§£å¯†å¯†ç ,æ›¿æ¢è¿™é‡Œçš„å€¼$decode = $navicatPassword-&gt;decrypt(&#39;xxxx&#39;);echo $decode.&quot;\n&quot;;?&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> å­˜å‚¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹è±¡è½¬æ¢å·¥å…·-MapStruct</title>
      <link href="/2020/10/02/backend/java/utils/convert/map-struct/"/>
      <url>/2020/10/02/backend/java/utils/convert/map-struct/</url>
      
        <content type="html"><![CDATA[<h2 id="MapStruct"><a href="#MapStruct" class="headerlink" title="MapStruct"></a>MapStruct</h2><p><a href="http://mapstruct.org/">MapStruct</a>æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œå®ƒåŸºäºçº¦å®šä¼˜äºé…ç½®æ–¹æ³•æå¤§åœ°ç®€åŒ–äº†Java beanç±»å‹ä¹‹é—´æ˜ å°„çš„å®ç°ã€‚<br>ç”Ÿæˆçš„æ˜ å°„ä»£ç ä½¿ç”¨æ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤å¿«é€Ÿï¼Œç±»å‹å®‰å…¨ä¸”æ˜“äºç†è§£ã€‚</p><h3 id="å¦‚ä½•æ¥å…¥MapStruct"><a href="#å¦‚ä½•æ¥å…¥MapStruct" class="headerlink" title="å¦‚ä½•æ¥å…¥MapStruct"></a>å¦‚ä½•æ¥å…¥MapStruct</h3><ul><li><a href="http://mapstruct.org/documentation/installation/">å®˜ç½‘æ–‡æ¡£</a></li></ul><p>IDEA Support: <a href="https://plugins.jetbrains.com/plugin/10036-mapstruct-support/versions">https://plugins.jetbrains.com/plugin/10036-mapstruct-support/versions</a></p><h3 id="Java-Beanå±æ€§æ‹·è´å¯¹æ¯”"><a href="#Java-Beanå±æ€§æ‹·è´å¯¹æ¯”" class="headerlink" title="Java Beanå±æ€§æ‹·è´å¯¹æ¯”"></a>Java Beanå±æ€§æ‹·è´å¯¹æ¯”</h3><ul><li>æ€§èƒ½</li></ul><pre><code class="textmate">get/set &gt;= [MapStruct](http://mapstruct.org/) &gt; [JMapper](https://jmapper-framework.github.io/jmapper-core/)  &gt;  [&quot;beanCopier(cglib)&quot;](https://github.com/cglib/cglib/blob/master/cglib/src/main/java/net/sf/cglib/beans/BeanCopier.java) &gt; Orika &gt; ModelMapper &gt; Spring BeanUtils &gt; Dozer &gt; Apache BeanUtils</code></pre><ul><li><p>æ€§èƒ½å¯¹æ¯”æ•°æ®æ¥æºï¼š</p><ul><li><a href="https://www.baeldung.com/java-performance-mapping-frameworks">https://www.baeldung.com/java-performance-mapping-frameworks</a></li><li><a href="https://java.libhunt.com/categories/337-bean-mapping">https://java.libhunt.com/categories/337-bean-mapping</a></li></ul></li><li><p>å¯¹æ¯”ç»“æœï¼š</p><ul><li>get/set éœ€è¦æ‰‹åŠ¨ç¼–å†™å¤§é‡è½¬æ¢ä»£ç ï¼Œä»£ç ç®€æ´æ€§å·®ã€é‡å¤æ€§é«˜å’Œå·¥ä½œé‡å¤§ã€‚</li><li>beanCopier æ€§èƒ½è¾ƒé«˜ï¼Œå±æ€§åå’Œç±»å‹æœ‰è¾ƒé«˜çš„åŒ¹é…è¦æ±‚ã€‚</li><li>MapStruct æ€§èƒ½è¾ƒé«˜ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç”ŸæˆGet/Setä»£ç ,æ”¯æŒä¸åŒå±æ€§ä¹‹é—´è‡ªå®šä¹‰è½¬æ¢ã€‚</li><li>Orika æ€§èƒ½è¾ƒé«˜,æ”¯æŒè‡ªå®šä¹‰å±æ€§æ‹·è´ï¼Œæ€§èƒ½ç•¥å·®ä¸å‰ä¸¤ç§ï¼Œä½†æ¯”åé¢å‡ ç§é«˜å¾ˆå¤šã€‚å±æ€§åç›¸åŒå•ç±»å‹ä¸åŒäº‹éœ€ç¼–å†™è½¬æ¢è§„åˆ™ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li><li>Spring BeanUtils æ€§èƒ½ä¸€èˆ¬ï¼Œåªèƒ½æ”¯æŒç›¸å…³åç§°çš„æ‹·è´ã€‚</li><li>Dozer æ€§èƒ½å·®ï¼Œä½¿ç”¨ç®€å•ï¼Œç¼–å†™xmlä¸æ–¹ä¾¿ã€‚</li><li>Apache BeanUtils æ€§èƒ½å·®ã€‚</li></ul></li></ul><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>å®ä¾‹ä»£ç :</p><pre><code class="java">/*** å®šä¹‰å¯¹è±¡ä¹‹é—´è½¬æ¢Mapper * @Mapper åªæœ‰åœ¨æ¥å£åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œ MapStruct æ‰ä¼šå»å®ç°è¯¥æ¥å£ *     @Mapper *     componentModel ï¼šä¸»è¦æ˜¯æŒ‡å®šå®ç°ç±»çš„ç±»å‹ï¼Œ *         - defaultï¼šé»˜è®¤ï¼Œå¯ä»¥é€šè¿‡ Mappers.getMapper(Class) æ–¹å¼è·å–å®ä¾‹å¯¹è±¡ *         -  springï¼šåœ¨æ¥å£çš„å®ç°ç±»ä¸Šè‡ªåŠ¨æ·»åŠ æ³¨è§£ @Componentï¼Œå¯é€šè¿‡ @Autowired æ–¹å¼æ³¨å…¥ *     uses ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢å™¨ * *     http://mapstruct.org/documentation/stable/reference/html/ *///@Mapper(componentModel = &quot;spring&quot;,uses = &#123;DateHandWritten.class&#125;)@Mapper(        uses = &#123;DateHandWritten.class, UserNameHandWritten.class&#125;,        imports = &#123;LocalDateUtil.class&#125;        )public interface PersonMapper &#123;    PersonMapper  INSTANCE  = Mappers.getMapper(PersonMapper.class);    @Mappings(&#123;            //@Mapping(source = &quot;name&quot;,target = &quot;name&quot;,ignore = true),            @Mapping(target = &quot;birthExpressionFormat&quot;, expression = &quot;java(LocalDateUtil.getDateNow().toString())&quot;),            @Mapping(source = &quot;name&quot;,target = &quot;address.name&quot;),            @Mapping(source = &quot;price&quot;,target = &quot;price&quot;,numberFormat = &quot;#.00&quot;),            @Mapping(source = &quot;birthDate&quot;,target = &quot;birthDateFormat&quot;,dateFormat = &quot;yyyy-MM-dd HH:mm:ss&quot;)    &#125;)    /***     * @Mappingï¼šå±æ€§æ˜ å°„ï¼Œè‹¥æºå¯¹è±¡å±æ€§ä¸ç›®æ ‡å¯¹è±¡åå­—ä¸€è‡´ï¼Œä¼šè‡ªåŠ¨æ˜ å°„å¯¹åº”å±æ€§     *     sourceï¼šæºå±æ€§     *     targetï¼šç›®æ ‡å±æ€§     *     dateFormatï¼šString åˆ° Date æ—¥æœŸä¹‹é—´ç›¸äº’è½¬æ¢ï¼Œé€šè¿‡ SimpleDateFormatï¼Œè¯¥å€¼ä¸º SimpleDateFormat              çš„æ—¥æœŸæ ¼å¼     *     ignore: å¿½ç•¥è¿™ä¸ªå­—æ®µ     * @Mappingsï¼šé…ç½®å¤šä¸ª@Mapping     */    PersonDto toDto(Person person);    @InheritConfiguration(name = &quot;toDto&quot;)    List&lt;PersonDto&gt; toDtos(List&lt;Person&gt; person);    /*@InheritInverseConfiguration()    PersonDto fromDto(Person person);*/    /**     * @InheritConfiguration ç”¨äºç»§æ‰¿é…ç½®     * */  /*  @InheritConfiguration(name = &quot;toDto&quot;)    void update(Person person, @MappingTarget PersonDto personDto);*/&#125;/**å®šä¹‰è‡ªå®šä¹‰è½¬æ¢è§„åˆ™*/public class DateHandWritten &#123;    public String asString(Date date) &#123;        return date != null ? new SimpleDateFormat( &quot;yyyy-MM-dd&quot; )            .format( date ) : null;    &#125;    public Date asDate(String date) &#123;        try &#123;            return date != null ? new SimpleDateFormat( &quot;yyyy-MM-dd&quot; )                .parse( date ) : null;        &#125;        catch ( ParseException e ) &#123;            throw new RuntimeException( e );        &#125;    &#125;&#125;/**å®šä¹‰è‡ªå®šä¹‰è½¬æ¢è§„åˆ™*/public class UserNameHandWritten &#123;    public String asUsername(String username) &#123;        return  &quot;è¢«ä¿®æ”¹åçš„name&quot;;    &#125; &#125;/***ä½¿ç”¨å®ä¾‹*/public class MapStructTest &#123;    @Test    public void personTest()&#123;        Person person = buildPerson();        PersonDto personDto = PersonMapper.INSTANCE.toDto(person);        System.out.println(JSON.toJSONString(personDto));        /**        * &#123;&quot;address&quot;:&#123;&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;&#125;,&quot;addresses&quot;:[&#123;&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;&#125;],&quot;age&quot;:0,&quot;birthDate&quot;:1555573411245,&quot;birthDateFormat&quot;:&quot;2019-04-18&quot;,&quot;birthExpressionFormat&quot;:&quot;Thu Apr 18 15:43:31 CST 2019&quot;,&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;,&quot;price&quot;:&quot;2.35&quot;&#125;        * */    &#125;    @Test    public void personListTest()&#123;        Person person = buildPerson();        List&lt;PersonDto&gt; personDtos = PersonMapper.INSTANCE.toDtos(Lists.newArrayList(person));        System.out.println(JSON.toJSONString(personDtos));        /**        * [&#123;&quot;address&quot;:&#123;&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;&#125;,&quot;addresses&quot;:[&#123;&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;&#125;],&quot;age&quot;:0,&quot;birthDate&quot;:1555573439123,&quot;birthDateFormat&quot;:&quot;2019-04-18&quot;,&quot;birthExpressionFormat&quot;:&quot;Thu Apr 18 15:43:59 CST 2019&quot;,&quot;name&quot;:&quot;è¢«ä¿®æ”¹åçš„name&quot;,&quot;price&quot;:&quot;2.35&quot;&#125;]        * */    &#125;    private Person buildPerson()&#123;        Address a = new Address();        a.setName(&quot;demo&quot;);        return Person.builder().birthDate(new Date()).price(BigDecimal.valueOf(2.347)).name(&quot;ä¸­å›½äºº&quot;).addresses(Lists.newArrayList(a)).build();    &#125;&#125;</code></pre><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><pre><code class="textmate">MapStructæ˜¯åŸºäºJSR 269çš„Javaæ³¨è§£å¤„ç†å™¨ï¼Œå› æ­¤å¯ä»¥åœ¨å‘½ä»¤è¡Œæ„å»ºä¸­ä½¿ç”¨ï¼ˆjavacã€Antã€Mavenç­‰ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨IDEå†…ä½¿ç”¨ã€‚JSR269è§„èŒƒ: å…è®¸åœ¨ç¼–è¯‘æœŸå¤„ç†æ³¨è§£ï¼Œè¯»å–ã€ä¿®æ”¹ã€æ·»åŠ æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„å†…å®¹ã€‚åœ¨Maven ç¼–è¯‘é˜¶æ®µå°†è‡ªåŠ¨å®ç°PersonMapperçš„å¯¹è±¡å±æ€§è½¬æ¢æ¥å£,ç”ŸæˆPersonMapperImplæ–‡ä»¶ã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜…è¯»æ‘˜è¦</title>
      <link href="/2020/10/02/thinking/abstract/"/>
      <url>/2020/10/02/thinking/abstract/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ»æ„ç»ƒä¹ -å¦‚ä½•ä»æ–°æ‰‹åˆ°å¤§å¸ˆ"><a href="#åˆ»æ„ç»ƒä¹ -å¦‚ä½•ä»æ–°æ‰‹åˆ°å¤§å¸ˆ" class="headerlink" title="åˆ»æ„ç»ƒä¹ -å¦‚ä½•ä»æ–°æ‰‹åˆ°å¤§å¸ˆ"></a>åˆ»æ„ç»ƒä¹ -å¦‚ä½•ä»æ–°æ‰‹åˆ°å¤§å¸ˆ</h2><h3 id="æ‹’ç»ä¸‰ç§é”™è¯¯æ€æƒ³"><a href="#æ‹’ç»ä¸‰ç§é”™è¯¯æ€æƒ³" class="headerlink" title="æ‹’ç»ä¸‰ç§é”™è¯¯æ€æƒ³"></a>æ‹’ç»ä¸‰ç§é”™è¯¯æ€æƒ³</h3><pre><code class="textmate">1. ç¬¬ä¸€ç§é”™è¯¯æ€æƒ³è®¤ä¸º æŸäººçš„èƒ½åŠ›é€šå¸¸å—åˆ°åŸºå› ç‰¹å¾çš„é™åˆ¶ã€‚è¿™ç§æ€ æƒ³å¸¸å¸¸è¡¨ç°ä¸ºå„ç§å„æ ·â€œæˆ‘ä¸èƒ½â€æˆ–è€…â€œæˆ‘ä¸ æ˜¯â€ä¹‹ç±»çš„è¡¨è¿°:â€œæˆ‘ä¸æ˜¯å¾ˆæœ‰åˆ›é€ åŠ›çš„ äººã€‚â€ã€â€œæˆ‘ä¸èƒ½ç®¡ç†å¥½åˆ«äººã€‚â€ã€â€œæˆ‘ä¸æ“…é•¿å’Œæ•°å­— æ‰“äº¤é“ã€‚â€ã€â€œæˆ‘åšä¸åˆ°æ¯”è¿™æ›´å¥½ã€‚â€ä½†æ˜¯ï¼Œå¦‚æˆ‘ ä»¬å·²ç»äº†è§£çš„é‚£æ ·ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªäººä»¬é€‰æ‹©ç€é‡å‘å±•çš„è¡Œä¸šæˆ–é¢†åŸŸä¹‹ä¸­ï¼Œäººäººéƒ½å¯ä»¥é€šè¿‡æ­£ç¡® çš„è®­ç»ƒæ¥å¸®åŠ©è‡ªå·±å¤§å¹…åº¦åœ°æé«˜ã€‚æˆ‘ä»¬å¯ä»¥å¡‘ é€ è‡ªå·±çš„æ½œåŠ›ã€‚2. ç¬¬äºŒç§é”™è¯¯æ€æƒ³è®¤ä¸ºï¼Œå¦‚æœä½ è¶³å¤Ÿé•¿æ—¶é—´åœ°åšæŸä»¶äº‹æƒ…ï¼Œä¸€å®šä¼šæ›´æ“…é•¿ã€‚è¿™ç§æ€æƒ³é”™åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šã€‚ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼ä¸€è€Œå†å†è€Œä¸‰åœ°åšæŸä»¶äº‹æƒ…ï¼Œå¹¶ä¸æ˜¯æé«˜ç»©æ•ˆå’Œè¡¨ç°çš„ç§˜è¯€;å®ƒä¼šä½¿äººä»¬åœä¸‹å‰è¿›çš„è„šæ­¥ï¼Œå¹¶ä¸”ç¼“æ…¢åœ°ä¸‹æ»‘ã€‚3.ç¬¬ä¸‰ç§é”™è¯¯æ€æƒ³è®¤ä¸ºï¼Œè¦æƒ³æé«˜ï¼Œåªéœ€è¦åŠªåŠ›ã€‚å¦‚æœè¶³å¤Ÿåˆ»è‹¦ï¼Œä½ ä¼šæ›´åŠ ä¼˜ç§€ã€‚å¦‚æœä½ æƒ³æˆä¸ºä¸€ä½æ›´ä¼˜ç§€çš„ç»ç†ï¼ŒåŠ å€åŠªåŠ›ã€‚å¦‚æœä½ æƒ³é”€å”®æ›´å¤šçš„äº§å“æˆ–æœåŠ¡ï¼ŒåŠ å€åŠªåŠ›ã€‚å¦‚æœä½ æƒ³ä¼˜åŒ–ä½ çš„å›¢é˜Ÿåä½œï¼ŒåŠ å€åŠªåŠ›ã€‚ä½†ç°å®æ˜¯ï¼Œæ‰€æœ‰è¿™äº›äº‹æƒ…ï¼Œå³ç®¡ç†ã€é”€å”®å’Œå›¢é˜Ÿåˆä½œï¼Œå…¨éƒ½æ˜¯ä¸“ä¸šåŒ–çš„æŠ€èƒ½ï¼Œé™¤éä½ è¿ç”¨ä¸€äº›ä¸“é—¨ç”¨äºæå‡é‚£äº›ç‰¹å®šæŠ€èƒ½çš„ç»ƒä¹ æ–¹æ³•ï¼Œå¦åˆ™ï¼Œå³ä½¿åŠ å€åŠªåŠ›ï¼Œä¹Ÿæ— æ³•è®©ä½ æœ‰æ›´å¤§çš„è¿›æ­¥ã€‚</code></pre><h3 id="ä¸‰Få·¥å…·"><a href="#ä¸‰Få·¥å…·" class="headerlink" title="ä¸‰Få·¥å…·"></a>ä¸‰Få·¥å…·</h3><pre><code class="textmate">åœ¨æ²¡æœ‰å¯¼å¸ˆçš„æ—¶å€™æœ‰æ•ˆåœ°ç»ƒä¹ æŸç§æŠ€èƒ½ï¼Œç‰¢ç‰¢è®°ä½ä»¥ä¸‹ä¸‰ä¸ªFï¼Œå°†æ˜¯æœ‰å¸®åŠ©çš„ã€‚è¿™ ä¸‰ä¸ªFï¼Œå…¶å®æ˜¯ä»¥å­—æ¯Få¼€å¤´ä¸‰ä¸ªå•è¯ï¼Œå³:ä¸“ æ³¨(focus)ã€åé¦ˆ(feedback)ä»¥åŠçº æ­£(fixit)ã€‚å°†æŠ€èƒ½åˆ†è§£æˆä¸€äº›ç»„æˆéƒ¨åˆ†ï¼Œä»¥ä¾¿åå¤ åœ°ç»ƒä¹ ï¼Œå¹¶ä¸”æœ‰æ•ˆåœ°åˆ†æã€ç¡®å®šä½ çš„ä¸è¶³ä¹‹ å¤„ï¼Œç„¶åæƒ³å‡ºå„ç§åŠæ³•æ¥è§£å†³å®ƒä»¬ã€‚</code></pre><h3 id="ä¿æŒåŠ¨æœº"><a href="#ä¿æŒåŠ¨æœº" class="headerlink" title="ä¿æŒåŠ¨æœº"></a>ä¿æŒåŠ¨æœº</h3><ul><li><p>ä¿æŒåŠ¨æœºçš„ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</p><pre><code class="textmate">ç»§ç»­å‰è¡Œçš„ç†ç”±å’Œåœä¸‹è„šæ­¥çš„ç†ç”±ã€‚ä½ ä¸å†åšè‡ªå·±å½“åˆæƒ³åšçš„äº‹æƒ…ï¼Œæ˜¯å› ä¸ºåœä¸‹è„šæ­¥çš„ç†ç”±æœ€ç»ˆæˆ˜èƒœäº†ç»§ç»­å‰è¡Œçš„ç†ç”±ã€‚å› æ­¤ï¼Œä½ è¦ä¿æŒåŠ¨æœºï¼Œè¦ä¹ˆå¼ºåŒ–ç»§ç»­å‰è¡Œçš„ç†ç”±ï¼Œè¦ä¹ˆå¼±åŒ–åœä¸‹è„šæ­¥çš„ç†ç”±ã€‚æˆåŠŸåœ°ä¿æŒåŠ¨æœºï¼Œé€šå¸¸åŒ…æ‹¬è¿™ä¸¤ä¸ªæ–¹é¢ã€‚</code></pre></li><li><p>å¼±åŒ–åœä¸‹è„šæ­¥çš„ç†ç”±</p><pre><code class="textmate">æ‰¾å‡ºé‚£äº›å¯èƒ½å¹²æ‰°ä½ ç»ƒä¹ çš„äº‹æƒ…ï¼Œå¹¶æƒ³åŠæ³•å°†å…¶å½±å“æ§åˆ¶åœ¨æœ€å°ã€‚ä¸¤ä¸ªé‡è¦çš„äº‹æƒ…ï¼š  ç¬¬ä¸€ä»¶æ˜¯ä¸€èˆ¬çš„èº«ä½“ä¿å…»:ä¿è¯å……è¶³çš„ç¡çœ å¹¶ä¿æŒå¥åº·ã€‚  ç¬¬äºŒä»¶æ˜¯å°†ç»ƒä¹ è¯¾çš„æ—¶é—´é™åˆ¶åœ¨1å°æ—¶å·¦å³ã€‚å¦‚æœæ¯”é‚£ä¸ªæ—¶é—´é•¿å¾—å¤šï¼Œä½ å°†æ— æ³•ä¿æŒé«˜åº¦çš„ä¸“æ³¨ã€‚</code></pre></li><li><p>å¢å¼ºç»§ç»­å‰è¡Œçš„å€¾å‘</p></li></ul><h3 id="é¿å…æ”¾å¼ƒ"><a href="#é¿å…æ”¾å¼ƒ" class="headerlink" title="é¿å…æ”¾å¼ƒ"></a>é¿å…æ”¾å¼ƒ</h3><pre><code class="textmate">å¦‚æœä½ ä¸å†ç›¸ä¿¡è‡ªå·±å¯ä»¥å®ç°æŸä¸ªç›®æ ‡ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºä½ çš„æ°´å¹³å·²ç»å€’é€€äº†ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºä½ é™·å…¥äº†åœæ»é˜¶æ®µï¼Œæ­¤æ—¶ï¼Œåƒä¸‡ä¸è¦åŠé€”è€ŒåºŸã€‚å’Œä½ è‡ªå·±è¾¾æˆä¸€ä¸ªåè®®ï¼Œä½ å°†å°½è‡ªå·±çš„åŠªåŠ›å›å½’åˆ°ä¹‹å‰çš„çŠ¶æ€æˆ–è€…è·¨è¶Šåœæ»é˜¶æ®µï¼Œç„¶åä½ å†æ”¾å¼ƒã€‚åˆ°é‚£ä¸ªæ—¶å€™ï¼Œä¹Ÿè®¸ä½ ä¸ä¼šæ”¾å¼ƒäº†ã€‚</code></pre><h2 id="èµ„æœ¬çš„æ•…äº‹-ç¬¬ä¸€å­£"><a href="#èµ„æœ¬çš„æ•…äº‹-ç¬¬ä¸€å­£" class="headerlink" title="èµ„æœ¬çš„æ•…äº‹ ç¬¬ä¸€å­£"></a>èµ„æœ¬çš„æ•…äº‹ ç¬¬ä¸€å­£</h2><h3 id="1-è‚¡ä»½çš„åŠ›é‡"><a href="#1-è‚¡ä»½çš„åŠ›é‡" class="headerlink" title="1.è‚¡ä»½çš„åŠ›é‡"></a>1.è‚¡ä»½çš„åŠ›é‡</h3><pre><code class="textmate">è‚¡ä»½åˆ¶å¯ä»¥èåˆ°æ›´å¤šçš„é’±ï¼Œæ‰©å¤§ç”Ÿäº§è§„æ¨¡ï¼›åŒæ—¶ä¹Ÿåˆ†æ‘Šäº†é£é™©</code></pre><h3 id="2-æ³¡æ²«çš„è¯±æƒ‘"><a href="#2-æ³¡æ²«çš„è¯±æƒ‘" class="headerlink" title="2.æ³¡æ²«çš„è¯±æƒ‘"></a>2.æ³¡æ²«çš„è¯±æƒ‘</h3><pre><code class="textmate">éƒé‡‘é¦™å¼•å…¥åï¼Œç”±äºä½œä¸ºèº«ä»½å’Œåœ°ä½çš„è±¡å¾ï¼Œä»·æ ¼é£™å‡ï¼Œå¯¼è‡´å¤§é‡èµ„é‡‘æ¶Œå…¥éƒé‡‘é¦™å¸‚åœºï¼›æœ€ç»ˆç”±äºä¸€ä¸ªæ²¡æœ‰ä¹°å®¶çš„ä¼ è¨€ï¼Œå¯¼è‡´ä»·æ ¼å´©ç›˜ï¼›éƒé‡‘é¦™æ³¡æ²«åï¼Œéƒé‡‘é¦™ä»·æ ¼è¶‹åŠ¿å›¾é¢‘ç¹å‡ºç°ï¼Œå¸¸è§äºé‡‘èå±æœºã€Aè‚¡å±æœºä¸­</code></pre><h3 id="3-å—æµ·éª—å±€"><a href="#3-å—æµ·éª—å±€" class="headerlink" title="3.å—æµ·éª—å±€"></a>3.å—æµ·éª—å±€</h3><pre><code class="textmate">æ›¾ç»çš„å•†ä¸šå·¨å¤´ç”±äºæˆ˜äº‰åŸå› ï¼Œåç»­æ— æ³•ç›ˆåˆ©ï¼›ç”¨è‚¡ç¥¨æ¢å›½å€ºï¼ŒåŠ ä¸Šç”¨è‚¡ç¥¨è´¿èµ‚ä¸»è¦å†³ç­–äººçš„æ–¹å¼é€šè¿‡äº†ææ¡ˆï¼›åç»­çœŸç›¸æš´éœ²ï¼Œæ¨åŠ¨äº†èµ„æœ¬å¸‚åœºå¼€å§‹å¾€åå°”è¡—è½¬ç§»</code></pre><h3 id="4-æ±‰å¯†å°”é¡¿çš„æ—‹è½¬é—¨-åå°”è¡—ä¹‹çˆ¶"><a href="#4-æ±‰å¯†å°”é¡¿çš„æ—‹è½¬é—¨-åå°”è¡—ä¹‹çˆ¶" class="headerlink" title="4.æ±‰å¯†å°”é¡¿çš„æ—‹è½¬é—¨(åå°”è¡—ä¹‹çˆ¶)"></a>4.æ±‰å¯†å°”é¡¿çš„æ—‹è½¬é—¨(åå°”è¡—ä¹‹çˆ¶)</h3><pre><code class="textmate">è§£é‡Š: ç¾å›½å‘è¡Œæ–°è´§å¸ã€æ–°å€ºåŠ¡ã€è”é‚¦ä¿¡ç”¨æ›¿ä»£å·æ”¿åºœä¿¡ç”¨ï¼Œè¾¾åˆ°ç»Ÿä¸€è´§å¸ã€ç»Ÿä¸€è´¢æ”¿çš„ç›®çš„ä½œç”¨: æ„å»ºäº†ç¾å›½çš„ä¿¡ç”¨è´§å¸å’Œå›½å€ºä½“ç³»ï¼Œæ˜¯ç°ä»£ç¾å›½é‡‘èä½“ç³»çš„ä¸¤å¤§æ”¯æŸ±å»ºç«‹å›½å®¶ä¿¡ç”¨ä½“ç³»ï¼Œå¹¶å°†å›½å®¶ä¿¡ç”¨ç›´æ¥è½¬æ¢ä¸ºç¤¾ä¼šè´¢å¯Œï¼Œä¿ƒè¿›ç»æµå¢é•¿å¼•ç”¨ï¼š ä¿¡ å›½ä¹‹å®ä¹Ÿ --ã€Šå·¦ä¼ ã€‹</code></pre><h3 id="5-æ¢§æ¡æ ‘ä¸‹çš„æ‰¿è¯º"><a href="#5-æ¢§æ¡æ ‘ä¸‹çš„æ‰¿è¯º" class="headerlink" title="5.æ¢§æ¡æ ‘ä¸‹çš„æ‰¿è¯º"></a>5.æ¢§æ¡æ ‘ä¸‹çš„æ‰¿è¯º</h3><pre><code class="textmate">èƒŒæ™¯: åˆæœŸè‚¡ç¥¨å¸‚åœºä¿¡æ¯ä¸é€æ˜ï¼Œç§ä¸‹äº¤æ˜“ï¼Œåˆ©ç”¨åˆ©å®³ä¿¡æ¯å¯ä»¥å½±å“è‚¡ä»·æœ‰äººåˆ©ç”¨æå‰çš„å€¼å¾—åˆ©å¥½æ¶ˆæ¯ï¼Œåˆ©ç”¨å¤§é‡æ æ†æˆä¸ºé“¶è¡Œè‚¡ç¥¨çš„æŒæœ‰è€…ï¼Œç»“æœè´·æ¬¾æ¸ é“è¢«æŒæƒè€…åˆ‡æ–­ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡è‚¡å¸‚å´©ç›˜è‚¡ç¥¨äº¤æ˜“å‘˜åœ¨æ¢§æ¡æ ‘ä¸‹åˆæ­¥ç­¾è®¢äº†å…³äºè‚¡ç¥¨äº¤æ˜“çš„ä¸€äº›åè®®(è¡Œä¸šçš„è‡ªå¾‹å’Œäº¤æ˜“çš„è§„åˆ™)ï¼Œæˆä¸ºçº½çº¦è‚¡ç¥¨äº¤æ˜“æ‰€çš„èµ·ç‚¹å¼•ç”¨: ä¸ä»¥è§„çŸ©ï¼Œä¸èƒ½æˆæ–¹åœ† --å­Ÿå­</code></pre><h3 id="6-ç»™é£é™©å®šä»·"><a href="#6-ç»™é£é™©å®šä»·" class="headerlink" title="6.ç»™é£é™©å®šä»·"></a>6.ç»™é£é™©å®šä»·</h3><pre><code class="textmate">æœŸè´§ï¼ŒåˆæœŸæ˜¯ä»è°·ç‰©æœŸè´§äº¤æ˜“å¼€å§‹ï¼Œè§„é¿è°·ç‰©ä»·æ ¼ä¸ç¨³å®šå¸¦æ¥çš„é£é™©(æˆˆç™»å“ˆä¼¯å¾·)ï¼›å¸‚åœºç›‘ç£æœºåˆ¶å‡ºç°ï¼Œä¿è¯é‡‘äº¤æ˜“åˆ¶åº¦å‡ºç°    ä¿è¯é‡‘äº¤æ˜“å’Œæ ‡å‡†åŒ–åˆçº¦ï¼Œæ˜¯èŠåŠ å“¥æœŸè´§äº¤æ˜“çš„ä¸¤å¤§å‘æ˜ï¼Œä¹Ÿæ˜¯å…¨çƒæœŸè´§äº¤æ˜“çš„åŸºçŸ³</code></pre><h3 id="7-æ³¨æ°´çš„è‚¡ç¥¨"><a href="#7-æ³¨æ°´çš„è‚¡ç¥¨" class="headerlink" title="7.æ³¨æ°´çš„è‚¡ç¥¨"></a>7.æ³¨æ°´çš„è‚¡ç¥¨</h3><pre><code class="textmate">æ»¥å‘è‚¡ç¥¨å¯¼è‡´äº¤æ˜“å¸‚åœºæ··ä¹±ï¼Œå‚¬ç”Ÿäº†æ–°çš„è‚¡ç¥¨äº¤æ˜“è§„åˆ™ï¼Œéåˆ¶æ»¥å‘è‚¡ç¥¨</code></pre><h3 id="8-å·¨äººçš„è¯ç”Ÿ"><a href="#8-å·¨äººçš„è¯ç”Ÿ" class="headerlink" title="8.å·¨äººçš„è¯ç”Ÿ"></a>8.å·¨äººçš„è¯ç”Ÿ</h3><pre><code class="textmate">ç¾å›½é’¢é“å…¬å¸è¯ç”Ÿï¼Œé¦–å®¶å¸‚å€¼è¶…è¿‡10äº¿ç¾å…ƒçš„å…¬å¸ï¼›é€šè¿‡æ•´åˆç¾å›½é’¢é“åˆ¶é€ ä¸šï¼Œæå‡ç¾å›½åˆšé“åˆ¶é€ ä¸šåœ°ä½ï¼Œå„æ–­äº†ç¾å›½é’¢é“è¡Œä¸šï¼›éšåä¿ƒè¿›å’Œè¡Œä¸šæ•´åˆæµªæ½®ï¼Œè¯ç”Ÿäº†å¾ˆå¤šå¤§å…¬å¸å¼•ç”¨: ç›¸å‡ºæ–°åŠæ³•çš„äººï¼Œåœ¨ä»–çš„åŠæ³•æ²¡æœ‰æˆåŠŸä»¥å‰ï¼Œäººå®¶æ€»æ˜¯è¯´ä»–å¼‚æƒ³å¤©å¼€ --é©¬å…‹åæ¸©</code></pre><h3 id="9-é•€é‡‘çš„ç¾å…ƒ"><a href="#9-é•€é‡‘çš„ç¾å…ƒ" class="headerlink" title="9.é•€é‡‘çš„ç¾å…ƒ"></a>9.é•€é‡‘çš„ç¾å…ƒ</h3><pre><code class="textmate">æ„å»ºä¸€ä¸ªå…¨çƒæ€§çš„è´§å¸é‡‘èä½“ç³»ï¼Œé‡è¦äººç‰©: å‡¯æ©æ–¯ å¸ƒé›·é¡¿æ£®æ—åè®®ç­¾è®¢ï¼šå„å›½è´§å¸ä¸ç¾å…ƒæŒ‚é’©ï¼Œå¹´åº¦æ±‡ç‡æ³¢åŠ¨ä¸è¶…è¿‡10%;ç¾å…ƒä¸é»„é‡‘æŒ‚é’©(35/ç›å¸)  åŒæŒ‚é’©åç»­ç”±äºç¾å›½éšæ„å¢å‘è´§å¸ï¼Œå¯¼è‡´å„å›½æŒ¤å…‘é»„é‡‘ï¼Œç¾å›½ä¸ºäº†é˜²æ­¢é»„é‡‘è¢«æŒ¤å…‘ï¼Œé¢å¸ƒå°¼å…‹æ¾å†²å‡»(ç¾å…ƒä¸é»„é‡‘è„±é’©)ï¼Œéšåå„å›½å…‘ç¾å…ƒå›ºå®šæ±‡ç‡æ”¹ä¸ºæµ®åŠ¨æ±‡ç‡ï¼›ä¸­ä¸œçŸ³æ²¹å±æœºçˆ†å‘ï¼Œå¯¼è‡´åŒæŒ‚é’©å¤±æ•ˆ</code></pre><h3 id="10-é£é™©çš„ä»·å€¼"><a href="#10-é£é™©çš„ä»·å€¼" class="headerlink" title="10.é£é™©çš„ä»·å€¼"></a>10.é£é™©çš„ä»·å€¼</h3><pre><code class="textmate">ç¬¬ä¸€å®¶é£é™©æŠ•èµ„å…¬å¸è¯ç”Ÿ(å¤šåˆ©å¥¥ç‰¹-é£é™©æŠ•èµ„ä¹‹çˆ¶)ï¼›çº³æ–¯è¾¾å…‹æˆç«‹ï¼Œä¸ºé£é™©æŠ•èµ„æä¾›äº†ä¸€æ¡ä»è¿›å…¥åˆ°é€€å‡ºçš„äº§ä¸šé“¾</code></pre><h3 id="11-æ—¥æœ¬æ³¡æ²«"><a href="#11-æ—¥æœ¬æ³¡æ²«" class="headerlink" title="11.æ—¥æœ¬æ³¡æ²«"></a>11.æ—¥æœ¬æ³¡æ²«</h3><pre><code class="textmate">å¿«é€Ÿå‡å€¼çš„æ—¥å…ƒï¼Œå¸¦æ¥æ¥¼å¸‚å’Œè‚¡å¸‚çš„é£æ¶¨ï¼Œèµ„æœ¬é€ƒç¦»å®ä½“ç»æµå¹¿åœºåè®®: è”åˆå¹²é¢„å¤–æ±‡å¸‚åœºï¼Œè®©ç¾å…ƒå¯¹ä¸»è¦è´§å¸æœ‰åºè´¬å€¼ï¼›ä¿ƒè¿›äº†æ—¥å…ƒçš„å‡å€¼ï¼›æ—¥å…ƒå‡å€¼å¯¼è‡´æŠ•èµ„äººå¤§é‡æ”¶è´­æµ·å¤–èµ„äº§ï¼Œå¯¹å†…æŠ•èµ„æ¥¼å¸‚è‚¡å¸‚ï¼Œæ³¡æ²«é€æ¸äº§ç”Ÿ ä¸¤ä¸ªæ—¥æœ¬è¯´æ³•: ä¸€ä¸ªæ˜¯ä½è¿·çš„æœ¬åœŸèµ„äº§ï¼Œå¦ä¸€ä¸ªæ˜¯æ—¥æœ¬å›½æ°‘çš„æµ·å¤–èµ„äº§ä¸æ–­å‘æœ¬åœŸæ±‡å›æ”¶å…¥</code></pre><h3 id="12-å…«ä½°ä¼´å€’é—­"><a href="#12-å…«ä½°ä¼´å€’é—­" class="headerlink" title="12.å…«ä½°ä¼´å€’é—­"></a>12.å…«ä½°ä¼´å€’é—­</h3><pre><code class="textmate">ç”±äºæ—¥å…ƒå‡å€¼ï¼Œå¤§é‡è´­å…¥æµ·å¤–å›ºå®šèµ„äº§å¼€è¿é”è¶…å¸‚ï¼›åæœŸç”±äºç»æµåŸå› è‚¡ä»·å´©ç›˜ï¼Œéœ€è¦å¿è¿˜å¤§é‡å€ºåŠ¡ï¼Œæœ€ç»ˆå¯¼è‡´ç ´äº§ï¼›å…«ä½°ä¼´è…¾é£åˆ°å€’é—­ï¼Œä¼´éšç€æ—¥æœ¬ç»æœŸæ³¡æ²«çš„è…¾é£ä¸ç ´ç­</code></pre><h3 id="13-é—¨å£çš„é‡è›®äºº"><a href="#13-é—¨å£çš„é‡è›®äºº" class="headerlink" title="13.é—¨å£çš„é‡è›®äºº"></a>13.é—¨å£çš„é‡è›®äºº</h3><pre><code class="textmate">é»‘è‰²æ˜ŸæœŸä¸€å¯¼è‡´çº³æ–¯ç»´å…‹å…¬å¸è‚¡ä»·æš´è·Œï¼ŒKKRæ‰“ç®—è”åˆå¦ä¸€å…¬å¸æ”¶è´­çº³æ–¯ç»´å…‹ï¼Œç»“æœåè¢«è¸¢å‡ºå±€ï¼Œè¯ç”Ÿå½“æ—¶æœ€å¤§è§„æ¨¡æ”¶è´­æ¡ˆï¼›åƒåœ¾å€ºåˆ¸ï¼šå·²å°‘é‡è‡ªæœ‰èµ„é‡‘ï¼Œå¤–åŠ æ‹Ÿæ”¶è´­ç›®æ ‡çš„èµ„äº§ä¸ºæŠµæŠ¼ï¼Œå¤§å¤§é™ä½äº†æ”¶è´­æ–¹çš„èµ„é‡‘å‹åŠ›å„è·¯èµ„æœ¬å¯¹å…¬å¸æ§åˆ¶æƒçš„äº‰å¤ºï¼Œå´åœ¨äº‰å¤ºè‡ªèº«åˆ©ç›Šçš„åŒæ—¶ï¼Œæå‡äº†å…¬å¸çš„ä»·å€¼ï¼Œæ­¤æ—¶çš„å…¬å¸ï¼Œå·²æ˜¯ä¸€ä¸ªå¯äº¤æ˜“çš„å•†å“ </code></pre><h3 id="14-è‹±é•‘ç‹™å‡»æˆ˜"><a href="#14-è‹±é•‘ç‹™å‡»æˆ˜" class="headerlink" title="14.è‹±é•‘ç‹™å‡»æˆ˜"></a>14.è‹±é•‘ç‹™å‡»æˆ˜</h3><pre><code class="textmate">ç´¢ç½—æ–¯  å¯¹å†²åŸºé‡‘è‹±é•‘å…‘é©¬å…‹(å¾·å›½è´§å¸)é‡‡ç”¨å›ºå®šæ±‡ç‡ï¼Œç´¢ç½—æ–¯åˆ¤æ–­è‹±é•‘ä»·å€¼è¢«é«˜ä¼°ï¼Œåšç©ºè‹±é•‘ï¼Œå¯¼è‡´è‹±é•‘é‡‡ç”¨æµ®åŠ¨åˆ©ç‡</code></pre><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‘˜è¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜…è¯»</title>
      <link href="/2020/10/02/thinking/book/"/>
      <url>/2020/10/02/thinking/book/</url>
      
        <content type="html"><![CDATA[<h3 id="æŠ€æœ¯ä¹¦"><a href="#æŠ€æœ¯ä¹¦" class="headerlink" title="æŠ€æœ¯ä¹¦"></a>æŠ€æœ¯ä¹¦</h3><ul><li>è®¡ç®—æœºåŸºç¡€</li></ul><table><thead><tr><th>åˆ†ç±»</th><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹</td><td></td></tr><tr><td></td><td>ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šé“¾æ¥ã€è£…è½½ä¸åº“ã€‹</td><td></td></tr><tr><td></td><td>ã€Šæ“ä½œç³»ç»ŸçœŸè±¡è¿˜åŸã€‹</td><td></td></tr><tr><td></td><td>ã€ŠLinux å†…æ ¸è®¾è®¡ä¸å®ç°ã€‹</td><td></td></tr><tr><td></td><td>ã€ŠWindows ç¨‹åºè®¾è®¡ã€‹ç¬¬äº”ç‰ˆ</td><td></td></tr><tr><td>è®¡ç®—æœºç½‘ç»œ</td><td>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹</td><td></td></tr><tr><td></td><td>ã€ŠTCP/IP ç½‘ç»œç¼–ç¨‹ã€‹</td><td></td></tr><tr><td></td><td>ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹</td><td></td></tr><tr><td></td><td>ã€Šå›¾è§£HTTPã€‹</td><td>ä¸Šé‡å®£</td></tr><tr><td></td><td>ã€ŠHTTPæƒå¨æŒ‡å—ã€‹</td><td></td></tr><tr><td>ç¼–è¯‘åŸç†</td><td>ã€Šç¼–è¯‘ç³»ç»Ÿé€è§†ï¼šå›¾è§£ç¼–è¯‘åŸç†ã€‹</td><td></td></tr><tr><td>è®¡ç®—æœºç»„æˆ</td><td>ã€Šè®¡ç®—æœºç»„æˆä¸è®¾è®¡ï¼šç¡¬ä»¶è½¯ä»¶æ¥å£ã€‹</td><td></td></tr><tr><td>æ¶æ„</td><td>ã€Šè½¯ä»¶æ¶æ„è®¾è®¡ï¼šç¨‹åºå‘˜å‘æ¶æ„å¸ˆè½¬å‹å¿…å¤‡ã€‹</td><td>æ¸©æ˜±</td></tr><tr><td></td><td>ã€Šä¸šåŠ¡æ¶æ„Â·åº”ç”¨æ¶æ„Â·æ•°æ®æ¶æ„å®æˆ˜ã€‹</td><td>æ¸©æ˜±</td></tr><tr><td></td><td>ã€Šäººæœˆç¥è¯ã€‹</td><td></td></tr><tr><td></td><td>ã€Šäººä»¶ã€‹</td><td></td></tr></tbody></table><ul><li>ç»¼åˆ</li></ul><p>ã€ŠNettyã€Zookeeperã€Redisé«˜å¹¶å‘å®æˆ˜ã€‹</p><ul><li>è¯­è¨€</li></ul><table><thead><tr><th>åˆ†ç±»</th><th>ä¹¦å</th></tr></thead><tbody><tr><td>Java</td><td>ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ã€‹</td></tr><tr><td></td><td>ã€ŠEffective Javaã€‹</td></tr><tr><td></td><td>ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹</td></tr><tr><td></td><td>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</td></tr><tr><td></td><td>ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</td></tr></tbody></table><h3 id="æ€è€ƒæ–¹å¼"><a href="#æ€è€ƒæ–¹å¼" class="headerlink" title="æ€è€ƒæ–¹å¼"></a>æ€è€ƒæ–¹å¼</h3><ul><li><p><a href="https://www.toutiao.com/i6619057728725729800/">ç»“æ„åŒ–æ€ç»´</a></p></li><li><p>é‡‘å­—å¡”ç»“æ„æ ‘</p><pre><code class="textmate">ç»“è®º             äº§å“éå¸¸æˆåŠŸ,éœ€è¦åŠ å¤§ç ”å‘åŠ›åº¦              /           |            \ç†ç”±      ç”¨æˆ·æ•°æ®å¥½      å¸‚åœºåé¦ˆå¥½         è¿è¥æ´»åŠ¨å’Œä¸Šçº¿æ–¹æ¡ˆå‡†å¤‡å……è¶³        /    \       /        \äº‹å®   ç”¨æˆ·å¤š  ç•™å­˜é«˜   æœç´¢æ’åé«˜   å¤šå®¶åª’ä½“æŠ¥é“</code></pre></li></ul><h3 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h3><p>ã€ŠAmp it upã€‹ - å¼—å…°å…‹Â·æ–¯æ´›ç‰¹æ›¼ (Frank Slootman)</p><pre><code class="textmate">ï¼ˆ1ï¼‰åŠ å¿«èŠ‚å¥ï¼Œæ—¶åˆ»è¦æ±‚å‘˜å·¥ä»¥æ›´å¿«çš„é€Ÿåº¦å®Œæˆå·¥ä½œã€‚    å¦‚æœä½ è¯´ä¸€å‘¨åå¯ä»¥æœ‰ç»“æœï¼Œä»–å°±é—®ä½ ä¸ºä»€ä¹ˆä¸èƒ½æ˜å¤©æˆ–åå¤©å‡ºç»“æœï¼Ÿè¿™å€’ä¸æ˜¯å› ä¸ºç€æ€¥ï¼Œè€Œæ˜¯ä»–è¦å¢åŠ æ‰€æœ‰äººçš„ç´§è¿«æ„Ÿã€‚    å…¬å¸å˜å¤§äº†ï¼Œå°±ä¼šè¡ŒåŠ¨è¿Ÿç¼“ï¼Œä¸æ„¿æ„å†’é™©ã€‚åªæœ‰åŠ å¿«èŠ‚å¥ï¼Œæ‰èƒ½è®©å…¬å¸å§‹ç»ˆå……æ»¡æ´»åŠ›ï¼Œä¿æŒå…´å¥‹åº¦ã€‚    ä»–è¯´ï¼šâ€œè¦æ±‚æŸäººåšæŸäº‹å¿«20%ï¼Œä»–ä»¬ä¼šä½¿ç”¨ä¼ ç»Ÿç­–ç•¥ã€‚å¦‚æœè¦æ±‚å¿«2,000%ï¼Œä»–ä»¬å°†ä¸å¾—ä¸æ¨ç¿»æ‰€æœ‰åŸºæœ¬å‡è®¾ï¼Œä½¿ç”¨éä¼ ç»Ÿç­–ç•¥ï¼Œè¿›è¡Œé‡å¤§åˆ›æ–°ã€‚â€ï¼ˆ2ï¼‰è¦æ±‚å‘˜å·¥æ€è€ƒä¸€äº›æç«¯é—®é¢˜ï¼Œæ‰“ç ´ä¼ ç»Ÿæ€ç»´çš„æŸç¼šã€‚    â€¢ä½ å¦‚ä½•åœ¨æ¥ä¸‹æ¥çš„å…­ä¸ªæœˆå†…å®ç°ä½ çš„10å¹´ç›®æ ‡ï¼Ÿ    â€¢å¦‚æœæ¯å‘¨åªèƒ½å·¥ä½œä¸€å¤©ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•æ”¹å˜å·¥ä½œæ–¹å¼ï¼Ÿ    â€¢å¦‚æœç°æœ‰çš„è¥é”€æ¸ é“éƒ½æ¶ˆå¤±äº†ï¼Œæˆ‘ä»¬å°†å¦‚ä½•å‘å±•æ–°å®¢æˆ·ï¼Ÿ    â€¢äº§å“å¢åŠ ä»€ä¹ˆç‰¹æ€§ï¼Œå¯ä»¥è®©ä»·æ ¼æé«˜10å€ï¼Ÿ    â€¢å¦‚æœä½ æœ‰10å€çš„èµ„æºï¼Œä¼šå¯¹äº§å“åšå“ªäº›æ”¹å˜ï¼Ÿï¼ˆ3ï¼‰æå‡ºæ˜ç¡®çš„ã€é›„å¿ƒå‹ƒå‹ƒçš„ç›®æ ‡ï¼Œé¼“åŠ±å‘˜å·¥å¤§èƒ†è¡ŒåŠ¨ã€‚iPod mini çš„æ—©æœŸå£å·æ˜¯â€œå£è¢‹é‡Œæœ‰ 1,000 é¦–æ­Œæ›²â€ï¼ŒSpaceX å…¬å¸çš„ç›®æ ‡æ˜¯è®©äººç±»æˆä¸ºâ€œå¤šæ˜Ÿçƒç‰©ç§â€ã€‚ç›®æ ‡è¶Šæ¸…æ™°ã€è¶Šé›„å¿ƒå‹ƒå‹ƒï¼Œä¼ ç»Ÿçš„æƒ°æ€§æ€ç»´å°±è¶Šéš¾ç”Ÿå­˜ã€‚ï¼ˆ4ï¼‰æ‹’ç»å¹³åº¸çš„äº§å“ã€‚ä»–é‡‡å–å²è’‚å¤«Â·ä¹”å¸ƒæ–¯çš„æ ‡å‡†ï¼Œäº§å“åªæœ‰ä¸¤ç§ï¼Œè¦ä¹ˆæ˜¯éå¸¸æ£’ï¼Œè¦ä¹ˆæ˜¯ä¸€å¡Œç³Šæ¶‚ï¼Œæ²¡æœ‰ä¸­é—´ç­‰çº§ã€‚    å‘˜å·¥å¼€å‘å‡ºæ–°äº§å“å’Œæ–°åŠŸèƒ½æ—¶ï¼Œä»–ä¼šé—®ï¼šâ€œä½ å…´å¥‹å—ï¼Ÿä½ ä»å¿ƒé‡Œå–œæ¬¢å®ƒå—ï¼Ÿâ€å¦‚æœæ²¡æœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œäº§å“å°±å¿…é¡»é‡æ–°è°ƒæ•´ã€‚ï¼ˆ5ï¼‰ä¸€æµå‘˜å·¥å¾—åˆ°é«˜é¢å¥–é‡‘ã€‚ æ¯ä¸ªå­£åº¦æœ«ï¼Œå…¬å¸éƒ½è¦ä¸¾è¡Œç»©æ•ˆè¯„å®šï¼Œä¸€å¹´è¦è¯„4æ¬¡ç»©æ•ˆã€‚    ç»©æ•ˆåˆ†å¸ƒæ˜¯ä¸€ä¸ªé’Ÿå½¢æ›²çº¿ï¼Œé«˜ç»©æ•ˆå‘˜å·¥æ€»æ˜¯å¤´éƒ¨çš„å°‘æ•°äººï¼Œå¯ä»¥å¾—åˆ°æé«˜çš„å¥–é‡‘ã€‚å¥–é‡‘æ”¾åœ¨ä¸€ä¸ªå¥–é‡‘æ± ï¼Œå…¶ä»–äººåªèƒ½åˆ†å‰©ä¸‹çš„å¥–é‡‘ï¼Œæˆ–è€…æ ¹æœ¬æ²¡æœ‰å¥–é‡‘ã€‚å¤§å¤šæ•°å…¬å¸é‡Œé¢ï¼Œä¸€æµå‘˜å·¥çš„è–ªæ°´ï¼Œç›¸æ¯”ä»–ä»¬çš„è´¡çŒ®éƒ½åä½ï¼Œè¿™ä¸åˆ©äºæ¿€åŠ±ä¼˜ç§€å‘˜å·¥ã€‚ï¼ˆ6ï¼‰ç¼©å°ç„¦ç‚¹ï¼Œä»–è¦æ±‚å‘˜å·¥åªå…³æ³¨æœ€é‡è¦çš„äº‹æƒ…ã€‚â€œè¯·åˆ—å‡ºæ¥ä¸‹æ¥éœ€è¦è§£å†³çš„100ä¸ªé—®é¢˜ï¼Œç„¶ååªç•™ä¸‹æœ€é‡è¦çš„é—®é¢˜1å’Œé—®é¢˜2ï¼Œæ”¾å¼ƒå…¶ä»–98ä¸ªé—®é¢˜ã€‚â€    ä»»ä½•åç¦»æ ¸å¿ƒä½¿å‘½çš„äº‹æƒ…éƒ½ä¼šè®©äººåˆ†å¿ƒã€‚å¯¹äºåŒä¸€ä¸ªå›¢é˜Ÿçš„æ¯ä¸ªæˆå‘˜ï¼Œä»–åˆ†åˆ«æŒ¨ä¸ªé—®ï¼šâ€œä½ ä»¬å›¢é˜Ÿçš„ä¼˜å…ˆäº‹é¡¹æ˜¯ä»€ä¹ˆï¼Ÿâ€ å¦‚æœç­”æ¡ˆä¸ä¸€è‡´ï¼Œä»–å°±çŸ¥é“å›¢é˜Ÿä¸å¤Ÿä¸“æ³¨ï¼Œå¿…é¡»æ•´æ”¹ã€‚</code></pre><h3 id="é‡‘è"><a href="#é‡‘è" class="headerlink" title="é‡‘è"></a>é‡‘è</h3><table><thead><tr><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>ç©·çˆ¸çˆ¸å¯Œçˆ¸çˆ¸</td><td>(ç¾)ç½—ä¼¯ç‰¹Â·æ¸…å´</td></tr><tr><td>ç©·æŸ¥ç†å¹´é‰´</td><td>(ç¾)æœ¬æ°æ˜Â·å¯Œå…°å…‹æ—</td></tr></tbody></table><h3 id="å­¦ä¹ æ–¹æ³•"><a href="#å­¦ä¹ æ–¹æ³•" class="headerlink" title="å­¦ä¹ æ–¹æ³•"></a>å­¦ä¹ æ–¹æ³•</h3><table><thead><tr><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>ã€Šåˆ»æ„ç»ƒä¹ -å¦‚ä½•ä»æ–°æ‰‹åˆ°å¤§å¸ˆã€‹</td><td>å®‰å¾·æ–¯Â·è‰¾åˆ©å…‹æ£®</td></tr></tbody></table><h3 id="å¿ƒç†å­¦"><a href="#å¿ƒç†å­¦" class="headerlink" title="å¿ƒç†å­¦"></a>å¿ƒç†å­¦</h3><table><thead><tr><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>ã€Šä¹Œåˆä¹‹ä¼—ã€‹</td><td>å¤æ–¯å¡”å¤«Â·å‹’åº</td></tr></tbody></table><h4 id="ä¹Œåˆä¹‹ä¼—60ä¸ªåŸºæœ¬è§‚ç‚¹"><a href="#ä¹Œåˆä¹‹ä¼—60ä¸ªåŸºæœ¬è§‚ç‚¹" class="headerlink" title="ä¹Œåˆä¹‹ä¼—60ä¸ªåŸºæœ¬è§‚ç‚¹"></a>ä¹Œåˆä¹‹ä¼—60ä¸ªåŸºæœ¬è§‚ç‚¹</h4><blockquote><p>è½¬è½½,ä½œè€…æœªçŸ¥</p></blockquote><pre><code class="textmate">1.äººä¸€åˆ°ç¾¤ä½“ä¸­ï¼Œæ™ºå•†å°±ä¸¥é‡é™ä½ï¼Œä¸ºäº†è·å¾—è®¤åŒï¼Œä¸ªä½“æ„¿æ„æŠ›å¼ƒæ˜¯éï¼Œç”¨æ™ºå•†å»æ¢å–é‚£ä»½è®©äººå¤‡æ„Ÿå®‰å…¨çš„å½’å±æ„Ÿã€‚2.æˆ‘ä»¬å§‹ç»ˆæœ‰ä¸€ç§é”™è§‰ï¼Œä»¥ä¸ºæˆ‘ä»¬çš„æ„Ÿæƒ…æºè‡ªäºæˆ‘ä»¬è‡ªå·±çš„å†…å¿ƒã€‚3.ç¾¤ä½“åªä¼šå¹²ä¸¤ç§äº‹â€”â€”é”¦ä¸Šæ·»èŠ±æˆ–è½äº•ä¸‹çŸ³ã€‚4.ä¸ªäººä¸€æ—¦æˆä¸ºç¾¤ä½“çš„ä¸€å‘˜ï¼Œä»–æ‰€ä½œæ‰€ä¸ºå°±ä¸ä¼šå†æ‰¿æ‹…è´£ä»»ï¼Œè¿™æ—¶æ¯ä¸ªäººéƒ½ä¼šæš´éœ²å‡ºè‡ªå·±ä¸å—åˆ°çš„çº¦æŸçš„ä¸€é¢ã€‚ç¾¤ä½“è¿½æ±‚å’Œç›¸ä¿¡çš„ä»æ¥ä¸æ˜¯ä»€ä¹ˆçœŸç›¸å’Œç†æ€§ï¼Œè€Œæ˜¯ç›²ä»ã€æ®‹å¿ã€åæ‰§å’Œç‹‚çƒ­ï¼ŒåªçŸ¥é“ç®€å•è€Œæç«¯çš„æ„Ÿæƒ…ã€‚5.æˆ‘ä»¬ä»¥ä¸ºè‡ªå·±æ˜¯ç†æ€§çš„ï¼Œæˆ‘ä»¬ä»¥ä¸ºè‡ªå·±çš„ä¸€ä¸¾ä¸€åŠ¨éƒ½æ˜¯æœ‰å…¶é“ç†çš„ã€‚ä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬çš„ç»å¤§å¤šæ•°æ—¥å¸¸è¡Œä¸ºï¼Œéƒ½æ˜¯ä¸€äº›æˆ‘ä»¬è‡ªå·±æ ¹æœ¬æ— æ³•äº†è§£çš„éšè”½åŠ¨æœºçš„ç»“æœã€‚6.æ‰€è°“çš„ä¿¡ä»°ï¼Œå®ƒèƒ½è®©ä¸€ä¸ªäººå˜å¾—å®Œå…¨å—è‡ªå·±çš„æ¢¦æƒ³å¥´å½¹ã€‚7.åœ¨ä¸ç†æ€§æ°¸æ’çš„å†²çªä¸­ï¼Œæ„Ÿæƒ…ä»æœªå¤±è¿‡æ‰‹ã€‚8.æœ‰æ—¶ä¸çœŸå®çš„ä¸œè¥¿æ¯”çœŸå®çš„ä¸œè¥¿åŒ…å«æ›´å¤šçš„çœŸç†ã€‚9.ç¾¤ä¼—æ²¡æœ‰çœŸæ­£æ¸´æ±‚è¿‡çœŸç†ï¼Œé¢å¯¹é‚£äº›ä¸åˆå£å‘³çš„è¯æ®ï¼Œä»–ä»¬ä¼šå……è€³ä¸é—»â€¦å‡¡æ˜¯èƒ½å‘ä»–ä»¬æä¾›å¹»è§‰çš„ï¼Œéƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°æˆä¸ºä»–ä»¬çš„ä¸»äººï¼›å‡¡æ˜¯è®©ä»–ä»¬å¹»ç­çš„ï¼Œéƒ½ä¼šæˆä¸ºä»–ä»¬çš„ç‰ºç‰²å“ã€‚10.æ•°é‡ï¼Œå³æ˜¯æ­£ä¹‰ã€‚11.æŒæ¡äº†å½±å“ç¾¤ä¼—æƒ³è±¡åŠ›çš„è‰ºæœ¯ï¼Œä¹Ÿå°±æŒæ¡äº†ç»Ÿæ²»ä»–ä»¬çš„è‰ºæœ¯ã€‚12.æ²¡æœ‰ä¼ ç»Ÿï¼Œå°±æ²¡æœ‰æ–‡æ˜ï¼›æ²¡æœ‰å¯¹ä¼ ç»Ÿçš„ç¼“æ…¢æ·˜æ±°ï¼Œå°±æ²¡æœ‰è¿›æ­¥ã€‚13.å­¤ç«‹çš„ä¸ªäººå¾ˆæ¸…æ¥šï¼Œåœ¨å­¤èº«ä¸€äººæ—¶ï¼Œä»–ä¸èƒ½ç„šçƒ§å®«æ®¿æˆ–æ´—åŠ«å•†åº—ï¼Œå³ä½¿å—åˆ°è¿™æ ·åšçš„è¯±æƒ‘ï¼Œä»–ä¹Ÿå¾ˆå®¹æ˜“æŠµåˆ¶è¿™ç§è¯±æƒ‘ã€‚ä½†æ˜¯åœ¨æˆä¸ºç¾¤ä½“çš„ä¸€å‘˜æ—¶ï¼Œä»–å°±ä¼šæ„è¯†åˆ°äººæ•°èµ‹äºˆä»–çš„åŠ›é‡ï¼Œè¿™è¶³ä»¥è®©ä»–ç”Ÿå‡ºæ€äººåŠ«æ çš„å¿µå¤´ï¼Œå¹¶ä¸”ä¼šç«‹åˆ»å±ˆä»äºè¿™ç§è¯±æƒ‘ã€‚å‡ºä¹é¢„æ–™çš„éšœç¢ä¼šè¢«ç‹‚æš´åœ°æ‘§æ¯ã€‚äººç±»çš„æœºä½“çš„ç¡®èƒ½å¤Ÿäº§ç”Ÿå¤§é‡ç‹‚çƒ­çš„æ¿€æƒ…ï¼Œå› æ­¤å¯ä»¥è¯´ï¼Œæ„¿æœ›å—é˜»çš„ç¾¤ä½“æ‰€å½¢æˆçš„æ­£å¸¸çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¿™ç§æ¿€æ„¤çŠ¶æ€ã€‚14.ä¸€ä¸ªå›½å®¶ä¸ºå…¶å¹´è½»äººæ‰€æä¾›çš„æ•™è‚²ï¼Œå¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå›½å®¶æœªæ¥çš„æ ·å­ã€‚15.èƒ½å¤Ÿæ„Ÿè§‰åˆ°çš„ç°è±¡å¯ä»¥æ¯”ä½œæ³¢æµªï¼Œæ˜¯æµ·æ´‹æ·±å¤„æˆ‘ä»¬ä¸€æ— æ‰€çŸ¥çš„é‚£äº›ä¹±è±¡åœ¨æ´‹é¢ä¸Šçš„è¡¨è±¡ã€‚16.æ˜¨å¤©å—ç¾¤ä¼—æ‹¥æˆ´çš„è‹±é›„ä¸€æ—¦å¤±è´¥ï¼Œä»Šå¤©å°±ä¼šå—åˆ°ä¾®è¾±ã€‚å½“ç„¶åæœ›è¶Šé«˜ï¼Œååº”å°±ä¼šè¶Šå¼ºçƒˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¾¤ä¼—å°±ä¼šæŠŠæœ«è·¯è‹±é›„è§†ä¸ºè‡ªå·±çš„åŒç±»ï¼Œä¸ºè‡ªå·±æ›¾å‘ä¸€ä¸ªå·²ä¸å¤å­˜åœ¨çš„æƒå¨ä½å¤´å“ˆè…°è€Œè¿›è¡ŒæŠ¥å¤ã€‚17.ç¾¤ä½“åœ¨æ™ºåŠ›ä¸Šæ€»æ˜¯ä½äºå­¤ç«‹çš„ä¸ªäººï¼Œä½†æ˜¯ä»æ„Ÿæƒ…åŠå…¶æ¿€å‘çš„è¡ŒåŠ¨è¿™ä¸ªè§’åº¦çœ‹ï¼Œç¾¤ä½“å¯ä»¥æ¯”ä¸ªäººè¡¨ç°å¾—æ›´å¥½æˆ–æ›´å·®ï¼Œè¿™å…¨çœ‹ç¯å¢ƒå¦‚ä½•ã€‚ä¸€åˆ‡å–å†³äºç¾¤ä½“æ‰€æ¥å—çš„æš—ç¤ºå…·æœ‰ä»€ä¹ˆæ€§è´¨ã€‚18.ç¾¤ä½“å› ä¸ºå¤¸å¤§è‡ªå·±çš„æ„Ÿæƒ…ï¼Œå› æ­¤å®ƒåªä¼šè¢«æç«¯æ„Ÿæƒ…æ‰€æ‰“åŠ¨ã€‚å¸Œæœ›æ„ŸåŠ¨ç¾¤ä½“çš„æ¼”è¯´å®¶ï¼Œå¿…é¡»å‡ºè¨€ä¸é€Šï¼Œä¿¡èª“æ—¦æ—¦ã€‚å¤¸å¤§å…¶è¾ã€è¨€ä¹‹å‡¿å‡¿ã€ä¸æ–­é‡å¤ã€ç»å¯¹ä¸ä»¥è¯´ç†çš„æ–¹å¼è¯æ˜ä»»ä½•äº‹æƒ…â€”â€”è¿™äº›éƒ½æ˜¯å…¬ä¼—é›†ä¼šä¸Šçš„æ¼”è¯´å®¶æƒ¯ç”¨çš„è®ºè¯´æŠ€å·§ã€‚19.ä»¤äººéš¾å¿˜çš„å†å²äº‹ä»¶ï¼Œåªæ˜¯äººç±»æ€æƒ³æ— å½¢çš„å˜åŒ–é€ æˆçš„æœ‰å½¢çš„åæœè€Œå·²ã€‚20.å­¤ç«‹çš„ä¸ªä½“å…·æœ‰æ§åˆ¶è‡ªèº«ååº”è¡Œä¸ºçš„èƒ½åŠ›ï¼Œè€Œç¾¤ä½“åˆ™ä¸å…·å¤‡ã€‚21.ä¸“æ¨ªå’Œåæ‰§æ˜¯ä¸€åˆ‡ç±»å‹çš„ç¾¤ä½“çš„å…±æ€§ã€‚22.å½±å“æ°‘ä¼—æƒ³è±¡åŠ›çš„ï¼Œå¹¶ä¸æ˜¯äº‹å®æœ¬èº«ï¼Œè€Œæ˜¯å®ƒä»¬å‘ç”Ÿå’Œå¼•èµ·æ³¨æ„çš„æ–¹å¼ã€‚23.ç¾¤ä½“æ€»æ˜¯å¯¹å¼ºæƒä¿¯é¦–å¸–è€³ï¼Œå´å¾ˆå°‘ä¸ºä»æ…ˆå–„è¡Œæ„ŸåŠ¨ï¼åœ¨ä»–ä»¬çœ‹æ¥ï¼Œä»æ…ˆå–„è‰¯åªä¸è¿‡æ˜¯è½¯å¼±å¯æ¬ºçš„ä»£åè¯ã€‚24.å¤§ä¼—æ²¡æœ‰è¾¨åˆ«èƒ½åŠ›ï¼Œå› è€Œæ— æ³•åˆ¤æ–­äº‹æƒ…çš„çœŸä¼ªï¼Œè®¸å¤šç»ä¸èµ·æ¨æ•²çš„è§‚ç‚¹ï¼Œéƒ½èƒ½è½»è€Œæ˜“ä¸¾çš„å¾—åˆ°æ™®éèµåŒ!25.ç¾¤ä½“ç›²ä»æ„è¯†ä¼šæ·¹æ²¡ä¸ªä½“çš„ç†æ€§ï¼Œä¸ªä½“ä¸€æ—¦å°†è‡ªå·±å½’å…¥è¯¥ç¾¤ä½“ï¼Œå…¶åŸæœ¬ç‹¬ç«‹çš„ç†æ€§å°±ä¼šè¢«ç¾¤ä½“çš„æ— çŸ¥ç–¯ç‹‚æ‰€æ·¹æ²¡ã€‚26.ä»é•¿è¿œçœ‹ï¼Œä¸æ–­é‡å¤çš„è¯´æ³•ä¼šè¿›å…¥æˆ‘ä»¬æ— æ„è¯†çš„è‡ªæˆ‘çš„æ·±å±‚åŒºåŸŸï¼Œè€Œæˆ‘ä»¬çš„è¡Œä¸ºåŠ¨æœºæ­£æ˜¯åœ¨è¿™é‡Œå½¢æˆçš„ã€‚åˆ°äº†ä¸€å®šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¿˜è®°è°æ˜¯é‚£ä¸ªä¸æ–­è¢«é‡å¤çš„ä¸»å¼ çš„ä½œè€…ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¯¹å®ƒæ·±ä¿¡ä¸ç§»ã€‚27.ç¾¤ä½“ä¸­çš„ä¸ªäººæ˜¯æ²™ä¸­ä¹‹æ²™ï¼Œé£å¯ä»¥éšæ„æ…åŠ¨ä»–ä»¬ã€‚28.ç¾¤ä½“è¡¨ç°å‡ºæ¥çš„æ„Ÿæƒ…ä¸ç®¡æ˜¯å¥½æ˜¯åï¼Œå…¶çªå‡ºçš„ç‰¹ç‚¹å°±æ˜¯æä¸ºç®€å•è€Œå¤¸å¼ ã€‚29.ä½†å‡¡èƒ½å¤Ÿæˆå°±å¤§ä¸šçš„é¢†è¢–äººç‰©ï¼Œä»–é‡è¦çš„å“è´¨ä¸æ˜¯åšå­¦å¤šè¯†ï¼Œè€Œæ˜¯å¿…é¡»å…·å¤‡å¼ºå¤§è€ŒæŒä¹…çš„æ„å¿—åŠ›ï¼Œè¿™æ˜¯ä¸€ç§æä¸ºç½•è§ï¼Œæä¸ºå¼ºå¤§çš„å“è´¨ï¼Œå®ƒè¶³ä»¥å¾æœä¸€åˆ‡ã€‚30.æ–‡æ˜å‘æ¥åªç”±å°‘æ•°çŸ¥è¯†è´µæ—é˜¶çº§è€Œéç¾¤ä½“æ¥åˆ›é€ ã€‚31.èº«ä¸ºä¸€ä½é¢†è¢–ï¼Œå¦‚æœæƒ³è¦è®©è‡ªå·±åˆ›ç«‹çš„å®—æ•™æˆ–æ”¿æ²»ä¿¡æ¡ç«™ä½è„šï¼Œå°±å¿…é¡»æˆåŠŸåœ°æ¿€èµ·ç¾¤ä¼—æƒ³å…¥ééçš„æ„Ÿæƒ…ã€‚32.ç»“ç¾¤åï¼Œç”±äºäººå¤šåŠ¿ä¼—ï¼Œä¸ªäººä¼šäº§ç”Ÿä¸€ç§å¹»è§‰ï¼Œæ„Ÿåˆ°è‡ªå·±åŠ›å¤§æ— ç©·ï¼Œä¸å¯æˆ˜èƒœï¼Œå¥½åƒæ²¡æœ‰ä»€ä¹ˆäº‹æƒ…æ˜¯åŠä¸åˆ°çš„ã€‚33.å½“ä¸€ä¸ªäººèå…¥ç¤¾ä¼šä¹‹ä¸­æ—¶ï¼Œä»–ä¾¿å¤±å»äº†è‡ªæˆ‘ã€‚34.åœ¨è¿«ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿè®¸è¿˜æ˜¯ä¼šæ„¿æ„æ¥å—ä¼ ç»Ÿæ•™è‚²å½“ä¸­æ‰€æœ‰çš„å¼Šç«¯ï¼Œå› ä¸ºå°½ç®¡å®ƒåªä¼šåŸ¹å…»ä¸€äº›è¢«ç¤¾ä¼šæ‰€æŠ›å¼ƒçš„äººã€å¿ƒæ€€ä¸æ»¡çš„äººï¼Œä½†èµ·ç ï¼Œå¯¹å†—ç¹çŸ¥è¯†çš„è‚¤æµ…æŒæ¡ï¼Œå¯¹æˆå †æ•™ç§‘ä¹¦çš„å®Œç¾èƒŒè¯µï¼Œæˆ–è®¸å¯ä»¥æé«˜æ™ºåŠ›æ°´å¹³ã€‚ä½†äº‹å®ä¸Šå®ƒçœŸçš„èƒ½æé«˜æ™ºåŠ›å—ï¼Ÿä¸å¯èƒ½ï¼åœ¨ç”Ÿæ´»ä¸­ï¼Œåˆ¤æ–­åŠ›ã€ç»éªŒã€è¿›å–å¿ƒå’Œä¸ªæ€§ï¼Œè¿™äº›æ‰æ˜¯å–å¾—æˆåŠŸçš„æ¡ä»¶ï¼Œè¿™äº›éƒ½ä¸æ˜¯ä¹¦æœ¬æ‰€èƒ½å¤Ÿç»™äºˆçš„ã€‚ä¹¦æœ¬æ˜¯å¯ä¾›æŸ¥è¯¢çš„æœ‰ç”¨å­—å…¸ï¼Œä½†å€˜è‹¥æŠŠè¿™äº›å†—é•¿çš„è¯æ¡éƒ½è£…åœ¨è„‘å­é‡Œï¼Œé‚£å¯æ˜¯ä¸€ç‚¹ç”¨éƒ½æ²¡æœ‰ã€‚35.æ–‡æ˜èµ–ä»¥å½¢æˆçš„é“å¾·åŠ›é‡å¤±å»æ•ˆåŠ›æ—¶ï¼Œå®ƒçš„æœ€ç»ˆç“¦è§£æ€»æ˜¯ç”±æ— æ„è¯†ä¸”é‡è›®çš„ç¾¤ä½“æ¥å®Œæˆçš„ã€‚36.ä¸€åˆ‡æ”¿æ²»ã€ç¥å­¦æˆ–ç¤¾ä¼šä¿¡æ¡ï¼Œè¦æƒ³åœ¨ç¾¤ä¼—ä¸­æ‰æ ¹ï¼Œéƒ½å¿…é¡»é‡‡å–å®—æ•™çš„å½¢å¼â€”â€”èƒ½å¤ŸæŠŠå±é™©çš„è®¨è®ºæ’é™¤åœ¨å¤–çš„å½¢å¼ã€‚37.ç¾¤ä½“ç²¾ç¥æœ€éœ€è¦çš„ä¸æ˜¯è‡ªç”±è€Œæ˜¯æœä»ã€‚ä»–ä»¬å¦‚æ­¤ç”˜æ„¿å¬ä»åˆ«äººçš„æ„å¿—ï¼Œä»¥è‡³äºåªè¦æœ‰äººè‡ªç§°æ˜¯å®ƒä»¬çš„ä¸»äººï¼Œä»–ä»¬å°±ä¼šæœ¬èƒ½åœ°å¬å‘½äºä»–ã€‚38.å°½ç®¡åœ¨é‚£ä¸€å¤©çš„é‚£ä¸¤ä¸ªå°æ—¶é‡Œä»–ä»¬åšåˆ°äº†æˆ–è€…å‡ ä¹åšåˆ°äº†ï¼Œåˆ°ä¸€ä¸ªæœˆä»¥åä»–ä»¬å´ä¸å†å…·å¤‡è¿™ç§èƒ½åŠ›ã€‚ä»–ä»¬æ— æ³•å†æ¬¡é€šè¿‡è€ƒè¯•ã€‚ä»–ä»¬è„‘ä¸­ä¸æ–­ä¸¢å¤±å¤§é‡è¿‡äºæ²‰é‡çš„çŸ¥è¯†ï¼Œè€Œä¸”æ²¡æœ‰æ–°çš„çŸ¥è¯†æ¥å¡«å……ã€‚ä»–ä»¬çš„æ€æƒ³æ´»åŠ›å¼€å§‹è¡°é€€ï¼Œä¿ƒè¿›æˆé•¿çš„æ‰èƒ½æ¸æ¸å¹²æ¶¸ï¼Œè¿™æ—¶ä¸€ä¸ªå¾—åˆ°å……åˆ†å‘å±•çš„äººè¯ç”Ÿäº†ï¼Œä½†æ­¤æ—¶çš„ä»–æ—©å·²ç–²æƒ«ä¸å ªã€‚ç»“å©šè¿‡ä¸Šå®‰å®šçš„ç”Ÿæ´»ï¼Œé™·å…¥æŸç§å¾ªç¯ï¼Œå¹¶æ°¸æ— æ­¢å¢ƒåœ°é‡å¤ä¸‹å»ï¼›ä»–å°†è‡ªå·±å°é—­åœ¨ç‹­éš˜çš„å·¥ä½œä¸­ï¼Œå°½èŒå°½è´£ï¼Œä»…æ­¤è€Œå·²ã€‚ä»–ä»¬æœ€ç»ˆå˜ä¸ºäº†å¹³åº¸ä¹‹è¾ˆã€‚39.ä¸ªäººä¸€æ—¦èå…¥ç¾¤ä½“ï¼Œä»–çš„ä¸ªæ€§ä¾¿ä¼šè¢«æ¹®æ²¡ï¼Œç¾¤ä½“çš„æ€æƒ³ä¾¿ä¼šå æ®ç»å¯¹çš„ç»Ÿæ²»åœ°ä½ï¼Œè€Œä¸æ­¤åŒæ—¶ï¼Œç¾¤ä½“çš„è¡Œä¸ºä¹Ÿä¼šè¡¨ç°å‡ºæ’æ–¥å¼‚è®®ï¼Œæç«¯åŒ–ã€æƒ…ç»ªåŒ–åŠä½æ™ºå•†åŒ–ç­‰ç‰¹ç‚¹ã€‚è¿›è€Œå¯¹ç¤¾ä¼šäº§ç”Ÿç ´åæ€§çš„å½±å“ã€‚40.æ‰€æœ‰æ—¶ä»£å’Œæ‰€æœ‰å›½å®¶çš„ä¼Ÿå¤§æ”¿å®¢ï¼ŒåŒ…æ‹¬æœ€ä¸“æ¨ªçš„æš´å›ï¼Œä¹Ÿéƒ½æŠŠç¾¤ä¼—çš„æƒ³è±¡åŠ›è§†ä¸ºä»–ä»¬æƒåŠ›çš„åŸºç¡€ï¼Œä»–ä»¬ä»æ¥æ²¡æœ‰è®¾æƒ³è¿‡é€šè¿‡ä¸å®ƒä½œå¯¹è€Œè¿›è¡Œç»Ÿæ²»ã€‚è¦æƒ³æŒæ¡è¿™ç§æœ¬é¢†ï¼Œä¸‡ä¸‡ä¸å¯æ±‚åŠ©äºæ™ºåŠ›æˆ–æ¨ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»å¯¹ä¸å¯ä»¥é‡‡ç”¨è®ºè¯çš„æ–¹å¼ã€‚41.ç¾¤ä½“çš„å åŠ åªæ˜¯æ„šè ¢çš„å åŠ ï¼Œè€ŒçœŸæ­£çš„æ™ºæ…§è¢«æ„šè ¢çš„æ´ªæµæ·¹æ²¡ã€‚42.äººä»¬ç»å¸¸è¯´èµ·é‚£å®¶å¤§ä¼—å‰§é™¢ï¼Œå®ƒåªæ¼”ä»¤äººå‹æŠ‘çš„æˆå‰§ï¼Œæ•£åœºåï¼Œå¿…é¡»ä¿æŠ¤æ‰®æ¼”å›å¾’çš„æ¼”å‘˜ï¼Œå…å¾—ä»–é­åˆ°è§‚ä¼—çš„æš´æ‰“ã€‚ä»–æ‰€çŠ¯çš„ç½ªè¡Œï¼Œå½“ç„¶æ˜¯æƒ³è±¡å‡ºæ¥çš„ï¼Œå¼•èµ·äº†ç¾¤ä¼—çš„å·¨å¤§æ„¤æ€’ã€‚æˆ‘è§‰å¾—è¿™æ˜¯ç¾¤ä½“ç²¾ç¥çŠ¶æ€æœ€æ˜¾è‘—çš„è¡¨ç°ä¹‹ä¸€ï¼Œè¿™æ¸…æ¥šåœ°è¯´æ˜ï¼Œè¦ç»™ä»–ä»¬ä»€ä¹ˆæš—ç¤ºæ˜¯ä¸€ä»¶å¤šä¹ˆå®¹æ˜“çš„äº‹æƒ…ã€‚å¯¹ä»–ä»¬æ¥è¯´ï¼Œå‡ä¸çœŸå‡ ä¹åŒæ ·å¥æ•ˆã€‚ä»–ä»¬æ˜æ˜¾åœ°è¡¨ç°å‡ºçœŸå‡ä¸åˆ†çš„å€¾å‘ã€‚43.å„ç§åˆ¶åº¦å¹¶æ²¡æœ‰å›ºå®šçš„ä¼˜ç‚¹ï¼Œå°±å®ƒä»¬æœ¬èº«è€Œè¨€ï¼Œå®ƒä»¬æ— æ‰€è°“å¥½åã€‚å› ä¸ºåœ¨ç‰¹å®šçš„æ—¶åˆ»å¯¹ä¸€ä¸ªæ°‘æ—æœ‰ç›Šçš„åˆ¶åº¦ï¼Œå¯¹å¦ä¸€ä¸ªæ°‘æ—ä¹Ÿè®¸æ˜¯æä¸ºæœ‰å®³çš„ ã€‚44.ç¾¤ä½“ä¹Ÿè®¸æ°¸è¿œæ˜¯æ— æ„è¯†çš„ï¼Œä½†è¿™ç§æ— æ„è¯†æœ¬èº«ï¼Œå¯èƒ½å°±æ˜¯å®ƒåŠ›é‡å¼ºå¤§çš„ç§˜å¯†ä¹‹ä¸€ã€‚åœ¨è‡ªç„¶ç•Œï¼Œç»å¯¹æœä»æœ¬èƒ½çš„ç”Ÿç‰©ï¼Œå…¶è¡Œä¸ºä¼šå¤æ‚å¾—è®©æˆ‘ä»¬ä¸æ•¢ç›¸ä¿¡ã€‚ç†æ™ºæ˜¯äººç±»æ–°è¿‘æ‰æœ‰çš„ä¸œè¥¿ï¼Œå¤ªä¸å®Œç¾äº†ï¼Œä¸èƒ½å‘æˆ‘ä»¬æ­ç¤ºæ— æ„è¯†çš„è§„å¾‹ï¼Œæ›´ä¸èƒ½æ›¿ä»£å®ƒã€‚åœ¨æˆ‘ä»¬çš„è¡Œä¸ºä¸¾æ­¢ä¸­ï¼Œæ— æ„è¯†éƒ¨åˆ†å çš„æ¯”é‡å¾ˆå¤§ï¼Œç†æ™ºæ‰€å çš„æ¯”ä¾‹å´å¾ˆå°ã€‚æ— æ„è¯†ç°åœ¨ä»ä½œä¸ºæœªçŸ¥çš„åŠ›é‡åœ¨èµ·ä½œç”¨ã€‚45.åˆ°äº†ä¸€å®šçš„æ—¶å€™æˆ‘ä»¬ä¸ä¼šè®°å¾—é‚£ä¸ªä¸æ–­è¢«é‡å¤çš„ä¸»å¼ çš„äººæ˜¯è°ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¯¹å®ƒæ·±ä¿¡ä¸ç–‘ï¼Œå¹¿å‘Šèƒ½æœ‰ä»¤äººåƒæƒŠçš„å¨åŠ›ï¼Œè¿™å°±æ˜¯åŸå›  ã€‚46.æ•™è‚²æ—¢ä¸ä¼šè®©äººæ›´é“å¾·ï¼ŒåŒæ ·ä¸ä¼šä½¿ä»–æ›´å¹¸ç¦ï¼Œå®ƒæ—¢ä¸èƒ½å°†ä»–çš„æœ¬èƒ½æ”¹å˜ ï¼Œä¹Ÿä¸èƒ½å°†ä»–å¤©ç”Ÿçš„çƒ­æƒ…æ”¹å˜ï¼Œè€Œä¸”æœ‰åœ¨è¿›è¡Œä¸è‰¯å¼•å¯¼åï¼Œå®ƒçš„å®³å¤„è¿œå¤§äºå¥½å¤„ã€‚47.å•ç‹¬ä¸€ä¸ªäººå¿…é¡»è¦ä¸ºä»–çš„è¡Œä¸ºæ‰¿æ‹…è´£ä»»â€”â€”æ³•å¾‹ä¸Šæˆ–è€…é“å¾·ä¸Šã€‚ä½†æ˜¯ï¼Œç¾¤ä½“åˆ™ä¸ç„¶ï¼Œç¾¤ä½“ä¸éœ€è¦æ‰¿æ‹…ä»»ä½•è´£ä»»ï¼Œç¾¤ä½“å°±æ˜¯è´£ä»»ï¼Œç¾¤ä½“å°±æ˜¯é“å¾·ï¼Œç¾¤ä½“å°±æ˜¯æ³•å¾‹ï¼Œç¾¤ä½“å°±æ˜¯é“å¾·ï¼Œç¾¤ä½“çš„è¡Œä¸ºè‡ªç„¶æ˜¯åˆç†çš„ã€‚48.åæœ›çš„äº§ç”Ÿä¸è‹¥å¹²å› ç´ æœ‰å…³ï¼Œè€ŒæˆåŠŸæ°¸è¿œæ˜¯å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªã€‚49.å­¦ä¹ è¯¾ç¨‹ï¼ŒæŠŠä¸€ç§è¯­æ³•æˆ–ä¸€ç¯‡çº²è¦ç‰¢è®°åœ¨å¿ƒï¼Œé‡å¤å¾—å¥½ï¼Œæ¨¡ä»¿ä¹Ÿå‡ºè‰²â€”â€”è¿™å®åœ¨æ˜¯ä¸€ç§ååˆ†å¯ç¬‘çš„æ•™è‚²æ–¹å¼ï¼Œå®ƒçš„æ¯é¡¹å·¥ä½œéƒ½æ˜¯ä¸€ç§ä¿¡ä»°è¡Œä¸ºï¼Œå³é»˜è®¤æ•™å¸ˆä¸å¯èƒ½çŠ¯é”™è¯¯ã€‚è¿™ç§æ•™è‚²çš„å”¯ä¸€ç»“æœï¼Œå°±æ˜¯è´¬ä½è‡ªæˆ‘ï¼Œè®©æˆ‘ä»¬å˜å¾—æ— èƒ½ã€‚50.æ°‘ä¼—çš„æƒ³è±¡åŠ›æ˜¯æ”¿å®¢çš„æƒåŠ›åŸºç¡€ã€‚51.åœ¨å†³å®šäººä»¬å†å²åœ°ä½ä¸Šèµ·ç€æ›´å¤§ä½œç”¨çš„ï¼Œä¸æ˜¯ä»–ä»¬çš„â€œçœŸå®â€é¢ç›®ï¼Œè€Œæ˜¯åäººå¯¹ä»–ä»¬çš„è®¤è¯†å’Œæ„Ÿå—ã€‚52.ç¾¤ä½“ä¼šè®©æ¯ä¸ªäººåœ¨å…¶ä¸­çš„é”™è¯¯ç¼©å°ï¼ŒåŒæ—¶è®©æ¯ä¸ªäººçš„æ¶æ„è¢«æ— é™æ”¾å¤§ã€‚54.æŸç¼šä¸ªäººè¡Œä¸ºçš„è´£ä»»æ„Ÿä¸€æ¶ˆå¤±ï¼Œäººä¾¿ä¼šéšå¿ƒæ‰€æ¬²ï¼Œè‚†æ„å¦„ä¸ºã€‚55.ç¾¤ä½“çš„æ— æ„è¯†è¡Œä¸ºå–ä»£äº†ä¸ªä½“æœ‰æ„è¯†çš„è¡Œä¸ºï¼Œè¿™æ˜¯ç°æ—¶ä»£æœ€æ˜¾è‘—çš„ç‰¹å¾ä¹‹ä¸€ã€‚56.å¶åƒå´‡æ‹œçš„äº”å¤§æ ‡è¯†ï¼š    ç¬¬ä¸€ï¼Œå¶åƒæ€»æ˜¯å‡Œé©¾äºä¿¡å¾’ï¼Œå¤„äºé«˜é«˜åœ¨ä¸Šçš„åœ°ä½ï¼Œè¿™ä¸€ç‚¹æœ‰ç€å†³å®šæ€§åœ°ä½œç”¨ã€‚    ç¬¬äºŒï¼Œä¿¡å¾’æ€»æ˜¯ç›²ç›®æœä»å¶åƒçš„å‘½ä»¤ã€‚    ç¬¬ä¸‰ï¼Œä¿¡å¾’æ²¡æœ‰èƒ½åŠ›ï¼Œä¹Ÿä¸æ„¿æ„å¯¹å¶åƒè§„å®šçš„ä¿¡æ¡è¿›è¡Œè®¨è®ºã€‚    ç¬¬å››ï¼Œä¿¡å¾’æœ‰ç€ç‹‚çƒ­çš„æ„¿æœ›ï¼Œå¸Œæœ›æŠŠå¶åƒçš„ä¿¡æ¡å¹¿åŠ ä¼ æ’­ã€‚    ç¬¬äº”ï¼Œä¿¡å¾’å€¾å‘äºæŠŠä¸æ¥å—å®ƒä»¬çš„ä»»ä½•äººè§†ä¸ºä»‡æ•Œã€‚    å½“ç¾¤ä½“ç¬¦åˆç¬¬ä¸€æ¡ï¼Œå…¶å½¢å¼å°±ç­‰åŒäºå®—æ•™ï¼Œè€Œè¿™ç§æƒ…æ„Ÿå°±å˜æˆäº†å®—æ•™ä¿¡ä»°ã€‚    å¯¹ç¾¤ä½“æ¥è¯´ï¼Œä¹Ÿè®¸æœ€ä¸åˆç†çš„æ‰æ˜¯æœ€åˆç†çš„é€‰æ‹©57.ç¾¤ä¼—æ—¥ç›Šè¢«å¤§ä¼—æ–‡åŒ–æ‰€æ¹®æ²¡ï¼Œè¿™ç§æ–‡åŒ–æŠŠå¹³åº¸ä½ä¿—å½“ä½œæœ€æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚58.æ‰€ä»¥ä¸è¦è½»æ˜“åœ°æˆä¸ºé›†ä½“çš„ä¸€ä»½å­ï¼Œè¿™æ ·å¾ˆå®¹æ˜“è¢«åˆ«æœ‰ç”¨å¿ƒçš„äººåˆ©ç”¨ï¼Œå³ä½¿ä½ ä»¥ä¸ºè‡ªå·±åªä¸è¿‡æ˜¯éšå£°é™„å’Œäº†ä¸€ä¸‹è€Œå·²ï¼Œå®é™…ä¸Šä½ å·²ç»æˆäº†å¸®å‡¶ã€‚59.ç¾¤ä½“çš„å¤¸å¼ å€¾å‘åªä½œç”¨äºæ„Ÿæƒ…ï¼Œå¯¹æ™ºåŠ›ä¸èµ·ä»»ä½•ä½œç”¨ã€‚60.ç¾¤ä½“ä¸å–„æ¨ç†ï¼Œå´åˆæ€¥äºè¡ŒåŠ¨ã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‚è®°</title>
      <link href="/2020/10/02/thinking/something/"/>
      <url>/2020/10/02/thinking/something/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://www.woshipm.com/marketing/5706732.html">è¥é”€-å¿…è¦è®¤çŸ¥</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‚è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶æ¨è</title>
      <link href="/2020/10/02/other/software/"/>
      <url>/2020/10/02/other/software/</url>
      
        <content type="html"><![CDATA[<h3 id="Macè½¯ä»¶-amp-å·¥å…·ç½‘ç«™"><a href="#Macè½¯ä»¶-amp-å·¥å…·ç½‘ç«™" class="headerlink" title="Macè½¯ä»¶&amp;å·¥å…·ç½‘ç«™"></a>Macè½¯ä»¶&amp;å·¥å…·ç½‘ç«™</h3><table><thead><tr><th>ä¸»è¦åŠŸèƒ½</th><th>è½¯ä»¶å</th><th>ç›¸å…³ç½‘å€</th></tr></thead><tbody><tr><td>å›¾ç‰‡ç¼–è¾‘å™¨</td><td>PixelStyle</td><td></td></tr><tr><td>è§†é¢‘æ’­æ”¾</td><td>IINA</td><td></td></tr><tr><td>å½•å±è½¯ä»¶</td><td>LICEcap</td><td></td></tr><tr><td>æ–‡ä»¶æ¯”è¾ƒ</td><td>Beyond Compare</td><td></td></tr><tr><td>Markdownç¼–è¾‘å·¥å…·</td><td>Haroopad</td><td></td></tr><tr><td>MacåŒ…ç®¡ç†å·¥å…·</td><td>Homebrew</td><td></td></tr><tr><td>Macç ´è§£è½¯ä»¶</td><td></td><td><a href="https://xclient.info/">https://xclient.info</a></td></tr><tr><td>ç›¸ä¼¼ç½‘ç«™æŸ¥è¯¢</td><td></td><td><a href="https://www.similarsites.com/">https://www.similarsites.com</a></td></tr></tbody></table><h3 id="å¸¸ç”¨è½¯ä»¶æ¿€æ´»æ–¹æ³•"><a href="#å¸¸ç”¨è½¯ä»¶æ¿€æ´»æ–¹æ³•" class="headerlink" title="å¸¸ç”¨è½¯ä»¶æ¿€æ´»æ–¹æ³•"></a>å¸¸ç”¨è½¯ä»¶æ¿€æ´»æ–¹æ³•</h3><h4 id="JReblæ¿€æ´»"><a href="#JReblæ¿€æ´»" class="headerlink" title="JReblæ¿€æ´»"></a>JReblæ¿€æ´»</h4><ul><li><a href="http://www.yq1012.com/things/5019.html">Idea JReblæ’ä»¶æ¿€æ´»æ–¹æ³•</a></li></ul><pre><code class="textmate">1.ç”Ÿæˆguid    http://jrebel.cicoding.cn/guid2.é…ç½®    è®¾ç½® JRebel &amp; XRebel ç‚¹å‡»Chanage license3.å¡«å…¥    http://jrebel.cicoding.cn/æ–°ç”Ÿæˆçš„guid    é‚®ç®±</code></pre><pre><code class="textmate">1. ä¸‹è½½å¯¹åº”ç³»ç»Ÿç‰ˆæœ¬releaseåŒ…https://github.com/ilanyu/ReverseProxy/releaseshttps://github.com/ilanyu/ReverseProxy/issues/30   M1ç”¨è¿™ä¸ª#æ‰§è¡Œshå‘½ä»¤chmod a+x ReverseProxy_darwin_arm64./ReverseProxy_darwin_arm64 -l &quot;0.0.0.0:8888&quot; -r &quot;http://idea.lanyue.com:80&quot;# å¯åŠ¨å¤±è´¥æŸ¥çœ‹8888ç«¯å£æ˜¯å¦è¢«å ç”¨(å¤§æ¦‚ç‡æ˜¯charles)sudo lsof -i tcp:8888#åœ¨æ¿€æ´»æ¡†ä¸­è¾“å…¥http://localhost:8888/&#123;gudi&#125;</code></pre><ul><li>æ–¹å¼äºŒ</li></ul><pre><code class="textmate">1.Team Url    http://jrebel.cicoding.cn/016AAD2C-DD8E-6D92-58EB-B6C79E874355    xxx@xxx.com2.ç„¶åè®¾ç½®ä¸ºç¦»çº¿ä½¿ç”¨</code></pre><h4 id="MacOS-sourceTreeè·³è¿‡ç™»å½•"><a href="#MacOS-sourceTreeè·³è¿‡ç™»å½•" class="headerlink" title="MacOS sourceTreeè·³è¿‡ç™»å½•"></a>MacOS sourceTreeè·³è¿‡ç™»å½•</h4><pre><code class="textmate">1.æ˜¾ç¤ºåŒ…å†…å®¹2.æœç´¢Atlassian3.åˆ é™¤æœå‡ºæ¥çš„æ–‡ä»¶(æ²¡æœ‰è¯´æ˜å®‰è£…åŒ…å¯èƒ½æœ‰é—®é¢˜)</code></pre><h4 id="MacOSè½¯ä»¶å·²æŸåä¿®å¤"><a href="#MacOSè½¯ä»¶å·²æŸåä¿®å¤" class="headerlink" title="MacOSè½¯ä»¶å·²æŸåä¿®å¤"></a>MacOSè½¯ä»¶å·²æŸåä¿®å¤</h4><pre><code class="textmate">## è½¯ä»¶å·²æŸåsudo xattr -d com.apple.quarantine /Applications/xxxxxx.app</code></pre><h4 id="sshå¯†é’¥ç”Ÿæˆ"><a href="#sshå¯†é’¥ç”Ÿæˆ" class="headerlink" title="sshå¯†é’¥ç”Ÿæˆ"></a>sshå¯†é’¥ç”Ÿæˆ</h4><pre><code class="shell"># é…ç½®git config --global user.name &quot;åç§°&quot;git config --global user.email &quot;é‚®ç®±åœ°å€&quot;# -té‡æ–°ç”Ÿæˆssh-keygen [-t] rsa -C &quot;your_email@example.com&quot; -f gitee_id_rsa# å¦‚æœç”Ÿæˆçš„å¯†é’¥ä¸ç”Ÿæ•ˆï¼Œå°†å¯†é’¥é‡æ–°åŠ ä¸‹ï¼ssh-add ~/.ssh/qts_id_rsa# æµ‹è¯•æ˜¯å¦æˆç”Ÿæ•ˆssh -T gitee@gitee.com# æŸ¥çœ‹å·²åŠ å…¥çš„å¯†é’¥ssh-add -l# åˆ é™¤æ‰€æœ‰å·²åŠ å…¥çš„å¯†é’¥ssh-add -D</code></pre>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºåšå®¢</title>
      <link href="/2020/09/30/other/hexo/"/>
      <url>/2020/09/30/other/hexo/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è®°å½•æœ¬åšå®¢æ­å»ºæ­¥éª¤ï¼Œé€‚ç”¨äºMac/Linuxç³»ç»Ÿï¼Œè¯¦ç»†ä»‹ç»åŠå…¶ä»–ç³»ç»Ÿè¯·å‚ç…§Hexoå®˜ç½‘</p></blockquote><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://hexo.io/zh-cn/">Hexoå®˜ç½‘</a></li><li><a href="https://hexo.io/themes/">å®˜ç½‘ä¸»é¢˜</a></li><li><a href="https://github.com/yelog/hexo-theme-3-hexo">3-hexoä¸»é¢˜</a></li><li><a href="https://yelog.org/2017/03/13/3-hexo-logs/">3-hexoä¸»é¢˜ç›¸å…³æ–‡æ¡£</a></li></ul><h3 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ"></a>å‡†å¤‡ç¯å¢ƒ</h3><blockquote><p>macç”¨æˆ·æ¨èå…ˆå®‰è£…Homebrewï¼Œé€šè¿‡Homebrewå®‰è£…ä¸€ä¸‹è½¯ä»¶</p></blockquote><ul><li><a href="https://brew.sh/">Homebrew</a></li><li>å®‰è£…Git</li><li>å®‰è£…Node.js</li></ul><h3 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h3><pre><code class="textmate">npm install -g hexo-cli</code></pre><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><pre><code class="shell">æ³¨: my-hexo - é¡¹ç›®å/é¡¹ç›®æ–‡ä»¶å¤¹åhexo init my-hexocd my-hexonpm install</code></pre><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><ul><li><p>ç›®å½•</p><pre><code class="textmate">.â”œâ”€â”€ _config.ymlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffoldsâ”œâ”€â”€ source|   â”œâ”€â”€ _drafts|   â””â”€â”€ _postsâ””â”€â”€ themes</code></pre></li><li><p>ç›®å½•ä»‹ç»</p></li></ul><pre><code class="textmate">1._config.ymlç½‘ç«™çš„ é…ç½® ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°2.package.jsonåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚3.scaffoldsæ¨¡ç‰ˆ æ–‡ä»¶å¤¹ã€‚å½“æ‚¨æ–°å»ºæ–‡ç« æ—¶ï¼ŒHexo ä¼šæ ¹æ® scaffold æ¥å»ºç«‹æ–‡ä»¶ã€‚4.sourceèµ„æºæ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ç”¨æˆ·èµ„æºçš„åœ°æ–¹ã€‚é™¤ _posts æ–‡ä»¶å¤¹ä¹‹å¤–ï¼Œå¼€å¤´å‘½åä¸º _ (ä¸‹åˆ’çº¿)çš„æ–‡ä»¶ / æ–‡ä»¶å¤¹å’Œéšè—çš„æ–‡ä»¶å°†ä¼šè¢«å¿½ç•¥ã€‚Markdown å’Œ HTML æ–‡ä»¶ä¼šè¢«è§£æå¹¶æ”¾åˆ° public æ–‡ä»¶å¤¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶ä¼šè¢«æ‹·è´è¿‡å»ã€‚5.themesä¸»é¢˜ æ–‡ä»¶å¤¹ã€‚Hexo ä¼šæ ¹æ®ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚</code></pre><h3 id="é…ç½®ä¸»é¢˜"><a href="#é…ç½®ä¸»é¢˜" class="headerlink" title="é…ç½®ä¸»é¢˜"></a>é…ç½®ä¸»é¢˜</h3><ul><li><a href="https://hexo.io/themes/">å®˜ç½‘ä¸»é¢˜</a></li><li>æœ¬åšå®¢ä½¿ç”¨çš„ä¸»é¢˜ <a href="https://github.com/yelog/hexo-theme-3-hexo">3-hexo</a></li></ul><pre><code class="textmate">1.é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ(ä¸‹è½½å…¶ä»–ä¸»é¢˜ï¼Œä¿®æ”¹ä¸ºthemes/xxxå³å¯)git clone https://github.com/yelog/hexo-theme-3-hexo.git themes/3-hexo2.ä¿®æ”¹é…ç½®ä¿®æ”¹hexoæ ¹ç›®å½•çš„_config.ymlï¼Œtheme: 3-hexo3.ä¸»é¢˜æ›´æ–°cd themes/3-hexogit pullåœ¨æ­¤æ„Ÿè°¢æä¾›ä¸»é¢˜çš„ä½œè€…</code></pre><h3 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h3><ul><li>å¸¸ç”¨æ–‡æ¡£å‘½ä»¤</li></ul><pre><code class="textmate">1.æ–°å»ºæ–‡æ¡£hexo new [layout] &lt;title&gt;2.æ–°å»ºè‰ç¨¿æ–‡æ¡£hexo new [layout] &lt;title&gt;3.è‰ç¨¿&lt;-&gt;å‘å¸ƒhexo publish [layout] &lt;title&gt;</code></pre><ul><li><p>å‚æ•°ä»‹ç»</p><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>ä½œç”¨</th><th>ç”Ÿæˆæ–‡ä»¶çš„è·¯å¾„</th></tr></thead><tbody><tr><td>layout</td><td>post</td><td>æ­£å¼å‘è¡¨çš„æ–‡ç« </td><td>source/_posts</td></tr><tr><td>layout</td><td>page</td><td>é™æ€é¡µé¢</td><td>source</td></tr><tr><td>layout</td><td>draft</td><td>è‰ç¨¿</td><td>source/_drafts</td></tr><tr><td>title</td><td>-</td><td>æ–‡ç« æ ‡é¢˜&amp;æ–‡ä»¶å</td><td>-</td></tr></tbody></table></li><li><p>æ–‡æ¡£å¤´éƒ¨ä¿¡æ¯æ ¼å¼</p></li></ul><pre><code class="textmate">---title: Javadate: 2020-09-30 14:51:20tags: - Javacategories: - Java- ç¬”è®°---</code></pre><ul><li>æ–‡æ¡£å¤´éƒ¨ä¿¡æ¯è§£é‡Š</li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>title</td><td>ç½‘ç«™æ ‡é¢˜</td></tr><tr><td>subtitle</td><td>ç½‘ç«™å‰¯æ ‡é¢˜</td></tr><tr><td>description</td><td>ç½‘ç«™æè¿°</td></tr><tr><td>tags</td><td>æ ‡ç­¾ï¼Œå¯å¤šä¸ª</td></tr><tr><td>categories</td><td>åˆ†ç±»èœå•ï¼Œå¯å®šä¹‰å¤šçº§</td></tr><tr><td>keywords</td><td>ç½‘ç«™çš„å…³é”®è¯ã€‚æ”¯æ´å¤šä¸ªå…³é”®è¯ã€‚</td></tr><tr><td>author</td><td>æ‚¨çš„åå­—</td></tr><tr><td>language</td><td>ç½‘ç«™ä½¿ç”¨çš„è¯­è¨€ã€‚å¯¹äºç®€ä½“ä¸­æ–‡ç”¨æˆ·æ¥è¯´ï¼Œä½¿ç”¨ä¸åŒçš„ä¸»é¢˜å¯èƒ½éœ€è¦è®¾ç½®æˆä¸åŒçš„å€¼ï¼Œè¯·å‚è€ƒä½ çš„ä¸»é¢˜çš„æ–‡æ¡£è‡ªè¡Œè®¾ç½®ï¼Œå¸¸è§çš„æœ‰ zh-Hanså’Œ zh-CNã€‚</td></tr><tr><td>timezone</td><td>ç½‘ç«™æ—¶åŒºã€‚Hexo é»˜è®¤ä½¿ç”¨æ‚¨ç”µè„‘çš„æ—¶åŒºã€‚è¯·å‚è€ƒ æ—¶åŒºåˆ—è¡¨ è¿›è¡Œè®¾ç½®ï¼Œå¦‚ America/New_York, Japan, å’Œ UTC ã€‚ä¸€èˆ¬çš„ï¼Œå¯¹äºä¸­å›½å¤§é™†åœ°åŒºå¯ä»¥ä½¿ç”¨ Asia/Shanghaiã€‚</td></tr></tbody></table><h3 id="è¿è¡Œ-amp-å‘å¸ƒ"><a href="#è¿è¡Œ-amp-å‘å¸ƒ" class="headerlink" title="è¿è¡Œ&amp;å‘å¸ƒ"></a>è¿è¡Œ&amp;å‘å¸ƒ</h3><ul><li>æœ¬åœ°è¿è¡Œ<pre><code class="textmate">npm run server</code></pre></li><li>ç¼–è¯‘&amp;éƒ¨ç½²<pre><code class="textmate">hexo clean hexo generateç¼–è¯‘åä¼šç”Ÿæˆpublicæ–‡ä»¶å¤¹ï¼Œéƒ¨ç½²gitpageå¯ä»¥ç›´æ¥æŒ‡å®špublicä¸ºèµ„æºæ–‡ä»¶å¤¹å³å¯</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
